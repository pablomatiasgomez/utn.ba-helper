/**
 * Skipped minification because the original files appears to be already minified.
 * Original file: /npm/@embrace-io/web-sdk@2.8.0/dist/embrace-web-sdk.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var EmbraceWebSdk=(()=>{var t=Object.defineProperty,e=Object.defineProperties,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertyNames,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,u=Math.pow,c=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,l=(t,e)=>{for(var r in e||(e={}))o.call(e,r)&&c(t,r,e[r]);if(i)for(var r of i(e))a.call(e,r)&&c(t,r,e[r]);return t},h=(t,r)=>e(t,n(r)),d=t=>"symbol"==typeof t?t:t+"",g=(t,e)=>{var r={};for(var n in t)o.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&i)for(var n of i(t))e.indexOf(n)<0&&a.call(t,n)&&(r[n]=t[n]);return r},p=(t,e,r)=>c(t,"symbol"!=typeof e?e+"":e,r),m=(t,e,r)=>new Promise((n,s)=>{var i=t=>{try{a(r.next(t))}catch(t){s(t)}},o=t=>{try{a(r.throw(t))}catch(t){s(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(i,o);a((r=r.apply(t,e)).next())}),_={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(_,{DiagLogLevel:()=>L,getNavigationInstrumentation:()=>Ci,initSDK:()=>xu,log:()=>oe,page:()=>le,session:()=>pe,trace:()=>Se,user:()=>Ee});var f="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},b="1.9.0",S=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var v=function(t){var e=new Set([t]),r=new Set,n=t.match(S);if(!n)return function(){return!1};var s=+n[1],i=+n[2],o=+n[3];if(null!=n[4])return function(e){return e===t};function a(t){return r.add(t),!1}function u(t){return e.add(t),!0}return function(t){if(e.has(t))return!0;if(r.has(t))return!1;var n=t.match(S);if(!n)return a(t);var c=+n[1],l=+n[2],h=+n[3];return null!=n[4]||s!==c?a(t):0===s?i===l&&o<=h?u(t):a(t):i<=l?u(t):a(t)}}(b),y=b.split(".")[0],w=Symbol.for("opentelemetry.js.api."+y),T=f;function E(t,e,r,n){var s;void 0===n&&(n=!1);var i=T[w]=null!==(s=T[w])&&void 0!==s?s:{version:b};if(!n&&i[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return r.error(o.stack||o.message),!1}if(i.version!==b){o=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+t+" does not match previously registered API v"+b);return r.error(o.stack||o.message),!1}return i[t]=e,r.debug("@opentelemetry/api: Registered a global for "+t+" v"+b+"."),!0}function C(t){var e,r,n=null===(e=T[w])||void 0===e?void 0:e.version;if(n&&v(n))return null===(r=T[w])||void 0===r?void 0:r[t]}function x(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+b+".");var r=T[w];r&&delete r[t]}var L,A,R=function(){function t(t){this._namespace=t.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return P("debug",this._namespace,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return P("error",this._namespace,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return P("info",this._namespace,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return P("warn",this._namespace,t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return P("verbose",this._namespace,t)},t}();function P(t,e,r){var n=C("diag");if(n)return r.unshift(e),n[t].apply(n,function(t,e,r){if(r||2===arguments.length)for(var n,s=0,i=e.length;s<i;s++)!n&&s in e||(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return t.concat(n||Array.prototype.slice.call(e))}([],function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,s,i=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o}(r),!1))}(A=L||(L={}))[A.NONE=0]="NONE",A[A.ERROR=30]="ERROR",A[A.WARN=50]="WARN",A[A.INFO=60]="INFO",A[A.DEBUG=70]="DEBUG",A[A.VERBOSE=80]="VERBOSE",A[A.ALL=9999]="ALL";var M=function(){function t(){function t(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=C("diag");if(n)return n[t].apply(n,function(t,e,r){if(r||2===arguments.length)for(var n,s=0,i=e.length;s<i;s++)!n&&s in e||(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return t.concat(n||Array.prototype.slice.call(e))}([],function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,s,i=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o}(e),!1))}}var e=this;e.setLogger=function(t,r){var n,s,i;if(void 0===r&&(r={logLevel:L.INFO}),t===e){var o=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return e.error(null!==(n=o.stack)&&void 0!==n?n:o.message),!1}"number"==typeof r&&(r={logLevel:r});var a=C("diag"),u=function(t,e){function r(r,n){var s=e[r];return"function"==typeof s&&t>=n?s.bind(e):function(){}}return t<L.NONE?t=L.NONE:t>L.ALL&&(t=L.ALL),e=e||{},{error:r("error",L.ERROR),warn:r("warn",L.WARN),info:r("info",L.INFO),debug:r("debug",L.DEBUG),verbose:r("verbose",L.VERBOSE)}}(null!==(s=r.logLevel)&&void 0!==s?s:L.INFO,t);if(a&&!r.suppressOverrideMessage){var c=null!==(i=(new Error).stack)&&void 0!==i?i:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),u.warn("Current logger will overwrite one already registered from "+c)}return E("diag",u,e,!0)},e.disable=function(){x("diag",e)},e.createComponentLogger=function(t){return new R(t)},e.verbose=t("verbose"),e.debug=t("debug"),e.info=t("info"),e.warn=t("warn"),e.error=t("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),I=function(){function t(t){this._entries=t?new Map(t):new Map}return t.prototype.getEntry=function(t){var e=this._entries.get(t);if(e)return Object.assign({},e)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(t){var e=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,s,i=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o}(t,2);return[e[0],e[1]]})},t.prototype.setEntry=function(e,r){var n=new t(this._entries);return n._entries.set(e,r),n},t.prototype.removeEntry=function(e){var r=new t(this._entries);return r._entries.delete(e),r},t.prototype.removeEntries=function(){for(var e,r,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var i=new t(this._entries);try{for(var o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),a=o.next();!a.done;a=o.next()){var u=a.value;i._entries.delete(u)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return i},t.prototype.clear=function(){return new t},t}(),D=Symbol("BaggageEntryMetadata"),O=M.instance();function k(t){return void 0===t&&(t={}),new I(new Map(Object.entries(t)))}function N(t){return Symbol.for(t)}var F,U,B=new(function(){return function t(e){var r=this;r._currentContext=e?new Map(e):new Map,r.getValue=function(t){return r._currentContext.get(t)},r.setValue=function(e,n){var s=new t(r._currentContext);return s._currentContext.set(e,n),s},r.deleteValue=function(e){var n=new t(r._currentContext);return n._currentContext.delete(e),n}}}()),j=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],V=function(){return function(){function t(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(console){var n=console[t];if("function"!=typeof n&&(n=console.log),"function"==typeof n)return n.apply(console,e)}}}for(var e=0;e<j.length;e++)this[j[e].n]=t(j[e].c)}}(),$=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),z=function(){function t(){}return t.prototype.createGauge=function(t,e){return et},t.prototype.createHistogram=function(t,e){return rt},t.prototype.createCounter=function(t,e){return tt},t.prototype.createUpDownCounter=function(t,e){return nt},t.prototype.createObservableGauge=function(t,e){return it},t.prototype.createObservableCounter=function(t,e){return st},t.prototype.createObservableUpDownCounter=function(t,e){return ot},t.prototype.addBatchObservableCallback=function(t,e){},t.prototype.removeBatchObservableCallback=function(t){},t}(),H=function(){return function(){}}(),q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.add=function(t,e){},e}(H),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.add=function(t,e){},e}(H),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.record=function(t,e){},e}(H),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e.prototype.record=function(t,e){},e}(H),Q=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.removeCallback=function(t){},t}(),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e}(Q),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e}(Q),Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $(e,t),e}(Q),Z=new z,tt=new q,et=new K,rt=new W,nt=new G,st=new X,it=new J,ot=new Y,at={get:function(t,e){if(null!=t)return t[e]},keys:function(t){return null==t?[]:Object.keys(t)}},ut={set:function(t,e,r){null!=t&&(t[e]=r)}},ct=function(){function t(){}return t.prototype.active=function(){return B},t.prototype.with=function(t,e,r){for(var n=[],s=3;s<arguments.length;s++)n[s-3]=arguments[s];return e.call.apply(e,function(t,e,r){if(r||2===arguments.length)for(var n,s=0,i=e.length;s<i;s++)!n&&s in e||(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return t.concat(n||Array.prototype.slice.call(e))}([r],function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,s,i=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o}(n),!1))},t.prototype.bind=function(t,e){return e},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),lt="context",ht=new ct,dt=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(t){return E(lt,t,M.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(t,e,r){for(var n,s=[],i=3;i<arguments.length;i++)s[i-3]=arguments[i];return(n=this._getContextManager()).with.apply(n,function(t,e,r){if(r||2===arguments.length)for(var n,s=0,i=e.length;s<i;s++)!n&&s in e||(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return t.concat(n||Array.prototype.slice.call(e))}([t,e,r],function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,s,i=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o}(s),!1))},t.prototype.bind=function(t,e){return this._getContextManager().bind(t,e)},t.prototype._getContextManager=function(){return C(lt)||ht},t.prototype.disable=function(){this._getContextManager().disable(),x(lt,M.instance())},t}();(U=F||(F={}))[U.NONE=0]="NONE",U[U.SAMPLED=1]="SAMPLED";var gt="0000000000000000",pt="00000000000000000000000000000000",mt={traceId:pt,spanId:gt,traceFlags:F.NONE},_t=function(){function t(t){void 0===t&&(t=mt),this._spanContext=t}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(t,e){return this},t.prototype.setAttributes=function(t){return this},t.prototype.addEvent=function(t,e){return this},t.prototype.addLink=function(t){return this},t.prototype.addLinks=function(t){return this},t.prototype.setStatus=function(t){return this},t.prototype.updateName=function(t){return this},t.prototype.end=function(t){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(t,e){},t}(),ft=N("OpenTelemetry Context Key SPAN");function bt(t){return t.getValue(ft)||void 0}function St(){return bt(dt.getInstance().active())}function vt(t,e){return t.setValue(ft,e)}function yt(t){return t.deleteValue(ft)}function wt(t,e){return vt(t,new _t(e))}function Tt(t){var e;return null===(e=bt(t))||void 0===e?void 0:e.spanContext()}var Et=/^([0-9a-f]{32})$/i,Ct=/^[0-9a-f]{16}$/i;function xt(t){return Et.test(t)&&t!==pt}function Lt(t){return xt(t.traceId)&&(e=t.spanId,Ct.test(e)&&e!==gt);var e}function At(t){return new _t(t)}var Rt=dt.getInstance(),Pt=function(){function t(){}return t.prototype.startSpan=function(t,e,r){if(void 0===r&&(r=Rt.active()),Boolean(null==e?void 0:e.root))return new _t;var n,s=r&&Tt(r);return"object"==typeof(n=s)&&"string"==typeof n.spanId&&"string"==typeof n.traceId&&"number"==typeof n.traceFlags&&Lt(s)?new _t(s):new _t},t.prototype.startActiveSpan=function(t,e,r,n){var s,i,o;if(!(arguments.length<2)){2===arguments.length?o=e:3===arguments.length?(s=e,o=r):(s=e,i=r,o=n);var a=null!=i?i:Rt.active(),u=this.startSpan(t,s,a),c=vt(a,u);return Rt.with(c,o,void 0,u)}},t}();var Mt,It,Dt,Ot,kt,Nt,Ft=new Pt,Ut=function(){function t(t,e,r,n){this._provider=t,this.name=e,this.version=r,this.options=n}return t.prototype.startSpan=function(t,e,r){return this._getTracer().startSpan(t,e,r)},t.prototype.startActiveSpan=function(t,e,r,n){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Ft},t}(),Bt=new(function(){function t(){}return t.prototype.getTracer=function(t,e,r){return new Pt},t}()),jt=function(){function t(){}return t.prototype.getTracer=function(t,e,r){var n;return null!==(n=this.getDelegateTracer(t,e,r))&&void 0!==n?n:new Ut(this,t,e,r)},t.prototype.getDelegate=function(){var t;return null!==(t=this._delegate)&&void 0!==t?t:Bt},t.prototype.setDelegate=function(t){this._delegate=t},t.prototype.getDelegateTracer=function(t,e,r){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(t,e,r)},t}();(It=Mt||(Mt={}))[It.NOT_RECORD=0]="NOT_RECORD",It[It.RECORD=1]="RECORD",It[It.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED",(Ot=Dt||(Dt={}))[Ot.INTERNAL=0]="INTERNAL",Ot[Ot.SERVER=1]="SERVER",Ot[Ot.CLIENT=2]="CLIENT",Ot[Ot.PRODUCER=3]="PRODUCER",Ot[Ot.CONSUMER=4]="CONSUMER",(Nt=kt||(kt={}))[Nt.UNSET=0]="UNSET",Nt[Nt.OK=1]="OK",Nt[Nt.ERROR=2]="ERROR";var Vt=dt.getInstance(),$t=M.instance(),zt=new(function(){function t(){}return t.prototype.getMeter=function(t,e,r){return Z},t}()),Ht="metrics",qt=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(t){return E(Ht,t,M.instance())},t.prototype.getMeterProvider=function(){return C(Ht)||zt},t.prototype.getMeter=function(t,e,r){return this.getMeterProvider().getMeter(t,e,r)},t.prototype.disable=function(){x(Ht,M.instance())},t}().getInstance(),Gt=function(){function t(){}return t.prototype.inject=function(t,e){},t.prototype.extract=function(t,e){return t},t.prototype.fields=function(){return[]},t}(),Kt=N("OpenTelemetry Baggage Key");function Wt(t){return t.getValue(Kt)||void 0}function Qt(){return Wt(dt.getInstance().active())}function Xt(t,e){return t.setValue(Kt,e)}function Jt(t){return t.deleteValue(Kt)}var Yt="propagation",Zt=new Gt,te=function(){function t(){this.createBaggage=k,this.getBaggage=Wt,this.getActiveBaggage=Qt,this.setBaggage=Xt,this.deleteBaggage=Jt}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(t){return E(Yt,t,M.instance())},t.prototype.inject=function(t,e,r){return void 0===r&&(r=ut),this._getGlobalPropagator().inject(t,e,r)},t.prototype.extract=function(t,e,r){return void 0===r&&(r=at),this._getGlobalPropagator().extract(t,e,r)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){x(Yt,M.instance())},t.prototype._getGlobalPropagator=function(){return C(Yt)||Zt},t}().getInstance(),ee="trace",re=function(){function t(){this._proxyTracerProvider=new jt,this.wrapSpanContext=At,this.isSpanContextValid=Lt,this.deleteSpan=yt,this.getSpan=bt,this.getActiveSpan=St,this.getSpanContext=Tt,this.setSpan=vt,this.setSpanContext=wt}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(t){var e=E(ee,this._proxyTracerProvider,M.instance());return e&&this._proxyTracerProvider.setDelegate(t),e},t.prototype.getTracerProvider=function(){return C(ee)||this._proxyTracerProvider},t.prototype.getTracer=function(t,e){return this.getTracerProvider().getTracer(t,e)},t.prototype.disable=function(){x(ee,M.instance()),this._proxyTracerProvider=new jt},t}().getInstance(),ne=new class{logException(t,e){}message(t,e,r){}},se=class{constructor(){p(this,"_delegate")}getDelegate(){var t;return null!=(t=this._delegate)?t:ne}setDelegate(t){this._delegate=t}logException(t,e){this.getDelegate().logException(t,e)}message(t,e,r){this.getDelegate().message(t,e,r)}},ie=class t{constructor({proxyLogManager:t}){p(this,"_proxyLogManager"),p(this,"getLogManager",()=>this._proxyLogManager),this._proxyLogManager=t}static getInstance(){return t._instance||(t._instance=new t({proxyLogManager:new se})),t._instance}setGlobalLogManager(t){this._proxyLogManager.setDelegate(t)}logException(t,e){this.getLogManager().logException(t,e)}message(t,e,r){this.getLogManager().message(t,e,r)}};p(ie,"_instance");var oe=ie.getInstance(),ae=new class{setCurrentRoute(t){}getCurrentRoute(){return null}getCurrentPageId(){return""}clearCurrentRoute(){}},ue=class{constructor(){p(this,"_delegate")}getDelegate(){var t;return null!=(t=this._delegate)?t:ae}setDelegate(t){this._delegate=t}setCurrentRoute(t){this.getDelegate().setCurrentRoute(t)}getCurrentRoute(){return this.getDelegate().getCurrentRoute()}getCurrentPageId(){return this.getDelegate().getCurrentPageId()}clearCurrentRoute(){this.getDelegate().clearCurrentRoute()}},ce=class t{constructor({proxyPageManager:t}){p(this,"_proxyPageManager"),this._proxyPageManager=t}static getInstance(){return t._instance||(t._instance=new t({proxyPageManager:new ue})),t._instance}getPageManager(){return this._proxyPageManager}setGlobalPageManager(t){this._proxyPageManager.setDelegate(t)}setCurrentRoute(t){this.getPageManager().setCurrentRoute(t)}getCurrentRoute(){return this.getPageManager().getCurrentRoute()}getCurrentPageId(){return this.getPageManager().getCurrentPageId()}clearCurrentRoute(){this.getPageManager().clearCurrentRoute()}};p(ce,"_instance");var le=ce.getInstance(),he=new class{constructor(){p(this,"getSessionId",()=>null),p(this,"getPreviousSessionId",()=>null)}addBreadcrumb(t){}addProperty(t,e,r){}removeProperty(t){}endSessionSpan(){}endSessionSpanInternal(t){}currentSessionAsReadableSpan(t){return null}getSessionSpan(){return null}getSessionStartTime(){return null}startSessionSpan(){}addSessionStartedListener(t){return()=>{}}addSessionEndedListener(t){return()=>{}}},de=class{constructor(){p(this,"_delegate")}getDelegate(){var t;return null!=(t=this._delegate)?t:he}setDelegate(t){this._delegate=t}addBreadcrumb(t){this.getDelegate().addBreadcrumb(t)}addProperty(t,e,r){this.getDelegate().addProperty(t,e,r)}removeProperty(t){this.getDelegate().removeProperty(t)}endSessionSpan(){this.getDelegate().endSessionSpan()}endSessionSpanInternal(t){this.getDelegate().endSessionSpanInternal(t)}currentSessionAsReadableSpan(t){return this.getDelegate().currentSessionAsReadableSpan(t)}getSessionId(){return this.getDelegate().getSessionId()}getPreviousSessionId(){return this.getDelegate().getPreviousSessionId()}getSessionSpan(){return this.getDelegate().getSessionSpan()}getSessionStartTime(){return this.getDelegate().getSessionStartTime()}startSessionSpan(t){this.getDelegate().startSessionSpan(t)}addSessionStartedListener(t){return this.getDelegate().addSessionStartedListener(t)}addSessionEndedListener(t){return this.getDelegate().addSessionEndedListener(t)}},ge=class t{constructor({proxySpanSessionManager:t}){p(this,"_proxySpanSessionManager"),p(this,"getSpanSessionManager",()=>this._proxySpanSessionManager),this._proxySpanSessionManager=t}static getInstance(){return t._instance||(t._instance=new t({proxySpanSessionManager:new de})),t._instance}setGlobalSessionManager(t){this._proxySpanSessionManager.setDelegate(t)}addBreadcrumb(t){this.getSpanSessionManager().addBreadcrumb(t)}addProperty(t,e,r){this.getSpanSessionManager().addProperty(t,e,r)}removeProperty(t){this.getSpanSessionManager().removeProperty(t)}endSessionSpan(){this.getSpanSessionManager().endSessionSpan()}endSessionSpanInternal(t){this.getSpanSessionManager().endSessionSpanInternal(t)}currentSessionAsReadableSpan(t){return this.getSpanSessionManager().currentSessionAsReadableSpan(t)}getSessionId(){return this.getSpanSessionManager().getSessionId()}getPreviousSessionId(){return this.getSpanSessionManager().getPreviousSessionId()}getSessionSpan(){return this.getSpanSessionManager().getSessionSpan()}getSessionStartTime(){return this.getSpanSessionManager().getSessionStartTime()}startSessionSpan(t){this.getSpanSessionManager().startSessionSpan(t)}addSessionStartedListener(t){return this.getSpanSessionManager().addSessionStartedListener(t)}addSessionEndedListener(t){return this.getSpanSessionManager().addSessionEndedListener(t)}};p(ge,"_instance");var pe=ge.getInstance(),me=class{constructor(t=mt){p(this,"_spanContext"),p(this,"attributes",{}),this._spanContext=t}fail(t){}spanContext(){return this._spanContext}setAttribute(t,e){return this}setAttributes(t){return this}removeAttribute(t){return this}addEvent(t,e,r){return this}addLink(t){return this}addLinks(t){return this}setStatus(t){return this}updateName(t){return this}end(t){}isRecording(){return!1}recordException(t,e){}},_e=new class{startSpan(t,e){return new me}setSpan(t,e){return B}getSpan(t){}},fe=class{constructor(){p(this,"_delegate")}getDelegate(){var t;return null!=(t=this._delegate)?t:_e}setDelegate(t){this._delegate=t}startSpan(t,e,r){return this.getDelegate().startSpan(t,e,r)}setSpan(t,e){return this.getDelegate().setSpan(t,e)}getSpan(t){return this.getDelegate().getSpan(t)}},be=class t{constructor({proxyTraceManager:t}){p(this,"_proxyTraceManager"),p(this,"getTraceManager",()=>this._proxyTraceManager),this._proxyTraceManager=t}static getInstance(){return t._instance||(t._instance=new t({proxyTraceManager:new fe})),t._instance}setGlobalTraceManager(t){this._proxyTraceManager.setDelegate(t)}startSpan(t,e,r){return this.getTraceManager().startSpan(t,e,r)}setSpan(t,e){return this.getTraceManager().setSpan(t,e)}getSpan(t){return this.getTraceManager().getSpan(t)}};p(be,"_instance");var Se=be.getInstance(),ve="enduser.pseudo.id",ye=new class{getEmbraceUserId(){return""}getUserId(){return null}setUserId(){}clearUserId(){}},we=class{constructor(){p(this,"_delegate")}getDelegate(){var t;return null!=(t=this._delegate)?t:ye}setDelegate(t){this._delegate=t}getEmbraceUserId(){return this.getDelegate().getEmbraceUserId()}getUserId(){return this.getDelegate().getUserId()}setUserId(t){this.getDelegate().setUserId(t)}clearUserId(){this.getDelegate().clearUserId()}},Te=class t{constructor({proxyUserManager:t}){p(this,"_proxyUserManager"),this._proxyUserManager=t}static getInstance(){return t._instance||(t._instance=new t({proxyUserManager:new we})),t._instance}getUserManager(){return this._proxyUserManager}setGlobalUserManager(t){this._proxyUserManager.setDelegate(t)}getEmbraceUserId(){return this.getUserManager().getEmbraceUserId()}getUserId(){return this.getUserManager().getUserId()}setUserId(t){this.getUserManager().setUserId(t)}clearUserId(){this.getUserManager().clearUserId()}};p(Te,"_instance");var Ee=Te.getInstance(),Ce=N("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function xe(t){return t.setValue(Ce,!0)}function Le(t){return!0===t.getValue(Ce)}var Ae="baggage";function Re(t){const e=t.split(";");if(e.length<=0)return;const r=e.shift();if(!r)return;const n=r.indexOf("=");if(n<=0)return;const s=decodeURIComponent(r.substring(0,n).trim()),i=decodeURIComponent(r.substring(n+1).trim());let o;var a;return e.length>0&&("string"!=typeof(a=e.join(";"))&&(O.error("Cannot create baggage metadata from unknown type: "+typeof a),a=""),o={__TYPE__:D,toString:function(){return a}}),{key:s,value:i,metadata:o}}var Pe=class{inject(t,e,r){const n=te.getBaggage(t);if(!n||Le(t))return;const s=function(t){return t.getAllEntries().map(([t,e])=>{let r=`${encodeURIComponent(t)}=${encodeURIComponent(e.value)}`;return void 0!==e.metadata&&(r+=";"+e.metadata.toString()),r})}(n).filter(t=>t.length<=4096).slice(0,180),i=function(t){return t.reduce((t,e)=>{const r=`${t}${""!==t?",":""}${e}`;return r.length>8192?t:r},"")}(s);i.length>0&&r.set(e,Ae,i)}extract(t,e,r){const n=r.get(e,Ae),s=Array.isArray(n)?n.join(","):n;if(!s)return t;const i={};if(0===s.length)return t;return s.split(",").forEach(t=>{const e=Re(t);if(e){const t={value:e.value};e.metadata&&(t.metadata=e.metadata),i[e.key]=t}}),0===Object.entries(i).length?t:te.setBaggage(t,te.createBaggage(i))}fields(){return[Ae]}};function Me(t){const e={};if("object"!=typeof t||null==t)return e;for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;if(!Ie(r)){$t.warn(`Invalid attribute key: ${r}`);continue}const n=t[r];De(n)?Array.isArray(n)?e[r]=n.slice():e[r]=n:$t.warn(`Invalid attribute value set for key: ${r}`)}return e}function Ie(t){return"string"==typeof t&&""!==t}function De(t){return null==t||(Array.isArray(t)?function(t){let e;for(const r of t){if(null==r)continue;const t=typeof r;if(t!==e){if(!e){if(Oe(t)){e=t;continue}return!1}return!1}}return!0}(t):Oe(typeof t))}function Oe(t){switch(t){case"number":case"boolean":case"string":return!0}return!1}var ke=t=>{$t.error(function(t){return"string"==typeof t?t:JSON.stringify(function(t){const e={};let r=t;for(;null!==r;)Object.getOwnPropertyNames(r).forEach(t=>{if(e[t])return;const n=r[t];n&&(e[t]=String(n))}),r=Object.getPrototypeOf(r);return e}(t))}(t))};function Ne(t){try{ke(t)}catch(t){}}var Fe,Ue,Be="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},je=performance,Ve="http.method",$e="http.url",ze="http.status_code",He="error.type",qe="exception.message",Ge="exception.stacktrace",Ke="exception.type",We="http.request.method",Qe="http.request.method_original",Xe="http.response.status_code",Je="server.address",Ye="server.port",Ze="service.name",tr="telemetry.sdk.language",er="telemetry.sdk.name",rr="telemetry.sdk.version",nr="url.full",sr="user_agent.original",ir="process.runtime.name",or={[er]:"opentelemetry",[ir]:"browser",[tr]:"webjs",[rr]:"2.2.0"},ar=Math.pow(10,6),ur=Math.pow(10,9);function cr(t){const e=t/1e3;return[Math.trunc(e),Math.round(t%1e3*ar)]}function lr(){let t=je.timeOrigin;if("number"!=typeof t){const e=je;t=e.timing&&e.timing.fetchStart}return t}function hr(t){return _r(cr(lr()),cr("number"==typeof t?t:je.now()))}function dr(t){if(pr(t))return t;if("number"==typeof t)return t<lr()?hr(t):cr(t);if(t instanceof Date)return cr(t.getTime());throw TypeError("Invalid input type")}function gr(t){return t[0]*ur+t[1]}function pr(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}function mr(t){return pr(t)||"number"==typeof t||t instanceof Date}function _r(t,e){const r=[t[0]+e[0],t[1]+e[1]];return r[1]>=ur&&(r[1]-=ur,r[0]+=1),r}(Ue=Fe||(Fe={}))[Ue.SUCCESS=0]="SUCCESS",Ue[Ue.FAILED=1]="FAILED";var fr=class{constructor(t={}){var e;p(this,"_propagators"),p(this,"_fields"),this._propagators=null!=(e=t.propagators)?e:[],this._fields=Array.from(new Set(this._propagators.map(t=>"function"==typeof t.fields?t.fields():[]).reduce((t,e)=>t.concat(e),[])))}inject(t,e,r){for(const n of this._propagators)try{n.inject(t,e,r)}catch(t){$t.warn(`Failed to inject with ${n.constructor.name}. Err: ${t.message}`)}}extract(t,e,r){return this._propagators.reduce((t,n)=>{try{return n.extract(t,e,r)}catch(t){$t.warn(`Failed to extract with ${n.constructor.name}. Err: ${t.message}`)}return t},t)}fields(){return this._fields.slice()}},br="[_0-9a-z-*/]",Sr=new RegExp(`^(?:${`[a-z]${br}{0,255}`}|${`[a-z0-9]${br}{0,240}@[a-z]${br}{0,13}`})$`),vr=/^[ -~]{0,255}[!-~]$/,yr=/,|=/;var wr=class t{constructor(t){p(this,"_internalState",new Map),t&&this._parse(t)}set(t,e){const r=this._clone();return r._internalState.has(t)&&r._internalState.delete(t),r._internalState.set(t,e),r}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce((t,e)=>(t.push(e+"="+this.get(e)),t),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce((t,e)=>{const r=e.trim(),n=r.indexOf("=");if(-1!==n){const s=r.slice(0,n),i=r.slice(n+1,e.length);(function(t){return Sr.test(t)})(s)&&function(t){return vr.test(t)&&!yr.test(t)}(i)&&t.set(s,i)}return t},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const e=new t;return e._internalState=new Map(this._internalState),e}},Tr="traceparent",Er="tracestate",Cr=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var xr=class{inject(t,e,r){const n=re.getSpanContext(t);if(!n||Le(t)||!Lt(n))return;const s=`00-${n.traceId}-${n.spanId}-0${Number(n.traceFlags||F.NONE).toString(16)}`;r.set(e,Tr,s),n.traceState&&r.set(e,Er,n.traceState.serialize())}extract(t,e,r){const n=r.get(e,Tr);if(!n)return t;const s=Array.isArray(n)?n[0]:n;if("string"!=typeof s)return t;const i=function(t){const e=Cr.exec(t);return e?"00"===e[1]&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}:null}(s);if(!i)return t;i.isRemote=!0;const o=r.get(e,Er);if(o){const t=Array.isArray(o)?o.join(","):o;i.traceState=new wr("string"==typeof t?t:void 0)}return re.setSpanContext(t,i)}fields(){return[Tr,Er]}},Lr="[object Null]",Ar="[object Undefined]",Rr=Function.prototype.toString,Pr=Rr.call(Object),Mr=Object.getPrototypeOf,Ir=Object.prototype,Dr=Ir.hasOwnProperty,Or=Symbol?Symbol.toStringTag:void 0,kr=Ir.toString;function Nr(t){if(!function(t){return null!=t&&"object"==typeof t}(t)||"[object Object]"!==function(t){if(null==t)return void 0===t?Ar:Lr;return Or&&Or in Object(t)?function(t){const e=Dr.call(t,Or),r=t[Or];let n=!1;try{t[Or]=void 0,n=!0}catch(t){}const s=kr.call(t);n&&(e?t[Or]=r:delete t[Or]);return s}(t):function(t){return kr.call(t)}(t)}(t))return!1;const e=Mr(t);if(null===e)return!0;const r=Dr.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Rr.call(r)===Pr}function Fr(...t){let e=t.shift();const r=new WeakMap;for(;t.length>0;)e=Br(e,t.shift(),0,r);return e}function Ur(t){return Vr(t)?t.slice():t}function Br(t,e,r=0,n){let s;if(!(r>20)){if(r++,Hr(t)||Hr(e)||$r(e))s=Ur(e);else if(Vr(t)){if(s=t.slice(),Vr(e))for(let t=0,r=e.length;t<r;t++)s.push(Ur(e[t]));else if(zr(e)){const t=Object.keys(e);for(let r=0,n=t.length;r<n;r++){const n=t[r];s[n]=Ur(e[n])}}}else if(zr(t))if(zr(e)){if(!function(t,e){if(!Nr(t)||!Nr(e))return!1;return!0}(t,e))return e;s=Object.assign({},t);const i=Object.keys(e);for(let o=0,a=i.length;o<a;o++){const a=i[o],u=e[a];if(Hr(u))void 0===u?delete s[a]:s[a]=u;else{const i=s[a],o=u;if(jr(t,a,n)||jr(e,a,n))delete s[a];else{if(zr(i)&&zr(o)){const r=n.get(i)||[],s=n.get(o)||[];r.push({obj:t,key:a}),s.push({obj:e,key:a}),n.set(i,r),n.set(o,s)}s[a]=Br(s[a],u,r,n)}}}}else s=e;return s}}function jr(t,e,r){const n=r.get(t[e])||[];for(let r=0,s=n.length;r<s;r++){const s=n[r];if(s.key===e&&s.obj===t)return!0}return!1}function Vr(t){return Array.isArray(t)}function $r(t){return"function"==typeof t}function zr(t){return!Hr(t)&&!Vr(t)&&!$r(t)&&"object"==typeof t}function Hr(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||void 0===t||t instanceof Date||t instanceof RegExp||null===t}var qr=class t extends Error{constructor(e){super(e),Object.setPrototypeOf(this,t.prototype)}};function Gr(t,e){let r;const n=new Promise(function(t,n){r=setTimeout(function(){n(new qr("Operation timed out."))},e)});return Promise.race([t,n]).then(t=>(clearTimeout(r),t),t=>{throw clearTimeout(r),t})}function Kr(t,e){return"string"==typeof e?t===e:!!t.match(e)}function Wr(t,e){if(!e)return!1;for(const r of e)if(Kr(t,r))return!0;return!1}var Qr=class{constructor(){p(this,"_promise"),p(this,"_resolve"),p(this,"_reject"),this._promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}},Xr=class{constructor(t,e){p(this,"_callback"),p(this,"_that"),p(this,"_isCalled",!1),p(this,"_deferred",new Qr),this._callback=t,this._that=e}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then(t=>this._deferred.resolve(t),t=>this._deferred.reject(t))}catch(t){this._deferred.reject(t)}}return this._deferred.promise}};var Jr,Yr,Zr={_export:function(t,e){return new Promise(r=>{Vt.with(xe(Vt.active()),()=>{t.export(e,t=>{r(t)})})})}};(Yr=Jr||(Jr={}))[Yr.UNSPECIFIED=0]="UNSPECIFIED",Yr[Yr.TRACE=1]="TRACE",Yr[Yr.TRACE2=2]="TRACE2",Yr[Yr.TRACE3=3]="TRACE3",Yr[Yr.TRACE4=4]="TRACE4",Yr[Yr.DEBUG=5]="DEBUG",Yr[Yr.DEBUG2=6]="DEBUG2",Yr[Yr.DEBUG3=7]="DEBUG3",Yr[Yr.DEBUG4=8]="DEBUG4",Yr[Yr.INFO=9]="INFO",Yr[Yr.INFO2=10]="INFO2",Yr[Yr.INFO3=11]="INFO3",Yr[Yr.INFO4=12]="INFO4",Yr[Yr.WARN=13]="WARN",Yr[Yr.WARN2=14]="WARN2",Yr[Yr.WARN3=15]="WARN3",Yr[Yr.WARN4=16]="WARN4",Yr[Yr.ERROR=17]="ERROR",Yr[Yr.ERROR2=18]="ERROR2",Yr[Yr.ERROR3=19]="ERROR3",Yr[Yr.ERROR4=20]="ERROR4",Yr[Yr.FATAL=21]="FATAL",Yr[Yr.FATAL2=22]="FATAL2",Yr[Yr.FATAL3=23]="FATAL3",Yr[Yr.FATAL4=24]="FATAL4";var tn=class{emit(t){}},en=new tn,rn=new class{getLogger(t,e,r){return new tn}},nn=class{constructor(t,e,r,n){this._provider=t,this.name=e,this.version=r,this.options=n}emit(t){this._getLogger().emit(t)}_getLogger(){if(this._delegate)return this._delegate;const t=this._provider._getDelegateLogger(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):en}},sn=class{getLogger(t,e,r){var n;return null!==(n=this._getDelegateLogger(t,e,r))&&void 0!==n?n:new nn(this,t,e,r)}_getDelegate(){var t;return null!==(t=this._delegate)&&void 0!==t?t:rn}_setDelegate(t){this._delegate=t}_getDelegateLogger(t,e,r){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getLogger(t,e,r)}},on="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},an=Symbol.for("io.opentelemetry.js.api.logs"),un=on;var cn=class t{constructor(){this._proxyLoggerProvider=new sn}static getInstance(){return this._instance||(this._instance=new t),this._instance}setGlobalLoggerProvider(t){return un[an]?this.getLoggerProvider():(un[an]=(e=1,r=t,n=rn,t=>t===e?r:n),this._proxyLoggerProvider._setDelegate(t),t);var e,r,n}getLoggerProvider(){var t,e;return null!==(e=null===(t=un[an])||void 0===t?void 0:t.call(un,1))&&void 0!==e?e:this._proxyLoggerProvider}getLogger(t,e,r){return this.getLoggerProvider().getLogger(t,e,r)}disable(){delete un[an],this._proxyLoggerProvider=new sn}}.getInstance();function ln(t){var e,r;const n=t.tracerProvider||re.getTracerProvider(),s=t.meterProvider||qt.getMeterProvider(),i=t.loggerProvider||cn.getLoggerProvider(),o=null!=(r=null==(e=t.instrumentations)?void 0:e.flat())?r:[];return function(t,e,r,n){for(let s=0,i=t.length;s<i;s++){const i=t[s];e&&i.setTracerProvider(e),r&&i.setMeterProvider(r),n&&i.setLoggerProvider&&i.setLoggerProvider(n),i.getConfig().enabled||i.enable()}}(o,n,s,i),()=>{!function(t){t.forEach(t=>t.disable())}(o)}}var hn=console.error.bind(console);function dn(t,e,r){const n=!!t[e]&&Object.prototype.propertyIsEnumerable.call(t,e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}var gn=(t,e,r)=>{if(!t||!t[e])return void hn("no original function "+String(e)+" to wrap");if(!r)return hn("no wrapper function"),void hn((new Error).stack);const n=t[e];if("function"!=typeof n||"function"!=typeof r)return void hn("original object and wrapper must be functions");const s=r(n,e);return dn(s,"__original",n),dn(s,"__unwrap",()=>{t[e]===s&&dn(t,e,n)}),dn(s,"__wrapped",!0),dn(t,e,s),s},pn=(t,e,r)=>{if(!t)return hn("must provide one or more modules to patch"),void hn((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach(t=>{e.forEach(e=>{gn(t,e,r)})}):hn("must provide one or more functions to wrap on modules")},mn=(t,e)=>{if(!t||!t[e])return hn("no function to unwrap."),void hn((new Error).stack);const r=t[e];r.__unwrap?r.__unwrap():hn("no original to unwrap to -- has "+String(e)+" already been unwrapped?")},_n=(t,e)=>{if(!t)return hn("must provide one or more modules to patch"),void hn((new Error).stack);Array.isArray(t)||(t=[t]),e&&Array.isArray(e)?t.forEach(t=>{e.forEach(e=>{mn(t,e)})}):hn("must provide one or more functions to unwrap on modules")};function fn(t){t&&t.logger&&("function"!=typeof t.logger?hn("new logger isn't a function, not replacing"):hn=t.logger)}fn.wrap=gn,fn.massWrap=pn,fn.unwrap=mn,fn.massUnwrap=_n;var bn,Sn,vn=class{constructor(t,e,r){p(this,"instrumentationName"),p(this,"instrumentationVersion"),p(this,"_config",{}),p(this,"_tracer"),p(this,"_meter"),p(this,"_logger"),p(this,"_diag"),p(this,"_wrap",gn),p(this,"_unwrap",mn),p(this,"_massWrap",pn),p(this,"_massUnwrap",_n),this.instrumentationName=t,this.instrumentationVersion=e,this.setConfig(r),this._diag=$t.createComponentLogger({namespace:t}),this._tracer=re.getTracer(t,e),this._meter=qt.getMeter(t,e),this._logger=cn.getLogger(t,e),this._updateMetricInstruments()}get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){var t;const e=null!=(t=this.init())?t:[];return Array.isArray(e)?e:[e]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t){this._config=l({enabled:!0},t)}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(t,e,r,n){if(t)try{t(r,n)}catch(t){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:e},t)}}},yn=class extends vn{constructor(t,e,r){super(t,e,r),this._config.enabled&&this.enable()}};function wn(t,e,r){let n,s;try{s=t()}catch(t){n=t}finally{if(e(n,s),n&&!r)throw n;return s}}function Tn(t){return"function"==typeof t&&"function"==typeof t.__original&&"function"==typeof t.__unwrap&&!0===t.__wrapped}function En(t,e){let r=bn.OLD;const n=null==e?void 0:e.split(",").map(t=>t.trim()).filter(t=>""!==t);for(const e of null!=n?n:[]){if(e.toLowerCase()===t+"/dup"){r=bn.DUPLICATE;break}e.toLowerCase()===t&&(r=bn.STABLE)}return r}(Sn=bn||(bn={}))[Sn.STABLE=1]="STABLE",Sn[Sn.OLD=2]="OLD",Sn[Sn.DUPLICATE=3]="DUPLICATE";var Cn=t=>null!==t&&"object"==typeof t&&"function"==typeof t.then,xn=class t{constructor(t,e){var r;p(this,"_rawAttributes"),p(this,"_asyncAttributesPending",!1),p(this,"_schemaUrl"),p(this,"_memoizedAttributes");const n=null!=(r=t.attributes)?r:{};this._rawAttributes=Object.entries(n).map(([t,e])=>(Cn(e)&&(this._asyncAttributesPending=!0),[t,e])),this._rawAttributes=Pn(this._rawAttributes),this._schemaUrl=function(t){if("string"==typeof t||void 0===t)return t;return void $t.warn("Schema URL must be string or undefined, got %s. Schema URL will be ignored.",t)}(null==e?void 0:e.schemaUrl)}static FromAttributeList(e,r){const n=new t({},r);return n._rawAttributes=Pn(e),n._asyncAttributesPending=e.filter(([t,e])=>Cn(e)).length>0,n}get asyncAttributesPending(){return this._asyncAttributesPending}waitForAsyncAttributes(){return m(this,null,function*(){if(this.asyncAttributesPending){for(let t=0;t<this._rawAttributes.length;t++){const[e,r]=this._rawAttributes[t];this._rawAttributes[t]=[e,Cn(r)?yield r:r]}this._asyncAttributesPending=!1}})}get attributes(){if(this.asyncAttributesPending&&$t.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const t={};for(const[e,r]of this._rawAttributes)Cn(r)?$t.debug(`Unsettled resource attribute ${e} skipped`):null!=r&&(null!=t[e]||(t[e]=r));return this._asyncAttributesPending||(this._memoizedAttributes=t),t}getRawAttributes(){return this._rawAttributes}get schemaUrl(){return this._schemaUrl}merge(e){if(null==e)return this;const r=function(t,e){const r=null==t?void 0:t.schemaUrl,n=null==e?void 0:e.schemaUrl,s=void 0===n||""===n;if(void 0===r||""===r)return n;if(s)return r;if(r===n)return r;return void $t.warn('Schema URL merge conflict: old resource has "%s", updating resource has "%s". Resulting resource will have undefined Schema URL.',r,n)}(this,e),n=r?{schemaUrl:r}:void 0;return t.FromAttributeList([...e.getRawAttributes(),...this.getRawAttributes()],n)}};function Ln(t,e){return xn.FromAttributeList(Object.entries(t),e)}function An(){return Ln({})}function Rn(){return Ln({[Ze]:"unknown_service",[tr]:or[tr],[er]:or[er],[rr]:or[rr]})}function Pn(t){return t.map(([t,e])=>Cn(e)?[t,e.catch(e=>{$t.debug("promise rejection for resource attribute: %s - %s",t,e)})]:[t,e])}var Mn,In=class{constructor(t){var e;p(this,"_spanContext"),p(this,"kind"),p(this,"parentSpanContext"),p(this,"attributes",{}),p(this,"links",[]),p(this,"events",[]),p(this,"startTime"),p(this,"resource"),p(this,"instrumentationScope"),p(this,"_droppedAttributesCount",0),p(this,"_droppedEventsCount",0),p(this,"_droppedLinksCount",0),p(this,"name"),p(this,"status",{code:kt.UNSET}),p(this,"endTime",[0,0]),p(this,"_ended",!1),p(this,"_duration",[-1,-1]),p(this,"_spanProcessor"),p(this,"_spanLimits"),p(this,"_attributeValueLengthLimit"),p(this,"_performanceStartTime"),p(this,"_performanceOffset"),p(this,"_startTimeProvided");const r=Date.now();this._spanContext=t.spanContext,this._performanceStartTime=je.now(),this._performanceOffset=r-(this._performanceStartTime+lr()),this._startTimeProvided=null!=t.startTime,this._spanLimits=t.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=t.spanProcessor,this.name=t.name,this.parentSpanContext=t.parentSpanContext,this.kind=t.kind,this.links=t.links||[],this.startTime=this._getTime(null!=(e=t.startTime)?e:r),this.resource=t.resource,this.instrumentationScope=t.scope,null!=t.attributes&&this.setAttributes(t.attributes),this._spanProcessor.onStart(this,t.context)}spanContext(){return this._spanContext}setAttribute(t,e){if(null==e||this._isSpanEnded())return this;if(0===t.length)return $t.warn(`Invalid attribute key: ${t}`),this;if(!De(e))return $t.warn(`Invalid attribute value set for key: ${t}`),this;const{attributeCountLimit:r}=this._spanLimits;return void 0!==r&&Object.keys(this.attributes).length>=r&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(e),this)}setAttributes(t){for(const[e,r]of Object.entries(t))this.setAttribute(e,r);return this}addEvent(t,e,r){if(this._isSpanEnded())return this;const{eventCountLimit:n}=this._spanLimits;if(0===n)return $t.warn("No events allowed."),this._droppedEventsCount++,this;void 0!==n&&this.events.length>=n&&(0===this._droppedEventsCount&&$t.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),mr(e)&&(mr(r)||(r=e),e=void 0);const s=Me(e);return this.events.push({name:t,attributes:s,time:this._getTime(r),droppedAttributesCount:0}),this}addLink(t){return this.links.push(t),this}addLinks(t){return this.links.push(...t),this}setStatus(t){return this._isSpanEnded()||(this.status=l({},t),null!=this.status.message&&"string"!=typeof t.message&&($t.warn(`Dropping invalid status.message of type '${typeof t.message}', expected 'string'`),delete this.status.message)),this}updateName(t){return this._isSpanEnded()||(this.name=t),this}end(t){this._isSpanEnded()?$t.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(t),this._duration=function(t,e){let r=e[0]-t[0],n=e[1]-t[1];return n<0&&(r-=1,n+=ur),[r,n]}(this.startTime,this.endTime),this._duration[0]<0&&($t.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&$t.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this))}_getTime(t){if("number"==typeof t&&t<=je.now())return hr(t+this._performanceOffset);if("number"==typeof t)return cr(t);if(t instanceof Date)return cr(t.getTime());if(pr(t))return t;if(this._startTimeProvided)return cr(Date.now());const e=je.now()-this._performanceStartTime;return _r(this.startTime,cr(e))}isRecording(){return!1===this._ended}recordException(t,e){const r={};"string"==typeof t?r[qe]=t:t&&(t.code?r[Ke]=t.code.toString():t.name&&(r[Ke]=t.name),t.message&&(r[qe]=t.message),t.stack&&(r[Ge]=t.stack)),r[Ke]||r[qe]?this.addEvent("exception",r,e):$t.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const t=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);$t.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,t)}return this._ended}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substring(0,e)}_truncateToSize(t){const e=this._attributeValueLengthLimit;return e<=0?($t.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map(t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t):t}};!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Mn||(Mn={}));var Dn,On,kn=class{shouldSample(){return{decision:Mn.NOT_RECORD}}toString(){return"AlwaysOffSampler"}},Nn=class{shouldSample(){return{decision:Mn.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}},Fn=class{constructor(t){var e,r,n,s;p(this,"_root"),p(this,"_remoteParentSampled"),p(this,"_remoteParentNotSampled"),p(this,"_localParentSampled"),p(this,"_localParentNotSampled"),this._root=t.root,this._root||(Ne(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Nn),this._remoteParentSampled=null!=(e=t.remoteParentSampled)?e:new Nn,this._remoteParentNotSampled=null!=(r=t.remoteParentNotSampled)?r:new kn,this._localParentSampled=null!=(n=t.localParentSampled)?n:new Nn,this._localParentNotSampled=null!=(s=t.localParentNotSampled)?s:new kn}shouldSample(t,e,r,n,s,i){const o=re.getSpanContext(t);return o&&Lt(o)?o.isRemote?o.traceFlags&F.SAMPLED?this._remoteParentSampled.shouldSample(t,e,r,n,s,i):this._remoteParentNotSampled.shouldSample(t,e,r,n,s,i):o.traceFlags&F.SAMPLED?this._localParentSampled.shouldSample(t,e,r,n,s,i):this._localParentNotSampled.shouldSample(t,e,r,n,s,i):this._root.shouldSample(t,e,r,n,s,i)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}},Un=class{constructor(t=0){p(this,"_ratio"),p(this,"_upperBound"),this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(4294967295*this._ratio)}shouldSample(t,e){return{decision:xt(e)&&this._accumulate(e)<this._upperBound?Mn.RECORD_AND_SAMPLED:Mn.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return"number"!=typeof t||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let e=0;for(let r=0;r<t.length/8;r++){const n=8*r;e=(e^parseInt(t.slice(n,n+8),16))>>>0}return e}};(On=Dn||(Dn={})).AlwaysOff="always_off",On.AlwaysOn="always_on",On.ParentBasedAlwaysOff="parentbased_always_off",On.ParentBasedAlwaysOn="parentbased_always_on",On.ParentBasedTraceIdRatio="parentbased_traceidratio",On.TraceIdRatio="traceidratio";function Bn(){return{sampler:jn(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:null!=void 0?undefined:1/0,attributeCountLimit:null!=void 0?undefined:128},spanLimits:{attributeValueLengthLimit:null!=void 0?undefined:1/0,attributeCountLimit:null!=void 0?undefined:128,linkCountLimit:null!=void 0?undefined:128,eventCountLimit:null!=void 0?undefined:128,attributePerEventCountLimit:null!=void 0?undefined:128,attributePerLinkCountLimit:null!=void 0?undefined:128}}}function jn(){const t=null!=void 0?undefined:Dn.ParentBasedAlwaysOn;switch(t){case Dn.AlwaysOn:return new Nn;case Dn.AlwaysOff:return new kn;case Dn.ParentBasedAlwaysOn:return new Fn({root:new Nn});case Dn.ParentBasedAlwaysOff:return new Fn({root:new kn});case Dn.TraceIdRatio:return new Un(Vn());case Dn.ParentBasedTraceIdRatio:return new Fn({root:new Un(Vn())});default:return $t.error(`OTEL_TRACES_SAMPLER value "${t}" invalid, defaulting to "${Dn.ParentBasedAlwaysOn}".`),new Fn({root:new Nn})}}function Vn(){return $t.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1}var $n=1/0;var zn=class{constructor(t,e){p(this,"_exporter"),p(this,"_maxExportBatchSize"),p(this,"_maxQueueSize"),p(this,"_scheduledDelayMillis"),p(this,"_exportTimeoutMillis"),p(this,"_isExporting",!1),p(this,"_finishedSpans",[]),p(this,"_timer"),p(this,"_shutdownOnce"),p(this,"_droppedSpansCount",0),this._exporter=t,this._maxExportBatchSize="number"==typeof(null==e?void 0:e.maxExportBatchSize)?e.maxExportBatchSize:null!=void 0?undefined:512,this._maxQueueSize="number"==typeof(null==e?void 0:e.maxQueueSize)?e.maxQueueSize:null!=void 0?undefined:2048,this._scheduledDelayMillis="number"==typeof(null==e?void 0:e.scheduledDelayMillis)?e.scheduledDelayMillis:null!=void 0?undefined:5e3,this._exportTimeoutMillis="number"==typeof(null==e?void 0:e.exportTimeoutMillis)?e.exportTimeoutMillis:null!=void 0?undefined:3e4,this._shutdownOnce=new Xr(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&($t.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(t,e){}onEnd(t){this._shutdownOnce.isCalled||0!==(t.spanContext().traceFlags&F.SAMPLED)&&this._addToBuffer(t)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then(()=>this.onShutdown()).then(()=>this._flushAll()).then(()=>this._exporter.shutdown())}_addToBuffer(t){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&$t.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&($t.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(t),this._maybeStartTimer()}_flushAll(){return new Promise((t,e)=>{const r=[];for(let t=0,e=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);t<e;t++)r.push(this._flushOneBatch());Promise.all(r).then(()=>{t()}).catch(e)})}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((t,e)=>{const r=setTimeout(()=>{e(new Error("Timeout"))},this._exportTimeoutMillis);Vt.with(xe(Vt.active()),()=>{let n;this._finishedSpans.length<=this._maxExportBatchSize?(n=this._finishedSpans,this._finishedSpans=[]):n=this._finishedSpans.splice(0,this._maxExportBatchSize);const s=()=>this._exporter.export(n,n=>{var s;clearTimeout(r),n.code===Fe.SUCCESS?t():e(null!=(s=n.error)?s:new Error("BatchSpanProcessor: span export failed"))});let i=null;for(let t=0,e=n.length;t<e;t++){const e=n[t];e.resource.asyncAttributesPending&&e.resource.waitForAsyncAttributes&&(null!=i||(i=[]),i.push(e.resource.waitForAsyncAttributes()))}null===i?s():Promise.all(i).then(s,t=>{Ne(t),e(t)})})})}_maybeStartTimer(){if(this._isExporting)return;const t=()=>{this._isExporting=!0,this._flushOneBatch().finally(()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(t=>{this._isExporting=!1,Ne(t)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout(()=>t(),this._scheduledDelayMillis),"number"!=typeof this._timer&&this._timer.unref())}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}},Hn=class extends zn{constructor(t,e){super(t,e),p(this,"_visibilityChangeListener"),p(this,"_pageHideListener"),this.onInit(e)}onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush().catch(t=>{Ne(t)})},this._pageHideListener=()=>{this.forceFlush().catch(t=>{Ne(t)})},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}},qn=class{constructor(){p(this,"generateTraceId",Kn(16)),p(this,"generateSpanId",Kn(8))}},Gn=Array(32);function Kn(t){return function(){for(let e=0;e<2*t;e++)Gn[e]=Math.floor(16*Math.random())+48,Gn[e]>=58&&(Gn[e]+=39);return String.fromCharCode.apply(null,Gn.slice(0,2*t))}}var Wn,Qn,Xn=class{constructor(t,e,r,n){p(this,"_sampler"),p(this,"_generalLimits"),p(this,"_spanLimits"),p(this,"_idGenerator"),p(this,"instrumentationScope"),p(this,"_resource"),p(this,"_spanProcessor");const s=function(t){const e={sampler:jn()},r=Bn(),n=Object.assign({},r,e,t);return n.generalLimits=Object.assign({},r.generalLimits,t.generalLimits||{}),n.spanLimits=Object.assign({},r.spanLimits,t.spanLimits||{}),n}(e);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=e.idGenerator||new qn,this._resource=r,this._spanProcessor=n,this.instrumentationScope=t}startSpan(t,e={},r=Vt.active()){var n,s,i;e.root&&(r=re.deleteSpan(r));const o=re.getSpan(r);if(Le(r)){$t.debug("Instrumentation suppressed, returning Noop Span");return re.wrapSpanContext(mt)}const a=null==o?void 0:o.spanContext(),u=this._idGenerator.generateSpanId();let c,l,h;a&&re.isSpanContextValid(a)?(l=a.traceId,h=a.traceState,c=a):l=this._idGenerator.generateTraceId();const d=null!=(n=e.kind)?n:Dt.INTERNAL,g=(null!=(s=e.links)?s:[]).map(t=>({context:t.context,attributes:Me(t.attributes)})),p=Me(e.attributes),m=this._sampler.shouldSample(r,l,t,d,p,g);h=null!=(i=m.traceState)?i:h;const _={traceId:l,spanId:u,traceFlags:m.decision===Mt.RECORD_AND_SAMPLED?F.SAMPLED:F.NONE,traceState:h};if(m.decision===Mt.NOT_RECORD){$t.debug("Recording is off, propagating context in a non-recording span");return re.wrapSpanContext(_)}const f=Me(Object.assign(p,m.attributes));return new In({resource:this._resource,scope:this.instrumentationScope,context:r,spanContext:_,name:t,kind:d,links:g,parentSpanContext:c,attributes:f,startTime:e.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(t,e,r,n){let s,i,o;if(arguments.length<2)return;2===arguments.length?o=e:3===arguments.length?(s=e,o=r):(s=e,i=r,o=n);const a=null!=i?i:Vt.active(),u=this.startSpan(t,s,a),c=re.setSpan(a,u);return Vt.with(c,o,void 0,u)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}},Jn=class{constructor(t){p(this,"_spanProcessors"),this._spanProcessors=t}forceFlush(){const t=[];for(const e of this._spanProcessors)t.push(e.forceFlush());return new Promise(e=>{Promise.all(t).then(()=>{e()}).catch(t=>{Ne(t||new Error("MultiSpanProcessor: forceFlush failed")),e()})})}onStart(t,e){for(const r of this._spanProcessors)r.onStart(t,e)}onEnd(t){for(const e of this._spanProcessors)e.onEnd(t)}shutdown(){const t=[];for(const e of this._spanProcessors)t.push(e.shutdown());return new Promise((e,r)=>{Promise.all(t).then(()=>{e()},r)})}};(Qn=Wn||(Wn={}))[Qn.resolved=0]="resolved",Qn[Qn.timeout=1]="timeout",Qn[Qn.error=2]="error",Qn[Qn.unresolved=3]="unresolved";var Yn=class{constructor(t={}){var e,r;p(this,"_config"),p(this,"_tracers",new Map),p(this,"_resource"),p(this,"_activeSpanProcessor");const n=Fr({},Bn(),function(t){var e,r,n,s,i,o,a,u,c,l,h,d;const g=Object.assign({},t.spanLimits);return g.attributeCountLimit=null!=(o=null!=(i=null!=(s=null!=(n=null==(e=t.spanLimits)?void 0:e.attributeCountLimit)?n:null==(r=t.generalLimits)?void 0:r.attributeCountLimit)?s:void 0)?i:void 0)?o:128,g.attributeValueLengthLimit=null!=(d=null!=(h=null!=(l=null!=(c=null==(a=t.spanLimits)?void 0:a.attributeValueLengthLimit)?c:null==(u=t.generalLimits)?void 0:u.attributeValueLengthLimit)?l:void 0)?h:void 0)?d:$n,Object.assign({},t,{spanLimits:g})}(t));this._resource=null!=(e=n.resource)?e:Rn(),this._config=Object.assign({},n,{resource:this._resource});const s=[];(null==(r=t.spanProcessors)?void 0:r.length)&&s.push(...t.spanProcessors),this._activeSpanProcessor=new Jn(s)}getTracer(t,e,r){const n=`${t}@${e||""}:${(null==r?void 0:r.schemaUrl)||""}`;return this._tracers.has(n)||this._tracers.set(n,new Xn({name:t,version:e,schemaUrl:null==r?void 0:r.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(n)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,e=this._activeSpanProcessor._spanProcessors.map(e=>new Promise(r=>{let n;const s=setTimeout(()=>{r(new Error(`Span processor did not completed within timeout period of ${t} ms`)),n=Wn.timeout},t);e.forceFlush().then(()=>{clearTimeout(s),n!==Wn.timeout&&(n=Wn.resolved,r(n))}).catch(t=>{clearTimeout(s),n=Wn.error,r(t)})}));return new Promise((t,r)=>{Promise.all(e).then(e=>{const n=e.filter(t=>t!==Wn.resolved);n.length>0?r(n):t()}).catch(t=>r([t]))})}shutdown(){return this._activeSpanProcessor.shutdown()}},Zn=class{constructor(){p(this,"_enabled",!1),p(this,"_currentContext",B)}_bindFunction(t=B,e){const r=this,n=function(...n){return r.with(t,()=>e.apply(this,n))};return Object.defineProperty(n,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),n}active(){return this._currentContext}bind(t,e){return void 0===t&&(t=this.active()),"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._currentContext=B,this._enabled=!1,this}enable(){return this._enabled||(this._enabled=!0,this._currentContext=B),this}with(t,e,r,...n){const s=this._currentContext;this._currentContext=t||B;try{return e.call(r,...n)}finally{this._currentContext=s}}};var ts,es,rs=class extends Yn{constructor(t={}){super(t)}register(t={}){var e;re.setGlobalTracerProvider(this),null!==(e=t.propagator)&&(void 0!==e?te.setGlobalPropagator(e):te.setGlobalPropagator(new fr({propagators:[new xr,new Pe]}))),function(t){if(null!==t){if(void 0===t){const t=new Zn;return t.enable(),void Vt.setGlobalContextManager(t)}t.enable(),Vt.setGlobalContextManager(t)}}(t.contextManager)}};(es=ts||(ts={})).CONNECT_END="connectEnd",es.CONNECT_START="connectStart",es.DECODED_BODY_SIZE="decodedBodySize",es.DOM_COMPLETE="domComplete",es.DOM_CONTENT_LOADED_EVENT_END="domContentLoadedEventEnd",es.DOM_CONTENT_LOADED_EVENT_START="domContentLoadedEventStart",es.DOM_INTERACTIVE="domInteractive",es.DOMAIN_LOOKUP_END="domainLookupEnd",es.DOMAIN_LOOKUP_START="domainLookupStart",es.ENCODED_BODY_SIZE="encodedBodySize",es.FETCH_START="fetchStart",es.LOAD_EVENT_END="loadEventEnd",es.LOAD_EVENT_START="loadEventStart",es.NAVIGATION_START="navigationStart",es.REDIRECT_END="redirectEnd",es.REDIRECT_START="redirectStart",es.REQUEST_START="requestStart",es.RESPONSE_END="responseEnd",es.RESPONSE_START="responseStart",es.SECURE_CONNECTION_START="secureConnectionStart",es.START_TIME="startTime",es.UNLOAD_EVENT_END="unloadEventEnd",es.UNLOAD_EVENT_START="unloadEventStart";var ns;function ss(t,e){return e in t}function is(t,e,r,n=!0){if(ss(r,e)&&"number"==typeof r[e]&&(!n||0!==r[e]))return t.addEvent(e,r[e])}function os(t,e,r=!1,n,s){if(void 0===n&&(n=0!==e[ts.START_TIME]),r||(is(t,ts.FETCH_START,e,n),is(t,ts.DOMAIN_LOOKUP_START,e,n),is(t,ts.DOMAIN_LOOKUP_END,e,n),is(t,ts.CONNECT_START,e,n),is(t,ts.SECURE_CONNECTION_START,e,n),is(t,ts.CONNECT_END,e,n),is(t,ts.REQUEST_START,e,n),is(t,ts.RESPONSE_START,e,n),is(t,ts.RESPONSE_END,e,n)),!s){const r=e[ts.ENCODED_BODY_SIZE];void 0!==r&&t.setAttribute("http.response_content_length",r);const n=e[ts.DECODED_BODY_SIZE];void 0!==n&&r!==n&&t.setAttribute("http.response_content_length_uncompressed",n)}}function as(){return"undefined"!=typeof location?location.origin:void 0}function us(t,e,r,n,s=new WeakSet,i){const o=cs(t),a=function(t,e,r,n,s,i){const o=gr(e),a=gr(r);let u=n.filter(e=>{const r=gr(dr(e[ts.FETCH_START])),n=gr(dr(e[ts.RESPONSE_END]));return e.initiatorType.toLowerCase()===(i||"xmlhttprequest")&&e.name===t&&r>=o&&n<=a});u.length>0&&(u=u.filter(t=>!s.has(t)));return u}(t=o.toString(),e,r,n,s,i);if(0===a.length)return{mainRequest:void 0};if(1===a.length)return{mainRequest:a[0]};const u=function(t){return t.slice().sort((t,e)=>{const r=t[ts.FETCH_START],n=e[ts.FETCH_START];return r>n?1:r<n?-1:0})}(a);if(o.origin!==as()&&u.length>1){let t=u[0],e=function(t,e,r){const n=gr(r),s=gr(dr(e));let i,o=t[1];const a=t.length;for(let e=1;e<a;e++){const r=t[e],a=gr(dr(r[ts.FETCH_START])),u=n-gr(dr(r[ts.RESPONSE_END]));a>=s&&(!i||u<i)&&(i=u,o=r)}return o}(u,t[ts.RESPONSE_END],r);const n=t[ts.RESPONSE_END];return e[ts.FETCH_START]<n&&(e=t,t=void 0),{corsPreFlightRequest:t,mainRequest:e}}return{mainRequest:a[0]}}function cs(t){if("function"==typeof URL)return new URL(t,"undefined"!=typeof document?document.baseURI:"undefined"!=typeof location?location.href:void 0);const e=(ns||(ns=document.createElement("a")),ns);return e.href=t,e}function ls(t,e){let r=e||[];("string"==typeof r||r instanceof RegExp)&&(r=[r]);return cs(t).origin===as()||r.some(e=>Kr(t,e))}var hs,ds="http.response.body.size",gs="log.record.uid",ps="session.id",ms="session.previous_id",_s="user.id",fs="emb.type",bs="emb.state",Ss="emb.cold_start",vs="emb.session_number",ys="emb.exception_number",ws="emb.sdk_startup_duration",Ts="emb.properties.",Es="emb.session_end_type",Cs="emb.stacktrace.js",xs="emb.exception_handling",Ls="emb.app_instance_id",As="emb.tab_id",Rs="emb.experience_id",Ps="emb.from_storage",Ms="emb.js_file_bundle_ids",Is="emb.navigation_source",Ds="app.surface.name",Os="app.surface.id",ks=({target:t,events:e,callback:r})=>{e.forEach(e=>{t.addEventListener(e,r)})},Ns=({target:t,events:e,callback:r})=>{e.forEach(e=>{t.removeEventListener(e,r)})},Fs="embrace_pending_",Us=class{constructor({resource:t=An(),storage:e=window.localStorage,diag:r=$t.createComponentLogger({namespace:"EmbraceSpanStorage"}),storedSpansExpireTimeoutMS:n=36e5,onExpiredSpansExport:s,spanSessionManager:i}){p(this,"_noExportTracer"),p(this,"_storage"),p(this,"_diag"),p(this,"_onExpiredSpansExport"),p(this,"_storedSpansExpireTimeoutMS"),p(this,"_spanSessionManager"),p(this,"_checkExpiredSpansInterval"),this._noExportTracer=new Yn({resource:t}).getTracer("embrace-web-sdk-sessions"),this._storage=e,this._diag=r,this._storedSpansExpireTimeoutMS=n,this._onExpiredSpansExport=s,this._spanSessionManager=i,this.startExpiredSpansCheck()}storePendingSpans(t,e,r){try{if(this.clearStoredSpans(t),this._getPendingSpansKeys().length>=10)return this._spanSessionManager.incrSessionCountForKey("emb.max_pending_spans_reached"),void this._diag.warn("Not storing pending spans as the max number of items was reached");const n=`${Fs}${t}_${Date.now()}`;this._storage.setItem(n,JSON.stringify([e,...r],(t,e)=>t.startsWith("_")?void 0:e)),this._diag.debug(`Stored pending span: ${n}`)}catch(t){this._diag.error("Failed to store spans to storage:",t)}}clearStoredSpans(t){try{const e=`${Fs}${t}_`;this._getPendingSpansKeys().forEach(t=>{t.startsWith(e)&&this._storage.removeItem(t)})}catch(t){this._diag.error("Failed to clear stored spans from storage:",t)}}startExpiredSpansCheck(){this._checkExpiredSpansInterval=setInterval(()=>{this.checkAndExportExpiredSpans()},3e5)}stopExpiredSpansCheck(){this._checkExpiredSpansInterval&&(clearInterval(this._checkExpiredSpansInterval),this._checkExpiredSpansInterval=void 0)}checkAndExportExpiredSpans(){try{const t=this._getPendingSpansKeys();if(0===t.length)return;const e=Date.now();t.forEach(t=>{const r=t.split("_"),n=parseInt(r[r.length-1],10);if(Number.isNaN(n)&&(this._diag.error("Found invalid timestamp in stored span:",n),this._storage.removeItem(t)),e-n<=this._storedSpansExpireTimeoutMS)return;const s=this._storage.getItem(t);if(s){try{const t=[];for(const e of JSON.parse(s)){const r=this._noExportTracer.startSpan(e.name,{kind:e.kind,attributes:e.attributes,links:e.links,startTime:e.startTime});r.setStatus(e.status),r.end(e.endTime),t.push(r)}this._onExpiredSpansExport&&t.length>0&&this._onExpiredSpansExport(t)}catch(t){this._diag.error("Failed to process expired spans:",t)}this._storage.removeItem(t)}})}catch(t){this._diag.error("Failed to check and export expired spans:",t)}}_getPendingSpansKeys(){const t=[];for(let e=0;e<this._storage.length;e++){const r=this._storage.key(e);(null==r?void 0:r.startsWith(Fs))&&t.push(r)}return t}destroy(){this.stopExpiredSpansCheck()}},Bs=[];for(let t=0;t<256;++t)Bs.push((t+256).toString(16).slice(1));var js=new Uint8Array(16);var Vs={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function $s(t,e,r){var n,s,i;const o=null!=(i=null!=(s=(t=t||{}).random)?s:null==(n=t.rng)?void 0:n.call(t))?i:function(){if(!hs){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");hs=crypto.getRandomValues.bind(crypto)}return hs(js)}();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){if((r=r||0)<0||r+16>e.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[r+t]=o[t];return e}return function(t,e=0){return(Bs[t[e+0]]+Bs[t[e+1]]+Bs[t[e+2]]+Bs[t[e+3]]+"-"+Bs[t[e+4]]+Bs[t[e+5]]+"-"+Bs[t[e+6]]+Bs[t[e+7]]+"-"+Bs[t[e+8]]+Bs[t[e+9]]+"-"+Bs[t[e+10]]+Bs[t[e+11]]+Bs[t[e+12]]+Bs[t[e+13]]+Bs[t[e+14]]+Bs[t[e+15]]).toLowerCase()}(o)}var zs,Hs,qs=function(t,e,r){return!Vs.randomUUID||e||t?$s(t,e,r):Vs.randomUUID()},Gs=()=>qs().replace(/-/g,"").toUpperCase(),Ks=(t,e,r)=>{try{const r=t.getItem(e);let n=r?parseInt(r,10):0;return n++,t.setItem(e,n.toString()),n}catch(t){return r.warn(`Failed to retrieve ${e} from storage: `,t),1}},Ws=t=>"hidden"===t.visibilityState?"background":"foreground",Qs=globalThis,Xs=(t,e)=>{if(!e||e<=0||e>100)return!1;return e>=Js(t)},Js=t=>{const e=t.slice(-6),r=u(16,6)-1;return parseInt(e,16)/r*100},Ys=class{constructor(t,e){p(this,"_keyPrefix"),p(this,"_storage"),this._keyPrefix=`${t}_`,this._storage=e}getNamespacedKeys(){const t=[];for(let e=0;e<this._storage.length;e++){const r=this._storage.key(e);(null==r?void 0:r.startsWith(this._keyPrefix))&&t.push(r.substring(this._keyPrefix.length))}return t}get length(){return this.getNamespacedKeys().length}clear(){this.getNamespacedKeys().forEach(t=>{this._storage.removeItem(`${this._keyPrefix}${t}`)})}getItem(t){return this._storage.getItem(`${this._keyPrefix}${t}`)}key(t){return this.getNamespacedKeys()[t]||null}removeItem(t){this._storage.removeItem(`${this._keyPrefix}${t}`)}setItem(t,e){this._storage.setItem(`${this._keyPrefix}${t}`,e)}},Zs=class{constructor(t=window.performance){p(this,"_clock"),p(this,"epochMillisFromOriginOffset",t=>this._clock.timeOrigin+t),p(this,"getNowHRTime",()=>cr(this.getNowMillis())),p(this,"getNowMillis",()=>this.epochMillisFromOriginOffset(this._clock.now())),p(this,"millisSinceHRTime",t=>this.getNowMillis()-function(t){return 1e3*t[0]+t[1]/1e6}(t)),this._clock=t}},ti=(t,e=1e3)=>{let r=!1;return(...n)=>{r||(t(...n),setTimeout(()=>{r=!1},e),r=!0)}},ei=class{constructor(t,e,r){this.instrumentationName=t,this.instrumentationVersion=e,p(this,"_config",{}),p(this,"_diag"),p(this,"_tracer"),p(this,"_meter"),p(this,"_logger"),this.setConfig(r),this._diag=$t.createComponentLogger({namespace:t}),this._tracer=re.getTracer(t,e),this._meter=qt.getMeter(t,e),this._logger=cn.getLogger(t,e),this._updateMetricInstruments()}get tracer(){return this._tracer}get meter(){return this._meter}get logger(){return this._logger}getModuleDefinitions(){var t;const e=null!=(t=this.init())?t:[];return Array.isArray(e)?e:[e]}getConfig(){return this._config}setConfig(t){this._config=l({enabled:!0},t)}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}_updateMetricInstruments(){}_runSpanCustomizationHook(t,e,r,n){if(t)try{t(r,n)}catch(t){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:e},t)}}},ri=class extends ei{constructor({instrumentationName:t,instrumentationVersion:e,config:r,diag:n,perf:s}){super(t,e,r),p(this,"_sessionManager"),p(this,"_logManager"),p(this,"_perf"),n&&(this._diag=n),this._perf=null!=s?s:new Zs,this._sessionManager=pe.getSpanSessionManager(),this._logManager=oe.getLogManager()}get sessionManager(){return this._sessionManager}get logManager(){return this._logManager}get perf(){return this._perf}init(){}setLogManager(t){this._logManager=t}setSessionManager(t){this._sessionManager=t}},ni={"first-paint":"firstPaint","first-contentful-paint":"firstContentfulPaint"},si=class extends ri{constructor({diag:t,perf:e,enabled:r,applyCustomAttributesOnSpan:n,ignorePerformancePaintEvents:s=!1,ignoreNetworkEvents:i=!1}={}){super({instrumentationName:"DocumentLoadInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{enabled:r,applyCustomAttributesOnSpan:n,ignorePerformancePaintEvents:s,ignoreNetworkEvents:i}}),p(this,"_onDocumentLoaded"),this._onDocumentLoaded=()=>{window.setTimeout(()=>{this._collectPerformance()},0)},this._config.enabled&&this.enable()}init(){this._diag.debug("Initializing document load instrumentation")}_addResourcesSpans(t){performance.getEntriesByType("resource").forEach(e=>{this._initResourceSpan(e,t)})}_collectPerformance(){const t=Array.from(document.getElementsByTagName("meta")).find(t=>t.getAttribute("name")===Tr),e=(()=>{const t={},e=window.performance.getEntriesByType("navigation")[0];return Object.values(ts).forEach(r=>{if(ss(e,r)){const n=e[r];"number"==typeof n&&(t[r]=n)}}),t})(),r=(null==t?void 0:t.content)||"";Vt.with(te.extract(B,{traceparent:r}),()=>{var t;const r=this._startSpan("documentLoad",ts.FETCH_START,e);var n;r&&(Vt.with(re.setSpan(Vt.active(),r),()=>{const t=this._startSpan("documentFetch",ts.FETCH_START,e);t&&(t.setAttribute(nr,location.href),Vt.with(re.setSpan(Vt.active(),t),()=>{var r;os(t,e,this.getConfig().ignoreNetworkEvents),this._addCustomAttributesOnSpan(t,null==(r=this.getConfig().applyCustomAttributesOnSpan)?void 0:r.documentFetch),this._endSpan(t,ts.RESPONSE_END,e)}))}),r.setAttribute(fs,"ux.document_load"),r.setAttribute(nr,location.href),r.setAttribute(sr,navigator.userAgent),this._addResourcesSpans(r),this.getConfig().ignoreNetworkEvents||(is(r,ts.FETCH_START,e),is(r,ts.UNLOAD_EVENT_START,e),is(r,ts.UNLOAD_EVENT_END,e),is(r,ts.DOM_INTERACTIVE,e),is(r,ts.DOM_CONTENT_LOADED_EVENT_START,e),is(r,ts.DOM_CONTENT_LOADED_EVENT_END,e),is(r,ts.DOM_COMPLETE,e),is(r,ts.LOAD_EVENT_START,e),is(r,ts.LOAD_EVENT_END,e)),this.getConfig().ignorePerformancePaintEvents||(n=r,window.performance.getEntriesByType("paint").forEach(({name:t,startTime:e})=>{ss(ni,t)&&n.addEvent(ni[t],e)})),this._addCustomAttributesOnSpan(r,null==(t=this.getConfig().applyCustomAttributesOnSpan)?void 0:t.documentLoad),this._endSpan(r,ts.LOAD_EVENT_END,e))})}_endSpan(t,e,r){t&&(ss(r,e)&&"number"==typeof r[e]?t.end(r[e]):t.end())}_initResourceSpan(t,e){var r;const n=this._startSpan("resourceFetch",ts.FETCH_START,t,e);n&&(n.setAttribute(fs,"ux.resource_fetch"),n.setAttribute(nr,t.name),os(n,t,this.getConfig().ignoreNetworkEvents),t.deliveryType&&n.setAttribute("http.response.delivery_type",t.deliveryType),t.initiatorType&&n.setAttribute("http.request.initiator_type",t.initiatorType),t.renderBlockingStatus&&n.setAttribute("http.request.render_blocking_status",t.renderBlockingStatus),t.responseStatus&&n.setAttribute(Xe,t.responseStatus),"number"==typeof t.encodedBodySize&&t.encodedBodySize>=0&&n.setAttribute(ds,t.encodedBodySize),"number"==typeof t.transferSize&&t.transferSize>=0&&n.setAttribute("http.response.size",t.transferSize),"number"==typeof t.decodedBodySize&&t.decodedBodySize>=0&&n.setAttribute("http.response.decoded_body_size",t.decodedBodySize),this._addResourceDiagnosticAttributes(n,t),this._addCustomAttributesOnResourceSpan(n,t,null==(r=this.getConfig().applyCustomAttributesOnSpan)?void 0:r.resourceFetch),this._endSpan(n,ts.RESPONSE_END,t))}_startSpan(t,e,r,n){if(ss(r,e)&&"number"==typeof r[e]){return this.tracer.startSpan(t,{startTime:r[e]},n?re.setSpan(Vt.active(),n):void 0)}}_waitForPageLoad(){"complete"===window.document.readyState?this._onDocumentLoaded():window.addEventListener("load",this._onDocumentLoaded)}_addCustomAttributesOnSpan(t,e){e&&wn(()=>{e(t)},t=>{t&&this._diag.error("addCustomAttributesOnSpan",t)},!0)}_addCustomAttributesOnResourceSpan(t,e,r){r&&wn(()=>{r(t,e)},t=>{t&&this._diag.error("addCustomAttributesOnResourceSpan",t)},!0)}_hasNoSizeData(t){const e="number"==typeof t.transferSize?t.transferSize:0,r="number"==typeof t.decodedBodySize?t.decodedBodySize:0,n="number"==typeof t.encodedBodySize?t.encodedBodySize:0;return 0===e&&0===r&&0===n}_hasTimingData(t){const e="number"==typeof t.fetchStart?t.fetchStart:0,r="number"==typeof t.responseEnd?t.responseEnd:0;return e>0&&r>0}_isCorsRestricted(t){return this._hasNoSizeData(t)&&this._hasTimingData(t)}_isFetchIncomplete(t){const e="number"==typeof t.fetchStart?t.fetchStart:0,r="number"==typeof t.responseEnd?t.responseEnd:0;return this._hasNoSizeData(t)&&e>0&&0===r}_isFetchPrevented(t){const e="number"==typeof t.fetchStart?t.fetchStart:0;return this._hasNoSizeData(t)&&0===e}_isCacheValidated(t){const e="number"==typeof t.transferSize?t.transferSize:0,r="string"==typeof t.deliveryType?t.deliveryType:"";return 300===e&&"cache"!==r}_addResourceDiagnosticAttributes(t,e){this._isCorsRestricted(e)?t.setAttribute("http.response.cors_opaque",!0):this._isFetchIncomplete(e)?t.setAttribute("http.request.incomplete",!0):this._isFetchPrevented(e)&&t.setAttribute("http.request.prevented",!0),this._isCacheValidated(e)&&t.setAttribute("http.response.cache_revalidated",!0)}enable(){window.removeEventListener("load",this._onDocumentLoaded),this._waitForPageLoad()}disable(){window.removeEventListener("load",this._onDocumentLoaded)}},ii=class extends ri{constructor({diag:t,perf:e,rootNode:r,emptyCheckDelayMs:n=500}){super({instrumentationName:"EmptyRootInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),p(this,"_observer"),p(this,"_emptyCheckDelayMs"),p(this,"_rootNode"),this._rootNode=r,this._emptyCheckDelayMs=n,this._observer=new MutationObserver((t,e)=>{this._observerCallback(t)}),this._config.enabled&&this._rootNode?this.enable():this._rootNode||this._diag.warn("supplied root node was null, this instrumentation won't be enabled")}disable(){this._observer.disconnect()}enable(){this._rootNode&&this._observer.observe(this._rootNode,{childList:!0})}_observerCallback(t){let e=!1,r=!1;for(const n of t)n.target===this._rootNode&&(n.removedNodes.length>0&&(e=!0),n.addedNodes.length>0&&(r=!0));e&&!r&&(this._diag.debug(`root node had child nodes removed without new ones being added, checking if it's empty in ${this._emptyCheckDelayMs}ms`),window.setTimeout(()=>{this._checkForEmptyRootNode()},this._emptyCheckDelayMs))}_checkForEmptyRootNode(){var t;if(0===(null==(t=this._rootNode)?void 0:t.childNodes.length)){this._diag.debug("root node was found to be empty");const t=this.sessionManager.getSessionSpan();t?t.addEvent("empty-root-node",{"emb.type":"ux.empty_root_node"}):this._diag.debug("no active session found to emit event on")}}},oi=(t,e)=>{const r=t.nodeName.toLowerCase(),n=e.substring(0,30),s=e.length>30?"...":"";return`<${r}${t.className?` class="${t.className}"`:""}>${n}${s}</${r}>`},ai=class extends ri{constructor({diag:t,perf:e,shouldTrack:r,innerTextForElement:n}={}){super({instrumentationName:"ClicksInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),p(this,"_onClickHandler"),this._onClickHandler=t=>{const e=t.target;if(e instanceof HTMLElement&&!e.hasAttribute("disabled")&&(!r||r(e)))try{const r=this.sessionManager.getSessionSpan();r&&r.addEvent("click",{"emb.type":"ux.tap","view.name":oi(e,n?n(e):e.innerText),"tap.coords":`${t.x.toString()},${t.y.toString()}`},this.perf.epochMillisFromOriginOffset(t.timeStamp))}catch(t){this._diag.error("failed to create new user interaction span event",t)}},this._config.enabled&&this.enable()}disable(){document.removeEventListener("click",this._onClickHandler)}enable(){document.addEventListener("click",this._onClickHandler)}},ui=class extends ri{constructor({diag:t,perf:e}={}){super({instrumentationName:"GlobalExceptionInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),p(this,"_onErrorHandler"),p(this,"_onUnhandledRejectionHandler"),this._onErrorHandler=t=>{this.logManager.logException(t.error||t.message,{handled:!1,timestamp:this.perf.epochMillisFromOriginOffset(t.timeStamp)})},this._onUnhandledRejectionHandler=t=>{let e;t.reason&&t.reason instanceof Error?e=t.reason:(e=new Error("string"==typeof t.reason?t.reason:"Unhandled Rejected Promise"),e.stack=""),this.logManager.logException(e,{handled:!1,timestamp:this.perf.epochMillisFromOriginOffset(t.timeStamp)})},this._config.enabled&&this.enable()}disable(){window.removeEventListener("error",this._onErrorHandler),window.removeEventListener("unhandledrejection",this._onUnhandledRejectionHandler)}enable(){window.addEventListener("error",this._onErrorHandler),window.addEventListener("unhandledrejection",this._onUnhandledRejectionHandler)}};(Hs=zs||(zs={})).COMPONENT="component",Hs.HTTP_STATUS_TEXT="http.status_text";var ci=$t.createComponentLogger({namespace:"@opentelemetry/opentelemetry-instrumentation-fetch/utils"});function li(...t){if(t[0]instanceof URL||"string"==typeof t[0]){const e=t[1];if(!(null==e?void 0:e.body))return Promise.resolve();if(e.body instanceof ReadableStream){const{body:t,length:r}=function(t){if(!t.pipeThrough)return ci.warn("Platform has ReadableStream but not pipeThrough!"),{body:t,length:Promise.resolve(void 0)};let e,r=0;const n=new Promise(t=>{e=t}),s=new TransformStream({start(){},transform(t,e){return m(this,null,function*(){const n=yield t;r+=n.byteLength,e.enqueue(t)})},flush(){e(r)}});return{body:t.pipeThrough(s),length:n}}(e.body);return e.body=t,r}return Promise.resolve(function(t){if(e=t,"undefined"!=typeof Document&&e instanceof Document)return(new XMLSerializer).serializeToString(document).length;var e;if("string"==typeof t)return di(t);if(t instanceof Blob)return t.size;if(t instanceof FormData)return function(t){let e=0;for(const[r,n]of t.entries())e+=r.length,n instanceof Blob?e+=n.size:e+=n.length;return e}(t);if(t instanceof URLSearchParams)return di(t.toString());if(void 0!==t.byteLength)return t.byteLength;return void ci.warn("unknown body type")}(e.body))}{const e=t[0];return(null==e?void 0:e.body)?e.clone().text().then(t=>di(t)):Promise.resolve()}}var hi=new TextEncoder;function di(t){return hi.encode(t).byteLength}function gi(t){const e=function(){if(void 0===pi){const t=void 0;t&&t.length>0?(pi={},t.forEach(t=>{pi[t]=!0})):pi=mi}return pi}(),r=t.toUpperCase();return r in e?r:"_OTHER"}var pi,mi={CONNECT:!0,DELETE:!0,GET:!0,HEAD:!0,OPTIONS:!0,PATCH:!0,POST:!0,PUT:!0,TRACE:!0};var _i={"https:":"443","http:":"80"};var fi,bi,Si="0.207.0",vi="object"==typeof process&&"node"===(null==(fi=process.release)?void 0:fi.name),yi=class extends yn{constructor(t={}){super("@opentelemetry/instrumentation-fetch",Si,t),p(this,"component","fetch"),p(this,"version",Si),p(this,"moduleName",this.component),p(this,"_usedResources",new WeakSet),p(this,"_tasksCount",0),p(this,"_semconvStability"),this._semconvStability=En("http",null==t?void 0:t.semconvStabilityOptIn)}init(){}_addChildSpan(t,e){const r=this.tracer.startSpan("CORS Preflight",{startTime:e[ts.FETCH_START]},re.setSpan(Vt.active(),t)),n=!(this._semconvStability&bn.OLD);os(r,e,this.getConfig().ignoreNetworkEvents,void 0,n),r.end(e[ts.RESPONSE_END])}_addFinalSpanAttributes(t,e){const r=cs(e.url);if(this._semconvStability&bn.OLD&&(t.setAttribute("http.status_code",e.status),null!=e.statusText&&t.setAttribute(zs.HTTP_STATUS_TEXT,e.statusText),t.setAttribute("http.host",r.host),t.setAttribute("http.scheme",r.protocol.replace(":","")),"undefined"!=typeof navigator&&t.setAttribute("http.user_agent",navigator.userAgent)),this._semconvStability&bn.STABLE){t.setAttribute(Xe,e.status),t.setAttribute(Je,r.hostname);const n=function(t){const e=Number(t.port||_i[t.protocol]);return e&&!isNaN(e)?e:void 0}(r);n&&t.setAttribute(Ye,n)}}_addHeaders(t,e){if(!ls(e,this.getConfig().propagateTraceHeaderCorsUrls)){const t={};return te.inject(Vt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}if(t instanceof Request)te.inject(Vt.active(),t.headers,{set:(t,e,r)=>t.set(e,"string"==typeof r?r:String(r))});else if(t.headers instanceof Headers)te.inject(Vt.active(),t.headers,{set:(t,e,r)=>t.set(e,"string"==typeof r?r:String(r))});else if(t.headers instanceof Map)te.inject(Vt.active(),t.headers,{set:(t,e,r)=>t.set(e,"string"==typeof r?r:String(r))});else{const e={};te.inject(Vt.active(),e),t.headers=Object.assign({},e,t.headers||{})}}_clearResources(){0===this._tasksCount&&this.getConfig().clearTimingResources&&(performance.clearResourceTimings(),this._usedResources=new WeakSet)}_createSpan(t,e={}){if(Wr(t,this.getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");let r="";const n={};if(this._semconvStability&bn.OLD){const s=(e.method||"GET").toUpperCase();r=`HTTP ${s}`,n[zs.COMPONENT]=this.moduleName,n["http.method"]=s,n["http.url"]=t}if(this._semconvStability&bn.STABLE){const s=e.method,i=gi(e.method||"GET");r||(r=i),n[We]=i,i!==s&&(n[Qe]=s),n[nr]=t}return this.tracer.startSpan(r,{kind:Dt.CLIENT,attributes:n})}_findResourceAndAddNetworkEvents(t,e,r){let n=e.entries;if(!n.length){if(!performance.getEntriesByType)return;n=performance.getEntriesByType("resource")}const s=us(e.spanUrl,e.startTime,r,n,this._usedResources,"fetch");if(s.mainRequest){const e=s.mainRequest;this._markResourceAsUsed(e);const r=s.corsPreFlightRequest;r&&(this._addChildSpan(t,r),this._markResourceAsUsed(r));const n=!(this._semconvStability&bn.OLD);os(t,e,this.getConfig().ignoreNetworkEvents,void 0,n)}}_markResourceAsUsed(t){this._usedResources.add(t)}_endSpan(t,e,r){const n=cr(Date.now()),s=hr();this._addFinalSpanAttributes(t,r),this._semconvStability&bn.STABLE&&r.status>=400&&(t.setStatus({code:kt.ERROR}),t.setAttribute(He,String(r.status))),setTimeout(()=>{var r;null==(r=e.observer)||r.disconnect(),this._findResourceAndAddNetworkEvents(t,e,s),this._tasksCount--,this._clearResources(),t.end(n)},300)}_patchConstructor(){return t=>{const e=this;return function(...r){const n=this,s=cs(r[0]instanceof Request?r[0].url:String(r[0])).href,i=r[0]instanceof Request?r[0]:r[1]||{},o=e._createSpan(s,i);if(!o)return t.apply(this,r);const a=e._prepareSpanData(s);function u(t,r){e._applyAttributesAfterFetch(t,i,r),e._endSpan(t,a,{status:r.status||0,statusText:r.message,url:s})}function c(t,r){e._applyAttributesAfterFetch(t,i,r),r.status>=200&&r.status<400?e._endSpan(t,a,r):e._endSpan(t,a,{status:r.status,statusText:r.statusText,url:s})}function l(t,e,r){let n=null;try{const e=r.clone().body;if(e){const s=e.getReader(),i=function(t,e){if(!t)return null;const r=t.getReader();return new ReadableStream({pull(t){return m(this,null,function*(){try{const{value:e,done:n}=yield r.read();n?(r.releaseLock(),t.close()):t.enqueue(e)}catch(e){t.error(e),r.cancel(e).catch(t=>{});try{r.releaseLock()}catch(t){}}})},cancel:t=>(e.cancel(t).catch(t=>{}),r.cancel(t))})}(r.body,s);n=new Response(i,{status:r.status,statusText:r.statusText,headers:r.headers});const o=()=>{s.read().then(({done:e})=>{e?c(t,r):o()},e=>{u(t,e)})};o()}else c(t,r)}finally{e(null!=n?n:r)}}function h(t,e,r){try{u(t,r)}finally{e(r)}}return e.getConfig().measureRequestSize&&li(...r).then(t=>{t&&(e._semconvStability&bn.OLD&&o.setAttribute("http.request_content_length_uncompressed",t),e._semconvStability&bn.STABLE&&o.setAttribute("http.request.body.size",t))}).catch(t=>{e._diag.warn("getFetchBodyLength",t)}),new Promise((r,a)=>Vt.with(re.setSpan(Vt.active(),o),()=>(e._addHeaders(i,s),e._callRequestHook(o,i),e._tasksCount++,t.apply(n,i instanceof Request?[i]:[s,i]).then(l.bind(n,o,r),h.bind(n,o,a)))))}}}_applyAttributesAfterFetch(t,e,r){const n=this.getConfig().applyCustomAttributesOnSpan;n&&wn(()=>n(t,e,r),t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)},!0)}_callRequestHook(t,e){const r=this.getConfig().requestHook;r&&wn(()=>r(t,e),t=>{t&&this._diag.error("requestHook",t)},!0)}_prepareSpanData(t){const e=hr(),r=[];if("function"!=typeof PerformanceObserver)return{entries:r,startTime:e,spanUrl:t};const n=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"fetch"===e.initiatorType&&e.name===t&&r.push(e)})});return n.observe({entryTypes:["resource"]}),{entries:r,observer:n,startTime:e,spanUrl:t}}enable(){vi?this._diag.warn("this instrumentation is intended for web usage only, it does not instrument Node.js's fetch()"):(Tn(fetch)&&(this._unwrap(Be,"fetch"),this._diag.debug("removing previous patch for constructor")),this._wrap(Be,"fetch",this._patchConstructor()))}disable(){vi||(this._unwrap(Be,"fetch"),this._usedResources=new WeakSet)}},wi=class extends yi{constructor(t={}){var e=t,{omitIfAlreadyPatched:r}=e,n=g(e,["omitIfAlreadyPatched"]);super(h(l({},n),{enabled:!1})),p(this,"_omitIfAlreadyPatched"),this._omitIfAlreadyPatched=r,n.enabled&&this.enable()}enable(){this._omitIfAlreadyPatched&&Tn(fetch)?this._diag.debug("fetch is already passed and `omitIfAlreadyPatched` is true, skipping enabling this instrumentation"):super.enable()}},Ti=/\([^()]+\)/g,Ei=class extends ri{constructor({diag:t,shouldCleanupPathOptionsFromRouteName:e=!0}){super({instrumentationName:"NavigationInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),p(this,"_shouldCleanupPathOptionsFromRouteName",!0),p(this,"_currentRouteSpan",null),p(this,"_instrumentationType","manual"),p(this,"_removeSessionStartedFn",null),p(this,"_removeSessionEndedFn",null),p(this,"setInstrumentationType",t=>{this._instrumentationType=t}),p(this,"setCurrentRoute",t=>{if(!this._config.enabled)return;const e=le.getCurrentRoute();t.url!==(null==e?void 0:e.url)&&(le.setCurrentRoute(t),this._endRouteSpan(e),this._startRouteSpan(t))}),p(this,"_setupSessionListeners",()=>{this._removeSessionStartedFn||(this._removeSessionStartedFn=this.sessionManager.addSessionStartedListener(()=>{const t=le.getCurrentRoute();t&&!this._currentRouteSpan&&(this._diag.debug("Session started, starting route span."),this._startRouteSpan(t))})),this._removeSessionEndedFn||(this._removeSessionEndedFn=this.sessionManager.addSessionEndedListener(()=>{this._currentRouteSpan&&(this._diag.debug("Session ended, ending route span."),this._endRouteSpan(le.getCurrentRoute()))}))}),p(this,"_cleanUpSessionListeners",()=>{this._removeSessionStartedFn&&(this._removeSessionStartedFn(),this._removeSessionStartedFn=null),this._removeSessionEndedFn&&(this._removeSessionEndedFn(),this._removeSessionEndedFn=null)}),p(this,"_startRouteSpan",t=>{this._diag.debug(`Starting route span for url: ${t.url}`),this._setupSessionListeners();const e=this._shouldCleanupPathOptionsFromRouteName?t.path.replace(Ti,""):t.path;return this._currentRouteSpan=this.tracer.startSpan(e,{attributes:{[fs]:"ux.surface",[Ds]:e,[Os]:le.getCurrentPageId()||void 0}}),this._currentRouteSpan.setAttribute("emb.instrumentation",this._instrumentationType),this._currentRouteSpan}),p(this,"_endRouteSpan",t=>{this._currentRouteSpan&&(t&&this._diag.debug(`Ending route span for url: ${t.url}`),this._currentRouteSpan.end(),this._currentRouteSpan=null)}),p(this,"enable",()=>{this._diag.debug("NavigationInstrumentation enabled, listening for navigation events.")}),p(this,"disable",()=>{this._cleanUpSessionListeners(),this.setConfig({enabled:!1}),this._diag.debug("NavigationInstrumentation disabled, stopped listening for navigation events.")}),this._shouldCleanupPathOptionsFromRouteName=e,this._config.enabled&&this.enable()}},Ci=(t={})=>(bi||(bi=new Ei(t)),bi),xi={samplingPct:100,networkSpansForwardingThreshold:0},Li="embrace_remote_config",Ai=t=>{const e={samplingPct:t.threshold};return void 0!==t.network_span_forwarding&&(e.networkSpansForwardingThreshold=t.network_span_forwarding.pct_enabled),e},Ri=class{constructor({appID:t,appVersion:e,deviceId:r,diag:n=$t.createComponentLogger({namespace:"embrace-config-manager"}),storage:s=window.localStorage,defaultConfig:i={},embraceConfigURL:o}={}){p(this,"_remoteConfigURL",null),p(this,"_diag"),p(this,"_storage"),p(this,"_sdkConfig"),p(this,"_etag",null),t&&e&&r&&(this._remoteConfigURL=((t,{osVersion:e,appVersion:r,deviceId:n},s)=>`${s||`https://a-${t}.config.emb-api.com`}/v2/config?appId=${t}&osVersion=${e}&appVersion=${r}&deviceId=${n}`)(t,{appVersion:e,deviceId:r,osVersion:"1"},o)),this._diag=n,this._storage=s;const a=this._getRemoteConfigFromStorage();a&&(this._etag=a.etag),this._sdkConfig=l(l(l({},xi),i),a?Ai(a.config):{})}setConfig(t){this._sdkConfig=l(l({},this._sdkConfig),t)}getConfig(){return this._sdkConfig}refreshRemoteConfig(){return m(this,null,function*(){if(this._remoteConfigURL)try{const t=yield this._fetchRemoteConfig(this._remoteConfigURL);if(!t)return void this._diag.debug("No changes in remote config, skipping update");const[e,r]=t;this._storage.setItem(Li,JSON.stringify({config:e,etag:r})),this._sdkConfig=Ai(e),this._etag=r}catch(t){this._diag.warn(`Failed to refresh remote config: ${t instanceof Error?t.message:String(t)}`)}})}_getRemoteConfigFromStorage(){try{const t=this._storage.getItem(Li);return t?JSON.parse(t):null}catch(t){return this._diag.warn(`Failed to parse remote config from storage: ${t instanceof Error?t.message:String(t)}`),null}}_fetchRemoteConfig(t){return m(this,null,function*(){const e=yield fetch(t,{headers:this._etag?{"If-None-Match":this._etag}:{}}),r=e.headers.get("etag");if(304===e.status)return null;if(!e.ok)return this._diag.warn(`Failed to fetch remote config from ${t}: ${e.statusText}`),null;return[yield e.json(),r]})}},Pi={maxAllowed:{error_log:500,warning_log:200,info_log:100,exception:500,breadcrumb:100,session_property:100,span:1e3,network_request:1e4},maxLength:{error_log:128,warning_log:128,info_log:128,exception:1024,breadcrumb:256,session_property_key:128,session_property_value:256,log_attribute_key:128,log_attribute_value:256,exception_attribute_key:128,exception_attribute_value:256},maxAttributes:{error_log:50,warning_log:50,info_log:50,exception:50}},Mi={info:"info_log",warning:"warning_log",error:"error_log"},Ii=class{constructor({diag:t,maxAllowed:e,maxLength:r,maxAttributes:n}){p(this,"_diag"),p(this,"_diagnosticCounts",{}),p(this,"_currentCount",{exception:0,error_log:0,warning_log:0,info_log:0,breadcrumb:0,session_property:0,span:0,network_request:0}),p(this,"_maxAllowed"),p(this,"_maxLength"),p(this,"_maxAttributes"),this._diag=null!=t?t:$t.createComponentLogger({namespace:"EmbraceLimitManager"}),this._maxAllowed=e,this._maxLength=r,this._maxAttributes=n}_dropIfMaxReached(t){return this._currentCount[t]>=this._maxAllowed[t]?(this._diag.warn(`disallowing ${t} because the maximum number of ${this._maxAllowed[t].toString()} has already been reached for this session`),this._incrDiagnosticCount(t,"drop"),!0):(this._currentCount[t]=(this._currentCount[t]||0)+1,!1)}truncateString(t,e){return e.length>this._maxLength[t]?(this._diag.warn(`truncating ${t} because it is longer than ${this._maxLength[t].toString()} characters: "${e}"`),this._incrDiagnosticCount(t,"truncate_string"),e.substring(0,this._maxLength[t])):e}_truncateAttributes(t,e,r,n){var s;const i=Object.keys(e);i.length>this._maxAttributes[t]&&(this._diag.warn(`truncating ${t} attributes because there are more than ${this._maxAttributes[t].toString()} set`),this._incrDiagnosticCount(t,"truncate_attributes"));const o={};for(let a=0;a<Math.min(i.length,this._maxAttributes[t]);a++){o[this.truncateString(r,i[a])]=this.truncateString(n,(null==(s=e[i[a]])?void 0:s.toString())||"")}return o}limitBreadcrumb(t){return this._dropIfMaxReached("breadcrumb")?"dropped":{name:this.truncateString("breadcrumb",t)}}limitException(t,e){return this._dropIfMaxReached("exception")?"dropped":{message:this.truncateString("exception",t),attributes:this._truncateAttributes("exception",e,"exception_attribute_key","exception_attribute_value")}}limitLog(t,e,r){const n=Mi[e];return this._dropIfMaxReached(n)?"dropped":{message:this.truncateString(n,t),attributes:this._truncateAttributes(n,r,"log_attribute_key","log_attribute_value")}}limitSessionProperty(t,e){return this._dropIfMaxReached("session_property")?"dropped":{key:this.truncateString("session_property_key",t),value:this.truncateString("session_property_value",e)}}dropReadableSpan(t){const e="perf.network_request"===t.attributes[fs]?"network_request":"span";return this._dropIfMaxReached(e)}reset(){this._diagnosticCounts={},this._currentCount={exception:0,error_log:0,warning_log:0,info_log:0,breadcrumb:0,session_property:0,span:0,network_request:0}}_incrDiagnosticCount(t,e){const r=`emb.app.applied_limit.${t}.${e}.count`;this._diagnosticCounts[r]=(this._diagnosticCounts[r]||0)+1}getDiagnosticCounts(){return this._diagnosticCounts}},Di=()=>JSON.stringify(Qs._EmbraceFileBundleIDs||{}),Oi=class t{constructor({diag:t,perf:e,spanSessionManager:r,limitManager:n,loggerProvider:s,visibilityDoc:i=window.document,storage:o=window.localStorage}){p(this,"_diag"),p(this,"_perf"),p(this,"_logger"),p(this,"_spanSessionManager"),p(this,"_limitManager"),p(this,"_visibilityDoc"),p(this,"_storage");const a=null!=s?s:cn;this._diag=null!=t?t:$t.createComponentLogger({namespace:"EmbraceLogManager"}),this._perf=null!=e?e:new Zs,this._logger=a.getLogger("embrace-web-sdk-logs"),this._spanSessionManager=r,this._limitManager=n,this._visibilityDoc=i,this._storage=o}static _logSeverityToSeverityNumber(t){switch(t){case"info":return Jr.INFO;case"warning":return Jr.WARN;default:return Jr.ERROR}}logException(e,{handled:r=!0,attributes:n={},timestamp:s=this._perf.getNowMillis()}={}){e||(e=new Error("logException received an undefined error")),null!=n&&"object"==typeof n||(this._diag.warn("attributes must be a non-null object",n),n={}),r||this._spanSessionManager.incrSessionCountForKey("emb.unhandled_exceptions_count");const i=t._normalizeErrorData(e),o=this._limitManager.limitException(i.message,n);"dropped"!==o&&this._logger.emit({timestamp:s,severityNumber:Jr.ERROR,severityText:"ERROR",body:o.message,attributes:h(l({},o.attributes),{[fs]:"sys.exception",[xs]:r?"HANDLED":"UNHANDLED",[Ke]:i.type,"exception.name":i.name,[qe]:o.message,[Ge]:i.stack,[Ms]:Di(),[bs]:Ws(this._visibilityDoc),[ys]:Ks(this._storage,"embrace_exception_number",this._diag)})})}message(t,e,{attributes:r={},includeStacktrace:n=!0,stacktrace:s}={}){if(!t||"string"!=typeof t)return void this._diag.warn("Message must be a string");"error"===e&&this._spanSessionManager.incrSessionCountForKey("emb.error_log_count");let i="";"info"!==e&&(s?i=s:n&&(i=(new Error).stack||"")),this._logMessage({message:t.trim(),severity:e,timestamp:this._perf.getNowMillis(),attributes:r,stacktrace:i})}_logMessage({message:e,severity:r,timestamp:n,attributes:s={},stacktrace:i}){const o=this._limitManager.limitLog(e,r,s);"dropped"!==o&&this._logger.emit({timestamp:n,severityNumber:t._logSeverityToSeverityNumber(r),severityText:r.toUpperCase(),body:o.message,attributes:h(l(h(l({},o.attributes),{[fs]:"sys.log"}),i?{[Cs]:i,[Ms]:Di()}:{}),{[bs]:Ws(this._visibilityDoc)})})}static _normalizeErrorData(t){if(t instanceof Error)return{message:"string"==typeof t.message?t.message.trim():"",type:t.constructor.name,name:t.name,stack:t.stack||""};const e=(new Error).stack||"";if("string"==typeof t)return{message:t.trim(),type:"String",name:"String",stack:e};if(t&&"object"==typeof t){let r="";try{r=JSON.stringify(t)}catch(t){r="[unable to serialize error]"}return{message:r,type:t.constructor.name,name:t.constructor.name,stack:e}}return{message:String(t).trim(),type:typeof t,name:typeof t,stack:e}}},ki=class{constructor(){p(this,"_currentRoute",null),p(this,"_currentPageId",null),p(this,"getCurrentPageId",()=>this._currentPageId),p(this,"getCurrentRoute",()=>this._currentRoute),p(this,"setCurrentRoute",t=>{this._currentRoute&&this._currentRoute.url===t.url||(this._currentPageId=Gs()),this._currentRoute=t}),p(this,"clearCurrentRoute",()=>{this._currentRoute=null,this._currentPageId=null})}},Ni=class{constructor({dynamicConfigManager:t,deviceId:e,blockNetworkSpanForwarding:r}){p(this,"_dynamicConfigManager"),p(this,"_deviceId"),p(this,"_blockNetworkSpanForwarding"),this._dynamicConfigManager=t,this._deviceId=e,this._blockNetworkSpanForwarding=r}isSDKEnabled(){const t=this._dynamicConfigManager.getConfig();return Xs(this._deviceId,t.samplingPct)}isNetworkSpanForwardingEnabled(){if(this._blockNetworkSpanForwarding)return!1;const t=this._dynamicConfigManager.getConfig();return Xs(this._deviceId,t.networkSpansForwardingThreshold)}},Fi="EmbIOAppVersionX.X.X",Ui="2.8.0",Bi="embrace-web-sdk",ji="embrace_app_instance_id",Vi=(t,e)=>{let r=null;try{r=t.getItem(ji)}catch(t){e.warn("Failed to retrieve app instance ID from session storage",t)}if(!r){e.debug("No existing app instance ID found in session storage, creating a new one"),r=Gs();try{t.setItem(ji,r)}catch(t){e.warn("Failed to persist app instance ID to session storage",t)}}return r},$i="embrace_tab",zi="embrace_tab_activity",Hi=class{constructor({diag:t,perf:e,visibilityDoc:r=window.document,storage:n=window.localStorage,sessionStorage:s=window.sessionStorage,limitManager:i,referrer:o=document.referrer}){p(this,"_previousSessionId",null),p(this,"_activeSessionId",null),p(this,"_activeSessionStartTime",null),p(this,"_sessionSpan",null),p(this,"_activeSessionCounts",null),p(this,"_nextSessionCounts",{}),p(this,"_coldStart",!0),p(this,"_sdkStartupDuration",0),p(this,"_sessionStartedListeners",[]),p(this,"_sessionEndedListeners",[]),p(this,"_tab"),p(this,"_navigationSource"),p(this,"_referrerInfo"),p(this,"_tracer"),p(this,"_noExportTracer"),p(this,"_diag"),p(this,"_perf"),p(this,"_visibilityDoc"),p(this,"_storage"),p(this,"_sessionStorage"),p(this,"_limitManager"),p(this,"_referrer"),this._diag=null!=t?t:$t.createComponentLogger({namespace:"EmbraceSpanSessionManager"}),this._perf=null!=e?e:new Zs,this._visibilityDoc=r,this._storage=n,this._sessionStorage=s,this._limitManager=i,this._referrer=o,this._tracer=re.getTracer("embrace-web-sdk-sessions"),this._noExportTracer=(new Yn).getTracer("embrace-web-sdk-sessions"),this._referrerInfo=this._processReferrer();const a=this._initTab();this._tab=a.tab,this._navigationSource=a.navigationSource,this._setupNewTabClickListeners()}_getPermanentAttributes(){const t=new Map;try{for(let e=0;e<this._storage.length;e++){const r=this._storage.key(e);if(null==r?void 0:r.startsWith(Ts)){const e=this._storage.getItem(r);e&&t.set(r,e)}}}catch(t){this._diag.warn("Error loading permanent session properties",t)}return Object.fromEntries(t.entries())}addBreadcrumb(t){if(!this._sessionSpan)return void this._diag.debug("trying to add breadcrumb to a session, but there is no session in progress. This is a no-op.");const e=this._limitManager.limitBreadcrumb(t);"dropped"!==e&&this._sessionSpan.addEvent("emb-breadcrumb",{message:e.name},this._perf.getNowMillis())}addProperty(t,e,r){if(!this._sessionSpan)return void this._diag.debug("trying to add properties to a session, but there is no session in progress. This is a no-op.");const n=this._limitManager.limitSessionProperty(t,e);if("dropped"===n)return;const s=Ts+n.key;if(this._sessionSpan.setAttribute(s,n.value),"permanent"===(null==r?void 0:r.lifespan))try{this._storage.setItem(s,e)}catch(t){this._diag.warn("Failed to set permanent session property",t)}}removeProperty(t){if(!this._sessionSpan)return void this._diag.debug("trying to remove a session property, but there is no session in progress. This is a no-op.");const e=Ts+this._limitManager.truncateString("session_property_key",t);this._sessionSpan.removeAttribute(e);try{this._storage.getItem(e)&&this._storage.removeItem(e)}catch(t){this._diag.warn("Error removing permanent session property",t)}}endSessionSpan(){this.endSessionSpanInternal("manual")}endSessionSpanInternal(t){if(this._sessionSpan){for(const t of this._sessionEndedListeners)try{t()}catch(t){this._diag.warn("Error while executing session ended listener",t)}this._sessionSpan.setAttributes(this._endSessionSpanAttributes(t)),this._sessionSpan.end(),this._sessionSpan=null,this._activeSessionStartTime=null,this._previousSessionId=this._activeSessionId,this._activeSessionId=null,this._activeSessionCounts=null,this._limitManager.reset()}else this._diag.debug("trying to end a session, but there is no session in progress. This is a no-op.")}_endSessionSpanAttributes(t){return h(l(l(h(l({},this._getPermanentAttributes()),{[Es]:t}),this._activeSessionCounts),this._limitManager.getDiagnosticCounts()),{[ws]:this._sdkStartupDuration})}currentSessionAsReadableSpan(t){if(!this._sessionSpan||!this._activeSessionStartTime)return this._diag.debug("trying to end a session, but there is no session in progress. This is a no-op."),null;const e=this._noExportTracer.startSpan("emb-session",{startTime:this._activeSessionStartTime,attributes:h(l(l({},this._sessionSpan.attributes),this._endSessionSpanAttributes(t)),{[Ps]:!0})});return e.end(),e}getSessionId(){return this._activeSessionId}getPreviousSessionId(){return this._previousSessionId}getSessionSpan(){return this._sessionSpan}getSessionStartTime(){return this._activeSessionStartTime}startSessionSpan(t){this._sessionSpan&&this.endSessionSpanInternal("manual"),this._activeSessionId=Gs(),this._activeSessionStartTime=this._perf.getNowHRTime(),this._activeSessionCounts={};const e=this._nextSessionCounts;this._nextSessionCounts={};const r=l(h(l({},this._getPermanentAttributes()),{[fs]:"ux.session",[bs]:Ws(this._visibilityDoc),[ps]:this._activeSessionId,[Ss]:this._coldStart,[vs]:Ks(this._storage,"embrace_session_number",this._diag),[Rs]:this._tab.experienceId,[As]:this._tab.tabId,[Is]:this._navigationSource}),e);this._referrerInfo.isValid&&this._referrerInfo.scrubbedUrl&&(r["emb.referrer_url"]=this._referrerInfo.scrubbedUrl),this._tab.sourceTabId&&(r["emb.source_tab_id"]=this._tab.sourceTabId),(null==t?void 0:t.reason)&&(r["emb.session_start_type"]=t.reason),this._sessionSpan=new qi(this._tracer.startSpan("emb-session",{attributes:r})),this._coldStart=!1;for(const t of this._sessionStartedListeners)try{t()}catch(t){this._diag.warn("Error while executing session started listener",t)}}incrSessionCountForKey(t){this._sessionSpan&&this._activeSessionCounts?this._activeSessionCounts[t]=(this._activeSessionCounts[t]||0)+1:this._diag.debug("trying to increment a count for the active session, but there is no session in progress. This is a no-op.")}incrNextSessionCountForKey(t){this._nextSessionCounts[t]=(this._nextSessionCounts[t]||0)+1}addSessionStartedListener(t){const e=this._sessionStartedListeners.push(t);return()=>{this._sessionStartedListeners.splice(e-1,1)}}addSessionEndedListener(t){const e=this._sessionEndedListeners.push(t);return()=>{this._sessionEndedListeners.splice(e-1,1)}}recordSDKStartupDuration(t){this._sdkStartupDuration=Math.ceil(t)}setTracerProvider(t){this._tracer=t.getTracer("embrace-web-sdk-sessions")}_determineNavigationSource(){try{const t=window.performance.getEntriesByType("navigation");if(t.length>0&&t[0]){const e=t[0];if("reload"===e.type)return"reload";if("back_forward"===e.type)return"back_forward"}}catch(t){this._diag.warn("Failed to get navigation type",t)}return this._referrerInfo.isValid?this._referrerInfo.isSameOrigin?"same_origin":"external":"direct"}_processReferrer(){if(!this._referrer)return{isValid:!1,isSameOrigin:!1};try{const t=new URL(this._referrer),e=window.location.origin;return{isValid:!0,isSameOrigin:t.origin===e,scrubbedUrl:t.origin+t.pathname}}catch(t){return{isValid:!1,isSameOrigin:!1}}}_getTabContext(t){const e=Vi(this._sessionStorage,this._diag);let r,n;if("same_origin"===t){const t=this._getTabActivity();if(t){Date.now()-t.lastActivityMs<=1e4&&(r=t.tabId,n=t.experienceId)}}return null!=n||(n=Gs()),{sourceTabId:r,experienceId:n,tabId:e}}_initTab(){const t=this._determineNavigationSource();try{const e=this._sessionStorage.getItem($i);if(e)return{tab:JSON.parse(e),navigationSource:t}}catch(t){this._diag.warn("Failed to retrieve tab data",t)}const e=this._getTabContext(t),r={experienceId:e.experienceId,sourceTabId:e.sourceTabId,tabId:e.tabId};try{this._sessionStorage.setItem($i,JSON.stringify(r))}catch(t){this._diag.warn("Failed to store tab data",t)}return{tab:r,navigationSource:t}}_getTabActivity(){try{const t=this._storage.getItem(zi);return t?JSON.parse(t):null}catch(t){return this._diag.warn("Failed to retrieve tab activity",t),null}}_storeTabActivity(t){try{this._storage.setItem(zi,JSON.stringify(t))}catch(t){this._diag.warn("Failed to save tab activity",t)}}_storeCurrentTabAsSource(){const t={tabId:this._tab.tabId,experienceId:this._tab.experienceId,lastActivityMs:Date.now()};this._storeTabActivity(t)}_setupNewTabClickListeners(){const t=t=>{var e;if(1===t.button||t.ctrlKey||t.metaKey||t.shiftKey)return void this._storeCurrentTabAsSource();(null==(e=t.target)?void 0:e.closest('a[target="_blank"], form[target="_blank"], a[rel*="noopener"], a[rel*="noreferrer"]'))&&this._storeCurrentTabAsSource()},e={capture:!0,passive:!0};document.addEventListener("auxclick",t,e),document.addEventListener("click",t,e)}},qi=class{constructor(t){p(this,"_span"),this._span=t}get attributes(){return this._span.attributes}addEvent(t,e,r){return this._span.addEvent(t,e,r),this}addLink(t){return this._span.addLink(t),this}addLinks(t){return this._span.addLinks(t),this}end(t){this._span.end(t)}isRecording(){return this._span.isRecording()}recordException(t,e){this._span.recordException(t,e)}setAttribute(t,e){return this._span.setAttribute(t,e),this}setAttributes(t){return this._span.setAttributes(t),this}removeAttribute(t){const e=this._span.attributes,{[t]:r}=e,n=g(e,[d(t)]);return this._span.attributes=n,this}setStatus(t){return this._span.setStatus(t),this}spanContext(){return this._span.spanContext()}updateName(t){return this._span.updateName(t),this}fail(t={code:"failure"}){t.code&&this._span.setAttribute("emb.error_code",t.code.toUpperCase()),this._span.end(t.endTime)}},Gi=class{constructor({tracerProvider:t}={}){p(this,"_tracer"),p(this,"setSpan",re.setSpan);const e=null!=t?t:re;this._tracer=e.getTracer("embrace-web-sdk-traces")}startSpan(t,e={},r){e.attributes=e.attributes?e.attributes:{},e.attributes[fs]="perf";const n=e.parentSpan?re.setSpan(Vt.active(),e.parentSpan):r;return new qi(this._tracer.startSpan(t,e,n))}getSpan(t){const e=re.getSpan(t);if(e)return new qi(e)}},Ki="embrace_user",Wi="embrace_user_id",Qi="embrace_external_user_id",Xi=class{constructor({diag:t,storage:e=window.localStorage}={}){p(this,"_diag"),p(this,"_storage"),p(this,"_embraceUserId",null),this._diag=null!=t?t:$t.createComponentLogger({namespace:"EmbraceUserManager"}),this._storage=e,this._migrateOldLocalStorageKey(),this._initialSetup()}getEmbraceUserId(){return this._embraceUserId||this._generateNewEmbraceUserId()}setEmbraceUserId(t){this._embraceUserId=t;try{this._storage.setItem(Wi,t)}catch(t){this._diag.warn("Failed to persist user object for storage, keeping it in-memory only",t)}}clearEmbraceUserId(){this._embraceUserId=null;try{this._storage.removeItem(Wi)}catch(t){this._diag.warn("Failed to remove embrace user in storage",t)}}_migrateOldLocalStorageKey(){try{const t=this._storage.getItem(Ki);if(t){const e=JSON.parse(t);(t=>"string"==typeof t[ve]&&32===t[ve].length)(e)?(this._diag.debug("Migrating old user data from storage"),this._storage.setItem(Wi,e[ve]),this._storage.removeItem(Ki)):(this._diag.warn("Invalid user data found in storage, clearing old user data"),this._storage.removeItem(Ki))}}catch(t){this._diag.warn("Failed to get old user data from storage",t)}}_initialSetup(){try{const e=this._storage.getItem(Wi);e?"string"==typeof(t=e)&&32===t.length?this._embraceUserId=e:(this._diag.warn("Invalid embrace user id, generating a new one"),this.clearEmbraceUserId()):this._diag.debug("No existing user found in storage, creating a new one")}catch(t){this._diag.warn("Failed to get embrace user id from storage, defaulting to a new one",t)}var t;this._embraceUserId||(this._embraceUserId=this._generateNewEmbraceUserId())}_generateNewEmbraceUserId(){const t=Gs();return this.setEmbraceUserId(t),t}getUserId(){try{return this._storage.getItem(Qi)}catch(t){return this._diag.warn("Failed to retrieve user id from storage",t),null}}setUserId(t){try{this._storage.setItem(Qi,t)}catch(t){this._diag.warn("Failed to store user id",t)}}clearUserId(){try{this._storage.removeItem(Qi)}catch(t){this._diag.warn("Failed to clear user id",t)}}},Ji=["keydown","mousedown","mousemove","scroll"],Yi=class extends ri{constructor({diag:t}={}){super({instrumentationName:"SpanSessionBrowserActivityInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),p(this,"_onActivityThrottled"),p(this,"_activityTimeout"),p(this,"disable",()=>{Ns({target:window,events:Ji,callback:this._onActivityThrottled}),this._activityTimeout&&clearTimeout(this._activityTimeout),this._activityTimeout=null}),p(this,"enable",()=>{ks({target:window,events:Ji,callback:this._onActivityThrottled})}),p(this,"_onInactivity",()=>{this._diag.debug("Inactivity detected"),this._activityTimeout&&clearTimeout(this._activityTimeout),this._activityTimeout=null,this.sessionManager.endSessionSpanInternal("inactivity")}),p(this,"_onActivity",()=>{this._diag.debug("Activity detected"),this._activityTimeout&&clearTimeout(this._activityTimeout),this.sessionManager.getSessionId()||this.sessionManager.startSessionSpan({reason:"activity"}),this._activityTimeout=setTimeout(this._onInactivity,18e5)}),this._activityTimeout=null,this._onActivityThrottled=ti(this._onActivity,3e4),this._config.enabled&&this.enable()}},Zi=class extends ri{constructor({diag:t}={}){super({instrumentationName:"SpanSessionOnLoadInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),this._config.enabled&&this.enable()}disable(){this.sessionManager.endSessionSpanInternal("unknown")}enable(){this.sessionManager.startSessionSpan({reason:"init"})}},to=144e5,eo=class extends ri{constructor({diag:t,perf:e}={}){super({instrumentationName:"SpanSessionTimeoutInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),p(this,"_sessionTimeout"),p(this,"disable",()=>{this._sessionTimeout&&clearTimeout(this._sessionTimeout),this._sessionTimeout=null}),p(this,"enable",()=>{this._checkTimeout()}),p(this,"_onTimeout",()=>{this._diag.debug("Timeout detected"),this._sessionTimeout&&clearTimeout(this._sessionTimeout),this.sessionManager.endSessionSpanInternal("timer"),this.sessionManager.startSessionSpan({reason:"timer"}),this._sessionTimeout=setTimeout(this._checkTimeout,to)}),p(this,"_checkTimeout",()=>{const t=this.sessionManager.getSessionStartTime();if(t){const e=this.perf.millisSinceHRTime(t),r=to-e;return r<=0?void this._onTimeout():(this._sessionTimeout&&clearTimeout(this._sessionTimeout),void(this._sessionTimeout=setTimeout(this._checkTimeout,r)))}this._sessionTimeout&&clearTimeout(this._sessionTimeout),this._sessionTimeout=setTimeout(this._checkTimeout,to)}),this._sessionTimeout=null,this._config.enabled&&this.enable()}},ro=["mousedown"],no=class extends ri{constructor({diag:t,perf:e,visibilityWaitTimeMs:r=0,limitedSessionMaxDurationMs:n=0,backgroundSessions:s=!1,maxPendingSpanCount:i=5,visibilityDoc:o=window.document}={},a){super({instrumentationName:"SpanSessionVisibilityInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),p(this,"_currentVisibilityState"),p(this,"_checkVisibilityTimeout"),p(this,"_interactionSinceLastVisibilityChange"),p(this,"_avoidEndingLimitedSessions"),p(this,"_embraceSpanProcessor"),p(this,"_checkVisibilityChange"),p(this,"_onVisibilityChange"),p(this,"_onInteractionThrottled"),this._currentVisibilityState=o.visibilityState,this._checkVisibilityTimeout=null,this._interactionSinceLastVisibilityChange=!1,this._avoidEndingLimitedSessions=n>0,this._embraceSpanProcessor=a,this._checkVisibilityChange=()=>r<=0?(this._currentVisibilityState=o.visibilityState,void this._onVisibilityChange()):(this._checkVisibilityTimeout&&clearTimeout(this._checkVisibilityTimeout),"visible"===o.visibilityState&&this._currentVisibilityState!==o.visibilityState?(this._currentVisibilityState=o.visibilityState,void this._onVisibilityChange()):(this._diag.debug(`Visibility changed to ${o.visibilityState}. Will wait ${(r/1e3).toString()}s, and check if visibility changed`),void(this._checkVisibilityTimeout=setTimeout(()=>{this._currentVisibilityState!==o.visibilityState?(this._currentVisibilityState=o.visibilityState,this._onVisibilityChange()):this._diag.debug(`Visibility was not changed after timeout happened: ${o.visibilityState}`)},r)))),this._onVisibilityChange=()=>{this._diag.debug(`Visibility change detected: ${o.visibilityState}`);const t=this.sessionManager.getSessionStartTime();if(this._avoidEndingLimitedSessions&&null!==t&&this.perf.millisSinceHRTime(t)<n&&!this._interactionSinceLastVisibilityChange&&!!this._embraceSpanProcessor&&this._embraceSpanProcessor.getPendingSpansCount()<i){this._diag.debug("Not ending the session since it is considered limited"),this.sessionManager.addBreadcrumb(`Tab visibility changed to ${o.visibilityState}`);const t=this.sessionManager.getSessionId();if(t){const e=this.sessionManager.currentSessionAsReadableSpan("state_changed");e&&this._embraceSpanProcessor.storePendingSpans(t,e)}}else{const t=this.sessionManager.getSessionId();this._embraceSpanProcessor&&t&&this._embraceSpanProcessor.clearStoredSpans(t),this.sessionManager.endSessionSpanInternal("state_changed"),"hidden"===o.visibilityState&&s?(this._diag.debug("Starting a session since document visibility switched to hidden and `backgroundSessions` is enabled"),this.sessionManager.startSessionSpan({reason:"hidden"})):"visible"===o.visibilityState&&(this._diag.debug("Starting a session since document visibility switched to visible"),this.sessionManager.startSessionSpan({reason:"visible"}))}this._interactionSinceLastVisibilityChange=!1},this._onInteractionThrottled=ti(()=>{this._interactionSinceLastVisibilityChange=!0},1e3),this._config.enabled&&this.enable()}disable(){window.removeEventListener("visibilitychange",this._checkVisibilityChange),this._avoidEndingLimitedSessions&&Ns({target:window,events:ro,callback:this._onInteractionThrottled})}enable(){window.addEventListener("visibilitychange",this._checkVisibilityChange),this._avoidEndingLimitedSessions&&ks({target:window,events:ro,callback:this._onInteractionThrottled})}},so=class{constructor(){p(this,"t"),p(this,"o",0),p(this,"i",[])}u(t){var e;if(t.hadRecentInput)return;const r=this.i[0],n=this.i.at(-1);this.o&&r&&n&&t.startTime-n.startTime<1e3&&t.startTime-r.startTime<5e3?(this.o+=t.value,this.i.push(t)):(this.o=t.value,this.i=[t]),null==(e=this.t)||e.call(this,t)}},io=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},oo=t=>{if("loading"===document.readyState)return"loading";{const e=io();if(e){if(t<e.domInteractive)return"loading";if(0===e.domContentLoadedEventStart||t<e.domContentLoadedEventStart)return"dom-interactive";if(0===e.domComplete||t<e.domComplete)return"dom-content-loaded"}}return"complete"},ao=t=>{const e=t.nodeName;return 1===t.nodeType?e.toLowerCase():e.toUpperCase().replace(/^#/,"")},uo=t=>{let e="";try{for(;9!==(null==t?void 0:t.nodeType);){const r=t,n=r.id?"#"+r.id:[ao(r),...Array.from(r.classList).sort()].join(".");if(e.length+n.length>99)return e||n;if(e=e?n+">"+e:n,r.id)break;t=r.parentNode}}catch(t){}return e},co=new WeakMap;function lo(t,e){return co.get(t)||co.set(t,new e),co.get(t)}var ho,go,po,mo=-1,_o=()=>mo,fo=t=>{addEventListener("pageshow",e=>{e.persisted&&(mo=e.timeStamp,t(e))},!0)},bo=(t,e,r,n)=>{let s,i;return o=>{var a,u;e.value>=0&&(o||n)&&(i=e.value-(null!=s?s:0),(i||void 0===s)&&(s=e.value,e.delta=i,e.rating=(a=e.value)>(u=r)[1]?"poor":a>u[0]?"needs-improvement":"good",t(e)))}},So=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},vo=()=>{var t;const e=io();return null!=(t=null==e?void 0:e.activationStart)?t:0},yo=(t,e=-1)=>{const r=io();let n="navigate";return _o()>=0?n="back-forward-cache":r&&(document.prerendering||vo()>0?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},wo=(t,e,r={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const n=new PerformanceObserver(t=>{Promise.resolve().then(()=>{e(t.getEntries())})});return n.observe(l({type:t,buffered:!0},r)),n}}catch(t){}},To=t=>{let e=!1;return()=>{e||(t(),e=!0)}},Eo=-1,Co=new Set,xo=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,Lo=t=>{if("hidden"===document.visibilityState){if("visibilitychange"===t.type)for(const t of Co)t();isFinite(Eo)||(Eo="visibilitychange"===t.type?t.timeStamp:0,removeEventListener("prerenderingchange",Lo,!0))}},Ao=()=>{var t;if(Eo<0){const e=vo(),r=document.prerendering||null==(t=globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0])?void 0:t.startTime;Eo=null!=r?r:xo(),addEventListener("visibilitychange",Lo,!0),addEventListener("prerenderingchange",Lo,!0),fo(()=>{setTimeout(()=>{Eo=xo()})})}return{get firstHiddenTime(){return Eo},onHidden(t){Co.add(t)}}},Ro=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},Po=[1800,3e3],Mo=(t,e={})=>{Ro(()=>{const r=Ao();let n,s=yo("FCP");const i=wo("paint",t=>{for(const e of t)"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<r.firstHiddenTime&&(s.value=Math.max(e.startTime-vo(),0),s.entries.push(e),n(!0)))});i&&(n=bo(t,s,Po,e.reportAllChanges),fo(r=>{s=yo("FCP"),n=bo(t,s,Po,e.reportAllChanges),So(()=>{s.value=performance.now()-r.timeStamp,n(!0)})}))})},Io=[.1,.25],Do=t=>t.find(t=>{var e;return 1===(null==(e=t.node)?void 0:e.nodeType)})||t[0],Oo=0,ko=1/0,No=0,Fo=t=>{for(const e of t)e.interactionId&&(ko=Math.min(ko,e.interactionId),No=Math.max(No,e.interactionId),Oo=No?(No-ko)/7+1:0)},Uo=()=>{var t;return ho?Oo:null!=(t=performance.interactionCount)?t:0},Bo=0,jo=class{constructor(){p(this,"l",[]),p(this,"h",new Map),p(this,"m"),p(this,"p")}v(){Bo=Uo(),this.l.length=0,this.h.clear()}M(){const t=Math.min(this.l.length-1,Math.floor((Uo()-Bo)/50));return this.l[t]}u(t){var e,r;if(null==(e=this.m)||e.call(this,t),!t.interactionId&&"first-input"!==t.entryType)return;const n=this.l.at(-1);let s=this.h.get(t.interactionId);if(s||this.l.length<10||t.duration>n.T){if(s?t.duration>s.T?(s.entries=[t],s.T=t.duration):t.duration===s.T&&t.startTime===s.entries[0].startTime&&s.entries.push(t):(s={id:t.interactionId,entries:[t],T:t.duration},this.h.set(s.id,s),this.l.push(s)),this.l.sort((t,e)=>e.T-t.T),this.l.length>10){const t=this.l.splice(10);for(const e of t)this.h.delete(e.id)}null==(r=this.p)||r.call(this,s)}}},Vo=t=>{const e=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?t():(t=To(t),addEventListener("visibilitychange",t,{once:!0,capture:!0}),e(()=>{t(),removeEventListener("visibilitychange",t,{capture:!0})}))},$o=[200,500],zo=class{constructor(){p(this,"m")}u(t){var e;null==(e=this.m)||e.call(this,t)}},Ho=[2500,4e3],qo=[800,1800],Go=t=>{document.prerendering?Ro(()=>Go(t)):"complete"!==document.readyState?addEventListener("load",()=>Go(t),!0):setTimeout(t)},Ko=["CLS","INP","LCP"],Wo=["CLS","INP","LCP","FCP","TTFB"],Qo={CLS:(t,e={})=>{const r=lo(e=Object.assign({},e),so),n=new WeakMap;r.t=t=>{var r,s,i;if(null==(r=null==t?void 0:t.sources)?void 0:r.length){const r=Do(t.sources),o=null==r?void 0:r.node;if(o){const t=null!=(i=null==(s=e.generateTarget)?void 0:s.call(e,o))?i:uo(o);n.set(r,t)}}},((t,e={})=>{const r=Ao();Mo(To(()=>{let n,s=yo("CLS",0);const i=lo(e,so),o=t=>{for(const e of t)i.u(e);i.o>s.value&&(s.value=i.o,s.entries=i.i,n())},a=wo("layout-shift",o);a&&(n=bo(t,s,Io,e.reportAllChanges),r.onHidden(()=>{o(a.takeRecords()),n(!0)}),fo(()=>{i.o=0,s=yo("CLS",0),n=bo(t,s,Io,e.reportAllChanges),So(()=>n())}),setTimeout(n))}))})(e=>{const r=(t=>{var e;let r={};if(t.entries.length){const s=t.entries.reduce((t,e)=>t.value>e.value?t:e);if(null==(e=null==s?void 0:s.sources)?void 0:e.length){const t=Do(s.sources);t&&(r={largestShiftTarget:n.get(t),largestShiftTime:s.startTime,largestShiftValue:s.value,largestShiftSource:t,largestShiftEntry:s,loadState:oo(s.startTime)})}}return Object.assign(t,{attribution:r})})(e);t(r)},e)},FCP:(t,e={})=>{Mo(e=>{const r=(t=>{let e={timeToFirstByte:0,firstByteToFCP:t.value,loadState:oo(_o())};if(t.entries.length){const r=io(),n=t.entries.at(-1);if(r){const s=r.activationStart||0,i=Math.max(0,r.responseStart-s);e={timeToFirstByte:i,firstByteToFCP:t.value-i,loadState:oo(t.entries[0].startTime),navigationEntry:r,fcpEntry:n}}}return Object.assign(t,{attribution:e})})(e);t(r)},e)},LCP:(t,e={})=>{const r=lo(e=Object.assign({},e),zo),n=new WeakMap;r.m=t=>{var r,s;const i=t.element;if(i){const o=null!=(s=null==(r=e.generateTarget)?void 0:r.call(e,i))?s:uo(i);n.set(t,o)}},((t,e={})=>{Ro(()=>{const r=Ao();let n,s=yo("LCP");const i=lo(e,zo),o=t=>{e.reportAllChanges||(t=t.slice(-1));for(const e of t)i.u(e),e.startTime<r.firstHiddenTime&&(s.value=Math.max(e.startTime-vo(),0),s.entries=[e],n())},a=wo("largest-contentful-paint",o);if(a){n=bo(t,s,Ho,e.reportAllChanges);const r=To(()=>{o(a.takeRecords()),a.disconnect(),n(!0)}),i=t=>{t.isTrusted&&(Vo(r),removeEventListener(t.type,i,{capture:!0}))};for(const t of["keydown","click","visibilitychange"])addEventListener(t,i,{capture:!0});fo(r=>{s=yo("LCP"),n=bo(t,s,Ho,e.reportAllChanges),So(()=>{s.value=performance.now()-r.timeStamp,n(!0)})})}})})(e=>{const r=(t=>{let e={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:t.value};if(t.entries.length){const r=io();if(r){const s=r.activationStart||0,i=t.entries.at(-1),o=i.url&&performance.getEntriesByType("resource").filter(t=>t.name===i.url)[0],a=Math.max(0,r.responseStart-s),u=Math.max(a,o?(o.requestStart||o.startTime)-s:0),c=Math.min(t.value,Math.max(u,o?o.responseEnd-s:0));e={target:n.get(i),timeToFirstByte:a,resourceLoadDelay:u-a,resourceLoadDuration:c-u,elementRenderDelay:t.value-c,navigationEntry:r,lcpEntry:i},i.url&&(e.url=i.url),o&&(e.lcpResourceEntry=o)}}return Object.assign(t,{attribution:e})})(e);t(r)},e)},INP:(t,e={})=>{const r=lo(e=Object.assign({},e),jo);let n=[],s=[],i=0;const o=new WeakMap,a=new WeakMap;let u=!1;const c=()=>{u||(Vo(l),u=!0)},l=()=>{const t=r.l.map(t=>o.get(t.entries[0])),e=s.length-50;s=s.filter((r,n)=>n>=e||t.includes(r));const a=new Set;for(const t of s){const e=h(t.startTime,t.processingEnd);for(const t of e)a.add(t)}const c=n.length-1-50;n=n.filter((t,e)=>t.startTime>i&&e>c||a.has(t)),u=!1};r.m=t=>{const e=t.startTime+t.duration;let r;i=Math.max(i,t.processingEnd);for(let n=s.length-1;n>=0;n--){const i=s[n];if(Math.abs(e-i.renderTime)<=8){r=i,r.startTime=Math.min(t.startTime,r.startTime),r.processingStart=Math.min(t.processingStart,r.processingStart),r.processingEnd=Math.max(t.processingEnd,r.processingEnd),r.entries.push(t);break}}r||(r={startTime:t.startTime,processingStart:t.processingStart,processingEnd:t.processingEnd,renderTime:e,entries:[t]},s.push(r)),(t.interactionId||"first-input"===t.entryType)&&o.set(t,r),c()},r.p=t=>{var r,n;if(!a.get(t)){const s=t.entries[0].target;if(s){const i=null!=(n=null==(r=e.generateTarget)?void 0:r.call(e,s))?n:uo(s);a.set(t,i)}}};const h=(t,e)=>{const r=[];for(const s of n)if(!(s.startTime+s.duration<t)){if(s.startTime>e)break;r.push(s)}return r};wo("long-animation-frame",t=>{n=n.concat(t),c()}),((t,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const r=Ao();Ro(()=>{var n;"interactionCount"in performance||ho||(ho=wo("event",Fo,{type:"event",buffered:!0,durationThreshold:0}));let s,i=yo("INP");const o=lo(e,jo),a=t=>{Vo(()=>{for(const e of t)o.u(e);const e=o.M();e&&e.T!==i.value&&(i.value=e.T,i.entries=e.entries,s())})},u=wo("event",a,{durationThreshold:null!=(n=e.durationThreshold)?n:40});s=bo(t,i,$o,e.reportAllChanges),u&&(u.observe({type:"first-input",buffered:!0}),r.onHidden(()=>{a(u.takeRecords()),s(!0)}),fo(()=>{o.v(),i=yo("INP"),s=bo(t,i,$o,e.reportAllChanges)}))})})(e=>{const n=(t=>{const e=t.entries[0],n=o.get(e),s=e.processingStart,i=Math.max(e.startTime+e.duration,s),u=Math.min(n.processingEnd,i),c=n.entries.sort((t,e)=>t.processingStart-e.processingStart),l=h(e.startTime,u),d=r.h.get(e.interactionId),g={interactionTarget:a.get(d),interactionType:e.name.startsWith("key")?"keyboard":"pointer",interactionTime:e.startTime,nextPaintTime:i,processedEventEntries:c,longAnimationFrameEntries:l,inputDelay:s-e.startTime,processingDuration:u-s,presentationDelay:i-u,loadState:oo(e.startTime),longestScript:void 0,totalScriptDuration:void 0,totalStyleAndLayoutDuration:void 0,totalPaintDuration:void 0,totalUnattributedDuration:void 0};return(t=>{var e;if(!(null==(e=t.longAnimationFrameEntries)?void 0:e.length))return;const r=t.interactionTime,n=t.inputDelay,s=t.processingDuration;let i,o,a=0,u=0,c=0,l=0;for(const e of t.longAnimationFrameEntries){u=u+e.startTime+e.duration-e.styleAndLayoutStart;for(const t of e.scripts){const e=t.startTime+t.duration;if(e<r)continue;const c=e-Math.max(r,t.startTime),h=t.duration?c/t.duration*t.forcedStyleAndLayoutDuration:0;a+=c-h,u+=h,c>l&&(o=t.startTime<r+n?"input-delay":t.startTime>=r+n+s?"presentation-delay":"processing-duration",i=t,l=c)}}const h=t.longAnimationFrameEntries.at(-1),d=h?h.startTime+h.duration:0;d>=r+n+s&&(c=t.nextPaintTime-d),i&&o&&(t.longestScript={entry:i,subpart:o,intersectingDuration:l}),t.totalScriptDuration=a,t.totalStyleAndLayoutDuration=u,t.totalPaintDuration=c,t.totalUnattributedDuration=t.nextPaintTime-r-a-u-c})(g),Object.assign(t,{attribution:g})})(e);t(n)},e)},TTFB:(t,e={})=>{((t,e={})=>{let r=yo("TTFB"),n=bo(t,r,qo,e.reportAllChanges);Go(()=>{const s=io();s&&(r.value=Math.max(s.responseStart-vo(),0),r.entries=[s],n(!0),fo(()=>{r=yo("TTFB",0),n=bo(t,r,qo,e.reportAllChanges),n(!0)}))})})(e=>{const r=(t=>{let e={waitingDuration:0,cacheDuration:0,dnsDuration:0,connectionDuration:0,requestDuration:0};if(t.entries.length){const r=t.entries[0],n=r.activationStart||0,s=Math.max((r.workerStart||r.fetchStart)-n,0),i=Math.max(r.domainLookupStart-n,0),o=Math.max(r.connectStart-n,0),a=Math.max(r.connectEnd-n,0);e={waitingDuration:s,cacheDuration:i-s,dnsDuration:o-i,connectionDuration:a-o,requestDuration:t.value-a,navigationEntry:r}}return Object.assign(t,{attribution:e})})(e);t(r)},e)},FID:void 0},Xo=class extends ri{constructor({diag:t,perf:e,trackingLevel:r="core",listeners:n=Qo,urlDocument:s=window.document,urlAttribution:i=!0,pageManager:o}={}){super({instrumentationName:"WebVitalsInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),p(this,"_metricsToTrack"),p(this,"_listeners"),p(this,"_urlDocument"),p(this,"_urlAttribution"),p(this,"_pageManager"),p(this,"_attributedPage",{INP:void 0,LCP:void 0,CLS:void 0,FCP:void 0,TTFB:void 0}),p(this,"_largestShiftTargetForCLS"),this._listeners=n,this._urlDocument=s,this._metricsToTrack="core"===r?[...Ko]:[...Wo],this._urlAttribution=i,this._pageManager=null!=o?o:le.getPageManager(),this._config.enabled&&this.enable()}disable(){}enable(){var t,e,r,n,s,i;this._metricsToTrack.forEach(t=>{var e,r;null==(r=(e=this._listeners)[t])||r.call(e,e=>{const r=this.sessionManager.getSessionSpan();if(!r)return;const n=this._getTimeForMetric(e),s=this._getAttributedPageForMetric(e),i=l({[fs]:"ux.web_vital",[nr]:s.fullURL,"emb.web_vital.navigation_type":e.navigationType,"emb.web_vital.name":e.name,"emb.web_vital.rating":e.rating,"emb.web_vital.id":e.id,"emb.web_vital.delta":e.delta,"emb.web_vital.value":e.value},((t,e)=>{const r={},n=[];if("CLS"===t){const t=e.attribution;n.push({key:"largestShiftTarget",value:t.largestShiftTarget},{key:"largestShiftValue",value:t.largestShiftValue})}else if("INP"===t){const t=e.attribution;n.push({key:"interactionTarget",value:t.interactionTarget},{key:"interactionType",value:t.interactionType},{key:"nextPaintTime",value:t.nextPaintTime},{key:"inputDelay",value:t.inputDelay},{key:"processingDuration",value:t.processingDuration},{key:"presentationDelay",value:t.presentationDelay},{key:"totalScriptDuration",value:t.totalScriptDuration},{key:"totalStyleAndLayoutDuration",value:t.totalStyleAndLayoutDuration},{key:"totalPaintDuration",value:t.totalPaintDuration},{key:"totalUnattributedDuration",value:t.totalUnattributedDuration},{key:"loadState",value:t.loadState})}else if("LCP"===t){const t=e.attribution;n.push({key:"target",value:t.target},{key:"url",value:t.url},{key:"timeToFirstByte",value:t.timeToFirstByte},{key:"resourceLoadDelay",value:t.resourceLoadDelay},{key:"resourceLoadDuration",value:t.resourceLoadDuration},{key:"elementRenderDelay",value:t.elementRenderDelay})}return n.forEach(t=>{void 0!==t.value&&(r[`emb.web_vital.attribution.${t.key}`]=t.value)}),r})(t,e));s.path&&s.pageID&&(i[Ds]=s.path,i[Os]=s.pageID),r.addEvent(`emb-web-vitals-report-${t}`,i,n)})}),this._urlAttribution&&(null==(e=(t=this._listeners).INP)||e.call(t,()=>{this._attributedPage.INP=this._currentAttributedPage()},{reportAllChanges:!0}),null==(n=(r=this._listeners).LCP)||n.call(r,()=>{this._attributedPage.LCP=this._currentAttributedPage()},{reportAllChanges:!0}),null==(i=(s=this._listeners).CLS)||i.call(s,t=>{const e=t;this._largestShiftTargetForCLS!==e.attribution.largestShiftTarget&&(this._largestShiftTargetForCLS=e.attribution.largestShiftTarget,this._attributedPage.CLS=this._currentAttributedPage())},{reportAllChanges:!0}))}_getTimeForMetric(t){return"CLS"===t.name&&t.attribution.largestShiftTime?this.perf.epochMillisFromOriginOffset(t.attribution.largestShiftTime):"INP"===t.name&&t.attribution.interactionTime?this.perf.epochMillisFromOriginOffset(t.attribution.interactionTime):this.perf.getNowMillis()}_currentAttributedPage(){const t={fullURL:this._urlDocument.URL},e=this._pageManager.getCurrentRoute(),r=this._pageManager.getCurrentPageId();return e&&r&&(t.path=e.path,t.pageID=r),t}_getAttributedPageForMetric(t){return"INP"===t.name&&this._attributedPage.INP?this._attributedPage.INP:"LCP"===t.name&&this._attributedPage.LCP?this._attributedPage.LCP:"CLS"===t.name&&this._attributedPage.CLS&&t.attribution.largestShiftTarget===this._largestShiftTargetForCLS?this._attributedPage.CLS:this._currentAttributedPage()}};(po=go||(go={})).METHOD_OPEN="open",po.METHOD_SEND="send",po.EVENT_ABORT="abort",po.EVENT_ERROR="error",po.EVENT_LOAD="loaded",po.EVENT_TIMEOUT="timeout";var Jo=$t.createComponentLogger({namespace:"@opentelemetry/opentelemetry-instrumentation-xml-http-request/utils"});function Yo(t){return e=t,"undefined"!=typeof Document&&e instanceof Document?(new XMLSerializer).serializeToString(document).length:"string"==typeof t?ta(t):t instanceof Blob?t.size:t instanceof FormData?function(t){let e=0;for(const[r,n]of t.entries())e+=r.length,n instanceof Blob?e+=n.size:e+=n.length;return e}(t):t instanceof URLSearchParams?ta(t.toString()):void 0!==t.byteLength?t.byteLength:void Jo.warn("unknown body type");var e}var Zo=new TextEncoder;function ta(t){return Zo.encode(t).byteLength}function ea(t){const e=function(){if(void 0===ra){const t=void 0;t&&t.length>0?(ra={},t.forEach(t=>{ra[t]=!0})):ra=na}return ra}(),r=t.toUpperCase();return r in e?r:"_OTHER"}var ra,na={CONNECT:!0,DELETE:!0,GET:!0,HEAD:!0,OPTIONS:!0,PATCH:!0,POST:!0,PUT:!0,TRACE:!0};var sa={"https:":"443","http:":"80"};var ia,oa="0.207.0";!function(t){t.HTTP_STATUS_TEXT="http.status_text"}(ia||(ia={}));var aa=class extends yn{constructor(t={}){super("@opentelemetry/instrumentation-xml-http-request",oa,t),p(this,"component","xml-http-request"),p(this,"version",oa),p(this,"moduleName",this.component),p(this,"_tasksCount",0),p(this,"_xhrMem",new WeakMap),p(this,"_usedResources",new WeakSet),p(this,"_semconvStability"),this._semconvStability=En("http",null==t?void 0:t.semconvStabilityOptIn)}init(){}_addHeaders(t,e){if(!ls(cs(e).href,this.getConfig().propagateTraceHeaderCorsUrls)){const t={};return te.inject(Vt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}const r={};te.inject(Vt.active(),r),Object.keys(r).forEach(e=>{t.setRequestHeader(e,String(r[e]))})}_addChildSpan(t,e){Vt.with(re.setSpan(Vt.active(),t),()=>{const t=this.tracer.startSpan("CORS Preflight",{startTime:e[ts.FETCH_START]}),r=!(this._semconvStability&bn.OLD);os(t,e,this.getConfig().ignoreNetworkEvents,void 0,r),t.end(e[ts.RESPONSE_END])})}_addFinalSpanAttributes(t,e,r){if(this._semconvStability&bn.OLD){if(void 0!==e.status&&t.setAttribute("http.status_code",e.status),void 0!==e.statusText&&t.setAttribute(ia.HTTP_STATUS_TEXT,e.statusText),"string"==typeof r){const e=cs(r);t.setAttribute("http.host",e.host),t.setAttribute("http.scheme",e.protocol.replace(":",""))}t.setAttribute("http.user_agent",navigator.userAgent)}this._semconvStability&bn.STABLE&&e.status&&t.setAttribute(Xe,e.status)}_applyAttributesAfterXHR(t,e){const r=this.getConfig().applyCustomAttributesOnSpan;"function"==typeof r&&wn(()=>r(t,e),t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)},!0)}_addResourceObserver(t,e){const r=this._xhrMem.get(t);r&&"function"==typeof PerformanceObserver&&"function"==typeof PerformanceResourceTiming&&(r.createdResources={observer:new PerformanceObserver(t=>{const n=t.getEntries(),s=cs(e);n.forEach(t=>{"xmlhttprequest"===t.initiatorType&&t.name===s.href&&r.createdResources&&r.createdResources.entries.push(t)})}),entries:[]},r.createdResources.observer.observe({entryTypes:["resource"]}))}_clearResources(){0===this._tasksCount&&this.getConfig().clearTimingResources&&(je.clearResourceTimings(),this._xhrMem=new WeakMap,this._usedResources=new WeakSet)}_findResourceAndAddNetworkEvents(t,e,r,n,s){if(!(r&&n&&s&&t.createdResources))return;let i=t.createdResources.entries;i&&i.length||(i=je.getEntriesByType("resource"));const o=us(cs(r).href,n,s,i,this._usedResources);if(o.mainRequest){const t=o.mainRequest;this._markResourceAsUsed(t);const r=o.corsPreFlightRequest;r&&(this._addChildSpan(e,r),this._markResourceAsUsed(r));const n=!(this._semconvStability&bn.OLD);os(e,t,this.getConfig().ignoreNetworkEvents,void 0,n)}}_cleanPreviousSpanInformation(t){const e=this._xhrMem.get(t);if(e){const r=e.callbackToRemoveEvents;r&&r(),this._xhrMem.delete(t)}}_createSpan(t,e,r){if(Wr(e,this.getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");let n="";const s=cs(e),i={};if(this._semconvStability&bn.OLD&&(n=r.toUpperCase(),i["http.method"]=r,i["http.url"]=s.toString()),this._semconvStability&bn.STABLE){const t=r,e=ea(r);n||(n=e),i[We]=e,e!==t&&(i[Qe]=t),i[nr]=s.toString(),i[Je]=s.hostname;const o=function(t){const e=Number(t.port||sa[t.protocol]);return e&&!isNaN(e)?e:void 0}(s);o&&(i[Ye]=o)}const o=this.tracer.startSpan(n,{kind:Dt.CLIENT,attributes:i});return o.addEvent(go.METHOD_OPEN),this._cleanPreviousSpanInformation(t),this._xhrMem.set(t,{span:o,spanUrl:e}),o}_markResourceAsUsed(t){this._usedResources.add(t)}_patchOpen(){return t=>{const e=this;return function(...r){const n=r[0],s=r[1];return e._createSpan(this,s,n),t.apply(this,r)}}}_patchSend(){const t=this;function e(e,r,n,s){const i=t._xhrMem.get(r);if(!i)return;if(i.status=r.status,i.statusText=r.statusText,t._xhrMem.delete(r),i.span){const e=i.span;t._applyAttributesAfterXHR(e,r),t._semconvStability&bn.STABLE&&(n?s&&(e.setStatus({code:kt.ERROR,message:s}),e.setAttribute(He,s)):i.status&&i.status>=400&&(e.setStatus({code:kt.ERROR}),e.setAttribute(He,String(i.status))))}const o=hr(),a=Date.now();setTimeout(()=>{!function(e,r,n,s){const i=r.callbackToRemoveEvents;"function"==typeof i&&i();const{span:o,spanUrl:a,sendStartTime:u}=r;o&&(t._findResourceAndAddNetworkEvents(r,o,a,u,n),o.addEvent(e,s),t._addFinalSpanAttributes(o,r,a),o.end(s),t._tasksCount--),t._clearResources()}(e,i,o,a)},300)}function r(){e(go.EVENT_ERROR,this,!0,"error")}function n(){e(go.EVENT_ABORT,this,!1)}function s(){e(go.EVENT_TIMEOUT,this,!0,"timeout")}function i(){this.status<299?e(go.EVENT_LOAD,this,!1):e(go.EVENT_ERROR,this,!1)}return e=>function(...o){const a=t._xhrMem.get(this);if(!a)return e.apply(this,o);const u=a.span,c=a.spanUrl;if(u&&c){if(t.getConfig().measureRequestSize&&(null==o?void 0:o[0])){const e=Yo(o[0]);void 0!==e&&(t._semconvStability&bn.OLD&&u.setAttribute("http.request_content_length_uncompressed",e),t._semconvStability&bn.STABLE&&u.setAttribute("http.request.body.size",e))}Vt.with(re.setSpan(Vt.active(),u),()=>{t._tasksCount++,a.sendStartTime=hr(),u.addEvent(go.METHOD_SEND),this.addEventListener("abort",n),this.addEventListener("error",r),this.addEventListener("load",i),this.addEventListener("timeout",s),a.callbackToRemoveEvents=()=>{!function(e){e.removeEventListener("abort",n),e.removeEventListener("error",r),e.removeEventListener("load",i),e.removeEventListener("timeout",s);const o=t._xhrMem.get(e);o&&(o.callbackToRemoveEvents=void 0)}(this),a.createdResources&&a.createdResources.observer.disconnect()},t._addHeaders(this,c),t._addResourceObserver(this,c)})}return e.apply(this,o)}}enable(){this._diag.debug("applying patch to",this.moduleName,this.version),Tn(XMLHttpRequest.prototype.open)&&(this._unwrap(XMLHttpRequest.prototype,"open"),this._diag.debug("removing previous patch from method open")),Tn(XMLHttpRequest.prototype.send)&&(this._unwrap(XMLHttpRequest.prototype,"send"),this._diag.debug("removing previous patch from method send")),this._wrap(XMLHttpRequest.prototype,"open",this._patchOpen()),this._wrap(XMLHttpRequest.prototype,"send",this._patchSend())}disable(){this._diag.debug("removing patch from",this.moduleName,this.version),this._unwrap(XMLHttpRequest.prototype,"open"),this._unwrap(XMLHttpRequest.prototype,"send"),this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}},ua=class extends aa{constructor(t={}){var e=t,{omitIfAlreadyPatched:r}=e,n=g(e,["omitIfAlreadyPatched"]);super(h(l({},n),{enabled:!1})),p(this,"_omitIfAlreadyPatched"),this._omitIfAlreadyPatched=r,n.enabled&&this.enable()}enable(){this._omitIfAlreadyPatched&&(Tn(XMLHttpRequest.prototype.open)||Tn(XMLHttpRequest.prototype.send))?this._diag.debug("XMLHttpRequest is already passed and `omitIfAlreadyPatched` is true, skipping enabling this instrumentation"):super.enable()}},ca=class{constructor(t,e,r){p(this,"hrTime"),p(this,"hrTimeObserved"),p(this,"spanContext"),p(this,"resource"),p(this,"instrumentationScope"),p(this,"attributes",{}),p(this,"_severityText"),p(this,"_severityNumber"),p(this,"_body"),p(this,"_eventName"),p(this,"totalAttributesCount",0),p(this,"_isReadonly",!1),p(this,"_logRecordLimits");const{timestamp:n,observedTimestamp:s,eventName:i,severityNumber:o,severityText:a,body:u,attributes:c={},context:l}=r,h=Date.now();if(this.hrTime=dr(null!=n?n:h),this.hrTimeObserved=dr(null!=s?s:h),l){const t=re.getSpanContext(l);t&&Lt(t)&&(this.spanContext=t)}this.severityNumber=o,this.severityText=a,this.body=u,this.resource=t.resource,this.instrumentationScope=e,this._logRecordLimits=t.logRecordLimits,this._eventName=i,this.setAttributes(c)}set severityText(t){this._isLogRecordReadonly()||(this._severityText=t)}get severityText(){return this._severityText}set severityNumber(t){this._isLogRecordReadonly()||(this._severityNumber=t)}get severityNumber(){return this._severityNumber}set body(t){this._isLogRecordReadonly()||(this._body=t)}get body(){return this._body}get eventName(){return this._eventName}set eventName(t){this._isLogRecordReadonly()||(this._eventName=t)}get droppedAttributesCount(){return this.totalAttributesCount-Object.keys(this.attributes).length}setAttribute(t,e){return this._isLogRecordReadonly()||null===e?this:0===t.length?($t.warn(`Invalid attribute key: ${t}`),this):De(e)||"object"==typeof e&&!Array.isArray(e)&&Object.keys(e).length>0?(this.totalAttributesCount+=1,Object.keys(this.attributes).length>=this._logRecordLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(1===this.droppedAttributesCount&&$t.warn("Dropping extra attributes."),this):(De(e)?this.attributes[t]=this._truncateToSize(e):this.attributes[t]=e,this)):($t.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,r]of Object.entries(t))this.setAttribute(e,r);return this}setBody(t){return this.body=t,this}setEventName(t){return this.eventName=t,this}setSeverityNumber(t){return this.severityNumber=t,this}setSeverityText(t){return this.severityText=t,this}_makeReadonly(){this._isReadonly=!0}_truncateToSize(t){const e=this._logRecordLimits.attributeValueLengthLimit;return e<=0?($t.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map(t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t):t}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substring(0,e)}_isLogRecordReadonly(){return this._isReadonly&&$t.warn("Can not execute the operation on emitted log record"),this._isReadonly}},la=class{constructor(t,e){p(this,"instrumentationScope"),p(this,"_sharedState"),this.instrumentationScope=t,this._sharedState=e}emit(t){const e=t.context||Vt.active(),r=new ca(this._sharedState,this.instrumentationScope,l({context:e},t));this._sharedState.activeProcessor.onEmit(r,e),r._makeReadonly()}};var ha=class{forceFlush(){return Promise.resolve()}onEmit(t,e){}shutdown(){return Promise.resolve()}},da=class{constructor(t,e){p(this,"processors"),p(this,"forceFlushTimeoutMillis"),this.processors=t,this.forceFlushTimeoutMillis=e}forceFlush(){return m(this,null,function*(){const t=this.forceFlushTimeoutMillis;yield Promise.all(this.processors.map(e=>Gr(e.forceFlush(),t)))})}onEmit(t,e){this.processors.forEach(r=>r.onEmit(t,e))}shutdown(){return m(this,null,function*(){yield Promise.all(this.processors.map(t=>t.shutdown()))})}},ga=class{constructor(t,e,r,n){p(this,"resource"),p(this,"forceFlushTimeoutMillis"),p(this,"logRecordLimits"),p(this,"processors"),p(this,"loggers",new Map),p(this,"activeProcessor"),p(this,"registeredLogRecordProcessors",[]),this.resource=t,this.forceFlushTimeoutMillis=e,this.logRecordLimits=r,this.processors=n,n.length>0?(this.registeredLogRecordProcessors=n,this.activeProcessor=new da(this.registeredLogRecordProcessors,this.forceFlushTimeoutMillis)):this.activeProcessor=new ha}},pa=class{constructor(t={}){var e,r;p(this,"_shutdownOnce"),p(this,"_sharedState");const n=Fr({},{forceFlushTimeoutMillis:3e4,logRecordLimits:{attributeValueLengthLimit:1/0,attributeCountLimit:128},includeTraceContext:!0},t),s=null!=(e=t.resource)?e:Rn();this._sharedState=new ga(s,n.forceFlushTimeoutMillis,function(t){var e,r,n,s,i,o;return{attributeCountLimit:null!=(n=null!=(r=null!=(e=t.attributeCountLimit)?e:void 0)?r:void 0)?n:128,attributeValueLengthLimit:null!=(o=null!=(i=null!=(s=t.attributeValueLengthLimit)?s:void 0)?i:void 0)?o:1/0}}(n.logRecordLimits),null!=(r=null==t?void 0:t.processors)?r:[]),this._shutdownOnce=new Xr(this._shutdown,this)}getLogger(t,e,r){if(this._shutdownOnce.isCalled)return $t.warn("A shutdown LoggerProvider cannot provide a Logger"),en;t||$t.warn("Logger requested without instrumentation scope name.");const n=t||"unknown",s=`${n}@${e||""}:${(null==r?void 0:r.schemaUrl)||""}`;return this._sharedState.loggers.has(s)||this._sharedState.loggers.set(s,new la({name:n,version:e,schemaUrl:null==r?void 0:r.schemaUrl},this._sharedState)),this._sharedState.loggers.get(s)}forceFlush(){return this._shutdownOnce.isCalled?($t.warn("invalid attempt to force flush after LoggerProvider shutdown"),this._shutdownOnce.promise):this._sharedState.activeProcessor.forceFlush()}shutdown(){return this._shutdownOnce.isCalled?($t.warn("shutdown may only be called once per LoggerProvider"),this._shutdownOnce.promise):this._shutdownOnce.call()}_shutdown(){return this._sharedState.activeProcessor.shutdown()}},ma=class{constructor(t,e){var r,n,s,i,o,a,u,c;p(this,"_exporter"),p(this,"_maxExportBatchSize"),p(this,"_maxQueueSize"),p(this,"_scheduledDelayMillis"),p(this,"_exportTimeoutMillis"),p(this,"_isExporting",!1),p(this,"_finishedLogRecords",[]),p(this,"_timer"),p(this,"_shutdownOnce"),this._exporter=t,this._maxExportBatchSize=null!=(n=null!=(r=null==e?void 0:e.maxExportBatchSize)?r:void 0)?n:512,this._maxQueueSize=null!=(i=null!=(s=null==e?void 0:e.maxQueueSize)?s:void 0)?i:2048,this._scheduledDelayMillis=null!=(a=null!=(o=null==e?void 0:e.scheduledDelayMillis)?o:void 0)?a:5e3,this._exportTimeoutMillis=null!=(c=null!=(u=null==e?void 0:e.exportTimeoutMillis)?u:void 0)?c:3e4,this._shutdownOnce=new Xr(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&($t.warn("BatchLogRecordProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}onEmit(t){this._shutdownOnce.isCalled||this._addToBuffer(t)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}shutdown(){return this._shutdownOnce.call()}_shutdown(){return m(this,null,function*(){this.onShutdown(),yield this._flushAll(),yield this._exporter.shutdown()})}_addToBuffer(t){this._finishedLogRecords.length>=this._maxQueueSize||(this._finishedLogRecords.push(t),this._maybeStartTimer())}_flushAll(){return new Promise((t,e)=>{const r=[],n=Math.ceil(this._finishedLogRecords.length/this._maxExportBatchSize);for(let t=0;t<n;t++)r.push(this._flushOneBatch());Promise.all(r).then(()=>{t()}).catch(e)})}_flushOneBatch(){return this._clearTimer(),0===this._finishedLogRecords.length?Promise.resolve():new Promise((t,e)=>{Gr(this._export(this._finishedLogRecords.splice(0,this._maxExportBatchSize)),this._exportTimeoutMillis).then(()=>t()).catch(e)})}_maybeStartTimer(){if(this._isExporting)return;const t=()=>{this._isExporting=!0,this._flushOneBatch().then(()=>{this._isExporting=!1,this._finishedLogRecords.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(t=>{this._isExporting=!1,Ne(t)})};if(this._finishedLogRecords.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout(()=>t(),this._scheduledDelayMillis),"number"!=typeof this._timer&&this._timer.unref())}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}_export(t){const e=()=>Zr._export(this._exporter,t).then(t=>{var e;t.code!==Fe.SUCCESS&&Ne(null!=(e=t.error)?e:new Error(`BatchLogRecordProcessor: log record export failed (status ${t})`))}).catch(Ne),r=t.map(t=>t.resource).filter(t=>t.asyncAttributesPending);return 0===r.length?e():Promise.all(r.map(t=>{var e;return null==(e=t.waitForAsyncAttributes)?void 0:e.call(t)})).then(e,Ne)}},_a=class extends ma{constructor(t,e){super(t,e),p(this,"_visibilityChangeListener"),p(this,"_pageHideListener"),this._onInit(e)}onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}_onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush()},this._pageHideListener=()=>{this.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}},fa=class{constructor(t){p(this,"_sessionIdProvider"),this._sessionIdProvider=t}forceFlush(){return m(this,null,function*(){})}onStart(t,e){var r;const n=null==(r=this._sessionIdProvider)?void 0:r.getSessionId();n&&t.setAttribute("session.id",n)}onEnd(t){}shutdown(){return m(this,null,function*(){})}};var ba={compression:"gzip",keepalive:!0,concurrencyLimit:5,timeoutMillis:3e4};function Sa(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function va(t){const e=new Uint8Array(t.length/2);let r=0;for(let n=0;n<t.length;n+=2){const s=Sa(t.charCodeAt(n)),i=Sa(t.charCodeAt(n+1));e[r++]=s<<4|i}return e}function ya(t){const e=BigInt(1e9);return BigInt(Math.trunc(t[0]))*e+BigInt(Math.trunc(t[1]))}function wa(t){const e=ya(t);return r=e,{low:Number(BigInt.asUintN(32,r)),high:Number(BigInt.asUintN(32,r>>BigInt(32)))};var r}var Ta="undefined"!=typeof BigInt?function(t){return ya(t).toString()}:gr;function Ea(t){return t}function Ca(t){if(void 0!==t)return va(t)}var xa={encodeHrTime:wa,encodeSpanContext:va,encodeOptionalSpanContext:Ca};function La(t){var e,r;if(void 0===t)return xa;const n=null==(e=t.useLongBits)||e,s=null!=(r=t.useHex)&&r;return{encodeHrTime:n?wa:Ta,encodeSpanContext:s?Ea:va,encodeOptionalSpanContext:s?Ea:Ca}}function Aa(t){const e={attributes:Pa(t.attributes),droppedAttributesCount:0},r=t.schemaUrl;return r&&""!==r&&(e.schemaUrl=r),e}function Ra(t){return{name:t.name,version:t.version}}function Pa(t){return Object.keys(t).map(e=>Ma(e,t[e]))}function Ma(t,e){return{key:t,value:Ia(e)}}function Ia(t){const e=typeof t;return"string"===e?{stringValue:t}:"number"===e?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:"boolean"===e?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(Ia)}}:"object"===e&&null!=t?{kvlistValue:{values:Object.entries(t).map(([t,e])=>Ma(t,e))}}:{}}function Da(t,e){const r=function(t){const e=new Map;for(const r of t){const{resource:t,instrumentationScope:{name:n,version:s="",schemaUrl:i=""}}=r;let o=e.get(t);o||(o=new Map,e.set(t,o));const a=`${n}@${s}:${i}`;let u=o.get(a);u||(u=[],o.set(a,u)),u.push(r)}return e}(t);return Array.from(r,([t,r])=>{const n=Aa(t);return{resource:n,scopeLogs:Array.from(r,([,t])=>({scope:Ra(t[0].instrumentationScope),logRecords:t.map(t=>function(t,e){var r,n,s;return{timeUnixNano:e.encodeHrTime(t.hrTime),observedTimeUnixNano:e.encodeHrTime(t.hrTimeObserved),severityNumber:t.severityNumber,severityText:t.severityText,body:Ia(t.body),eventName:t.eventName,attributes:Oa(t.attributes),droppedAttributesCount:t.droppedAttributesCount,flags:null==(r=t.spanContext)?void 0:r.traceFlags,traceId:e.encodeOptionalSpanContext(null==(n=t.spanContext)?void 0:n.traceId),spanId:e.encodeOptionalSpanContext(null==(s=t.spanContext)?void 0:s.spanId)}}(t,e)),schemaUrl:t[0].instrumentationScope.schemaUrl})),schemaUrl:n.schemaUrl}})}function Oa(t){return Object.keys(t).map(e=>Ma(e,t[e]))}function ka(t,e){let r=255&t|256;return e&&(r|=512),r}function Na(t,e){var r,n,s,i;const o=t.spanContext(),a=t.status,u=(null==(r=t.parentSpanContext)?void 0:r.spanId)?e.encodeSpanContext(null==(n=t.parentSpanContext)?void 0:n.spanId):void 0;return{traceId:e.encodeSpanContext(o.traceId),spanId:e.encodeSpanContext(o.spanId),parentSpanId:u,traceState:null==(s=o.traceState)?void 0:s.serialize(),name:t.name,kind:null==t.kind?0:t.kind+1,startTimeUnixNano:e.encodeHrTime(t.startTime),endTimeUnixNano:e.encodeHrTime(t.endTime),attributes:Pa(t.attributes),droppedAttributesCount:t.droppedAttributesCount,events:t.events.map(t=>function(t,e){return{attributes:t.attributes?Pa(t.attributes):[],name:t.name,timeUnixNano:e.encodeHrTime(t.time),droppedAttributesCount:t.droppedAttributesCount||0}}(t,e)),droppedEventsCount:t.droppedEventsCount,status:{code:a.code,message:a.message},links:t.links.map(t=>function(t,e){var r;return{attributes:t.attributes?Pa(t.attributes):[],spanId:e.encodeSpanContext(t.context.spanId),traceId:e.encodeSpanContext(t.context.traceId),traceState:null==(r=t.context.traceState)?void 0:r.serialize(),droppedAttributesCount:t.droppedAttributesCount||0,flags:ka(t.context.traceFlags,t.context.isRemote)}}(t,e)),droppedLinksCount:t.droppedLinksCount,flags:ka(o.traceFlags,null==(i=t.parentSpanContext)?void 0:i.isRemote)}}function Fa(t,e){const r=function(t){const e=new Map;for(const r of t){let t=e.get(r.resource);t||(t=new Map,e.set(r.resource,t));const n=`${r.instrumentationScope.name}@${r.instrumentationScope.version||""}:${r.instrumentationScope.schemaUrl||""}`;let s=t.get(n);s||(s=[],t.set(n,s)),s.push(r)}return e}(t),n=[],s=r.entries();let i=s.next();for(;!i.done;){const[t,r]=i.value,o=[],a=r.values();let u=a.next();for(;!u.done;){const t=u.value;if(t.length>0){const r=t.map(t=>Na(t,e));o.push({scope:Ra(t[0].instrumentationScope),spans:r,schemaUrl:t[0].instrumentationScope.schemaUrl})}u=a.next()}const c=Aa(t),l={resource:c,scopeSpans:o,schemaUrl:c.schemaUrl};n.push(l),i=s.next()}return n}var Ua={serializeRequest:t=>{const e={resourceLogs:Da(t,La({useHex:!0,useLongBits:!1}))};return(new TextEncoder).encode(JSON.stringify(e))},deserializeResponse:t=>{if(0===t.length)return{};const e=new TextDecoder;return JSON.parse(e.decode(t))}},Ba={serializeRequest:t=>{const e={resourceSpans:Fa(t,La({useHex:!0,useLongBits:!1}))};return(new TextEncoder).encode(JSON.stringify(e))},deserializeResponse:t=>{if(0===t.length)return{};const e=new TextDecoder;return JSON.parse(e.decode(t))}},ja=class{constructor(t){this._delegate=t}export(t,e){this._delegate.export(t,e)}forceFlush(){return this._delegate.forceFlush()}shutdown(){return this._delegate.shutdown()}},Va=class extends ja{constructor(t){super(su(t,Ua))}},$a=(t,e)=>`${ou(t,e)}/v2/logs`,za=class extends Va{constructor({appID:t,userID:e,embraceDataURL:r}){super(h(l({},ba),{headers:iu(t,e),url:$a(t,r)}))}},Ha=class extends ja{constructor(t){super(su(h(l({},t),{compression:"gzip"}),Ba))}},qa=(t,e)=>`${ou(t,e)}/v2/spans`,Ga=class extends Ha{constructor({appID:t,userID:e,embraceDataURL:r}){super(h(l({},ba),{headers:iu(t,e),url:qa(t,r)}))}},Ka=class extends Error{constructor(t,e,r){super(t),p(this,"code"),p(this,"name","OTLPExporterError"),p(this,"data"),this.data=r,this.code=e}},Wa=class{constructor(t){p(this,"_concurrencyLimit"),p(this,"_sendingPromises",[]),this._concurrencyLimit=t}pushPromise(t){if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(t);const e=()=>{const e=this._sendingPromises.indexOf(t);this._sendingPromises.splice(e,1)};t.then(e,e)}hasReachedLimit(){return this._sendingPromises.length>=this._concurrencyLimit}awaitAll(){return m(this,null,function*(){yield Promise.all(this._sendingPromises)})}};function Qa(t){return new Wa(t.concurrencyLimit)}function Xa(){return{handleResponse(t){null!=t&&function(t){return Object.prototype.hasOwnProperty.call(t,"partialSuccess")}(t)&&null!=t.partialSuccess&&0!==Object.keys(t.partialSuccess).length&&$t.warn("Received Partial Success response:",JSON.stringify(t.partialSuccess))}}}var Ja=class{constructor(t,e,r,n,s){p(this,"_transport"),p(this,"_serializer"),p(this,"_responseHandler"),p(this,"_promiseQueue"),p(this,"_timeout"),p(this,"_diagLogger"),this._transport=t,this._serializer=e,this._responseHandler=r,this._promiseQueue=n,this._timeout=s,this._diagLogger=$t.createComponentLogger({namespace:"OTLPExportDelegate"})}export(t,e){if(this._diagLogger.debug("items to be sent",t),this._promiseQueue.hasReachedLimit())return void e({code:Fe.FAILED,error:new Error("Concurrent export limit reached")});const r=this._serializer.serializeRequest(t);null!=r?this._promiseQueue.pushPromise(this._transport.send(r,this._timeout).then(t=>{if("success"!==t.status)"failure"===t.status&&t.error?e({code:Fe.FAILED,error:t.error}):"retryable"===t.status?e({code:Fe.FAILED,error:new Ka("Export failed with retryable status")}):e({code:Fe.FAILED,error:new Ka("Export failed with unknown error")});else{if(null!=t.data)try{this._responseHandler.handleResponse(this._serializer.deserializeResponse(t.data))}catch(e){this._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",e,t.data)}e({code:Fe.SUCCESS})}},t=>e({code:Fe.FAILED,error:t}))):e({code:Fe.FAILED,error:new Error("Nothing to send")})}forceFlush(){return this._promiseQueue.awaitAll()}shutdown(){return m(this,null,function*(){this._diagLogger.debug("shutdown started"),yield this.forceFlush(),this._transport.shutdown()})}};function Ya(t,e,r){return n={transport:r,serializer:e,promiseHandler:Qa(t)},s={timeout:t.timeoutMillis},new Ja(n.transport,n.serializer,Xa(),n.promiseHandler,s.timeout);var n,s}var Za,tu=class t{constructor(t){this._config=t}static _compressRequest(t){return m(this,null,function*(){const e=new CompressionStream("gzip"),r=e.writable.getWriter();r.write(t),r.close();const n=[],s=e.readable.getReader();let i=!1;for(;!i;){const t=yield s.read();t.value&&n.push(t.value),i=t.done}const o=new Uint8Array(n.reduce((t,e)=>t+e.length,0));let a=0;for(const t of n)o.set(t,a),a+=t.length;return o})}send(t,e){return this._asyncSend(t,e)}shutdown(){}_asyncSend(e,r){return m(this,null,function*(){let n=e;const s=l({"Content-Type":"application/json"},this._config.headers);let i,o;if("gzip"===this._config.compression&&(n=yield t._compressRequest(e),s["Content-Encoding"]="gzip",s["Content-Length"]=n.length.toString()),"timeout"in AbortSignal)i=AbortSignal.timeout(r);else{const t=new AbortController;i=t.signal,o=setTimeout(()=>{t.abort(new DOMException("TimeoutError","TimeoutError"))},r)}try{const t=yield fetch(this._config.url,{method:"POST",keepalive:!0,headers:s,body:n,signal:i});return t.ok?{status:"success"}:{status:"failure",error:new Error(`${t.status} Fetch request failed`)}}catch(t){return{status:"failure",error:t instanceof Error?t:new Error(String(t))}}finally{void 0!==o&&clearTimeout(o)}})}},eu=t=>new tu(t),ru=()=>40*Math.random()-20,nu=class{constructor(t,e=new Zs){this._transport=t,this._perf=e}send(t,e){return m(this,null,function*(){var r;const n=this._perf.getNowMillis()+e;let s=yield this._transport.send(t,e),i=5,o=1e3;for(;"retryable"===s.status&&i>0;){i--;const e=Math.max(Math.min(o,5e3)+ru(),0);o*=1.5;const a=null!=(r=s.retryInMillis)?r:e,u=n-this._perf.getNowMillis();if(a>u)return s;s=yield this._retry(t,u,a)}return s})}shutdown(){this._transport.shutdown()}_retry(t,e,r){return new Promise((n,s)=>{setTimeout(()=>{this._transport.send(t,e).then(n,s)},r)})}},su=(t,e)=>{return Ya(t,e,(r={transport:eu(t)},new nu(r.transport,null!=(n=r.perf)?n:new Zs)));var r,n},iu=(t,e)=>({"X-EM-AID":t,"X-EM-DID":e}),ou=(t,e)=>e||`https://a-${t}.data.emb-api.com`,au=class{constructor({urlDocument:t=window.document}={}){p(this,"_urlDocument"),this._urlDocument=t}forceFlush(){return Promise.resolve(void 0)}onEmit(t){t.attributes[fs]||t.setAttribute(fs,"sys.log"),t.setAttribute(nr,this._urlDocument.URL)}shutdown(){return Promise.resolve(void 0)}},uu=/.+:\/\/.+/,cu=class{forceFlush(){return Promise.resolve(void 0)}onEnd(t){var e,r,n,s,i,o,a,u,c;(t=>{var e;if((t.attributes[We]||t.attributes[Ve])&&("number"==typeof t.attributes[Xe]||"number"==typeof t.attributes[ze])){const r=null!=(e=t.attributes[nr])?e:t.attributes[$e];return!(!r||"string"!=typeof r||!uu.exec(r))}return!1})(t)&&(t.attributes[fs]="perf.network_request",null!=(e=t.attributes)[r=nr]||(e[r]=t.attributes[$e]),null!=(n=t.attributes)[s=Xe]||(n[s]=t.attributes[ze]),null!=(i=t.attributes)[o=We]||(i[o]=t.attributes[Ve]),null!=(a=t.attributes)[u=ds]||(a[u]=t.attributes["http.response_content_length"]),null!=(c=t.attributes)["http.request.body.size"]||(c["http.request.body.size"]=t.attributes["http.request_content_length"]))}onStart(){}shutdown(){return Promise.resolve(void 0)}},lu=(t,e)=>`emb.${"current"===e?"export_failed":"previous_export_failed"}.${t}`,hu=class{constructor({resource:t,exporter:e,limitManager:r,spanSessionManager:n,storage:s=window.localStorage,storedSpansExpireTimeoutMS:i,diag:o=$t.createComponentLogger({namespace:"EmbraceSessionBatchedSpanProcessor"})}){p(this,"_shutdownOnce"),p(this,"_pendingSpans",[]),p(this,"_exporter"),p(this,"_limitManager"),p(this,"_spanStorage"),p(this,"_spanSessionManager"),p(this,"_diag"),p(this,"_shutdown",()=>(this._spanStorage.destroy(),this._exporter.shutdown())),this._diag=o,this._exporter=e,this._shutdownOnce=new Xr(this._shutdown,this),this._limitManager=r,this._spanSessionManager=n,this._spanStorage=new Us({resource:t,storage:s,diag:o,onExpiredSpansExport:t=>{this._exportSpans(t)},storedSpansExpireTimeoutMS:i,spanSessionManager:n})}forceFlush(){return this._diag.debug("forceFlush called for EmbraceSessionBatchedSpanProcessor. This is a no op"),Promise.resolve(void 0)}onEnd(t){if(this._shutdownOnce.isCalled)this._diag.debug("span ended after processor shutdown. Ignoring span.");else if((t=>"ux.session"===t.attributes[fs])(t))this._diag.debug("session span ended. Exporting all pending spans."),this._exportSpans([t,...this._pendingSpans]),this._pendingSpans=[];else{if(this._diag.debug("non-session span ended. Adding to pending spans queue."),this._limitManager.dropReadableSpan(t))return;this._pendingSpans.push(t)}}_exportSpans(t){Zr._export(this._exporter,t).then(t=>{var e;if(t.code===Fe.FAILED){const r=(null==(e=t.error)?void 0:e.message)||"unknown error";let n="unknown";"Concurrent export limit reached"===r?n="concurrent_limit":"Fetch request errored"===r&&(n="fetch_error"),this._spanSessionManager.incrSessionCountForKey(lu(n,"current")),this._spanSessionManager.incrNextSessionCountForKey(lu(n,"previous")),this._diag.error(`spans failed to export: ${r}`)}}).catch(t=>{let e="unknown error";t&&t instanceof Error?e=t.message:"string"==typeof t&&(e=t),this._spanSessionManager.incrSessionCountForKey(lu("unknown","current")),this._spanSessionManager.incrNextSessionCountForKey(lu("unknown","previous")),this._diag.error(`spans failed to export: ${e}`)})}onStart(){}getPendingSpansCount(){return this._pendingSpans.length}storePendingSpans(t,e){this._spanStorage.storePendingSpans(t,e,this._pendingSpans)}clearStoredSpans(t){this._spanStorage.clearStoredSpans(t)}shutdown(){return this._shutdownOnce.call()}},du=class{constructor({spanSessionManager:t}){p(this,"_spanSessionManager"),this._spanSessionManager=t}forceFlush(){return Promise.resolve(void 0)}onEmit(t){t.setAttributes({[gs]:Gs(),[ps]:this._spanSessionManager.getSessionId(),[ms]:this._spanSessionManager.getPreviousSessionId()})}shutdown(){return Promise.resolve(void 0)}},gu=class{constructor({attributeScrubbers:t}){p(this,"_attributeScrubbers"),this._attributeScrubbers=t}forceFlush(){return Promise.resolve(void 0)}onEmit(t){this._attributeScrubbers.forEach(e=>{const r=t.attributes[e.key];r&&"string"==typeof r&&t.setAttribute(e.key,e.scrub(r))})}shutdown(){return Promise.resolve(void 0)}},pu=class{constructor({pageManager:t}){p(this,"_pageManager"),this._pageManager=t}forceFlush(){return Promise.resolve(void 0)}onEmit(t){const e=this._pageManager.getCurrentRoute();e&&(t.setAttribute(Ds,e.path),t.setAttribute(Os,this._pageManager.getCurrentPageId()))}shutdown(){return Promise.resolve(void 0)}},mu=class{constructor({pageManager:t}){p(this,"_pageManager"),this._pageManager=t}forceFlush(){return Promise.resolve(void 0)}onEnd(t){const e=this._pageManager.getCurrentRoute(),r=this._pageManager.getCurrentPageId();e&&r&&(t.attributes[Ds]=e.path,t.attributes[Os]=r)}onStart(){}shutdown(){return Promise.resolve(void 0)}},_u=class{constructor({attributeScrubbers:t}){p(this,"_attributeScrubbers"),this._attributeScrubbers=t}forceFlush(){return Promise.resolve(void 0)}onEnd(t){this._attributeScrubbers.forEach(e=>{const r=t.attributes[e.key];r&&"string"==typeof r&&(t.attributes[e.key]=e.scrub(r))})}onStart(){}shutdown(){return Promise.resolve(void 0)}},fu=class{constructor({userManager:t}){p(this,"_userManager"),this._userManager=t}forceFlush(){return Promise.resolve(void 0)}onEmit(t){this._userManager.getUserId()&&t.setAttributes({[_s]:this._userManager.getUserId()})}shutdown(){return Promise.resolve(void 0)}},bu=class{constructor({userManager:t}){p(this,"_userManager"),this._userManager=t}forceFlush(){return Promise.resolve(void 0)}onEnd(t){const e=this._userManager.getUserId();e&&(t.attributes[_s]=e)}onStart(){}shutdown(){return Promise.resolve(void 0)}},Su=class extends xr{inject(t,e,r){super.inject(t,e,r);const n=re.getSpan(t);if(n){const t=at.get(e,"traceparent");t&&n.setAttribute("emb.w3c_traceparent",t)}}},vu=/\/\/(.+):(.+)@(.+)\//,yu=["AWSAccessKeyId","Signature","sig","`X-Goog-Signature","password","auth","pw","token"],wu=({value:t,queryParamRegex:e,scrubPath:r,scrubQuery:n})=>{let s=t;return r&&(s=s.replace(vu,"//REDACTED:REDACTED@$3/")),n&&(s=s.replaceAll(e,"$1$2=REDACTED")),s},Tu=t=>{const e=[...yu,...t||[]],r=new RegExp(`(^|&|\\?)(${e.join("|")})=[^&]+`,"g");return[{key:nr,scrub:t=>wu({value:t,queryParamRegex:r,scrubPath:!0,scrubQuery:!0})},{key:$e,scrub:t=>wu({value:t,queryParamRegex:r,scrubPath:!0,scrubQuery:!0})},{key:"url.path",scrub:t=>wu({value:t,queryParamRegex:r,scrubPath:!0,scrubQuery:!1})},{key:"url.query",scrub:t=>wu({value:t,queryParamRegex:r,scrubPath:!1,scrubQuery:!0})}]},Eu=new class{constructor({diagLogger:t=$t.createComponentLogger({namespace:"embrace-registry"})}={}){p(this,"_sdk",null),p(this,"_diag"),p(this,"register",t=>{null!==this._sdk&&this._diag.warn("previously registered sdk will be overwritten"),this._sdk=t}),p(this,"clear",()=>{null===this._sdk&&this._diag.warn("sdk already cleared, this is a no-op"),this._sdk=null}),p(this,"registered",()=>this._sdk),this._diag=t}},Cu=(t={},{logManager:e,spanSessionManager:r,embraceSpanProcessor:n,pageManager:s}={})=>{var i,o,a,u,c,d;const g=[new Zi(t["session-on-load"]),new no(t["session-visibility"],n),new Yi(t["session-activity"]),new eo(t["session-timeout"])];(null==(i=t.omit)?void 0:i.has("exception"))||g.push(new ui(t.exception)),(null==(o=t.omit)?void 0:o.has("click"))||g.push(new ai(t.click)),(null==(a=t.omit)?void 0:a.has("web-vital"))||g.push(new Xo(h(l({},t["web-vital"]),{pageManager:s}))),(null==(u=t.omit)?void 0:u.has("document-load"))||g.push(new si(t["document-load"])),(null==(c=t.omit)?void 0:c.has("@opentelemetry/instrumentation-fetch"))||g.push(new wi(l(l({},t.network),t["@opentelemetry/instrumentation-fetch"]))),(null==(d=t.omit)?void 0:d.has("@opentelemetry/instrumentation-xml-http-request"))||g.push(new ua(l(l({},t.network),t["@opentelemetry/instrumentation-xml-http-request"]))),t["empty-root"]&&g.push(new ii(l({},t["empty-root"])));for(const t of g)t instanceof ri&&(r&&t.setSessionManager(r),e&&t.setLogManager(e));return g},xu=({appID:t,appVersion:e,resource:r=An(),spanExporters:n=[],logExporters:s=[],spanProcessors:i=[],propagator:o=null,defaultInstrumentationConfig:a,instrumentations:u=[],contextManager:c=null,logProcessors:l=[],attributeScrubbers:h=[],enableDefaultAttributeScrubbing:d=!0,additionalQueryParamsToScrub:g=[],logLevel:p=L.ERROR,embraceDataURL:_,embraceConfigURL:f,diagLogger:b=$t.createComponentLogger({namespace:"embrace-sdk"}),dynamicSDKConfigManager:S,dynamicSDKConfig:v,registerGlobally:y=!0,blockNetworkSpanForwarding:w=!1,restrictedProtocols:T=new Set(["file:"])}={appID:""})=>{var E;try{const C=new Zs,x=C.getNowMillis();if(y){const t=Eu.registered();if(null!==t)return b.warn("SDK has already been successfully initialized, skipping this invocation of initSDK"),t}$t.setLogger(new V,{logLevel:p});const L=!!t&&(t=>{if(void 0===t)throw new Error("appID is required when using Embrace exporter");if(5!==t.length)throw new Error("appID should be 5 characters long");return!0})(t);if(!L&&!s.length&&!n.length)throw new Error("when the embrace appID is omitted then at least one logExporter or spanExporter must be set");if(T.has(window.location.protocol))throw new Error(`not initializing due to restricted protocol: ${window.location.protocol}`);const A=!y&&t,R=A?new Ys(t,window.localStorage):window.localStorage,P=A?new Ys(t,window.sessionStorage):window.sessionStorage,M=r.merge((({diagLogger:t,appVersion:e,pageSessionStorage:r})=>{const n=null!=e?e:Fi.trim();return Ln({[Ze]:Bi,[er]:Bi,app_version:n,app_framework:1,sdk_version:Ui,[rr]:Ui,sdk_simple_version:1,sdk_platform:"web",[tr]:"webjs",[Ls]:Vi(r,t),[sr]:window.navigator.userAgent,screen_resolution:`${window.screen.width}x${window.screen.height}`})})({diagLogger:b,appVersion:e,pageSessionStorage:P})),I=Lu({registerGlobally:y,sdkLocalStorage:R}),D=I.getEmbraceUserId();if(L&&!D)throw new Error("userID is required when using Embrace exporter");const O=null!=S?S:new Ri({appID:t,appVersion:e||Fi.trim()||"no-app-version",embraceConfigURL:f,defaultConfig:v,deviceId:D,storage:R});O.refreshRemoteConfig();const k=new Ni({dynamicConfigManager:O,deviceId:D,blockNetworkSpanForwarding:w});if(!k.isSDKEnabled())return b.debug("SDK is disabled, skipping initialization."),!1;const N=(({diag:t,featureManager:e,registerGlobally:r,propagator:n,defaultInstrumentationConfig:s})=>{var i;if(!e.isNetworkSpanForwardingEnabled())return!1;const o=[];return r||o.push("Network span forwarding cannot be used when `registerGlobally` is set to false. Turning off network span forwarding."),n&&o.push("Network span forwarding cannot be used alongside a custom `propagator`. Turning off network span forwarding."),(null==(i=null==s?void 0:s.omit)?void 0:i.has("@opentelemetry/instrumentation-xml-http-request"))&&s.omit.has("@opentelemetry/instrumentation-fetch")&&o.push("Network span forwarding cannot be used when both '@opentelemetry/instrumentation-xml-http-request' and '@opentelemetry/instrumentation-fetch' are omitted. Turning off network span forwarding."),o.forEach(e=>{t.warn(e)}),0===o.length})({featureManager:k,diag:b,registerGlobally:y,defaultInstrumentationConfig:a,propagator:o}),F=new Ii(Pi),U=[...d?Tu(g):[],...h],B=Au({limitManager:F,registerGlobally:y,sdkLocalStorage:R,sdkSessionStorage:P});let j,$;L&&(j=new hu({resource:M,exporter:new Ga({appID:t,embraceDataURL:_,userID:D}),limitManager:F,storedSpansExpireTimeoutMS:null==(E=null==a?void 0:a["session-visibility"])?void 0:E.storedSpansExpireTimeoutMS,storage:R,spanSessionManager:B}),$=new _a(new za({appID:t,embraceDataURL:_,userID:D})));const z=Mu({registerGlobally:y}),{tracerProvider:H,embraceTraceManager:q}=Ru({resource:M,spanSessionManager:B,userManager:I,spanExporters:n,spanProcessors:i,propagator:N?new Su:o,contextManager:c,attributeScrubbers:U,registerGlobally:y,embraceSpanProcessor:j,pageManager:z});B.setTracerProvider(H);const{loggerProvider:G,embraceLogManager:K}=Pu({resource:M,userManager:I,logExporters:s,logProcessors:l,spanSessionManager:B,limitManager:F,attributeScrubbers:U,registerGlobally:y,embraceLogProcessor:$,sdkLocalStorage:R,pageManager:z});ln(y?{instrumentations:[Cu(a,{embraceSpanProcessor:j,pageManager:z}),...u]}:{tracerProvider:H,loggerProvider:G,instrumentations:[Cu(a,{logManager:K,spanSessionManager:B,embraceSpanProcessor:j,pageManager:z}),...u]}),b.info("successfully initialized the SDK");const W={setDynamicConfig:t=>{O.setConfig(t)},flush:()=>m(null,null,function*(){yield H.forceFlush(),yield G.forceFlush()}),log:K,trace:q,session:B,user:I,page:z};return y&&Eu.register(W),B.recordSDKStartupDuration(C.getNowMillis()-x),W}catch(t){const e=t instanceof Error?t.message:"Unknown error.";return b.error(`failed to initialize the SDK: ${e}`),!1}},Lu=({registerGlobally:t,sdkLocalStorage:e})=>{const r=new Xi({storage:e});return t&&Ee.setGlobalUserManager(r),r},Au=({limitManager:t,registerGlobally:e,sdkLocalStorage:r,sdkSessionStorage:n})=>{const s=new Hi({limitManager:t,storage:r,sessionStorage:n});return e&&pe.setGlobalSessionManager(s),s},Ru=({resource:t,spanSessionManager:e,userManager:r,spanExporters:n,spanProcessors:s=[],propagator:i=null,contextManager:o=null,attributeScrubbers:a,registerGlobally:u,embraceSpanProcessor:c,pageManager:l})=>{const h=[...s,(d=e,new fa(d)),new cu,new bu({userManager:r}),new mu({pageManager:l}),new _u({attributeScrubbers:a})];var d;null==n||n.forEach(t=>{h.push(new Hn(t))}),c&&h.push(c);const g=new rs({resource:t,spanProcessors:h,spanLimits:{attributeCountLimit:2*Pi.maxAllowed.session_property,attributePerEventCountLimit:20,eventCountLimit:2*Pi.maxAllowed.breadcrumb,attributeValueLengthLimit:1024}}),p=new Gi({tracerProvider:u?void 0:g});return u&&(Se.setGlobalTraceManager(p),g.register({contextManager:o||new Zn,propagator:i})),{tracerProvider:g,embraceTraceManager:p}},Pu=({resource:t,userManager:e,logExporters:r,logProcessors:n,spanSessionManager:s,limitManager:i,attributeScrubbers:o,registerGlobally:a,embraceLogProcessor:u,sdkLocalStorage:c,pageManager:l})=>{const h=[...n,new du({spanSessionManager:s}),new au,new fu({userManager:e}),new gu({attributeScrubbers:o}),new pu({pageManager:l})];null==r||r.forEach(t=>{h.push(new _a(t))}),u&&h.push(u);const d=new pa({resource:t,processors:h}),g=new Oi({spanSessionManager:s,limitManager:i,loggerProvider:a?void 0:d,storage:c});return a&&(cn.setGlobalLoggerProvider(d),oe.setGlobalLogManager(g)),{loggerProvider:d,embraceLogManager:g}},Mu=({registerGlobally:t})=>{const e=new ki;return t&&le.setGlobalPageManager(e),e};return Za=_,((e,n,i,a)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let u of s(n))o.call(e,u)||u===i||t(e,u,{get:()=>n[u],enumerable:!(a=r(n,u))||a.enumerable});return e})(t({},"__esModule",{value:!0}),Za)})();
//# sourceMappingURL=embrace-web-sdk.js.map