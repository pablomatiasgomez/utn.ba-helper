/**
 * Skipped minification because the original files appears to be already minified.
 * Original file: /npm/@embrace-io/web-sdk@1.8.0/build/iife/bundle.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var EmbraceWebSdk=function(t){"use strict";const e=new class{logException(t,e){}message(t,e,n){}};class n{getDelegate(){var t;return null!=(t=this._delegate)?t:e}setDelegate(t){this._delegate=t}logException(t,e){this.getDelegate().logException(t,e)}message(t,e,n){this.getDelegate().message(t,e,n)}}class r{static getInstance(){return r._instance||(r._instance=new r({proxyLogManager:new n})),r._instance}setGlobalLogManager(t){this._proxyLogManager.setDelegate(t)}logException(t,e){this.getLogManager().logException(t,e)}message(t,e,n){this.getLogManager().message(t,e,n)}constructor({proxyLogManager:t}){this.getLogManager=()=>this._proxyLogManager,this._proxyLogManager=t}}const i=r.getInstance();const s=new class{addBreadcrumb(t){}addProperty(t,e,n){}removeProperty(t){}endSessionSpan(){}endSessionSpanInternal(){}getSessionSpan(){return null}getSessionStartTime(){return null}startSessionSpan(){}addSessionStartedListener(t){return()=>{}}addSessionEndedListener(t){return()=>{}}constructor(){this.getSessionId=()=>null}};class o{getDelegate(){var t;return null!=(t=this._delegate)?t:s}setDelegate(t){this._delegate=t}addBreadcrumb(t){this.getDelegate().addBreadcrumb(t)}addProperty(t,e,n){this.getDelegate().addProperty(t,e,n)}removeProperty(t){this.getDelegate().removeProperty(t)}endSessionSpan(){this.getDelegate().endSessionSpan()}endSessionSpanInternal(t){this.getDelegate().endSessionSpanInternal(t)}getSessionId(){return this.getDelegate().getSessionId()}getSessionSpan(){return this.getDelegate().getSessionSpan()}getSessionStartTime(){return this.getDelegate().getSessionStartTime()}startSessionSpan(){this.getDelegate().startSessionSpan()}addSessionStartedListener(t){return this.getDelegate().addSessionStartedListener(t)}addSessionEndedListener(t){return this.getDelegate().addSessionEndedListener(t)}}class a{static getInstance(){return a._instance||(a._instance=new a({proxySpanSessionManager:new o})),a._instance}setGlobalSessionManager(t){this._proxySpanSessionManager.setDelegate(t)}addBreadcrumb(t){this.getSpanSessionManager().addBreadcrumb(t)}addProperty(t,e,n){this.getSpanSessionManager().addProperty(t,e,n)}removeProperty(t){this.getSpanSessionManager().removeProperty(t)}endSessionSpan(){this.getSpanSessionManager().endSessionSpan()}endSessionSpanInternal(t){this.getSpanSessionManager().endSessionSpanInternal(t)}getSessionId(){return this.getSpanSessionManager().getSessionId()}getSessionSpan(){return this.getSpanSessionManager().getSessionSpan()}getSessionStartTime(){return this.getSpanSessionManager().getSessionStartTime()}startSessionSpan(){this.getSpanSessionManager().startSessionSpan()}addSessionStartedListener(t){return this.getSpanSessionManager().addSessionStartedListener(t)}addSessionEndedListener(t){return this.getSpanSessionManager().addSessionEndedListener(t)}constructor({proxySpanSessionManager:t}){this.getSpanSessionManager=()=>this._proxySpanSessionManager,this._proxySpanSessionManager=t}}const u=a.getInstance();var c="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},l="1.9.0",h=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var d=function(t){var e=new Set([t]),n=new Set,r=t.match(h);if(!r)return function(){return!1};var i=+r[1],s=+r[2],o=+r[3];if(null!=r[4])return function(e){return e===t};function a(t){return n.add(t),!1}function u(t){return e.add(t),!0}return function(t){if(e.has(t))return!0;if(n.has(t))return!1;var r=t.match(h);if(!r)return a(t);var c=+r[1],l=+r[2],d=+r[3];return null!=r[4]||i!==c?a(t):0===i?s===l&&o<=d?u(t):a(t):s<=l?u(t):a(t)}}(l),p=l.split(".")[0],g=Symbol.for("opentelemetry.js.api."+p),_=c;function m(t,e,n,r){var i;void 0===r&&(r=!1);var s=_[g]=null!==(i=_[g])&&void 0!==i?i:{version:l};if(!r&&s[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(o.stack||o.message),!1}if(s.version!==l){o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+t+" does not match previously registered API v"+l);return n.error(o.stack||o.message),!1}return s[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+l+"."),!0}function f(t){var e,n,r=null===(e=_[g])||void 0===e?void 0:e.version;if(r&&d(r))return null===(n=_[g])||void 0===n?void 0:n[t]}function v(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+l+".");var n=_[g];n&&delete n[t]}var E,T=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},S=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},b=function(){function t(t){this._namespace=t.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return y("debug",this._namespace,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return y("error",this._namespace,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return y("info",this._namespace,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return y("warn",this._namespace,t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return y("verbose",this._namespace,t)},t}();function y(t,e,n){var r=f("diag");if(r)return n.unshift(e),r[t].apply(r,S([],T(n),!1))}!function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"}(E||(E={}));var L=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},O=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},w=function(){function t(){function t(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=f("diag");if(r)return r[t].apply(r,O([],L(e),!1))}}var e=this;e.setLogger=function(t,n){var r,i,s;if(void 0===n&&(n={logLevel:E.INFO}),t===e){var o=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return e.error(null!==(r=o.stack)&&void 0!==r?r:o.message),!1}"number"==typeof n&&(n={logLevel:n});var a=f("diag"),u=function(t,e){function n(n,r){var i=e[n];return"function"==typeof i&&t>=r?i.bind(e):function(){}}return t<E.NONE?t=E.NONE:t>E.ALL&&(t=E.ALL),e=e||{},{error:n("error",E.ERROR),warn:n("warn",E.WARN),info:n("info",E.INFO),debug:n("debug",E.DEBUG),verbose:n("verbose",E.VERBOSE)}}(null!==(i=n.logLevel)&&void 0!==i?i:E.INFO,t);if(a&&!n.suppressOverrideMessage){var c=null!==(s=(new Error).stack)&&void 0!==s?s:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),u.warn("Current logger will overwrite one already registered from "+c)}return m("diag",u,e,!0)},e.disable=function(){v("diag",e)},e.createComponentLogger=function(t){return new b(t)},e.verbose=t("verbose"),e.debug=t("debug"),e.info=t("info"),e.warn=t("warn"),e.error=t("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),R=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},C=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},A=function(){function t(t){this._entries=t?new Map(t):new Map}return t.prototype.getEntry=function(t){var e=this._entries.get(t);if(e)return Object.assign({},e)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(t){var e=R(t,2);return[e[0],e[1]]})},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=new t(this._entries);try{for(var o=C(r),a=o.next();!a.done;a=o.next()){var u=a.value;s._entries.delete(u)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return s},t.prototype.clear=function(){return new t},t}(),P=Symbol("BaggageEntryMetadata"),I=w.instance();function M(t){return void 0===t&&(t={}),new A(new Map(Object.entries(t)))}function N(t){return Symbol.for(t)}var x,D,U=function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(t){return n._currentContext.get(t)},n.setValue=function(e,r){var i=new t(n._currentContext);return i._currentContext.set(e,r),i},n.deleteValue=function(e){var r=new t(n._currentContext);return r._currentContext.delete(e),r}},k=new U,F=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],B=function(){function t(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(console){var r=console[t];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,e)}}}for(var e=0;e<F.length;e++)this[F[e].n]=t(F[e].c)},j=(x=function(t,e){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},x(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),V=function(){function t(){}return t.prototype.createGauge=function(t,e){return J},t.prototype.createHistogram=function(t,e){return tt},t.prototype.createCounter=function(t,e){return Z},t.prototype.createUpDownCounter=function(t,e){return et},t.prototype.createObservableGauge=function(t,e){return rt},t.prototype.createObservableCounter=function(t,e){return nt},t.prototype.createObservableUpDownCounter=function(t,e){return it},t.prototype.addBatchObservableCallback=function(t,e){},t.prototype.removeBatchObservableCallback=function(t){},t}(),H=function(){},$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.add=function(t,e){},e}(H),G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.add=function(t,e){},e}(H),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.record=function(t,e){},e}(H),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.record=function(t,e){},e}(H),q=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.removeCallback=function(t){},t}(),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e}(q),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e}(q),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e}(q),Y=new V,Z=new $,J=new X,tt=new z,et=new G,nt=new W,rt=new K,it=new Q,st={get:function(t,e){if(null!=t)return t[e]},keys:function(t){return null==t?[]:Object.keys(t)}},ot={set:function(t,e,n){null!=t&&(t[e]=n)}},at=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},ut=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},ct=function(){function t(){}return t.prototype.active=function(){return k},t.prototype.with=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];return e.call.apply(e,ut([n],at(r),!1))},t.prototype.bind=function(t,e){return e},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),lt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},ht=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},dt="context",pt=new ct,gt=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(t){return m(dt,t,w.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(t,e,n){for(var r,i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return(r=this._getContextManager()).with.apply(r,ht([t,e,n],lt(i),!1))},t.prototype.bind=function(t,e){return this._getContextManager().bind(t,e)},t.prototype._getContextManager=function(){return f(dt)||pt},t.prototype.disable=function(){this._getContextManager().disable(),v(dt,w.instance())},t}();!function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"}(D||(D={}));var _t="0000000000000000",mt="00000000000000000000000000000000",ft={traceId:mt,spanId:_t,traceFlags:D.NONE},vt=function(){function t(t){void 0===t&&(t=ft),this._spanContext=t}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(t,e){return this},t.prototype.setAttributes=function(t){return this},t.prototype.addEvent=function(t,e){return this},t.prototype.addLink=function(t){return this},t.prototype.addLinks=function(t){return this},t.prototype.setStatus=function(t){return this},t.prototype.updateName=function(t){return this},t.prototype.end=function(t){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(t,e){},t}(),Et=N("OpenTelemetry Context Key SPAN");function Tt(t){return t.getValue(Et)||void 0}function St(){return Tt(gt.getInstance().active())}function bt(t,e){return t.setValue(Et,e)}function yt(t){return t.deleteValue(Et)}function Lt(t,e){return bt(t,new vt(e))}function Ot(t){var e;return null===(e=Tt(t))||void 0===e?void 0:e.spanContext()}var wt=/^([0-9a-f]{32})$/i,Rt=/^[0-9a-f]{16}$/i;function Ct(t){return wt.test(t)&&t!==mt}function At(t){return Ct(t.traceId)&&(e=t.spanId,Rt.test(e)&&e!==_t);var e}function Pt(t){return new vt(t)}var It=gt.getInstance(),Mt=function(){function t(){}return t.prototype.startSpan=function(t,e,n){if(void 0===n&&(n=It.active()),Boolean(null==e?void 0:e.root))return new vt;var r,i=n&&Ot(n);return"object"==typeof(r=i)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&At(i)?new vt(i):new vt},t.prototype.startActiveSpan=function(t,e,n,r){var i,s,o;if(!(arguments.length<2)){2===arguments.length?o=e:3===arguments.length?(i=e,o=n):(i=e,s=n,o=r);var a=null!=s?s:It.active(),u=this.startSpan(t,i,a),c=bt(a,u);return It.with(c,o,void 0,u)}},t}();var Nt,xt,Dt,Ut=new Mt,kt=function(){function t(t,e,n,r){this._provider=t,this.name=e,this.version=n,this.options=r}return t.prototype.startSpan=function(t,e,n){return this._getTracer().startSpan(t,e,n)},t.prototype.startActiveSpan=function(t,e,n,r){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Ut},t}(),Ft=new(function(){function t(){}return t.prototype.getTracer=function(t,e,n){return new Mt},t}()),Bt=function(){function t(){}return t.prototype.getTracer=function(t,e,n){var r;return null!==(r=this.getDelegateTracer(t,e,n))&&void 0!==r?r:new kt(this,t,e,n)},t.prototype.getDelegate=function(){var t;return null!==(t=this._delegate)&&void 0!==t?t:Ft},t.prototype.setDelegate=function(t){this._delegate=t},t.prototype.getDelegateTracer=function(t,e,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(t,e,n)},t}();!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Nt||(Nt={})),function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"}(xt||(xt={})),function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"}(Dt||(Dt={}));var jt=gt.getInstance(),Vt=w.instance(),Ht=new(function(){function t(){}return t.prototype.getMeter=function(t,e,n){return Y},t}()),$t="metrics",Gt=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(t){return m($t,t,w.instance())},t.prototype.getMeterProvider=function(){return f($t)||Ht},t.prototype.getMeter=function(t,e,n){return this.getMeterProvider().getMeter(t,e,n)},t.prototype.disable=function(){v($t,w.instance())},t}().getInstance(),Xt=function(){function t(){}return t.prototype.inject=function(t,e){},t.prototype.extract=function(t,e){return t},t.prototype.fields=function(){return[]},t}(),zt=N("OpenTelemetry Baggage Key");function qt(t){return t.getValue(zt)||void 0}function Wt(){return qt(gt.getInstance().active())}function Kt(t,e){return t.setValue(zt,e)}function Qt(t){return t.deleteValue(zt)}var Yt="propagation",Zt=new Xt,Jt=function(){function t(){this.createBaggage=M,this.getBaggage=qt,this.getActiveBaggage=Wt,this.setBaggage=Kt,this.deleteBaggage=Qt}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(t){return m(Yt,t,w.instance())},t.prototype.inject=function(t,e,n){return void 0===n&&(n=ot),this._getGlobalPropagator().inject(t,e,n)},t.prototype.extract=function(t,e,n){return void 0===n&&(n=st),this._getGlobalPropagator().extract(t,e,n)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){v(Yt,w.instance())},t.prototype._getGlobalPropagator=function(){return f(Yt)||Zt},t}(),te=Jt.getInstance(),ee="trace",ne=function(){function t(){this._proxyTracerProvider=new Bt,this.wrapSpanContext=Pt,this.isSpanContextValid=At,this.deleteSpan=yt,this.getSpan=Tt,this.getActiveSpan=St,this.getSpanContext=Ot,this.setSpan=bt,this.setSpanContext=Lt}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(t){var e=m(ee,this._proxyTracerProvider,w.instance());return e&&this._proxyTracerProvider.setDelegate(t),e},t.prototype.getTracerProvider=function(){return f(ee)||this._proxyTracerProvider},t.prototype.getTracer=function(t,e){return this.getTracerProvider().getTracer(t,e)},t.prototype.disable=function(){v(ee,w.instance()),this._proxyTracerProvider=new Bt},t}(),re=ne.getInstance();class ie{fail(t){}spanContext(){return this._spanContext}setAttribute(t,e){return this}setAttributes(t){return this}removeAttribute(t){return this}addEvent(t,e,n){return this}addLink(t){return this}addLinks(t){return this}setStatus(t){return this}updateName(t){return this}end(t){}isRecording(){return!1}recordException(t,e){}constructor(t=ft){this.attributes={},this._spanContext=t}}const se=new class{startSpan(t,e){return new ie}setSpan(t,e){return k}getSpan(t){}};class oe{getDelegate(){var t;return null!=(t=this._delegate)?t:se}setDelegate(t){this._delegate=t}startSpan(t,e,n){return this.getDelegate().startSpan(t,e,n)}setSpan(t,e){return this.getDelegate().setSpan(t,e)}getSpan(t){return this.getDelegate().getSpan(t)}}class ae{static getInstance(){return ae._instance||(ae._instance=new ae({proxyTraceManager:new oe})),ae._instance}setGlobalTraceManager(t){this._proxyTraceManager.setDelegate(t)}startSpan(t,e,n){return this.getTraceManager().startSpan(t,e,n)}setSpan(t,e){return this.getTraceManager().setSpan(t,e)}getSpan(t){return this.getTraceManager().getSpan(t)}constructor({proxyTraceManager:t}){this.getTraceManager=()=>this._proxyTraceManager,this._proxyTraceManager=t}}const ue=ae.getInstance(),ce="enduser.pseudo.id";const le=new class{getEmbraceUserId(){return""}getUserId(){return null}setUserId(){}clearUserId(){}};class he{getDelegate(){var t;return null!=(t=this._delegate)?t:le}setDelegate(t){this._delegate=t}getEmbraceUserId(){return this.getDelegate().getEmbraceUserId()}getUserId(){return this.getDelegate().getUserId()}setUserId(t){this.getDelegate().setUserId(t)}clearUserId(){this.getDelegate().clearUserId()}}class de{static getInstance(){return de._instance||(de._instance=new de({proxyUserManager:new he})),de._instance}getUserManager(){return this._proxyUserManager}setGlobalUserManager(t){this._proxyUserManager.setDelegate(t)}getEmbraceUserId(){return this.getUserManager().getEmbraceUserId()}getUserId(){return this.getUserManager().getUserId()}setUserId(t){this.getUserManager().setUserId(t)}clearUserId(){this.getUserManager().clearUserId()}constructor({proxyUserManager:t}){this._proxyUserManager=t}}const pe=de.getInstance();var ge;!function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.TRACE=1]="TRACE",t[t.TRACE2=2]="TRACE2",t[t.TRACE3=3]="TRACE3",t[t.TRACE4=4]="TRACE4",t[t.DEBUG=5]="DEBUG",t[t.DEBUG2=6]="DEBUG2",t[t.DEBUG3=7]="DEBUG3",t[t.DEBUG4=8]="DEBUG4",t[t.INFO=9]="INFO",t[t.INFO2=10]="INFO2",t[t.INFO3=11]="INFO3",t[t.INFO4=12]="INFO4",t[t.WARN=13]="WARN",t[t.WARN2=14]="WARN2",t[t.WARN3=15]="WARN3",t[t.WARN4=16]="WARN4",t[t.ERROR=17]="ERROR",t[t.ERROR2=18]="ERROR2",t[t.ERROR3=19]="ERROR3",t[t.ERROR4=20]="ERROR4",t[t.FATAL=21]="FATAL",t[t.FATAL2=22]="FATAL2",t[t.FATAL3=23]="FATAL3",t[t.FATAL4=24]="FATAL4"}(ge||(ge={}));class _e{emit(t){}}const me=new _e;const fe=new class{getLogger(t,e,n){return new _e}};class ve{emit(t){this._getLogger().emit(t)}_getLogger(){if(this._delegate)return this._delegate;const t=this._provider.getDelegateLogger(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):me}constructor(t,e,n,r){this._provider=t,this.name=e,this.version=n,this.options=r}}class Ee{getLogger(t,e,n){var r;return null!==(r=this.getDelegateLogger(t,e,n))&&void 0!==r?r:new ve(this,t,e,n)}getDelegate(){var t;return null!==(t=this._delegate)&&void 0!==t?t:fe}setDelegate(t){this._delegate=t}getDelegateLogger(t,e,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getLogger(t,e,n)}}const Te="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},Se=Symbol.for("io.opentelemetry.js.api.logs"),be=Te;class ye{static getInstance(){return this._instance||(this._instance=new ye),this._instance}setGlobalLoggerProvider(t){return be[Se]?this.getLoggerProvider():(be[Se]=(e=1,n=t,r=fe,t=>t===e?n:r),this._proxyLoggerProvider.setDelegate(t),t);var e,n,r}getLoggerProvider(){var t,e;return null!==(e=null===(t=be[Se])||void 0===t?void 0:t.call(be,1))&&void 0!==e?e:this._proxyLoggerProvider}getLogger(t,e,n){return this.getLoggerProvider().getLogger(t,e,n)}disable(){delete be[Se],this._proxyLoggerProvider=new Ee}constructor(){this._proxyLoggerProvider=new Ee}}const Le=ye.getInstance();var Oe,we;var Re=function(){if(we)return Oe;function t(t){return"function"==typeof t}we=1;var e=console.error.bind(console);function n(t,e,n){var r=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:r,writable:!0,value:n})}function r(n){n&&n.logger&&(t(n.logger)?e=n.logger:e("new logger isn't a function, not replacing"))}function i(r,i,s){if(r&&r[i]){if(!s)return e("no wrapper function"),void e((new Error).stack);if(t(r[i])&&t(s)){var o=r[i],a=s(o,i);return n(a,"__original",o),n(a,"__unwrap",function(){r[i]===a&&n(r,i,o)}),n(a,"__wrapped",!0),n(r,i,a),a}e("original object and wrapper must be functions")}else e("no original function "+i+" to wrap")}function s(t,n){return t&&t[n]?t[n].__unwrap?t[n].__unwrap():void e("no original to unwrap to -- has "+n+" already been unwrapped?"):(e("no function to unwrap."),void e((new Error).stack))}return r.wrap=i,r.massWrap=function(t,n,r){if(!t)return e("must provide one or more modules to patch"),void e((new Error).stack);Array.isArray(t)||(t=[t]),n&&Array.isArray(n)?t.forEach(function(t){n.forEach(function(e){i(t,e,r)})}):e("must provide one or more functions to wrap on modules")},r.unwrap=s,r.massUnwrap=function(t,n){if(!t)return e("must provide one or more modules to patch"),void e((new Error).stack);Array.isArray(t)||(t=[t]),n&&Array.isArray(n)?t.forEach(function(t){n.forEach(function(e){s(t,e)})}):e("must provide one or more functions to unwrap on modules")},Oe=r}();let Ce=class{get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){var t;const e=null!==(t=this.init())&&void 0!==t?t:[];return Array.isArray(e)?e:[e]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t){this._config=Object.assign({enabled:!0},t)}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(t,e,n,r){if(t)try{t(n,r)}catch(t){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:e},t)}}constructor(t,e,n){this.instrumentationName=t,this.instrumentationVersion=e,this._config={},this._wrap=Re.wrap,this._unwrap=Re.unwrap,this._massWrap=Re.massWrap,this._massUnwrap=Re.massUnwrap,this.setConfig(n),this._diag=Vt.createComponentLogger({namespace:t}),this._tracer=re.getTracer(t,e),this._meter=Gt.getMeter(t,e),this._logger=Le.getLogger(t,e),this._updateMetricInstruments()}};class Ae extends Ce{constructor(t,e,n){super(t,e,n),this._config.enabled&&this.enable()}}function Pe(t,e,n){let r,i;try{i=t()}catch(t){r=t}finally{return e(r,i),i}}function Ie(t){return"function"==typeof t&&"function"==typeof t.__original&&"function"==typeof t.__unwrap&&!0===t.__wrapped}var Me="service.name",Ne="telemetry.sdk.name",xe="telemetry.sdk.language",De="telemetry.sdk.version";const Ue=N("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function ke(t){return t.setValue(Ue,!0)}function Fe(t){return!0===t.getValue(Ue)}const Be="baggage";function je(t){const e=t.split(";");if(e.length<=0)return;const n=e.shift();if(!n)return;const r=n.indexOf("=");if(r<=0)return;const i=decodeURIComponent(n.substring(0,r).trim()),s=decodeURIComponent(n.substring(r+1).trim());let o;var a;return e.length>0&&("string"!=typeof(a=e.join(";"))&&(I.error("Cannot create baggage metadata from unknown type: "+typeof a),a=""),o={__TYPE__:P,toString:function(){return a}}),{key:i,value:s,metadata:o}}class Ve{inject(t,e,n){const r=te.getBaggage(t);if(!r||Fe(t))return;const i=function(t){return t.getAllEntries().map(([t,e])=>{let n=`${encodeURIComponent(t)}=${encodeURIComponent(e.value)}`;return void 0!==e.metadata&&(n+=";"+e.metadata.toString()),n})}(r).filter(t=>t.length<=4096).slice(0,180),s=function(t){return t.reduce((t,e)=>{const n=`${t}${""!==t?",":""}${e}`;return n.length>8192?t:n},"")}(i);s.length>0&&n.set(e,Be,s)}extract(t,e,n){const r=n.get(e,Be),i=Array.isArray(r)?r.join(","):r;if(!i)return t;const s={};if(0===i.length)return t;return i.split(",").forEach(t=>{const e=je(t);if(e){const t={value:e.value};e.metadata&&(t.metadata=e.metadata),s[e.key]=t}}),0===Object.entries(s).length?t:te.setBaggage(t,te.createBaggage(s))}fields(){return[Be]}}function He(t){const e={};if("object"!=typeof t||null==t)return e;for(const[n,r]of Object.entries(t))$e(n)?Ge(r)?Array.isArray(r)?e[n]=r.slice():e[n]=r:Vt.warn(`Invalid attribute value set for key: ${n}`):Vt.warn(`Invalid attribute key: ${n}`);return e}function $e(t){return"string"==typeof t&&t.length>0}function Ge(t){return null==t||(Array.isArray(t)?function(t){let e;for(const n of t)if(null!=n){if(!e){if(Xe(n)){e=typeof n;continue}return!1}if(typeof n!==e)return!1}return!0}(t):Xe(t))}function Xe(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}let ze=t=>{Vt.error(function(t){return"string"==typeof t?t:JSON.stringify(function(t){const e={};let n=t;for(;null!==n;)Object.getOwnPropertyNames(n).forEach(t=>{if(e[t])return;const r=n[t];r&&(e[t]=String(r))}),n=Object.getPrototypeOf(n);return e}(t))}(t))};function qe(t){try{ze(t)}catch(t){}}var We;!function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"}(We||(We={}));const Ke=["OTEL_SDK_DISABLED"];function Qe(t){return Ke.indexOf(t)>-1}const Ye=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Ze(t){return Ye.indexOf(t)>-1}const Je=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS","OTEL_SEMCONV_STABILITY_OPT_IN"];function tn(t){return Je.indexOf(t)>-1}const en=1/0,nn=128,rn={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:E.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:en,OTEL_ATTRIBUTE_COUNT_LIMIT:nn,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:en,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:nn,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:en,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:nn,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:We.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative",OTEL_SEMCONV_STABILITY_OPT_IN:[]};function sn(t,e,n){if(void 0===n[t])return;const r=String(n[t]);e[t]="true"===r.toLowerCase()}function on(t,e,n,r=-1/0,i=1/0){if(void 0!==n[t]){const s=Number(n[t]);isNaN(s)||(e[t]=s<r?r:s>i?i:s)}}function an(t,e,n,r=","){const i=n[t];"string"==typeof i&&(e[t]=i.split(r).map(t=>t.trim()))}const un={ALL:E.ALL,VERBOSE:E.VERBOSE,DEBUG:E.DEBUG,INFO:E.INFO,WARN:E.WARN,ERROR:E.ERROR,NONE:E.NONE};function cn(t,e,n){const r=n[t];if("string"==typeof r){const n=un[r.toUpperCase()];null!=n&&(e[t]=n)}}function ln(t){const e={};for(const n in rn){const r=n;if("OTEL_LOG_LEVEL"===r)cn(r,e,t);else if(Qe(r))sn(r,e,t);else if(Ze(r))on(r,e,t);else if(tn(r))an(r,e,t);else{const n=t[r];null!=n&&(e[r]=String(n))}}return e}const hn="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{};function dn(){const t=ln(hn);return Object.assign({},rn,t)}function pn(){return ln(hn)}function gn(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function _n(t){const e=new Uint8Array(t.length/2);let n=0;for(let r=0;r<t.length;r+=2){const i=gn(t.charCodeAt(r)),s=gn(t.charCodeAt(r+1));e[n++]=i<<4|s}return e}const mn=performance;var fn="process.runtime.name",vn="telemetry.sdk.name",En="telemetry.sdk.language",Tn="telemetry.sdk.version";const Sn={[vn]:"opentelemetry",[fn]:"browser",[En]:"webjs",[Tn]:"1.30.1"};const bn=Math.pow(10,6),yn=Math.pow(10,9);function Ln(t){const e=t/1e3;return[Math.trunc(e),Math.round(t%1e3*bn)]}function On(){let t=mn.timeOrigin;if("number"!=typeof t){const e=mn;t=e.timing&&e.timing.fetchStart}return t}function wn(t){return In(Ln(On()),Ln("number"==typeof t?t:mn.now()))}function Rn(t){if(An(t))return t;if("number"==typeof t)return t<On()?wn(t):Ln(t);if(t instanceof Date)return Ln(t.getTime());throw TypeError("Invalid input type")}function Cn(t){return t[0]*yn+t[1]}function An(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}function Pn(t){return An(t)||"number"==typeof t||t instanceof Date}function In(t,e){const n=[t[0]+e[0],t[1]+e[1]];return n[1]>=yn&&(n[1]-=yn,n[0]+=1),n}var Mn;!function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"}(Mn||(Mn={}));class Nn{inject(t,e,n){for(const r of this._propagators)try{r.inject(t,e,n)}catch(t){Vt.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}}extract(t,e,n){return this._propagators.reduce((t,r)=>{try{return r.extract(t,e,n)}catch(t){Vt.warn(`Failed to extract with ${r.constructor.name}. Err: ${t.message}`)}return t},t)}fields(){return this._fields.slice()}constructor(t={}){var e;this._propagators=null!==(e=t.propagators)&&void 0!==e?e:[],this._fields=Array.from(new Set(this._propagators.map(t=>"function"==typeof t.fields?t.fields():[]).reduce((t,e)=>t.concat(e),[])))}}const xn="[_0-9a-z-*/]",Dn=new RegExp(`^(?:${`[a-z]${xn}{0,255}`}|${`[a-z0-9]${xn}{0,240}@[a-z]${xn}{0,13}`})$`),Un=/^[ -~]{0,255}[!-~]$/,kn=/,|=/;class Fn{set(t,e){const n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce((t,e)=>(t.push(e+"="+this.get(e)),t),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce((t,e)=>{const n=e.trim(),r=n.indexOf("=");if(-1!==r){const i=n.slice(0,r),s=n.slice(r+1,e.length);(function(t){return Dn.test(t)})(i)&&function(t){return Un.test(t)&&!kn.test(t)}(s)&&t.set(i,s)}return t},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new Fn;return t._internalState=new Map(this._internalState),t}constructor(t){this._internalState=new Map,t&&this._parse(t)}}const Bn="traceparent",jn="tracestate",Vn=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");class Hn{inject(t,e,n){const r=re.getSpanContext(t);if(!r||Fe(t)||!At(r))return;const i=`00-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||D.NONE).toString(16)}`;n.set(e,Bn,i),r.traceState&&n.set(e,jn,r.traceState.serialize())}extract(t,e,n){const r=n.get(e,Bn);if(!r)return t;const i=Array.isArray(r)?r[0]:r;if("string"!=typeof i)return t;const s=function(t){const e=Vn.exec(t);return e?"00"===e[1]&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}:null}(i);if(!s)return t;s.isRemote=!0;const o=n.get(e,jn);if(o){const t=Array.isArray(o)?o.join(","):o;s.traceState=new Fn("string"==typeof t?t:void 0)}return re.setSpanContext(t,s)}fields(){return[Bn,jn]}}const $n="[object Null]",Gn="[object Undefined]",Xn=Function.prototype.toString,zn=Xn.call(Object),qn=(Wn=Object.getPrototypeOf,Kn=Object,function(t){return Wn(Kn(t))});var Wn,Kn;const Qn=Object.prototype,Yn=Qn.hasOwnProperty,Zn=Symbol?Symbol.toStringTag:void 0,Jn=Qn.toString;function tr(t){if(!function(t){return null!=t&&"object"==typeof t}(t)||"[object Object]"!==function(t){if(null==t)return void 0===t?Gn:$n;return Zn&&Zn in Object(t)?function(t){const e=Yn.call(t,Zn),n=t[Zn];let r=!1;try{t[Zn]=void 0,r=!0}catch(t){}const i=Jn.call(t);r&&(e?t[Zn]=n:delete t[Zn]);return i}(t):function(t){return Jn.call(t)}(t)}(t))return!1;const e=qn(t);if(null===e)return!0;const n=Yn.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Xn.call(n)===zn}function er(...t){let e=t.shift();const n=new WeakMap;for(;t.length>0;)e=rr(e,t.shift(),0,n);return e}function nr(t){return sr(t)?t.slice():t}function rr(t,e,n=0,r){let i;if(!(n>20)){if(n++,ur(t)||ur(e)||or(e))i=nr(e);else if(sr(t)){if(i=t.slice(),sr(e))for(let t=0,n=e.length;t<n;t++)i.push(nr(e[t]));else if(ar(e)){const t=Object.keys(e);for(let n=0,r=t.length;n<r;n++){const r=t[n];i[r]=nr(e[r])}}}else if(ar(t))if(ar(e)){if(!function(t,e){if(!tr(t)||!tr(e))return!1;return!0}(t,e))return e;i=Object.assign({},t);const s=Object.keys(e);for(let o=0,a=s.length;o<a;o++){const a=s[o],u=e[a];if(ur(u))void 0===u?delete i[a]:i[a]=u;else{const s=i[a],o=u;if(ir(t,a,r)||ir(e,a,r))delete i[a];else{if(ar(s)&&ar(o)){const n=r.get(s)||[],i=r.get(o)||[];n.push({obj:t,key:a}),i.push({obj:e,key:a}),r.set(s,n),r.set(o,i)}i[a]=rr(i[a],u,n,r)}}}}else i=e;return i}}function ir(t,e,n){const r=n.get(t[e])||[];for(let n=0,i=r.length;n<i;n++){const i=r[n];if(i.key===e&&i.obj===t)return!0}return!1}function sr(t){return Array.isArray(t)}function or(t){return"function"==typeof t}function ar(t){return!ur(t)&&!sr(t)&&!or(t)&&"object"==typeof t}function ur(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||void 0===t||t instanceof Date||t instanceof RegExp||null===t}class cr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,cr.prototype)}}function lr(t,e){let n;const r=new Promise(function(t,r){n=setTimeout(function(){r(new cr("Operation timed out."))},e)});return Promise.race([t,r]).then(t=>(clearTimeout(n),t),t=>{throw clearTimeout(n),t})}function hr(t,e){return"string"==typeof e?t===e:!!t.match(e)}function dr(t,e){if(!e)return!1;for(const n of e)if(hr(t,n))return!0;return!1}class pr{get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}constructor(){this._promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}}class gr{get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then(t=>this._deferred.resolve(t),t=>this._deferred.reject(t))}catch(t){this._deferred.reject(t)}}return this._deferred.promise}constructor(t,e){this._callback=t,this._that=e,this._isCalled=!1,this._deferred=new pr}}const _r={_export:function(t,e){return new Promise(n=>{jt.with(ke(jt.active()),()=>{t.export(e,t=>{n(t)})})})}};function mr(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}class fr{static empty(){return fr.EMPTY}static default(){return new fr({[Me]:"unknown_service",[xe]:Sn[xe],[Ne]:Sn[Ne],[De]:Sn[De]})}get attributes(){var t;return this.asyncAttributesPending&&Vt.error("Accessing resource attributes before async attributes settled"),null!==(t=this._attributes)&&void 0!==t?t:{}}waitForAsyncAttributes(){return(t=function*(){this.asyncAttributesPending&&(yield this._asyncAttributesPromise)},function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){mr(s,r,i,o,a,"next",t)}function a(t){mr(s,r,i,o,a,"throw",t)}o(void 0)})}).call(this);var t}merge(t){var e;if(!t)return this;const n=Object.assign(Object.assign({},this._syncAttributes),null!==(e=t._syncAttributes)&&void 0!==e?e:t.attributes);if(!this._asyncAttributesPromise&&!t._asyncAttributesPromise)return new fr(n);const r=Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then(([e,n])=>{var r;return Object.assign(Object.assign(Object.assign(Object.assign({},this._syncAttributes),e),null!==(r=t._syncAttributes)&&void 0!==r?r:t.attributes),n)});return new fr(n,r)}constructor(t,e){var n;this._attributes=t,this.asyncAttributesPending=null!=e,this._syncAttributes=null!==(n=this._attributes)&&void 0!==n?n:{},this._asyncAttributesPromise=null==e?void 0:e.then(t=>(this._attributes=Object.assign({},this._attributes,t),this.asyncAttributesPending=!1,t),t=>(Vt.debug("a resource's async attributes promise rejected: %s",t),this.asyncAttributesPending=!1,{}))}}fr.EMPTY=new fr({});class vr{set severityText(t){this._isLogRecordReadonly()||(this._severityText=t)}get severityText(){return this._severityText}set severityNumber(t){this._isLogRecordReadonly()||(this._severityNumber=t)}get severityNumber(){return this._severityNumber}set body(t){this._isLogRecordReadonly()||(this._body=t)}get body(){return this._body}get droppedAttributesCount(){return this.totalAttributesCount-Object.keys(this.attributes).length}setAttribute(t,e){return this._isLogRecordReadonly()||null===e?this:0===t.length?(Vt.warn(`Invalid attribute key: ${t}`),this):Ge(e)||"object"==typeof e&&!Array.isArray(e)&&Object.keys(e).length>0?(this.totalAttributesCount+=1,Object.keys(this.attributes).length>=this._logRecordLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(1===this.droppedAttributesCount&&Vt.warn("Dropping extra attributes."),this):(Ge(e)?this.attributes[t]=this._truncateToSize(e):this.attributes[t]=e,this)):(Vt.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,n]of Object.entries(t))this.setAttribute(e,n);return this}setBody(t){return this.body=t,this}setSeverityNumber(t){return this.severityNumber=t,this}setSeverityText(t){return this.severityText=t,this}_makeReadonly(){this._isReadonly=!0}_truncateToSize(t){const e=this._logRecordLimits.attributeValueLengthLimit;return e<=0?(Vt.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map(t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t):t}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substring(0,e)}_isLogRecordReadonly(){return this._isReadonly&&Vt.warn("Can not execute the operation on emitted log record"),this._isReadonly}constructor(t,e,n){this.attributes={},this.totalAttributesCount=0,this._isReadonly=!1;const{timestamp:r,observedTimestamp:i,severityNumber:s,severityText:o,body:a,attributes:u={},context:c}=n,l=Date.now();if(this.hrTime=Rn(null!=r?r:l),this.hrTimeObserved=Rn(null!=i?i:l),c){const t=re.getSpanContext(c);t&&At(t)&&(this.spanContext=t)}this.severityNumber=s,this.severityText=o,this.body=a,this.resource=t.resource,this.instrumentationScope=e,this._logRecordLimits=t.logRecordLimits,this.setAttributes(u)}}class Er{emit(t){const e=t.context||jt.active(),n=new vr(this._sharedState,this.instrumentationScope,Object.assign({context:e},t));this._sharedState.activeProcessor.onEmit(n,e),n._makeReadonly()}constructor(t,e){this.instrumentationScope=t,this._sharedState=e}}function Tr(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}function Sr(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){Tr(s,r,i,o,a,"next",t)}function a(t){Tr(s,r,i,o,a,"throw",t)}o(void 0)})}}class br{forceFlush(){return Sr(function*(){const t=this.forceFlushTimeoutMillis;yield Promise.all(this.processors.map(e=>lr(e.forceFlush(),t)))}).call(this)}onEmit(t,e){this.processors.forEach(n=>n.onEmit(t,e))}shutdown(){return Sr(function*(){yield Promise.all(this.processors.map(t=>t.shutdown()))}).call(this)}constructor(t,e){this.processors=t,this.forceFlushTimeoutMillis=e}}class yr{forceFlush(){return Promise.resolve()}onEmit(t,e){}shutdown(){return Promise.resolve()}}class Lr{constructor(t,e,n){this.resource=t,this.forceFlushTimeoutMillis=e,this.logRecordLimits=n,this.loggers=new Map,this.registeredLogRecordProcessors=[],this.activeProcessor=new yr}}class Or{getLogger(t,e,n){if(this._shutdownOnce.isCalled)return Vt.warn("A shutdown LoggerProvider cannot provide a Logger"),me;t||Vt.warn("Logger requested without instrumentation scope name.");const r=t||"unknown",i=`${r}@${e||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._sharedState.loggers.has(i)||this._sharedState.loggers.set(i,new Er({name:r,version:e,schemaUrl:null==n?void 0:n.schemaUrl},this._sharedState)),this._sharedState.loggers.get(i)}addLogRecordProcessor(t){0===this._sharedState.registeredLogRecordProcessors.length&&this._sharedState.activeProcessor.shutdown().catch(t=>Vt.error("Error while trying to shutdown current log record processor",t)),this._sharedState.registeredLogRecordProcessors.push(t),this._sharedState.activeProcessor=new br(this._sharedState.registeredLogRecordProcessors,this._sharedState.forceFlushTimeoutMillis)}forceFlush(){return this._shutdownOnce.isCalled?(Vt.warn("invalid attempt to force flush after LoggerProvider shutdown"),this._shutdownOnce.promise):this._sharedState.activeProcessor.forceFlush()}shutdown(){return this._shutdownOnce.isCalled?(Vt.warn("shutdown may only be called once per LoggerProvider"),this._shutdownOnce.promise):this._shutdownOnce.call()}_shutdown(){return this._sharedState.activeProcessor.shutdown()}constructor(t={}){const e=er({},{forceFlushTimeoutMillis:3e4,logRecordLimits:{attributeValueLengthLimit:dn().OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:dn().OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT},includeTraceContext:!0,mergeResourceWithDefaults:!0},t),n=function(t,e){const n=null!=e?e:fr.empty();return t?fr.default().merge(n):n}(e.mergeResourceWithDefaults,t.resource);this._sharedState=new Lr(n,e.forceFlushTimeoutMillis,function(t){var e,n,r,i,s,o;const a=pn();return{attributeCountLimit:null!==(r=null!==(n=null!==(e=t.attributeCountLimit)&&void 0!==e?e:a.OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT)&&void 0!==n?n:a.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==r?r:nn,attributeValueLengthLimit:null!==(o=null!==(s=null!==(i=t.attributeValueLengthLimit)&&void 0!==i?i:a.OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==s?s:a.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==o?o:en}}(e.logRecordLimits)),this._shutdownOnce=new gr(this._shutdown,this)}}function wr(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}class Rr{onEmit(t){this._shutdownOnce.isCalled||this._addToBuffer(t)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}shutdown(){return this._shutdownOnce.call()}_shutdown(){return(t=function*(){this.onShutdown(),yield this._flushAll(),yield this._exporter.shutdown()},function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){wr(s,r,i,o,a,"next",t)}function a(t){wr(s,r,i,o,a,"throw",t)}o(void 0)})}).call(this);var t}_addToBuffer(t){this._finishedLogRecords.length>=this._maxQueueSize||(this._finishedLogRecords.push(t),this._maybeStartTimer())}_flushAll(){return new Promise((t,e)=>{const n=[],r=Math.ceil(this._finishedLogRecords.length/this._maxExportBatchSize);for(let t=0;t<r;t++)n.push(this._flushOneBatch());Promise.all(n).then(()=>{t()}).catch(e)})}_flushOneBatch(){return this._clearTimer(),0===this._finishedLogRecords.length?Promise.resolve():new Promise((t,e)=>{lr(this._export(this._finishedLogRecords.splice(0,this._maxExportBatchSize)),this._exportTimeoutMillis).then(()=>t()).catch(e)})}_maybeStartTimer(){void 0===this._timer&&(this._timer=setTimeout(()=>{this._flushOneBatch().then(()=>{this._finishedLogRecords.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(t=>{qe(t)})},this._scheduledDelayMillis),this._timer)}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}_export(t){const e=()=>_r._export(this._exporter,t).then(t=>{var e;t.code!==Mn.SUCCESS&&qe(null!==(e=t.error)&&void 0!==e?e:new Error(`BatchLogRecordProcessor: log record export failed (status ${t})`))}).catch(qe),n=t.map(t=>t.resource).filter(t=>t.asyncAttributesPending);return 0===n.length?e():Promise.all(n.map(t=>{var e;return null===(e=t.waitForAsyncAttributes)||void 0===e?void 0:e.call(t)})).then(e,qe)}constructor(t,e){var n,r,i,s;this._exporter=t,this._finishedLogRecords=[];const o=dn();this._maxExportBatchSize=null!==(n=null==e?void 0:e.maxExportBatchSize)&&void 0!==n?n:o.OTEL_BLRP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=null!==(r=null==e?void 0:e.maxQueueSize)&&void 0!==r?r:o.OTEL_BLRP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=null!==(i=null==e?void 0:e.scheduledDelayMillis)&&void 0!==i?i:o.OTEL_BLRP_SCHEDULE_DELAY,this._exportTimeoutMillis=null!==(s=null==e?void 0:e.exportTimeoutMillis)&&void 0!==s?s:o.OTEL_BLRP_EXPORT_TIMEOUT,this._shutdownOnce=new gr(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Vt.warn("BatchLogRecordProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}}class Cr extends Rr{onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}_onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush()},this._pageHideListener=()=>{this.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}constructor(t,e){super(t,e),this._onInit(e)}}var Ar="exception.type",Pr="exception.message";class Ir{spanContext(){return this._spanContext}setAttribute(t,e){return null==e||this._isSpanEnded()?this:0===t.length?(Vt.warn(`Invalid attribute key: ${t}`),this):Ge(e)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(e),this):(Vt.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,n]of Object.entries(t))this.setAttribute(e,n);return this}addEvent(t,e,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return Vt.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(0===this._droppedEventsCount&&Vt.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),Pn(e)&&(Pn(n)||(n=e),e=void 0);const r=He(e);return this.events.push({name:t,attributes:r,time:this._getTime(n),droppedAttributesCount:0}),this}addLink(t){return this.links.push(t),this}addLinks(t){return this.links.push(...t),this}setStatus(t){return this._isSpanEnded()||(this.status=Object.assign({},t),null!=this.status.message&&"string"!=typeof t.message&&(Vt.warn(`Dropping invalid status.message of type '${typeof t.message}', expected 'string'`),delete this.status.message)),this}updateName(t){return this._isSpanEnded()||(this.name=t),this}end(t){this._isSpanEnded()?Vt.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(t),this._duration=function(t,e){let n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=yn),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&(Vt.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&Vt.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this))}_getTime(t){if("number"==typeof t&&t<=mn.now())return wn(t+this._performanceOffset);if("number"==typeof t)return Ln(t);if(t instanceof Date)return Ln(t.getTime());if(An(t))return t;if(this._startTimeProvided)return Ln(Date.now());const e=mn.now()-this._performanceStartTime;return In(this.startTime,Ln(e))}isRecording(){return!1===this._ended}recordException(t,e){const n={};"string"==typeof t?n[Pr]=t:t&&(t.code?n[Ar]=t.code.toString():t.name&&(n[Ar]=t.name),t.message&&(n[Pr]=t.message),t.stack&&(n["exception.stacktrace"]=t.stack)),n[Ar]||n[Pr]?this.addEvent("exception",n,e):Vt.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){return this._ended&&Vt.warn(`Can not execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`),this._ended}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substring(0,e)}_truncateToSize(t){const e=this._attributeValueLengthLimit;return e<=0?(Vt.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map(t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t):t}constructor(t,e,n,r,i,s,o=[],a,u,c){this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:Dt.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=s,this.kind=i,this.links=o;const l=Date.now();this._performanceStartTime=mn.now(),this._performanceOffset=l-(this._performanceStartTime+On()),this._startTimeProvided=null!=a,this.startTime=this._getTime(null!=a?a:l),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this._spanLimits=t.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,null!=c&&this.setAttributes(c),this._spanProcessor=t.getActiveSpanProcessor(),this._spanProcessor.onStart(this,e)}}var Mr;!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Mr||(Mr={}));class Nr{shouldSample(){return{decision:Mr.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class xr{shouldSample(){return{decision:Mr.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class Dr{shouldSample(t,e,n,r,i,s){const o=re.getSpanContext(t);return o&&At(o)?o.isRemote?o.traceFlags&D.SAMPLED?this._remoteParentSampled.shouldSample(t,e,n,r,i,s):this._remoteParentNotSampled.shouldSample(t,e,n,r,i,s):o.traceFlags&D.SAMPLED?this._localParentSampled.shouldSample(t,e,n,r,i,s):this._localParentNotSampled.shouldSample(t,e,n,r,i,s):this._root.shouldSample(t,e,n,r,i,s)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}constructor(t){var e,n,r,i;this._root=t.root,this._root||(qe(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new xr),this._remoteParentSampled=null!==(e=t.remoteParentSampled)&&void 0!==e?e:new xr,this._remoteParentNotSampled=null!==(n=t.remoteParentNotSampled)&&void 0!==n?n:new Nr,this._localParentSampled=null!==(r=t.localParentSampled)&&void 0!==r?r:new xr,this._localParentNotSampled=null!==(i=t.localParentNotSampled)&&void 0!==i?i:new Nr}}class Ur{shouldSample(t,e){return{decision:Ct(e)&&this._accumulate(e)<this._upperBound?Mr.RECORD_AND_SAMPLED:Mr.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return"number"!=typeof t||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let e=0;for(let n=0;n<t.length/8;n++){const r=8*n;e=(e^parseInt(t.slice(r,r+8),16))>>>0}return e}constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(4294967295*this._ratio)}}const kr=We.AlwaysOn;function Fr(){const t=dn();return{sampler:Br(t),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:t.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:t.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:t.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:t.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT},mergeResourceWithDefaults:!0}}function Br(t=dn()){switch(t.OTEL_TRACES_SAMPLER){case We.AlwaysOn:return new xr;case We.AlwaysOff:return new Nr;case We.ParentBasedAlwaysOn:return new Dr({root:new xr});case We.ParentBasedAlwaysOff:return new Dr({root:new Nr});case We.TraceIdRatio:return new Ur(jr(t));case We.ParentBasedTraceIdRatio:return new Dr({root:new Ur(jr(t))});default:return Vt.error(`OTEL_TRACES_SAMPLER value "${t.OTEL_TRACES_SAMPLER} invalid, defaulting to ${kr}".`),new xr}}function jr(t){if(void 0===t.OTEL_TRACES_SAMPLER_ARG||""===t.OTEL_TRACES_SAMPLER_ARG)return Vt.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;const e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(Vt.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is invalid, defaulting to 1.`),1):e<0||e>1?(Vt.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is out of range ([0..1]), defaulting to 1.`),1):e}class Vr{forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(t,e){}onEnd(t){this._shutdownOnce.isCalled||0!==(t.spanContext().traceFlags&D.SAMPLED)&&this._addToBuffer(t)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then(()=>this.onShutdown()).then(()=>this._flushAll()).then(()=>this._exporter.shutdown())}_addToBuffer(t){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&Vt.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(Vt.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(t),this._maybeStartTimer()}_flushAll(){return new Promise((t,e)=>{const n=[];for(let t=0,e=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);t<e;t++)n.push(this._flushOneBatch());Promise.all(n).then(()=>{t()}).catch(e)})}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((t,e)=>{const n=setTimeout(()=>{e(new Error("Timeout"))},this._exportTimeoutMillis);jt.with(ke(jt.active()),()=>{let r;this._finishedSpans.length<=this._maxExportBatchSize?(r=this._finishedSpans,this._finishedSpans=[]):r=this._finishedSpans.splice(0,this._maxExportBatchSize);const i=()=>this._exporter.export(r,r=>{var i;clearTimeout(n),r.code===Mn.SUCCESS?t():e(null!==(i=r.error)&&void 0!==i?i:new Error("BatchSpanProcessor: span export failed"))});let s=null;for(let t=0,e=r.length;t<e;t++){const e=r[t];e.resource.asyncAttributesPending&&e.resource.waitForAsyncAttributes&&(null!=s||(s=[]),s.push(e.resource.waitForAsyncAttributes()))}null===s?i():Promise.all(s).then(i,t=>{qe(t),e(t)})})})}_maybeStartTimer(){if(this._isExporting)return;const t=()=>{this._isExporting=!0,this._flushOneBatch().finally(()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(t=>{this._isExporting=!1,qe(t)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout(()=>t(),this._scheduledDelayMillis),this._timer)}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}constructor(t,e){this._exporter=t,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;const n=dn();this._maxExportBatchSize="number"==typeof(null==e?void 0:e.maxExportBatchSize)?e.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==e?void 0:e.maxQueueSize)?e.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==e?void 0:e.scheduledDelayMillis)?e.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==e?void 0:e.exportTimeoutMillis)?e.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new gr(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Vt.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}}class Hr extends Vr{onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush().catch(t=>{qe(t)})},this._pageHideListener=()=>{this.forceFlush().catch(t=>{qe(t)})},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}constructor(t,e){super(t,e),this.onInit(e)}}class $r{constructor(){this.generateTraceId=Xr(16),this.generateSpanId=Xr(8)}}const Gr=Array(32);function Xr(t){return function(){for(let e=0;e<2*t;e++)Gr[e]=Math.floor(16*Math.random())+48,Gr[e]>=58&&(Gr[e]+=39);return String.fromCharCode.apply(null,Gr.slice(0,2*t))}}class zr{startSpan(t,e={},n=jt.active()){var r,i,s;e.root&&(n=re.deleteSpan(n));const o=re.getSpan(n);if(Fe(n)){Vt.debug("Instrumentation suppressed, returning Noop Span");return re.wrapSpanContext(ft)}const a=null==o?void 0:o.spanContext(),u=this._idGenerator.generateSpanId();let c,l,h;a&&re.isSpanContextValid(a)?(c=a.traceId,l=a.traceState,h=a.spanId):c=this._idGenerator.generateTraceId();const d=null!==(r=e.kind)&&void 0!==r?r:xt.INTERNAL,p=(null!==(i=e.links)&&void 0!==i?i:[]).map(t=>({context:t.context,attributes:He(t.attributes)})),g=He(e.attributes),_=this._sampler.shouldSample(n,c,t,d,g,p);l=null!==(s=_.traceState)&&void 0!==s?s:l;const m={traceId:c,spanId:u,traceFlags:_.decision===Nt.RECORD_AND_SAMPLED?D.SAMPLED:D.NONE,traceState:l};if(_.decision===Nt.NOT_RECORD){Vt.debug("Recording is off, propagating context in a non-recording span");return re.wrapSpanContext(m)}const f=He(Object.assign(g,_.attributes));return new Ir(this,n,t,m,d,h,p,e.startTime,void 0,f)}startActiveSpan(t,e,n,r){let i,s,o;if(arguments.length<2)return;2===arguments.length?o=e:3===arguments.length?(i=e,o=n):(i=e,s=n,o=r);const a=null!=s?s:jt.active(),u=this.startSpan(t,i,a),c=re.setSpan(a,u);return jt.with(c,o,void 0,u)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}constructor(t,e,n){this._tracerProvider=n;const r=function(t){const e={sampler:Br()},n=Fr(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}(e);this._sampler=r.sampler,this._generalLimits=r.generalLimits,this._spanLimits=r.spanLimits,this._idGenerator=e.idGenerator||new $r,this.resource=n.resource,this.instrumentationLibrary=t}}class qr{forceFlush(){const t=[];for(const e of this._spanProcessors)t.push(e.forceFlush());return new Promise(e=>{Promise.all(t).then(()=>{e()}).catch(t=>{qe(t||new Error("MultiSpanProcessor: forceFlush failed")),e()})})}onStart(t,e){for(const n of this._spanProcessors)n.onStart(t,e)}onEnd(t){for(const e of this._spanProcessors)e.onEnd(t)}shutdown(){const t=[];for(const e of this._spanProcessors)t.push(e.shutdown());return new Promise((e,n)=>{Promise.all(t).then(()=>{e()},n)})}constructor(t){this._spanProcessors=t}}class Wr{onStart(t,e){}onEnd(t){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}}var Kr,Qr;!function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"}(Kr||(Kr={}));class Yr{getTracer(t,e,n){const r=`${t}@${e||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._tracers.has(r)||this._tracers.set(r,new zr({name:t,version:e,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)}addSpanProcessor(t){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch(t=>Vt.error("Error while trying to shutdown current span processor",t)),this._registeredSpanProcessors.push(t),this.activeSpanProcessor=new qr(this._registeredSpanProcessors)}getActiveSpanProcessor(){return this.activeSpanProcessor}register(t={}){re.setGlobalTracerProvider(this),void 0===t.propagator&&(t.propagator=this._buildPropagatorFromEnv()),t.contextManager&&jt.setGlobalContextManager(t.contextManager),t.propagator&&te.setGlobalPropagator(t.propagator)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,e=this._registeredSpanProcessors.map(e=>new Promise(n=>{let r;const i=setTimeout(()=>{n(new Error(`Span processor did not completed within timeout period of ${t} ms`)),r=Kr.timeout},t);e.forceFlush().then(()=>{clearTimeout(i),r!==Kr.timeout&&(r=Kr.resolved,n(r))}).catch(t=>{clearTimeout(i),r=Kr.error,n(t)})}));return new Promise((t,n)=>{Promise.all(e).then(e=>{const r=e.filter(t=>t!==Kr.resolved);r.length>0?n(r):t()}).catch(t=>n([t]))})}shutdown(){return this.activeSpanProcessor.shutdown()}_getPropagator(t){var e;return null===(e=this.constructor._registeredPropagators.get(t))||void 0===e?void 0:e()}_getSpanExporter(t){var e;return null===(e=this.constructor._registeredExporters.get(t))||void 0===e?void 0:e()}_buildPropagatorFromEnv(){const t=Array.from(new Set(dn().OTEL_PROPAGATORS)),e=t.map(t=>{const e=this._getPropagator(t);return e||Vt.warn(`Propagator "${t}" requested through environment variable is unavailable.`),e}).reduce((t,e)=>(e&&t.push(e),t),[]);return 0===e.length?void 0:1===t.length?e[0]:new Nn({propagators:e})}_buildExporterFromEnv(){const t=dn().OTEL_TRACES_EXPORTER;if("none"===t||""===t)return;const e=this._getSpanExporter(t);return e||Vt.error(`Exporter "${t}" requested through environment variable is unavailable.`),e}constructor(t={}){var e,n;this._registeredSpanProcessors=[],this._tracers=new Map;const r=er({},Fr(),function(t){var e,n,r,i,s,o,a,u,c,l,h,d;const p=Object.assign({},t.spanLimits),g=pn();return p.attributeCountLimit=null!==(o=null!==(s=null!==(i=null!==(n=null===(e=t.spanLimits)||void 0===e?void 0:e.attributeCountLimit)&&void 0!==n?n:null===(r=t.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==i?i:g.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==s?s:g.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==o?o:nn,p.attributeValueLengthLimit=null!==(d=null!==(h=null!==(l=null!==(u=null===(a=t.spanLimits)||void 0===a?void 0:a.attributeValueLengthLimit)&&void 0!==u?u:null===(c=t.generalLimits)||void 0===c?void 0:c.attributeValueLengthLimit)&&void 0!==l?l:g.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:g.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==d?d:en,Object.assign({},t,{spanLimits:p})}(t));if(this.resource=null!==(e=r.resource)&&void 0!==e?e:fr.empty(),r.mergeResourceWithDefaults&&(this.resource=fr.default().merge(this.resource)),this._config=Object.assign({},r,{resource:this.resource}),null===(n=t.spanProcessors)||void 0===n?void 0:n.length)this._registeredSpanProcessors=[...t.spanProcessors],this.activeSpanProcessor=new qr(this._registeredSpanProcessors);else{const t=this._buildExporterFromEnv();if(void 0!==t){const e=new Hr(t);this.activeSpanProcessor=e}else this.activeSpanProcessor=new Wr}}}Yr._registeredPropagators=new Map([["tracecontext",()=>new Hn],["baggage",()=>new Ve]]),Yr._registeredExporters=new Map;class Zr{_bindFunction(t=k,e){const n=this,r=function(...r){return n.with(t,()=>e.apply(this,r))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r}active(){return this._currentContext}bind(t,e){return void 0===t&&(t=this.active()),"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._currentContext=k,this._enabled=!1,this}enable(){return this._enabled||(this._enabled=!0,this._currentContext=k),this}with(t,e,n,...r){const i=this._currentContext;this._currentContext=t||k;try{return e.call(n,...r)}finally{this._currentContext=i}}constructor(){this._enabled=!1,this._currentContext=k}}class Jr extends Yr{register(t={}){void 0===t.contextManager&&(t.contextManager=new Zr),t.contextManager&&t.contextManager.enable(),super.register(t)}constructor(t={}){if(super(t),t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor"}}!function(t){t.CONNECT_END="connectEnd",t.CONNECT_START="connectStart",t.DECODED_BODY_SIZE="decodedBodySize",t.DOM_COMPLETE="domComplete",t.DOM_CONTENT_LOADED_EVENT_END="domContentLoadedEventEnd",t.DOM_CONTENT_LOADED_EVENT_START="domContentLoadedEventStart",t.DOM_INTERACTIVE="domInteractive",t.DOMAIN_LOOKUP_END="domainLookupEnd",t.DOMAIN_LOOKUP_START="domainLookupStart",t.ENCODED_BODY_SIZE="encodedBodySize",t.FETCH_START="fetchStart",t.LOAD_EVENT_END="loadEventEnd",t.LOAD_EVENT_START="loadEventStart",t.NAVIGATION_START="navigationStart",t.REDIRECT_END="redirectEnd",t.REDIRECT_START="redirectStart",t.REQUEST_START="requestStart",t.RESPONSE_END="responseEnd",t.RESPONSE_START="responseStart",t.SECURE_CONNECTION_START="secureConnectionStart",t.UNLOAD_EVENT_END="unloadEventEnd",t.UNLOAD_EVENT_START="unloadEventStart"}(Qr||(Qr={}));let ti;function ei(t,e){return e in t}function ni(t,e,n,r){let i,s;ei(n,e)&&"number"==typeof n[e]&&(i=n[e]);const o=Qr.FETCH_START;if(ei(n,o)&&"number"==typeof n[o]&&(s=n[o]),void 0!==i&&void 0!==s&&i>=s)return t.addEvent(e,i),t}function ri(t,e,n=!1){n||(ni(t,Qr.FETCH_START,e),ni(t,Qr.DOMAIN_LOOKUP_START,e),ni(t,Qr.DOMAIN_LOOKUP_END,e),ni(t,Qr.CONNECT_START,e),ei(e,"name")&&e.name.startsWith("https:")&&ni(t,Qr.SECURE_CONNECTION_START,e),ni(t,Qr.CONNECT_END,e),ni(t,Qr.REQUEST_START,e),ni(t,Qr.RESPONSE_START,e),ni(t,Qr.RESPONSE_END,e));const r=e[Qr.ENCODED_BODY_SIZE];void 0!==r&&t.setAttribute("http.response_content_length",r);const i=e[Qr.DECODED_BODY_SIZE];void 0!==i&&r!==i&&t.setAttribute("http.response_content_length_uncompressed",i)}function ii(){return"undefined"!=typeof location?location.origin:void 0}function si(t,e,n,r,i=new WeakSet,s){const o=oi(t),a=function(t,e,n,r,i,s){const o=Cn(e),a=Cn(n);let u=r.filter(e=>{const n=Cn(Rn(e[Qr.FETCH_START])),r=Cn(Rn(e[Qr.RESPONSE_END]));return e.initiatorType.toLowerCase()===(s||"xmlhttprequest")&&e.name===t&&n>=o&&r<=a});u.length>0&&(u=u.filter(t=>!i.has(t)));return u}(t=o.toString(),e,n,r,i,s);if(0===a.length)return{mainRequest:void 0};if(1===a.length)return{mainRequest:a[0]};const u=function(t){return t.slice().sort((t,e)=>{const n=t[Qr.FETCH_START],r=e[Qr.FETCH_START];return n>r?1:n<r?-1:0})}(a);if(o.origin!==ii()&&u.length>1){let t=u[0],e=function(t,e,n){const r=Cn(n),i=Cn(Rn(e));let s,o=t[1];const a=t.length;for(let e=1;e<a;e++){const n=t[e],a=Cn(Rn(n[Qr.FETCH_START])),u=r-Cn(Rn(n[Qr.RESPONSE_END]));a>=i&&(!s||u<s)&&(s=u,o=n)}return o}(u,t[Qr.RESPONSE_END],n);const r=t[Qr.RESPONSE_END];return e[Qr.FETCH_START]<r&&(e=t,t=void 0),{corsPreFlightRequest:t,mainRequest:e}}return{mainRequest:a[0]}}function oi(t){if("function"==typeof URL)return new URL(t,"undefined"!=typeof document?document.baseURI:"undefined"!=typeof location?location.href:void 0);const e=(ti||(ti=document.createElement("a")),ti);return e.href=t,e}function ai(t,e){let n=e||[];("string"==typeof n||n instanceof RegExp)&&(n=[n]);return oi(t).origin===ii()||n.some(e=>hr(t,e))}function ui(t){const e=BigInt(1e9);return BigInt(t[0])*e+BigInt(t[1])}function ci(t){const e=ui(t);return n=e,{low:Number(BigInt.asUintN(32,n)),high:Number(BigInt.asUintN(32,n>>BigInt(32)))};var n}const li="undefined"!=typeof BigInt?function(t){return ui(t).toString()}:Cn;function hi(t){return t}function di(t){if(void 0!==t)return _n(t)}const pi={encodeHrTime:ci,encodeSpanContext:_n,encodeOptionalSpanContext:di};function gi(t){var e,n;if(void 0===t)return pi;const r=null===(e=t.useLongBits)||void 0===e||e,i=null!==(n=t.useHex)&&void 0!==n&&n;return{encodeHrTime:r?ci:li,encodeSpanContext:i?hi:_n,encodeOptionalSpanContext:i?hi:di}}function _i(t){return{attributes:fi(t.attributes),droppedAttributesCount:0}}function mi(t){return{name:t.name,version:t.version}}function fi(t){return Object.keys(t).map(e=>vi(e,t[e]))}function vi(t,e){return{key:t,value:Ei(e)}}function Ei(t){const e=typeof t;return"string"===e?{stringValue:t}:"number"===e?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:"boolean"===e?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(Ei)}}:"object"===e&&null!=t?{kvlistValue:{values:Object.entries(t).map(([t,e])=>vi(t,e))}}:{}}function Ti(t,e){const n=function(t){const e=new Map;for(const n of t){const{resource:t,instrumentationScope:{name:r,version:i="",schemaUrl:s=""}}=n;let o=e.get(t);o||(o=new Map,e.set(t,o));const a=`${r}@${i}:${s}`;let u=o.get(a);u||(u=[],o.set(a,u)),u.push(n)}return e}(t);return Array.from(n,([t,n])=>({resource:_i(t),scopeLogs:Array.from(n,([,t])=>({scope:mi(t[0].instrumentationScope),logRecords:t.map(t=>function(t,e){var n,r,i;return{timeUnixNano:e.encodeHrTime(t.hrTime),observedTimeUnixNano:e.encodeHrTime(t.hrTimeObserved),severityNumber:t.severityNumber,severityText:t.severityText,body:Ei(t.body),attributes:Si(t.attributes),droppedAttributesCount:t.droppedAttributesCount,flags:null===(n=t.spanContext)||void 0===n?void 0:n.traceFlags,traceId:e.encodeOptionalSpanContext(null===(r=t.spanContext)||void 0===r?void 0:r.traceId),spanId:e.encodeOptionalSpanContext(null===(i=t.spanContext)||void 0===i?void 0:i.spanId)}}(t,e)),schemaUrl:t[0].instrumentationScope.schemaUrl})),schemaUrl:void 0}))}function Si(t){return Object.keys(t).map(e=>vi(e,t[e]))}function bi(t,e){var n;const r=t.spanContext(),i=t.status;return{traceId:e.encodeSpanContext(r.traceId),spanId:e.encodeSpanContext(r.spanId),parentSpanId:e.encodeOptionalSpanContext(t.parentSpanId),traceState:null===(n=r.traceState)||void 0===n?void 0:n.serialize(),name:t.name,kind:null==t.kind?0:t.kind+1,startTimeUnixNano:e.encodeHrTime(t.startTime),endTimeUnixNano:e.encodeHrTime(t.endTime),attributes:fi(t.attributes),droppedAttributesCount:t.droppedAttributesCount,events:t.events.map(t=>function(t,e){return{attributes:t.attributes?fi(t.attributes):[],name:t.name,timeUnixNano:e.encodeHrTime(t.time),droppedAttributesCount:t.droppedAttributesCount||0}}(t,e)),droppedEventsCount:t.droppedEventsCount,status:{code:i.code,message:i.message},links:t.links.map(t=>function(t,e){var n;return{attributes:t.attributes?fi(t.attributes):[],spanId:e.encodeSpanContext(t.context.spanId),traceId:e.encodeSpanContext(t.context.traceId),traceState:null===(n=t.context.traceState)||void 0===n?void 0:n.serialize(),droppedAttributesCount:t.droppedAttributesCount||0}}(t,e)),droppedLinksCount:t.droppedLinksCount}}function yi(t,e){const n=function(t){const e=new Map;for(const n of t){let t=e.get(n.resource);t||(t=new Map,e.set(n.resource,t));const r=`${n.instrumentationLibrary.name}@${n.instrumentationLibrary.version||""}:${n.instrumentationLibrary.schemaUrl||""}`;let i=t.get(r);i||(i=[],t.set(r,i)),i.push(n)}return e}(t),r=[],i=n.entries();let s=i.next();for(;!s.done;){const[t,n]=s.value,o=[],a=n.values();let u=a.next();for(;!u.done;){const t=u.value;if(t.length>0){const n=t.map(t=>bi(t,e));o.push({scope:mi(t[0].instrumentationLibrary),spans:n,schemaUrl:t[0].instrumentationLibrary.schemaUrl})}u=a.next()}const c={resource:_i(t),scopeSpans:o,schemaUrl:void 0};r.push(c),s=i.next()}return r}const Li={serializeRequest:t=>{const e={resourceLogs:Ti(t,gi({useHex:!0,useLongBits:!1}))};return(new TextEncoder).encode(JSON.stringify(e))},deserializeResponse:t=>{const e=new TextDecoder;return JSON.parse(e.decode(t))}},Oi={serializeRequest:t=>{const e={resourceSpans:yi(t,gi({useHex:!0,useLongBits:!1}))};return(new TextEncoder).encode(JSON.stringify(e))},deserializeResponse:t=>{const e=new TextDecoder;return JSON.parse(e.decode(t))}};class wi{export(t,e){this._delegate.export(t,e)}forceFlush(){return this._delegate.forceFlush()}shutdown(){return this._delegate.shutdown()}constructor(t){this._delegate=t}}class Ri extends wi{constructor(t){super(_s(t,Li))}}const Ci=(t,e)=>ki(t,e)+"/v2/logs";function Ai(){return Ai=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ai.apply(this,arguments)}class Pi extends Ri{constructor({appID:t,userID:e,embraceDataURL:n}){super(Ai({},Fi,{headers:Ui(t,e),url:Ci(t,n)}))}}function Ii(){return Ii=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ii.apply(this,arguments)}class Mi extends wi{constructor(t){super(_s(Ii({},t,{compression:"gzip"}),Oi))}}const Ni=(t,e)=>ki(t,e)+"/v2/spans";function xi(){return xi=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},xi.apply(this,arguments)}class Di extends Mi{constructor({appID:t,userID:e,embraceDataURL:n}){super(xi({},Fi,{headers:Ui(t,e),url:Ni(t,n)}))}}const Ui=(t,e)=>({"X-EM-AID":t,"X-EM-DID":e}),ki=(t,e)=>e||`https://a-${t}.data.emb-api.com`,Fi={compression:"gzip",keepalive:!0,concurrencyLimit:5,timeoutMillis:3e4};var Bi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ji=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.name="OTLPExporterError",i.data=r,i.code=n,i}return Bi(e,t),e}(Error),Vi=function(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})},Hi=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},$i=function(){function t(t){this._sendingPromises=[],this._concurrencyLimit=t}return t.prototype.pushPromise=function(t){var e=this;if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(t);var n=function(){var n=e._sendingPromises.indexOf(t);e._sendingPromises.splice(n,1)};t.then(n,n)},t.prototype.hasReachedLimit=function(){return this._sendingPromises.length>=this._concurrencyLimit},t.prototype.awaitAll=function(){return Vi(this,void 0,void 0,function(){return Hi(this,function(t){switch(t.label){case 0:return[4,Promise.all(this._sendingPromises)];case 1:return t.sent(),[2]}})})},t}();function Gi(t){return new $i(t.concurrencyLimit)}function Xi(){return{handleResponse:function(t){null!=t&&function(t){return Object.prototype.hasOwnProperty.call(t,"partialSuccess")}(t)&&null!=t.partialSuccess&&0!==Object.keys(t.partialSuccess).length&&Vt.warn("Received Partial Success response:",JSON.stringify(t.partialSuccess))}}}var zi=function(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function a(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})},qi=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Wi=function(){function t(t,e,n,r,i){this._transport=t,this._serializer=e,this._responseHandler=n,this._promiseQueue=r,this._timeout=i,this._diagLogger=Vt.createComponentLogger({namespace:"OTLPExportDelegate"})}return t.prototype.export=function(t,e){var n=this;if(this._diagLogger.debug("items to be sent",t),this._promiseQueue.hasReachedLimit())e({code:Mn.FAILED,error:new Error("Concurrent export limit reached")});else{var r=this._serializer.serializeRequest(t);null!=r?this._promiseQueue.pushPromise(this._transport.send(r,this._timeout).then(function(t){if("success"!==t.status)"failure"===t.status&&t.error?e({code:Mn.FAILED,error:t.error}):"retryable"===t.status?e({code:Mn.FAILED,error:new ji("Export failed with retryable status")}):e({code:Mn.FAILED,error:new ji("Export failed with unknown error")});else{if(null!=t.data)try{n._responseHandler.handleResponse(n._serializer.deserializeResponse(t.data))}catch(e){n._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",e,t.data)}e({code:Mn.SUCCESS})}},function(t){return e({code:Mn.FAILED,error:t})})):e({code:Mn.FAILED,error:new Error("Nothing to send")})}},t.prototype.forceFlush=function(){return this._promiseQueue.awaitAll()},t.prototype.shutdown=function(){return zi(this,void 0,void 0,function(){return qi(this,function(t){switch(t.label){case 0:return this._diagLogger.debug("shutdown started"),[4,this.forceFlush()];case 1:return t.sent(),this._transport.shutdown(),[2]}})})},t}();function Ki(t,e,n){return r={transport:n,serializer:e,promiseHandler:Gi(t)},i={timeout:t.timeoutMillis},new Wi(r.transport,r.serializer,Xi(),r.promiseHandler,i.timeout);var r,i}function Qi(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}function Yi(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){Qi(s,r,i,o,a,"next",t)}function a(t){Qi(s,r,i,o,a,"throw",t)}o(void 0)})}}function Zi(){return Zi=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Zi.apply(this,arguments)}class Ji{static _compressRequest(t){return Yi(function*(){const e=new CompressionStream("gzip"),n=e.writable.getWriter();n.write(t),n.close();const r=[],i=e.readable.getReader();let s=!1;for(;!s;){const t=yield i.read();t.value&&r.push(t.value),s=t.done}const o=new Uint8Array(r.reduce((t,e)=>t+e.length,0));let a=0;for(const t of r)o.set(t,a),a+=t.length;return o})()}send(t,e){return this._asyncSend(t,e)}shutdown(){}_asyncSend(t,e){return Yi(function*(){let n=t;const r=Zi({"Content-Type":"application/json"},this._config.headers);"gzip"===this._config.compression&&(n=yield Ji._compressRequest(t),r["Content-Encoding"]="gzip",r["Content-Length"]=n.length.toString());try{return(yield fetch(this._config.url,{method:"POST",keepalive:!0,headers:r,body:n,signal:AbortSignal.timeout(e)})).ok?{status:"success"}:{status:"failure",error:new Error("Fetch request failed")}}catch(t){return{status:"failure",error:new Error("Fetch request errored")}}}).call(this)}constructor(t){this._config=t}}const ts=t=>new Ji(t),es=[];for(let t=0;t<256;++t)es.push((t+256).toString(16).slice(1));let ns;const rs=new Uint8Array(16);var is={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ss(t,e,n){if(is.randomUUID&&!t)return is.randomUUID();var r,i;const s=null!=(i=null!=(r=(t=t||{}).random)?r:null==t.rng?void 0:t.rng.call(t))?i:function(){if(!ns){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ns=crypto.getRandomValues.bind(crypto)}return ns(rs)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=15&s[6]|64,s[8]=63&s[8]|128,function(t,e=0){return(es[t[e+0]]+es[t[e+1]]+es[t[e+2]]+es[t[e+3]]+"-"+es[t[e+4]]+es[t[e+5]]+"-"+es[t[e+6]]+es[t[e+7]]+"-"+es[t[e+8]]+es[t[e+9]]+"-"+es[t[e+10]]+es[t[e+11]]+es[t[e+12]]+es[t[e+13]]+es[t[e+14]]+es[t[e+15]]).toLowerCase()}(s)}const os=()=>ss().replace(/-/g,"").toUpperCase(),as=({target:t,events:e,callback:n})=>{e.forEach(e=>{t.addEventListener(e,n)})},us=({target:t,events:e,callback:n})=>{e.forEach(e=>{t.removeEventListener(e,n)})},cs=t=>{const e=t.slice(-6),n=Math.pow(16,6)-1;return parseInt(e,16)/n*100};class ls{constructor(t=mn){this.epochMillisFromOriginOffset=t=>this._clock.timeOrigin+t,this.getNowHRTime=()=>Ln(this.getNowMillis()),this.getNowMillis=()=>this.epochMillisFromOriginOffset(this._clock.now()),this.millisSinceHRTime=t=>this.getNowMillis()-function(t){return 1e3*t[0]+t[1]/1e6}(t),this._clock=t}}const hs=(t,e=1e3)=>{let n=!1;return(...r)=>{n||(t(...r),setTimeout(()=>{n=!1},e),n=!0)}};function ds(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}const ps=()=>40*Math.random()-20;class gs{send(t,e){return(n=function*(){const n=this._perf.getNowMillis()+e;let r=yield this._transport.send(t,e),i=5,s=1e3;for(;"retryable"===r.status&&i>0;){i--;const e=Math.max(Math.min(s,5e3)+ps(),0);var o;s*=1.5;const a=null!=(o=r.retryInMillis)?o:e,u=n-this._perf.getNowMillis();if(a>u)return r;r=yield this._retry(t,u,a)}return r},function(){var t=this,e=arguments;return new Promise(function(r,i){var s=n.apply(t,e);function o(t){ds(s,r,i,o,a,"next",t)}function a(t){ds(s,r,i,o,a,"throw",t)}o(void 0)})}).call(this);var n}shutdown(){this._transport.shutdown()}_retry(t,e,n){return new Promise((r,i)=>{setTimeout(()=>{this._transport.send(t,e).then(r,i)},n)})}constructor(t,e=new ls){this._transport=t,this._perf=e}}const _s=(t,e)=>{return Ki(t,e,(n={transport:ts(t)},new gs(n.transport)));var n},ms="http.method",fs="http.url",vs="http.status_code",Es="exception.message",Ts="exception.stacktrace",Ss="exception.type",bs="http.request.method",ys="http.response.status_code",Ls="service.name",Os="telemetry.sdk.language",ws="telemetry.sdk.name",Rs="telemetry.sdk.version",Cs="url.full",As="user_agent.original",Ps="emb.type",Is="emb.state",Ms="emb.cold_start",Ns="emb.session_number",xs="emb.startup_duration",Ds="emb.properties.",Us="emb.session_end_type",ks="emb.stacktrace.js",Fs="emb.exception_handling",Bs="emb.app_instance_id",js="view.name";var Vs=function(t){return t.Session="ux.session",t.View="ux.view",t.Network="perf.network_request",t.Perf="perf",t.SystemLog="sys.log",t.SystemException="sys.exception",t.WebVital="ux.web_vital",t}({}),Hs=function(t){return t.Foreground="foreground",t.Background="background",t}({});function $s(){return $s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},$s.apply(this,arguments)}class Gs{static _logSeverityToSeverityNumber(t){switch(t){case"info":return ge.INFO;case"warning":return ge.WARN;default:return ge.ERROR}}logException(t,{handled:e=!0,attributes:n={},timestamp:r=this._perf.getNowMillis()}={}){e||this._spanSessionManager.incrSessionCountForKey("emb.unhandled_exceptions_count"),this._logger.emit({timestamp:r,severityNumber:ge.ERROR,severityText:"ERROR",body:t.message||"",attributes:$s({},n,{[Ps]:Vs.SystemException,[Fs]:e?"HANDLED":"UNHANDLED",[Ss]:t.constructor.name,"exception.name":t.name,[Es]:t.message,[Ts]:t.stack})})}message(t,e,{attributes:n={},includeStacktrace:r=!0}={}){"error"===e&&this._spanSessionManager.incrSessionCountForKey("emb.error_log_count"),this._logMessage({message:t,severity:e,timestamp:this._perf.getNowMillis(),attributes:n,stackTrace:r&&"info"!=e?(new Error).stack:void 0})}_logMessage({message:t,severity:e,timestamp:n,attributes:r={},stackTrace:i}){const s=this._limitManager.limitLog(t,e,r);"dropped"!==s&&this._logger.emit({timestamp:n,severityNumber:Gs._logSeverityToSeverityNumber(e),severityText:e.toUpperCase(),body:s.message,attributes:$s({},s.attributes,{[Ps]:Vs.SystemLog},i?{[ks]:i}:{})})}constructor({perf:t,spanSessionManager:e,limitManager:n}){this._perf=null!=t?t:new ls,this._logger=Le.getLogger("embrace-web-sdk-logs"),this._spanSessionManager=e,this._limitManager=n}}const Xs="log.record.uid",zs="session.id",qs="user.id",Ws="embrace_session_number";function Ks(){return Ks=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ks.apply(this,arguments)}class Qs{_getPermanentAttributes(){const t=new Map;try{for(let e=0;e<this._storage.length;e++){const n=this._storage.key(e);if(null==n?void 0:n.startsWith(Ds)){const e=this._storage.getItem(n);e&&t.set(n,e)}}}catch(t){this._diag.warn("Error loading permanent session properties",t)}return Object.fromEntries(t.entries())}_getSessionNumber(){const t=this._storage.getItem(Ws);let e=t?parseInt(t,10):0;return e++,this._storage.setItem(Ws,e.toString()),e}addBreadcrumb(t){if(!this._sessionSpan)return void this._diag.debug("trying to add breadcrumb to a session, but there is no session in progress. This is a no-op.");const e=this._limitManager.limitBreadcrumb(t);"dropped"!==e&&this._sessionSpan.addEvent("emb-breadcrumb",{message:e.name},this._perf.getNowMillis())}addProperty(t,e,n){if(!this._sessionSpan)return void this._diag.debug("trying to add properties to a session, but there is no session in progress. This is a no-op.");const r=this._limitManager.limitSessionProperty(t,e);if("dropped"===r)return;const i=Ds+r.key;if(this._sessionSpan.setAttribute(i,r.value),"permanent"===(null==n?void 0:n.lifespan))try{this._storage.setItem(i,e)}catch(t){this._diag.warn("Failed to set permanent session property",t)}}removeProperty(t){if(!this._sessionSpan)return void this._diag.debug("trying to remove a session property, but there is no session in progress. This is a no-op.");const e=Ds+this._limitManager.truncateString("session_property_key",t);this._sessionSpan.removeAttribute(e);try{this._storage.getItem(e)&&this._storage.removeItem(e)}catch(t){this._diag.warn("Error removing permanent session property",t)}}endSessionSpan(){this.endSessionSpanInternal("manual")}endSessionSpanInternal(t){if(this._sessionSpan){this._sessionSpan.setAttributes(Ks({},this._getPermanentAttributes(),{[Us]:t},this._activeSessionCounts,this._limitManager.getDiagnosticCounts(),{[xs]:this._startupDuration})),this._sessionSpan.end(),this._sessionSpan=null,this._activeSessionStartTime=null,this._activeSessionId=null,this._activeSessionCounts=null;for(const t of this._sessionEndedListeners)try{t()}catch(t){this._diag.warn("Error while executing session ended listener",t)}this._limitManager.reset()}else this._diag.debug("trying to end a session, but there is no session in progress. This is a no-op.")}getSessionId(){return this._activeSessionId}getSessionSpan(){return this._sessionSpan}getSessionStartTime(){return this._activeSessionStartTime}startSessionSpan(){this._sessionSpan&&this.endSessionSpanInternal("manual");const t=re.getTracer("embrace-web-sdk-sessions");this._activeSessionId=os(),this._activeSessionStartTime=this._perf.getNowHRTime(),this._activeSessionCounts={},this._sessionSpan=new no(t.startSpan("emb-session",{attributes:Ks({},this._getPermanentAttributes(),{[Ps]:Vs.Session,[Is]:"hidden"===this._visibilityDoc.visibilityState?Hs.Background:Hs.Foreground,[zs]:this._activeSessionId,[Ms]:this._coldStart,[Ns]:this._getSessionNumber()})})),this._coldStart=!1;for(const t of this._sessionStartedListeners)try{t()}catch(t){this._diag.warn("Error while executing session started listener",t)}}incrSessionCountForKey(t){this._sessionSpan&&this._activeSessionCounts?this._activeSessionCounts[t]=(this._activeSessionCounts[t]||0)+1:this._diag.debug("trying to increment a count for the active session, but there is no session in progress. This is a no-op.")}addSessionStartedListener(t){const e=this._sessionStartedListeners.push(t);return()=>{this._sessionStartedListeners.splice(e-1,1)}}addSessionEndedListener(t){const e=this._sessionEndedListeners.push(t);return()=>{this._sessionEndedListeners.splice(e-1,1)}}recordStartupDuration(t){this._startupDuration=t}constructor({diag:t,perf:e,visibilityDoc:n=window.document,storage:r=window.localStorage,limitManager:i}){this._activeSessionId=null,this._activeSessionStartTime=null,this._sessionSpan=null,this._activeSessionCounts=null,this._coldStart=!0,this._startupDuration=0,this._sessionStartedListeners=[],this._sessionEndedListeners=[],this._diag=null!=t?t:Vt.createComponentLogger({namespace:"EmbraceSpanSessionManager"}),this._perf=null!=e?e:new ls,this._visibilityDoc=n,this._storage=r,this._limitManager=i}}const Ys={info:"info_log",warning:"warning_log",error:"error_log"};class Zs{_dropIfMaxReached(t){return this._currentCount[t]>=this._maxAllowed[t]?(this._diag.warn(`disallowing ${t} because the maximum number of ${this._maxAllowed[t].toString()} has already been reached for this session`),this._incrDiagnosticCount(t,"drop"),!0):(this._currentCount[t]=(this._currentCount[t]||0)+1,!1)}truncateString(t,e){return e.length>this._maxLength[t]?(this._diag.warn(`truncating ${t} because it is longer than ${this._maxLength[t].toString()} characters: "${e}"`),this._incrDiagnosticCount(t,"truncate_string"),e.substring(0,this._maxLength[t])):e}_truncateAttributes(t,e,n,r){const i=Object.keys(e);i.length>this._maxAttributes[t]&&(this._diag.warn(`truncating ${t} attributes because there are more than ${this._maxAttributes[t].toString()} set`),this._incrDiagnosticCount(t,"truncate_attributes"));const s={};for(let a=0;a<Math.min(i.length,this._maxAttributes[t]);a++){var o;s[this.truncateString(n,i[a])]=this.truncateString(r,(null==(o=e[i[a]])?void 0:o.toString())||"")}return s}limitBreadcrumb(t){return this._dropIfMaxReached("breadcrumb")?"dropped":{name:this.truncateString("breadcrumb",t)}}limitLog(t,e,n){const r=Ys[e];return this._dropIfMaxReached(r)?"dropped":{message:this.truncateString(r,t),attributes:this._truncateAttributes(r,n,"log_attribute_key","log_attribute_value")}}limitSessionProperty(t,e){return this._dropIfMaxReached("session_property")?"dropped":{key:this.truncateString("session_property_key",t),value:this.truncateString("session_property_value",e)}}dropReadableSpan(t){const e=t.attributes[Ps]===Vs.Network?"network_request":"span";return this._dropIfMaxReached(e)}reset(){this._diagnosticCounts={},this._currentCount={error_log:0,warning_log:0,info_log:0,breadcrumb:0,session_property:0,span:0,network_request:0}}_incrDiagnosticCount(t,e){const n=`emb.app.applied_limit.${t}.${e}.count`;this._diagnosticCounts[n]=(this._diagnosticCounts[n]||0)+1}getDiagnosticCounts(){return this._diagnosticCounts}constructor({diag:t,maxAllowed:e,maxLength:n,maxAttributes:r}){this._diagnosticCounts={},this._currentCount={error_log:0,warning_log:0,info_log:0,breadcrumb:0,session_property:0,span:0,network_request:0},this._diag=null!=t?t:Vt.createComponentLogger({namespace:"EmbraceLimitManager"}),this._maxAllowed=e,this._maxLength=n,this._maxAttributes=r}}const Js={maxAllowed:{error_log:500,warning_log:200,info_log:100,breadcrumb:100,session_property:100,span:1e3,network_request:1e4},maxLength:{error_log:128,warning_log:128,info_log:128,breadcrumb:256,session_property_key:128,session_property_value:256,log_attribute_key:128,log_attribute_value:256},maxAttributes:{error_log:50,warning_log:50,info_log:50}};function to(t){var e=function(t,e){if("object"!==eo(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!==eo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"===eo(e)?e:String(e)}function eo(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}class no{get attributes(){return this._span.attributes}addEvent(t,e,n){return this._span.addEvent(t,e,n),this}addLink(t){return this._span.addLink(t),this}addLinks(t){return this._span.addLinks(t),this}end(t){this._span.end(t)}isRecording(){return this._span.isRecording()}recordException(t,e){this._span.recordException(t,e)}setAttribute(t,e){return this._span.setAttribute(t,e),this}setAttributes(t){return this._span.setAttributes(t),this}removeAttribute(t){const e=this._span.attributes,{[t]:n}=e,r=function(t,e){if(null==t)return{};var n,r,i={},s=Object.keys(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(e,[t].map(to));return this._span.attributes=r,this}setStatus(t){return this._span.setStatus(t),this}spanContext(){return this._span.spanContext()}updateName(t){return this._span.updateName(t),this}fail(t={code:"failure"}){t.code&&this._span.setAttribute("emb.error_code",t.code.toUpperCase()),this._span.end(t.endTime)}constructor(t){this._span=t}}class ro{startSpan(t,e={},n){const r=re.getTracer("embrace-web-sdk-traces");e.attributes=e.attributes?e.attributes:{},e.attributes[Ps]=Vs.Perf;const i=e.parentSpan?re.setSpan(jt.active(),e.parentSpan):n;return new no(r.startSpan(t,e,i))}getSpan(t){const e=re.getSpan(t);if(e)return new no(e)}constructor(){this.setSpan=re.setSpan}}const io="embrace_user",so="embrace_user_id",oo="embrace_external_user_id";class ao{getEmbraceUserId(){return this._embraceUserId||this._generateNewEmbraceUserId()}setEmbraceUserId(t){this._embraceUserId=t;try{this._storage.setItem(so,t)}catch(t){this._diag.warn("Failed to persist user object for storage, keeping it in-memory only",t)}}clearEmbraceUserId(){this._embraceUserId=null;try{this._storage.removeItem(so)}catch(t){this._diag.warn("Failed to remove embrace user in storage",t)}}_migrateOldLocalStorageKey(){try{const t=this._storage.getItem(io);if(t){const e=JSON.parse(t);(t=>"string"==typeof t[ce]&&32===t[ce].length)(e)?(this._diag.debug("Migrating old user data from storage"),this._storage.setItem(so,e[ce]),this._storage.removeItem(io)):(this._diag.warn("Invalid user data found in storage, clearing old user data"),this._storage.removeItem(io))}}catch(t){this._diag.warn("Failed to get old user data from storage",t)}}_initialSetup(){try{const e=this._storage.getItem(so);e?"string"==typeof(t=e)&&32===t.length?this._embraceUserId=e:(this._diag.warn("Invalid embrace user id, generating a new one"),this.clearEmbraceUserId()):this._diag.debug("No existing user found in storage, creating a new one")}catch(t){this._diag.warn("Failed to get embrace user id from storage, defaulting to a new one",t)}var t;this._embraceUserId||(this._embraceUserId=this._generateNewEmbraceUserId())}_generateNewEmbraceUserId(){const t=os();return this.setEmbraceUserId(t),t}getUserId(){return this._storage.getItem(oo)}setUserId(t){this._storage.setItem(oo,t)}clearUserId(){this._storage.removeItem(oo)}constructor({diag:t,storage:e=localStorage}={}){this._embraceUserId=null,this._diag=null!=t?t:Vt.createComponentLogger({namespace:"EmbraceUserManager"}),this._storage=e,this._migrateOldLocalStorageKey(),this._initialSetup()}}const uo={samplingPct:100},co="embrace_remote_config";function lo(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}function ho(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){lo(s,r,i,o,a,"next",t)}function a(t){lo(s,r,i,o,a,"throw",t)}o(void 0)})}}function po(){return po=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},po.apply(this,arguments)}const go=t=>({samplingPct:t.threshold});class _o{setConfig(t){this._sdkConfig=po({},this._sdkConfig,t)}getConfig(){return this._sdkConfig}refreshRemoteConfig(){return ho(function*(){if(this._remoteConfigURL)try{const t=yield this._fetchRemoteConfig(this._remoteConfigURL);if(!t)return void this._diag.debug("No changes in remote config, skipping update");const[e,n]=t;this._storage.setItem(co,JSON.stringify({config:e,etag:n})),this._sdkConfig=go(e),this._etag=n}catch(t){this._diag.warn(`Failed to refresh remote config: ${t instanceof Error?t.message:String(t)}`)}}).call(this)}_getRemoteConfigFromStorage(){try{const t=this._storage.getItem(co);return t?JSON.parse(t):null}catch(t){return this._diag.warn(`Failed to parse remote config from storage: ${t instanceof Error?t.message:String(t)}`),null}}_fetchRemoteConfig(t){return ho(function*(){const e=yield fetch(t,{headers:this._etag?{"If-None-Match":this._etag}:{}}),n=e.headers.get("etag");if(304===e.status)return null;if(!e.ok)return this._diag.warn(`Failed to fetch remote config from ${t}: ${e.statusText}`),null;return[yield e.json(),n]}).call(this)}constructor({appID:t,appVersion:e,deviceId:n,diag:r=Vt.createComponentLogger({namespace:"embrace-config-manager"}),storage:i=localStorage,defaultConfig:s={},embraceConfigURL:o}={}){this._remoteConfigURL=null,this._etag=null,t&&e&&n&&(this._remoteConfigURL=((t,{osVersion:e,appVersion:n,deviceId:r},i)=>`${i||`https://a-${t}.config.emb-api.com`}/v2/config?appId=${t}&osVersion=${e}&appVersion=${n}&deviceId=${r}`)(t,{appVersion:e,deviceId:n,osVersion:"1"},o)),this._diag=r,this._storage=i;const a=this._getRemoteConfigFromStorage();a&&(this._etag=a.etag),this._sdkConfig=po({},uo,s,a?go(a.config):{})}}class mo{isSDKEnabled(){const t=this._dynamicConfigManager.getConfig();return e=this._deviceId,!((n=t.samplingPct)<=0||n>100)&&n>=cs(e);var e,n}constructor({dynamicConfigManager:t,deviceId:e}){this._dynamicConfigManager=t,this._deviceId=e}}class fo{get diag(){return this._diag}get processorName(){return this._processorName}constructor({diag:t,processorName:e}){this._processorName=e,this._diag=null!=t?t:Vt.createComponentLogger({namespace:e})}}function vo(){return vo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},vo.apply(this,arguments)}class Eo extends fo{forceFlush(){return this.diag.debug("forceFlush called for EmbraceSessionBatchedSpanProcessor. This is a no op"),Promise.resolve(void 0)}onEnd(t){if(this._shutdownOnce.isCalled)this.diag.debug("span ended after processor shutdown. Ignoring span.");else if((t=>t.attributes[Ps]===Vs.Session)(t))this.diag.debug("session span ended. Exporting all pending spans."),_r._export(this._exporter,[t,...this._pendingSpans]).then(t=>{var e;t.code===Mn.FAILED&&this.diag.error(`spans failed to export: ${(null==(e=t.error)?void 0:e.message)||"unknown error"}`)}).catch(t=>{let e="unknown error";t&&t instanceof Error?e=t.message:"string"==typeof t&&(e=t),this.diag.error(`spans failed to export: ${e}`)}),this._pendingSpans=[];else{if(this.diag.debug("non-session span ended. Adding to pending spans queue."),this._limitManager.dropReadableSpan(t))return;this._pendingSpans.push(t)}}onStart(){}shutdown(){return this._shutdownOnce.call()}constructor(t){var{exporter:e,limitManager:n}=t,r=function(t,e){if(null==t)return{};var n,r,i={},s=Object.keys(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,["exporter","limitManager"]);super(vo({},r,{processorName:"EmbraceSessionBatchedSpanProcessor"})),this._pendingSpans=[],this._shutdown=()=>this._exporter.shutdown(),this._exporter=e,this._shutdownOnce=new gr(this._shutdown,this),this._limitManager=n}}class To{forceFlush(){return Promise.resolve(void 0)}onEmit(t){t.setAttributes({[Xs]:os(),[zs]:this._spanSessionManager.getSessionId()})}shutdown(){return Promise.resolve(void 0)}constructor({spanSessionManager:t}){this._spanSessionManager=t}}const So=/.+:\/\/.+/;class bo{forceFlush(){return Promise.resolve(void 0)}onEnd(t){var e,n,r,i,s,o,a,u;(t=>{if((t.attributes[bs]||t.attributes[ms])&&(t.attributes[ys]||t.attributes[vs])){var e;const n=null!=(e=t.attributes[Cs])?e:t.attributes[fs];return!(!n||"string"!=typeof n||!So.exec(n))}return!1})(t)&&(t.attributes[Ps]=Vs.Network,null!=(e=t.attributes)[n=Cs]||(e[n]=t.attributes[fs]),null!=(r=t.attributes)[i=ys]||(r[i]=t.attributes[vs]),null!=(s=t.attributes)[o=bs]||(s[o]=t.attributes[ms]),null!=(a=t.attributes)["http.response.body.size"]||(a["http.response.body.size"]=t.attributes["http.response_content_length"]),null!=(u=t.attributes)["http.request.body.size"]||(u["http.request.body.size"]=t.attributes["http.request_content_length"]))}onStart(){}shutdown(){return Promise.resolve(void 0)}}class yo{forceFlush(){return Promise.resolve(void 0)}onEmit(t){t.attributes[Ps]||t.setAttribute(Ps,Vs.SystemLog),t.setAttribute(Cs,this._urlDocument.URL)}shutdown(){return Promise.resolve(void 0)}constructor({urlDocument:t=window.document}={}){this._urlDocument=t}}class Lo{forceFlush(){return Promise.resolve(void 0)}onEmit(t){this._userManager.getUserId()&&t.setAttributes({[qs]:this._userManager.getUserId()})}shutdown(){return Promise.resolve(void 0)}constructor({userManager:t}){this._userManager=t}}class Oo{forceFlush(){return Promise.resolve(void 0)}onEnd(t){const e=this._userManager.getUserId();e&&(t.attributes[qs]=e)}onStart(){}shutdown(){return Promise.resolve(void 0)}constructor({userManager:t}){this._userManager=t}}class wo{forceFlush(){return Promise.resolve(void 0)}onEmit(t){this._attributeScrubbers.forEach(e=>{const n=t.attributes[e.key];n&&"string"==typeof n&&t.setAttribute(e.key,e.scrub(n))})}shutdown(){return Promise.resolve(void 0)}constructor({attributeScrubbers:t}){this._attributeScrubbers=t}}class Ro{forceFlush(){return Promise.resolve(void 0)}onEnd(t){this._attributeScrubbers.forEach(e=>{const n=t.attributes[e.key];n&&"string"==typeof n&&(t.attributes[e.key]=e.scrub(n))})}onStart(){}shutdown(){return Promise.resolve(void 0)}constructor({attributeScrubbers:t}){this._attributeScrubbers=t}}const Co="1.8.0",Ao="embrace-web-sdk",Po="embrace_app_instance_id",Io=(t,e)=>{let n=null;try{n=t.getItem(Po)}catch(t){e.warn("Failed to retrieve app instance ID from session storage",t)}if(!n){e.debug("No existing app instance ID found in session storage, creating a new one"),n=os();try{t.setItem(Po,n)}catch(t){e.warn("Failed to persist app instance ID to session storage",t)}}return n};function Mo(){return Mo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Mo.apply(this,arguments)}class No{get tracer(){return this._tracer}get meter(){return this._meter}get logger(){return this._logger}getModuleDefinitions(){var t;const e=null!=(t=this.init())?t:[];return Array.isArray(e)?e:[e]}getConfig(){return this._config}setConfig(t){this._config=Mo({enabled:!0},t)}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}_updateMetricInstruments(){}_runSpanCustomizationHook(t,e,n,r){if(t)try{t(n,r)}catch(t){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:e},t)}}constructor(t,e,n){this.instrumentationName=t,this.instrumentationVersion=e,this._config={},this.setConfig(n),this._diag=Vt.createComponentLogger({namespace:t}),this._tracer=re.getTracer(t,e),this._meter=Gt.getMeter(t,e),this._logger=Le.getLogger(t,e),this._updateMetricInstruments()}}class xo extends No{get sessionManager(){return this._sessionManager}get logManager(){return this._logManager}get perf(){return this._perf}init(){}constructor({instrumentationName:t,instrumentationVersion:e,config:n,diag:r,perf:s}){super(t,e,n),r&&(this._diag=r),this._perf=null!=s?s:new ls,this._sessionManager=u.getSpanSessionManager(),this._logManager=i.getLogManager()}}const Do=["mousedown"];class Uo extends xo{disable(){window.removeEventListener("visibilitychange",this._checkVisibilityChange),this._avoidEndingLimitedSessions&&us({target:window,events:Do,callback:this._onInteractionThrottled})}enable(){window.addEventListener("visibilitychange",this._checkVisibilityChange),this._avoidEndingLimitedSessions&&as({target:window,events:Do,callback:this._onInteractionThrottled})}constructor({diag:t,perf:e,visibilityWaitTimeMs:n=0,limitedSessionMaxDurationMs:r=0,backgroundSessions:i=!1,visibilityDoc:s=window.document}={}){super({instrumentationName:"SpanSessionVisibilityInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this._currentVisibilityState=s.visibilityState,this._checkVisibilityTimeout=null,this._interactionSinceLastVisibilityChange=!1,this._avoidEndingLimitedSessions=r>0,this._checkVisibilityChange=()=>n<=0?(this._currentVisibilityState=s.visibilityState,void this._onVisibilityChange()):(this._checkVisibilityTimeout&&clearTimeout(this._checkVisibilityTimeout),"visible"===s.visibilityState&&this._currentVisibilityState!=s.visibilityState?(this._currentVisibilityState=s.visibilityState,void this._onVisibilityChange()):(this._diag.debug(`Visibility changed to ${s.visibilityState}. Will wait ${(n/1e3).toString()}s, and check if visibility changed`),void(this._checkVisibilityTimeout=setTimeout(()=>{this._currentVisibilityState!=s.visibilityState?(this._currentVisibilityState=s.visibilityState,this._onVisibilityChange()):this._diag.debug(`Visibility was not changed after timeout happened: ${s.visibilityState}`)},n)))),this._onVisibilityChange=()=>{this._diag.debug(`Visibility change detected: ${s.visibilityState}`);const t=this.sessionManager.getSessionStartTime();this._avoidEndingLimitedSessions&&null!==t&&this.perf.millisSinceHRTime(t)<r&&!this._interactionSinceLastVisibilityChange?(this._diag.debug("Not ending the session since it is considered limited"),this.sessionManager.addBreadcrumb(`Tab visibility changed to ${s.visibilityState}`)):(this.sessionManager.endSessionSpanInternal("state_changed"),"hidden"===s.visibilityState&&i?(this._diag.debug("Starting a session since document visibility switched to hidden and `backgroundSessions` is enabled"),this.sessionManager.startSessionSpan()):"visible"===s.visibilityState&&(this._diag.debug("Starting a session since document visibility switched to visible"),this.sessionManager.startSessionSpan())),this._interactionSinceLastVisibilityChange=!1},this._onInteractionThrottled=hs(()=>{this._interactionSinceLastVisibilityChange=!0},1e3),this._config.enabled&&this.enable()}}const ko=["keydown","mousedown","mousemove","scroll"];class Fo extends xo{constructor({diag:t}={}){super({instrumentationName:"SpanSessionBrowserActivityInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),this.disable=()=>{us({target:window,events:ko,callback:this._onActivityThrottled}),this._activityTimeout&&clearTimeout(this._activityTimeout),this._activityTimeout=null},this.enable=()=>{as({target:window,events:ko,callback:this._onActivityThrottled})},this._onInactivity=()=>{this._diag.debug("Inactivity detected"),this._activityTimeout&&clearTimeout(this._activityTimeout),this._activityTimeout=null,this.sessionManager.endSessionSpanInternal("inactivity")},this._onActivity=()=>{this._diag.debug("Activity detected"),this._activityTimeout&&clearTimeout(this._activityTimeout),this.sessionManager.getSessionId()||this.sessionManager.startSessionSpan(),this._activityTimeout=setTimeout(this._onInactivity,18e5)},this._activityTimeout=null,this._onActivityThrottled=hs(this._onActivity,3e4),this._config.enabled&&this.enable()}}class Bo extends xo{disable(){this.sessionManager.endSessionSpanInternal("unknown")}enable(){this.sessionManager.startSessionSpan()}constructor({diag:t}={}){super({instrumentationName:"SpanSessionOnLoadInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),this._config.enabled&&this.enable()}}const jo=144e5;class Vo extends xo{constructor({diag:t,perf:e}={}){super({instrumentationName:"SpanSessionTimeoutInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this.disable=()=>{this._sessionTimeout&&clearTimeout(this._sessionTimeout),this._sessionTimeout=null},this.enable=()=>{this._checkTimeout()},this._onTimeout=()=>{this._diag.debug("Timeout detected"),this._sessionTimeout&&clearTimeout(this._sessionTimeout),this.sessionManager.endSessionSpanInternal("timer"),this.sessionManager.startSessionSpan(),this._sessionTimeout=setTimeout(this._checkTimeout,jo)},this._checkTimeout=()=>{const t=this.sessionManager.getSessionStartTime();if(t){const e=this.perf.millisSinceHRTime(t),n=jo-e;return n<=0?void this._onTimeout():(this._sessionTimeout&&clearTimeout(this._sessionTimeout),void(this._sessionTimeout=setTimeout(this._checkTimeout,n)))}this._sessionTimeout&&clearTimeout(this._sessionTimeout),this._sessionTimeout=setTimeout(this._checkTimeout,jo)},this._sessionTimeout=null,this._config.enabled&&this.enable()}}class Ho extends xo{disable(){window.removeEventListener("error",this._onErrorHandler),window.removeEventListener("unhandledrejection",this._onUnhandledRejectionHandler)}enable(){window.addEventListener("error",this._onErrorHandler),window.addEventListener("unhandledrejection",this._onUnhandledRejectionHandler)}constructor({diag:t,perf:e}={}){super({instrumentationName:"GlobalExceptionInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this._onErrorHandler=t=>{this.logManager.logException(t.error,{handled:!1,timestamp:this.perf.epochMillisFromOriginOffset(t.timeStamp)})},this._onUnhandledRejectionHandler=t=>{let e;t.reason&&t.reason instanceof Error?e=t.reason:(e=new Error("string"==typeof t.reason?t.reason:"Unhandled Rejected Promise"),e.stack=""),this.logManager.logException(e,{handled:!1,timestamp:this.perf.epochMillisFromOriginOffset(t.timeStamp)})},this._config.enabled&&this.enable()}}const $o=(t,e)=>{const n=t.nodeName.toLowerCase(),r=e.substring(0,30),i=e.length>30?"...":"";return`<${n}${t.className?` class="${t.className}"`:""}>${r}${i}</${n}>`};class Go extends xo{disable(){document.removeEventListener("click",this._onClickHandler)}enable(){document.addEventListener("click",this._onClickHandler)}constructor({diag:t,perf:e,shouldTrack:n,innerTextForElement:r}={}){super({instrumentationName:"SpanSessionBrowserActivityInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this._onClickHandler=t=>{const e=t.target;if(e instanceof HTMLElement&&!e.hasAttribute("disabled")&&(!n||n(e)))try{const n=this.sessionManager.getSessionSpan();n&&n.addEvent("click",{"emb.type":"ux.tap","view.name":$o(e,r?r(e):e.innerText),"tap.coords":`${t.x.toString()},${t.y.toString()}`},this.perf.epochMillisFromOriginOffset(t.timeStamp))}catch(t){this._diag.error("failed to create new user interaction span event",t)}},this._config.enabled&&this.enable()}}function Xo(){return Xo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Xo.apply(this,arguments)}class zo{u(t){if(t.hadRecentInput)return;const e=this.i[0],n=this.i.at(-1);this.o&&e&&n&&t.startTime-n.startTime<1e3&&t.startTime-e.startTime<5e3?(this.o+=t.value,this.i.push(t)):(this.o=t.value,this.i=[t]),null==this.t||this.t.call(this,t)}constructor(){this.o=0,this.i=[]}}const qo=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},Wo=t=>{if("loading"===document.readyState)return"loading";{const e=qo();if(e){if(t<e.domInteractive)return"loading";if(0===e.domContentLoadedEventStart||t<e.domContentLoadedEventStart)return"dom-interactive";if(0===e.domComplete||t<e.domComplete)return"dom-content-loaded"}}return"complete"},Ko=t=>{const e=t.nodeName;return 1===t.nodeType?e.toLowerCase():e.toUpperCase().replace(/^#/,"")},Qo=t=>{let e="";try{for(;9!==(null==t?void 0:t.nodeType);){const n=t,r=n.id?"#"+n.id:[Ko(n),...Array.from(n.classList).sort()].join(".");if(e.length+r.length>99)return e||r;if(e=e?r+">"+e:r,n.id)break;t=n.parentNode}}catch(e){}return e},Yo=new WeakMap;function Zo(t,e){return Yo.get(t)||Yo.set(t,new e),Yo.get(t)}let Jo=-1;const ta=()=>Jo,ea=t=>{addEventListener("pageshow",e=>{e.persisted&&(Jo=e.timeStamp,t(e))},!0)},na=(t,e,n,r)=>{let i,s;return o=>{e.value>=0&&(o||r)&&(s=e.value-(null!=i?i:0),(s||void 0===i)&&(i=e.value,e.delta=s,e.rating=((t,e)=>t>e[1]?"poor":t>e[0]?"needs-improvement":"good")(e.value,n),t(e)))}},ra=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},ia=()=>{const t=qo();var e;return null!=(e=null==t?void 0:t.activationStart)?e:0},sa=(t,e=-1)=>{const n=qo();let r="navigate";return ta()>=0?r="back-forward-cache":n&&(document.prerendering||ia()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},oa=(t,e,n={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver(t=>{Promise.resolve().then(()=>{e(t.getEntries())})});return r.observe(Xo({type:t,buffered:!0},n)),r}}catch(e){}},aa=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let ua=-1;const ca=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,la=t=>{"hidden"===document.visibilityState&&ua>-1&&(ua="visibilitychange"===t.type?t.timeStamp:0,da())},ha=()=>{addEventListener("visibilitychange",la,!0),addEventListener("prerenderingchange",la,!0)},da=()=>{removeEventListener("visibilitychange",la,!0),removeEventListener("prerenderingchange",la,!0)},pa=()=>{if(ua<0){var t;const e=ia(),n=document.prerendering||null==(t=globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0])?void 0:t.startTime;ua=null!=n?n:ca(),ha(),ea(()=>{setTimeout(()=>{ua=ca(),ha()})})}return{get firstHiddenTime(){return ua}}},ga=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},_a=[1800,3e3],ma=(t,e={})=>{ga(()=>{const n=pa();let r,i=sa("FCP");const s=oa("paint",t=>{for(const e of t)"first-contentful-paint"===e.name&&(s.disconnect(),e.startTime<n.firstHiddenTime&&(i.value=Math.max(e.startTime-ia(),0),i.entries.push(e),r(!0)))});s&&(r=na(t,i,_a,e.reportAllChanges),ea(n=>{i=sa("FCP"),r=na(t,i,_a,e.reportAllChanges),ra(()=>{i.value=performance.now()-n.timeStamp,r(!0)})}))})},fa=[.1,.25],va=t=>t.find(t=>{var e;return 1===(null==(e=t.node)?void 0:e.nodeType)})||t[0];let Ea=0,Ta=1/0,Sa=0;const ba=t=>{for(const e of t)e.interactionId&&(Ta=Math.min(Ta,e.interactionId),Sa=Math.max(Sa,e.interactionId),Ea=Sa?(Sa-Ta)/7+1:0)};let ya;const La=()=>{var t;return ya?Ea:null!=(t=performance.interactionCount)?t:0};let Oa=0;class wa{v(){Oa=La(),this.l.length=0,this.h.clear()}M(){const t=Math.min(this.l.length-1,Math.floor((La()-Oa)/50));return this.l[t]}u(t){if(null==this.m||this.m.call(this,t),!t.interactionId&&"first-input"!==t.entryType)return;const e=this.l.at(-1);let n=this.h.get(t.interactionId);if(n||this.l.length<10||t.duration>e.T){if(n?t.duration>n.T?(n.entries=[t],n.T=t.duration):t.duration===n.T&&t.startTime===n.entries[0].startTime&&n.entries.push(t):(n={id:t.interactionId,entries:[t],T:t.duration},this.h.set(n.id,n),this.l.push(n)),this.l.sort((t,e)=>e.T-t.T),this.l.length>10){const t=this.l.splice(10);for(const e of t)this.h.delete(e.id)}null==this.p||this.p.call(this,n)}}constructor(){this.l=[],this.h=new Map}}const Ra=t=>{const e=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?t():(t=aa(t),document.addEventListener("visibilitychange",t,{once:!0}),e(()=>{t(),document.removeEventListener("visibilitychange",t)}))},Ca=[200,500];class Aa{u(t){null==this.m||this.m.call(this,t)}}const Pa=[2500,4e3],Ia=[800,1800],Ma=t=>{document.prerendering?ga(()=>Ma(t)):"complete"!==document.readyState?addEventListener("load",()=>Ma(t),!0):setTimeout(t)},Na=["CLS","INP","LCP"],xa=["CLS","INP","LCP","FCP","TTFB"],Da={CLS:(t,e={})=>{const n=Zo(e=Object.assign({},e),zo),r=new WeakMap;n.t=t=>{var n;if(null==t||null==(n=t.sources)?void 0:n.length){const n=va(t.sources);if(n){var i;const t=(null!=(i=e.generateTarget)?i:Qo)(n.node);r.set(n,t)}}},((t,e={})=>{ma(aa(()=>{let n,r=sa("CLS",0);const i=Zo(e,zo),s=t=>{for(const e of t)i.u(e);i.o>r.value&&(r.value=i.o,r.entries=i.i,n())},o=oa("layout-shift",s);o&&(n=na(t,r,fa,e.reportAllChanges),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(s(o.takeRecords()),n(!0))}),ea(()=>{i.o=0,r=sa("CLS",0),n=na(t,r,fa,e.reportAllChanges),ra(()=>n())}),setTimeout(n))}))})(e=>{const n=(t=>{let e={};if(t.entries.length){var n;const i=t.entries.reduce((t,e)=>t.value>e.value?t:e);if(null==i||null==(n=i.sources)?void 0:n.length){const t=va(i.sources);t&&(e={largestShiftTarget:r.get(t),largestShiftTime:i.startTime,largestShiftValue:i.value,largestShiftSource:t,largestShiftEntry:i,loadState:Wo(i.startTime)})}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},FCP:(t,e={})=>{ma(e=>{const n=(t=>{let e={timeToFirstByte:0,firstByteToFCP:t.value,loadState:Wo(ta())};if(t.entries.length){const n=qo(),r=t.entries.at(-1);if(n){const i=n.activationStart||0,s=Math.max(0,n.responseStart-i);e={timeToFirstByte:s,firstByteToFCP:t.value-s,loadState:Wo(t.entries[0].startTime),navigationEntry:n,fcpEntry:r}}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},LCP:(t,e={})=>{const n=Zo(e=Object.assign({},e),Aa),r=new WeakMap;n.m=t=>{if(t.element){var n;const i=(null!=(n=e.generateTarget)?n:Qo)(t.element);r.set(t,i)}},((t,e={})=>{ga(()=>{const n=pa();let r,i=sa("LCP");const s=Zo(e,Aa),o=t=>{e.reportAllChanges||(t=t.slice(-1));for(const e of t)s.u(e),e.startTime<n.firstHiddenTime&&(i.value=Math.max(e.startTime-ia(),0),i.entries=[e],r())},a=oa("largest-contentful-paint",o);if(a){r=na(t,i,Pa,e.reportAllChanges);const n=aa(()=>{o(a.takeRecords()),a.disconnect(),r(!0)});for(const t of["keydown","click","visibilitychange"])addEventListener(t,()=>Ra(n),{capture:!0,once:!0});ea(n=>{i=sa("LCP"),r=na(t,i,Pa,e.reportAllChanges),ra(()=>{i.value=performance.now()-n.timeStamp,r(!0)})})}})})(e=>{const n=(t=>{let e={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:t.value};if(t.entries.length){const n=qo();if(n){const i=n.activationStart||0,s=t.entries.at(-1),o=s.url&&performance.getEntriesByType("resource").filter(t=>t.name===s.url)[0],a=Math.max(0,n.responseStart-i),u=Math.max(a,o?(o.requestStart||o.startTime)-i:0),c=Math.min(t.value,Math.max(u,o?o.responseEnd-i:0));e={target:r.get(s),timeToFirstByte:a,resourceLoadDelay:u-a,resourceLoadDuration:c-u,elementRenderDelay:t.value-c,navigationEntry:n,lcpEntry:s},s.url&&(e.url=s.url),o&&(e.lcpResourceEntry=o)}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},INP:(t,e={})=>{const n=Zo(e=Object.assign({},e),wa);let r=[],i=[],s=0;const o=new WeakMap,a=new WeakMap;let u=!1;const c=()=>{u||(Ra(l),u=!0)},l=()=>{const t=n.l.map(t=>o.get(t.entries[0])),e=i.length-50;i=i.filter((n,r)=>r>=e||t.includes(n));const a=new Set;for(const t of i){const e=h(t.startTime,t.processingEnd);for(const t of e)a.add(t)}const c=r.length-1-50;r=r.filter((t,e)=>t.startTime>s&&e>c||a.has(t)),u=!1};n.m=t=>{const e=t.startTime+t.duration;let n;s=Math.max(s,t.processingEnd);for(let r=i.length-1;r>=0;r--){const s=i[r];if(Math.abs(e-s.renderTime)<=8){n=s,n.startTime=Math.min(t.startTime,n.startTime),n.processingStart=Math.min(t.processingStart,n.processingStart),n.processingEnd=Math.max(t.processingEnd,n.processingEnd),n.entries.push(t);break}}n||(n={startTime:t.startTime,processingStart:t.processingStart,processingEnd:t.processingEnd,renderTime:e,entries:[t]},i.push(n)),(t.interactionId||"first-input"===t.entryType)&&o.set(t,n),c()},n.p=t=>{if(!a.get(t)){var n;const r=(null!=(n=e.generateTarget)?n:Qo)(t.entries[0].target);a.set(t,r)}};const h=(t,e)=>{const n=[];for(const i of r)if(!(i.startTime+i.duration<t)){if(i.startTime>e)break;n.push(i)}return n},d=t=>{const e=t.entries[0],r=o.get(e),i=e.processingStart,s=Math.max(e.startTime+e.duration,i),u=Math.min(r.processingEnd,s),c=r.entries.sort((t,e)=>t.processingStart-e.processingStart),l=h(e.startTime,u),d=n.h.get(e.interactionId),p={interactionTarget:a.get(d),interactionType:e.name.startsWith("key")?"keyboard":"pointer",interactionTime:e.startTime,nextPaintTime:s,processedEventEntries:c,longAnimationFrameEntries:l,inputDelay:i-e.startTime,processingDuration:u-i,presentationDelay:s-u,loadState:Wo(e.startTime),longestScript:void 0,totalScriptDuration:void 0,totalStyleAndLayoutDuration:void 0,totalPaintDuration:void 0,totalUnattributedDuration:void 0};return(t=>{var e;if(!(null==(e=t.longAnimationFrameEntries)?void 0:e.length))return;const n=t.interactionTime,r=t.inputDelay,i=t.processingDuration;let s,o,a=0,u=0,c=0,l=0;for(const e of t.longAnimationFrameEntries){u=u+e.startTime+e.duration-e.styleAndLayoutStart;for(const t of e.scripts){const e=t.startTime+t.duration;if(e<n)continue;const c=e-Math.max(n,t.startTime),h=t.duration?c/t.duration*t.forcedStyleAndLayoutDuration:0;a+=c-h,u+=h,c>l&&(o=t.startTime<n+r?"input-delay":t.startTime>=n+r+i?"presentation-delay":"processing-duration",s=t,l=c)}}const h=t.longAnimationFrameEntries.at(-1),d=h?h.startTime+h.duration:0;d>=n+r+i&&(c=t.nextPaintTime-d),s&&o&&(t.longestScript={entry:s,subpart:o,intersectingDuration:l}),t.totalScriptDuration=a,t.totalStyleAndLayoutDuration=u,t.totalPaintDuration=c,t.totalUnattributedDuration=t.nextPaintTime-n-a-u-c})(p),Object.assign(t,{attribution:p})};oa("long-animation-frame",t=>{r=r.concat(t),c()}),((t,e={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&ga(()=>{"interactionCount"in performance||ya||(ya=oa("event",ba,{type:"event",buffered:!0,durationThreshold:0}));let n,r=sa("INP");var i;const s=Zo(e,wa),o=t=>{Ra(()=>{for(const e of t)s.u(e);const e=s.M();e&&e.T!==r.value&&(r.value=e.T,r.entries=e.entries,n())})},a=oa("event",o,{durationThreshold:null!=(i=e.durationThreshold)?i:40});n=na(t,r,Ca,e.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(o(a.takeRecords()),n(!0))}),ea(()=>{s.v(),r=sa("INP"),n=na(t,r,Ca,e.reportAllChanges)}))})})(e=>{const n=d(e);t(n)},e)},TTFB:(t,e={})=>{((t,e={})=>{let n=sa("TTFB"),r=na(t,n,Ia,e.reportAllChanges);Ma(()=>{const i=qo();i&&(n.value=Math.max(i.responseStart-ia(),0),n.entries=[i],r(!0),ea(()=>{n=sa("TTFB",0),r=na(t,n,Ia,e.reportAllChanges),r(!0)}))})})(e=>{const n=(t=>{let e={waitingDuration:0,cacheDuration:0,dnsDuration:0,connectionDuration:0,requestDuration:0};if(t.entries.length){const n=t.entries[0],r=n.activationStart||0,i=Math.max((n.workerStart||n.fetchStart)-r,0),s=Math.max(n.domainLookupStart-r,0),o=Math.max(n.connectStart-r,0),a=Math.max(n.connectEnd-r,0);e={waitingDuration:i,cacheDuration:s-i,dnsDuration:o-s,connectionDuration:a-o,requestDuration:t.value-a,navigationEntry:n}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},FID:void 0};function Ua(){return Ua=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ua.apply(this,arguments)}class ka extends xo{disable(){}enable(){this._metricsToTrack.forEach(t=>{var e;null==(e=this._listeners[t])||e.call(this._listeners,e=>{const n=this.sessionManager.getSessionSpan();if(!n)return;const r=this._getTimeForMetric(e),i=Ua({[Ps]:Vs.WebVital,[Cs]:this._getAttributedURLForMetric(e),"emb.web_vital.navigation_type":e.navigationType,"emb.web_vital.name":e.name,"emb.web_vital.rating":e.rating,"emb.web_vital.id":e.id,"emb.web_vital.delta":e.delta,"emb.web_vital.value":e.value},((t,e)=>{const n={},r=[];if("CLS"===t){const t=e.attribution;r.push({key:"largestShiftTarget",value:t.largestShiftTarget},{key:"largestShiftValue",value:t.largestShiftValue})}else if("INP"===t){const t=e.attribution;r.push({key:"interactionTarget",value:t.interactionTarget},{key:"interactionType",value:t.interactionType},{key:"nextPaintTime",value:t.nextPaintTime},{key:"inputDelay",value:t.inputDelay},{key:"processingDuration",value:t.processingDuration},{key:"presentationDelay",value:t.presentationDelay},{key:"totalScriptDuration",value:t.totalScriptDuration},{key:"totalStyleAndLayoutDuration",value:t.totalStyleAndLayoutDuration},{key:"totalPaintDuration",value:t.totalPaintDuration},{key:"totalUnattributedDuration",value:t.totalUnattributedDuration},{key:"loadState",value:t.loadState})}else if("LCP"===t){const t=e.attribution;r.push({key:"target",value:t.target},{key:"url",value:t.url},{key:"timeToFirstByte",value:t.timeToFirstByte},{key:"resourceLoadDelay",value:t.resourceLoadDelay},{key:"resourceLoadDuration",value:t.resourceLoadDuration},{key:"elementRenderDelay",value:t.elementRenderDelay})}return r.forEach(t=>{void 0!==t.value&&(n[`emb.web_vital.attribution.${t.key}`]=t.value)}),n})(t,e));n.addEvent(`emb-web-vitals-report-${t}`,i,r)})}),this._urlAttribution&&(null==this._listeners.INP||this._listeners.INP.call(this._listeners,()=>{this._attributedURL.INP=this._urlDocument.URL},{reportAllChanges:!0}),null==this._listeners.LCP||this._listeners.LCP.call(this._listeners,()=>{this._attributedURL.LCP=this._urlDocument.URL},{reportAllChanges:!0}),null==this._listeners.CLS||this._listeners.CLS.call(this._listeners,t=>{const e=t;this._largestShiftTargetForCLS!==e.attribution.largestShiftTarget&&(this._largestShiftTargetForCLS=e.attribution.largestShiftTarget,this._attributedURL.CLS=this._urlDocument.URL)},{reportAllChanges:!0}))}_getTimeForMetric(t){return"CLS"===t.name&&t.attribution.largestShiftTime?this.perf.epochMillisFromOriginOffset(t.attribution.largestShiftTime):"INP"===t.name&&t.attribution.interactionTime?this.perf.epochMillisFromOriginOffset(t.attribution.interactionTime):this.perf.getNowMillis()}_getAttributedURLForMetric(t){return"INP"===t.name&&this._attributedURL.INP?this._attributedURL.INP:"LCP"===t.name&&this._attributedURL.LCP?this._attributedURL.LCP:"CLS"===t.name&&this._attributedURL.CLS&&t.attribution.largestShiftTarget===this._largestShiftTargetForCLS?this._attributedURL.CLS:this._urlDocument.URL}constructor({diag:t,perf:e,trackingLevel:n="core",listeners:r=Da,urlDocument:i=window.document,urlAttribution:s=!1}={}){super({instrumentationName:"WebVitalsInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this._attributedURL={INP:void 0,LCP:void 0,CLS:void 0,FCP:void 0,TTFB:void 0},this._listeners=r,this._urlDocument=i,this._metricsToTrack="core"===n?[...Na]:[...xa],this._urlAttribution=s,this._config.enabled&&this.enable()}}const Fa=/\(.*?\)/g;class Ba extends xo{constructor({diag:t,shouldCleanupPathOptionsFromRouteName:e=!0}){super({instrumentationName:"NavigationInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),this._shouldCleanupPathOptionsFromRouteName=!0,this._currentRoute=null,this._currentRouteSpan=null,this._instrumentationType=null,this._removeSessionStartedFn=null,this._removeSessionEndedFn=null,this.setInstrumentationType=t=>{this._instrumentationType=t},this.setCurrentRoute=t=>{var e;this._config.enabled&&t.url!==(null==(e=this._currentRoute)?void 0:e.url)&&(this._endRouteSpan(),this._startRouteSpan(t),this._currentRoute=t)},this._setupSessionListeners=()=>{this._removeSessionStartedFn||(this._removeSessionStartedFn=this.sessionManager.addSessionStartedListener(()=>{this._currentRoute&&!this._currentRouteSpan&&(this._diag.debug("Session started, starting route span."),this._startRouteSpan(this._currentRoute))})),this._removeSessionEndedFn||(this._removeSessionEndedFn=this.sessionManager.addSessionEndedListener(()=>{this._currentRouteSpan&&(this._diag.debug("Session ended, ending route span."),this._endRouteSpan())}))},this._cleanUpSessionListeners=()=>{this._removeSessionStartedFn&&(this._removeSessionStartedFn(),this._removeSessionStartedFn=null),this._removeSessionEndedFn&&(this._removeSessionEndedFn(),this._removeSessionEndedFn=null)},this._startRouteSpan=t=>{this._diag.debug(`Starting route span for url: ${t.url}`),this._setupSessionListeners();const e=this._shouldCleanupPathOptionsFromRouteName?t.path.replace(Fa,""):t.path;return this._currentRouteSpan=this.tracer.startSpan(e,{attributes:{[Ps]:Vs.View,[js]:e}}),this._instrumentationType&&this._currentRouteSpan.setAttribute("emb.instrumentation",this._instrumentationType),this._currentRouteSpan},this._endRouteSpan=()=>{this._currentRouteSpan&&this._currentRoute&&(this._diag.debug(`Ending route span for url: ${this._currentRoute.url}`),this._currentRouteSpan.end(),this._currentRouteSpan=null)},this.enable=()=>{this._diag.debug("NavigationInstrumentation enabled, listening for navigation events.")},this.disable=()=>{this._cleanUpSessionListeners(),this.setConfig({enabled:!1}),this._diag.debug("NavigationInstrumentation disabled, stopped listening for navigation events.")},this._shouldCleanupPathOptionsFromRouteName=e,this._config.enabled&&this.enable()}}let ja;var Va;!function(t){t.DOCUMENT_LOAD="documentLoad",t.DOCUMENT_FETCH="documentFetch",t.RESOURCE_FETCH="resourceFetch"}(Va||(Va={}));var Ha;!function(t){t.FIRST_PAINT="firstPaint",t.FIRST_CONTENTFUL_PAINT="firstContentfulPaint"}(Ha||(Ha={}));const $a={"first-paint":Ha.FIRST_PAINT,"first-contentful-paint":Ha.FIRST_CONTENTFUL_PAINT};class Ga extends Ae{init(){}_onDocumentLoaded(){window.setTimeout(()=>{this._collectPerformance()})}_addResourcesSpans(t){var e,n;const r=null===(n=(e=mn).getEntriesByType)||void 0===n?void 0:n.call(e,"resource");r&&r.forEach(e=>{this._initResourceSpan(e,t)})}_collectPerformance(){const t=Array.from(document.getElementsByTagName("meta")).find(t=>t.getAttribute("name")===Bn),e=(()=>{var t,e;const n={},r=null===(e=(t=mn).getEntriesByType)||void 0===e?void 0:e.call(t,"navigation")[0];if(r)Object.values(Qr).forEach(t=>{if(ei(r,t)){const e=r[t];"number"==typeof e&&(n[t]=e)}});else{const t=mn.timing;t&&Object.values(Qr).forEach(e=>{if(ei(t,e)){const r=t[e];"number"==typeof r&&(n[e]=r)}})}return n})(),n=t&&t.content||"";jt.with(te.extract(k,{traceparent:n}),()=>{var t;const n=this._startSpan(Va.DOCUMENT_LOAD,Qr.FETCH_START,e);n&&(jt.with(re.setSpan(jt.active(),n),()=>{const t=this._startSpan(Va.DOCUMENT_FETCH,Qr.FETCH_START,e);t&&(t.setAttribute(fs,location.href),jt.with(re.setSpan(jt.active(),t),()=>{var n;this.getConfig().ignoreNetworkEvents||ri(t,e),this._addCustomAttributesOnSpan(t,null===(n=this.getConfig().applyCustomAttributesOnSpan)||void 0===n?void 0:n.documentFetch),this._endSpan(t,Qr.RESPONSE_END,e)}))}),n.setAttribute(fs,location.href),n.setAttribute("http.user_agent",navigator.userAgent),this._addResourcesSpans(n),this.getConfig().ignoreNetworkEvents||(ni(n,Qr.FETCH_START,e),ni(n,Qr.UNLOAD_EVENT_START,e),ni(n,Qr.UNLOAD_EVENT_END,e),ni(n,Qr.DOM_INTERACTIVE,e),ni(n,Qr.DOM_CONTENT_LOADED_EVENT_START,e),ni(n,Qr.DOM_CONTENT_LOADED_EVENT_END,e),ni(n,Qr.DOM_COMPLETE,e),ni(n,Qr.LOAD_EVENT_START,e),ni(n,Qr.LOAD_EVENT_END,e)),this.getConfig().ignorePerformancePaintEvents||(t=>{var e,n;const r=null===(n=(e=mn).getEntriesByType)||void 0===n?void 0:n.call(e,"paint");r&&r.forEach(({name:e,startTime:n})=>{ei($a,e)&&t.addEvent($a[e],n)})})(n),this._addCustomAttributesOnSpan(n,null===(t=this.getConfig().applyCustomAttributesOnSpan)||void 0===t?void 0:t.documentLoad),this._endSpan(n,Qr.LOAD_EVENT_END,e))})}_endSpan(t,e,n){t&&(ei(n,e)?t.end(n[e]):t.end())}_initResourceSpan(t,e){var n;const r=this._startSpan(Va.RESOURCE_FETCH,Qr.FETCH_START,t,e);r&&(r.setAttribute(fs,t.name),this.getConfig().ignoreNetworkEvents||ri(r,t),this._addCustomAttributesOnResourceSpan(r,t,null===(n=this.getConfig().applyCustomAttributesOnSpan)||void 0===n?void 0:n.resourceFetch),this._endSpan(r,Qr.RESPONSE_END,t))}_startSpan(t,e,n,r){if(ei(n,e)&&"number"==typeof n[e]){return this.tracer.startSpan(t,{startTime:n[e]},r?re.setSpan(jt.active(),r):void 0)}}_waitForPageLoad(){"complete"===window.document.readyState?this._onDocumentLoaded():(this._onDocumentLoaded=this._onDocumentLoaded.bind(this),window.addEventListener("load",this._onDocumentLoaded))}_addCustomAttributesOnSpan(t,e){e&&Pe(()=>e(t),t=>{t&&this._diag.error("addCustomAttributesOnSpan",t)})}_addCustomAttributesOnResourceSpan(t,e,n){n&&Pe(()=>n(t,e),t=>{t&&this._diag.error("addCustomAttributesOnResourceSpan",t)})}enable(){window.removeEventListener("load",this._onDocumentLoaded),this._waitForPageLoad()}disable(){window.removeEventListener("load",this._onDocumentLoaded)}constructor(t={}){super("@opentelemetry/instrumentation-document-load","0.44.1",t),this.component="document-load",this.version="1",this.moduleName=this.component}}var Xa;!function(t){t.COMPONENT="component",t.HTTP_ERROR_NAME="http.error_name",t.HTTP_STATUS_TEXT="http.status_text"}(Xa||(Xa={}));var za="http.method",qa="http.url";function Wa(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}const Ka=Vt.createComponentLogger({namespace:"@opentelemetry/opentelemetry-instrumentation-fetch/utils"});function Qa(...t){if(t[0]instanceof URL||"string"==typeof t[0]){const e=t[1];if(!(null==e?void 0:e.body))return Promise.resolve();if(e.body instanceof ReadableStream){const{body:t,length:n}=function(t){if(!t.pipeThrough)return Ka.warn("Platform has ReadableStream but not pipeThrough!"),{body:t,length:Promise.resolve(void 0)};let e,n=0;const r=new Promise(t=>{e=t}),i=new TransformStream({start(){},transform(t,e){return(r=function*(){const r=yield t;n+=r.byteLength,e.enqueue(t)},function(){var t=this,e=arguments;return new Promise(function(n,i){var s=r.apply(t,e);function o(t){Wa(s,n,i,o,a,"next",t)}function a(t){Wa(s,n,i,o,a,"throw",t)}o(void 0)})})();var r},flush(){e(n)}});return{body:t.pipeThrough(i),length:r}}(e.body);return e.body=t,n}return Promise.resolve(function(t){if("undefined"!=typeof Document&&t instanceof Document)return(new XMLSerializer).serializeToString(document).length;if(t instanceof Blob)return t.size;if(void 0!==t.byteLength)return t.byteLength;if(t instanceof FormData)return function(t){let e=0;for(const[n,r]of t.entries())e+=n.length,r instanceof Blob?e+=r.size:e+=r.length;return e}(t);if(t instanceof URLSearchParams)return Za(t.toString());if("string"==typeof t)return Za(t);return void Ka.warn("unknown body type")}(e.body))}{const e=t[0];return(null==e?void 0:e.body)?e.clone().text().then(t=>Za(t)):Promise.resolve()}}const Ya=new TextEncoder;function Za(t){return Ya.encode(t).byteLength}const Ja="0.57.2";var tu;const eu="object"==typeof process&&"node"===(null===(tu=process.release)||void 0===tu?void 0:tu.name);class nu extends Ae{init(){}_addChildSpan(t,e){const n=this.tracer.startSpan("CORS Preflight",{startTime:e[Qr.FETCH_START]},re.setSpan(jt.active(),t));ri(n,e,this.getConfig().ignoreNetworkEvents),n.end(e[Qr.RESPONSE_END])}_addFinalSpanAttributes(t,e){const n=oi(e.url);t.setAttribute("http.status_code",e.status),null!=e.statusText&&t.setAttribute(Xa.HTTP_STATUS_TEXT,e.statusText),t.setAttribute("http.host",n.host),t.setAttribute("http.scheme",n.protocol.replace(":","")),"undefined"!=typeof navigator&&t.setAttribute("http.user_agent",navigator.userAgent)}_addHeaders(t,e){if(!ai(e,this.getConfig().propagateTraceHeaderCorsUrls)){const t={};return te.inject(jt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}if(t instanceof Request)te.inject(jt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else if(t.headers instanceof Headers)te.inject(jt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else if(t.headers instanceof Map)te.inject(jt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else{const e={};te.inject(jt.active(),e),t.headers=Object.assign({},e,t.headers||{})}}_clearResources(){0===this._tasksCount&&this.getConfig().clearTimingResources&&(performance.clearResourceTimings(),this._usedResources=new WeakSet)}_createSpan(t,e={}){if(dr(t,this.getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const n=(e.method||"GET").toUpperCase(),r=`HTTP ${n}`;return this.tracer.startSpan(r,{kind:xt.CLIENT,attributes:{[Xa.COMPONENT]:this.moduleName,[za]:n,[qa]:t}})}_findResourceAndAddNetworkEvents(t,e,n){let r=e.entries;if(!r.length){if(!performance.getEntriesByType)return;r=performance.getEntriesByType("resource")}const i=si(e.spanUrl,e.startTime,n,r,this._usedResources,"fetch");if(i.mainRequest){const e=i.mainRequest;this._markResourceAsUsed(e);const n=i.corsPreFlightRequest;n&&(this._addChildSpan(t,n),this._markResourceAsUsed(n)),ri(t,e,this.getConfig().ignoreNetworkEvents)}}_markResourceAsUsed(t){this._usedResources.add(t)}_endSpan(t,e,n){const r=Ln(Date.now()),i=wn();this._addFinalSpanAttributes(t,n),setTimeout(()=>{var n;null===(n=e.observer)||void 0===n||n.disconnect(),this._findResourceAndAddNetworkEvents(t,e,i),this._tasksCount--,this._clearResources(),t.end(r)},300)}_patchConstructor(){return t=>{const e=this;return function(...n){const r=this,i=oi(n[0]instanceof Request?n[0].url:String(n[0])).href,s=n[0]instanceof Request?n[0]:n[1]||{},o=e._createSpan(i,s);if(!o)return t.apply(this,n);const a=e._prepareSpanData(i);function u(t,n){e._applyAttributesAfterFetch(t,s,n),e._endSpan(t,a,{status:n.status||0,statusText:n.message,url:i})}function c(t,n){e._applyAttributesAfterFetch(t,s,n),n.status>=200&&n.status<400?e._endSpan(t,a,n):e._endSpan(t,a,{status:n.status,statusText:n.statusText,url:i})}function l(t,e,n){try{const e=n.clone(),r=n.clone(),i=e.body;if(i){const e=i.getReader(),n=()=>{e.read().then(({done:e})=>{e?c(t,r):n()},e=>{u(t,e)})};n()}else c(t,n)}finally{e(n)}}function h(t,e,n){try{u(t,n)}finally{e(n)}}return e.getConfig().measureRequestSize&&Qa(...n).then(t=>{t&&o.setAttribute("http.request_content_length_uncompressed",t)}).catch(t=>{e._diag.warn("getFetchBodyLength",t)}),new Promise((n,a)=>jt.with(re.setSpan(jt.active(),o),()=>(e._addHeaders(s,i),e._tasksCount++,t.apply(r,s instanceof Request?[s]:[i,s]).then(l.bind(r,o,n),h.bind(r,o,a)))))}}}_applyAttributesAfterFetch(t,e,n){const r=this.getConfig().applyCustomAttributesOnSpan;r&&Pe(()=>r(t,e,n),t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)})}_prepareSpanData(t){const e=wn(),n=[];if("function"!=typeof PerformanceObserver)return{entries:n,startTime:e,spanUrl:t};const r=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"fetch"===e.initiatorType&&e.name===t&&n.push(e)})});return r.observe({entryTypes:["resource"]}),{entries:n,observer:r,startTime:e,spanUrl:t}}enable(){eu?this._diag.warn("this instrumentation is intended for web usage only, it does not instrument Node.js's fetch()"):(Ie(fetch)&&(this._unwrap(hn,"fetch"),this._diag.debug("removing previous patch for constructor")),this._wrap(hn,"fetch",this._patchConstructor()))}disable(){eu||(this._unwrap(hn,"fetch"),this._usedResources=new WeakSet)}constructor(t={}){super("@opentelemetry/instrumentation-fetch",Ja,t),this.component="fetch",this.version=Ja,this.moduleName=this.component,this._usedResources=new WeakSet,this._tasksCount=0}}var ru,iu="http.method",su="http.url";!function(t){t.METHOD_OPEN="open",t.METHOD_SEND="send",t.EVENT_ABORT="abort",t.EVENT_ERROR="error",t.EVENT_LOAD="loaded",t.EVENT_TIMEOUT="timeout"}(ru||(ru={}));const ou=Vt.createComponentLogger({namespace:"@opentelemetry/opentelemetry-instrumentation-xml-http-request/utils"});function au(t){return"undefined"!=typeof Document&&t instanceof Document?(new XMLSerializer).serializeToString(document).length:t instanceof Blob?t.size:void 0!==t.byteLength?t.byteLength:t instanceof FormData?function(t){let e=0;for(const[n,r]of t.entries())e+=n.length,r instanceof Blob?e+=r.size:e+=r.length;return e}(t):t instanceof URLSearchParams?cu(t.toString()):"string"==typeof t?cu(t):void ou.warn("unknown body type")}const uu=new TextEncoder;function cu(t){return uu.encode(t).byteLength}const lu="0.57.2";var hu;!function(t){t.HTTP_STATUS_TEXT="http.status_text"}(hu||(hu={}));class du extends Ae{init(){}_addHeaders(t,e){if(!ai(oi(e).href,this.getConfig().propagateTraceHeaderCorsUrls)){const t={};return te.inject(jt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}const n={};te.inject(jt.active(),n),Object.keys(n).forEach(e=>{t.setRequestHeader(e,String(n[e]))})}_addChildSpan(t,e){jt.with(re.setSpan(jt.active(),t),()=>{const t=this.tracer.startSpan("CORS Preflight",{startTime:e[Qr.FETCH_START]});ri(t,e,this.getConfig().ignoreNetworkEvents),t.end(e[Qr.RESPONSE_END])})}_addFinalSpanAttributes(t,e,n){if("string"==typeof n){const r=oi(n);void 0!==e.status&&t.setAttribute("http.status_code",e.status),void 0!==e.statusText&&t.setAttribute(hu.HTTP_STATUS_TEXT,e.statusText),t.setAttribute("http.host",r.host),t.setAttribute("http.scheme",r.protocol.replace(":","")),t.setAttribute("http.user_agent",navigator.userAgent)}}_applyAttributesAfterXHR(t,e){const n=this.getConfig().applyCustomAttributesOnSpan;"function"==typeof n&&Pe(()=>n(t,e),t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)})}_addResourceObserver(t,e){const n=this._xhrMem.get(t);n&&"function"==typeof PerformanceObserver&&"function"==typeof PerformanceResourceTiming&&(n.createdResources={observer:new PerformanceObserver(t=>{const r=t.getEntries(),i=oi(e);r.forEach(t=>{"xmlhttprequest"===t.initiatorType&&t.name===i.href&&n.createdResources&&n.createdResources.entries.push(t)})}),entries:[]},n.createdResources.observer.observe({entryTypes:["resource"]}))}_clearResources(){0===this._tasksCount&&this.getConfig().clearTimingResources&&(mn.clearResourceTimings(),this._xhrMem=new WeakMap,this._usedResources=new WeakSet)}_findResourceAndAddNetworkEvents(t,e,n,r,i){if(!(n&&r&&i&&t.createdResources))return;let s=t.createdResources.entries;s&&s.length||(s=mn.getEntriesByType("resource"));const o=si(oi(n).href,r,i,s,this._usedResources);if(o.mainRequest){const t=o.mainRequest;this._markResourceAsUsed(t);const n=o.corsPreFlightRequest;n&&(this._addChildSpan(e,n),this._markResourceAsUsed(n)),ri(e,t,this.getConfig().ignoreNetworkEvents)}}_cleanPreviousSpanInformation(t){const e=this._xhrMem.get(t);if(e){const n=e.callbackToRemoveEvents;n&&n(),this._xhrMem.delete(t)}}_createSpan(t,e,n){if(dr(e,this.getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const r=n.toUpperCase(),i=this.tracer.startSpan(r,{kind:xt.CLIENT,attributes:{[iu]:n,[su]:oi(e).toString()}});return i.addEvent(ru.METHOD_OPEN),this._cleanPreviousSpanInformation(t),this._xhrMem.set(t,{span:i,spanUrl:e}),i}_markResourceAsUsed(t){this._usedResources.add(t)}_patchOpen(){return t=>{const e=this;return function(...n){const r=n[0],i=n[1];return e._createSpan(this,i,r),t.apply(this,n)}}}_patchSend(){const t=this;function e(e,n){const r=t._xhrMem.get(n);if(!r)return;r.status=n.status,r.statusText=n.statusText,t._xhrMem.delete(n),r.span&&t._applyAttributesAfterXHR(r.span,n);const i=wn(),s=Date.now();setTimeout(()=>{!function(e,n,r,i){const s=n.callbackToRemoveEvents;"function"==typeof s&&s();const{span:o,spanUrl:a,sendStartTime:u}=n;o&&(t._findResourceAndAddNetworkEvents(n,o,a,u,r),o.addEvent(e,i),t._addFinalSpanAttributes(o,n,a),o.end(i),t._tasksCount--),t._clearResources()}(e,r,i,s)},300)}function n(){e(ru.EVENT_ERROR,this)}function r(){e(ru.EVENT_ABORT,this)}function i(){e(ru.EVENT_TIMEOUT,this)}function s(){this.status<299?e(ru.EVENT_LOAD,this):e(ru.EVENT_ERROR,this)}return e=>function(...o){const a=t._xhrMem.get(this);if(!a)return e.apply(this,o);const u=a.span,c=a.spanUrl;if(u&&c){if(t.getConfig().measureRequestSize&&(null==o?void 0:o[0])){const t=au(o[0]);void 0!==t&&u.setAttribute("http.request_content_length_uncompressed",t)}jt.with(re.setSpan(jt.active(),u),()=>{t._tasksCount++,a.sendStartTime=wn(),u.addEvent(ru.METHOD_SEND),this.addEventListener("abort",r),this.addEventListener("error",n),this.addEventListener("load",s),this.addEventListener("timeout",i),a.callbackToRemoveEvents=()=>{!function(e){e.removeEventListener("abort",r),e.removeEventListener("error",n),e.removeEventListener("load",s),e.removeEventListener("timeout",i);const o=t._xhrMem.get(e);o&&(o.callbackToRemoveEvents=void 0)}(this),a.createdResources&&a.createdResources.observer.disconnect()},t._addHeaders(this,c),t._addResourceObserver(this,c)})}return e.apply(this,o)}}enable(){this._diag.debug("applying patch to",this.moduleName,this.version),Ie(XMLHttpRequest.prototype.open)&&(this._unwrap(XMLHttpRequest.prototype,"open"),this._diag.debug("removing previous patch from method open")),Ie(XMLHttpRequest.prototype.send)&&(this._unwrap(XMLHttpRequest.prototype,"send"),this._diag.debug("removing previous patch from method send")),this._wrap(XMLHttpRequest.prototype,"open",this._patchOpen()),this._wrap(XMLHttpRequest.prototype,"send",this._patchSend())}disable(){this._diag.debug("removing patch from",this.moduleName,this.version),this._unwrap(XMLHttpRequest.prototype,"open"),this._unwrap(XMLHttpRequest.prototype,"send"),this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}constructor(t={}){super("@opentelemetry/instrumentation-xml-http-request",lu,t),this.component="xml-http-request",this.version=lu,this.moduleName=this.component,this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}}function pu(){return pu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},pu.apply(this,arguments)}const gu=(t={})=>{var e,n,r,i,s,o;const a=[new Bo(t["session-on-load"]),new Uo(t["session-visibility"]),new Fo(t["session-activity"]),new Vo(t["session-timeout"])];return(null==(e=t.omit)?void 0:e.has("exception"))||a.push(new Ho(t.exception)),(null==(n=t.omit)?void 0:n.has("click"))||a.push(new Go(t.click)),(null==(r=t.omit)?void 0:r.has("web-vital"))||a.push(new ka(t["web-vital"])),(null==(i=t.omit)?void 0:i.has("@opentelemetry/instrumentation-document-load"))||a.push(new Ga(t["@opentelemetry/instrumentation-document-load"])),(null==(s=t.omit)?void 0:s.has("@opentelemetry/instrumentation-fetch"))||a.push(new nu(pu({},t.network,t["@opentelemetry/instrumentation-fetch"]))),(null==(o=t.omit)?void 0:o.has("@opentelemetry/instrumentation-xml-http-request"))||a.push(new du(pu({},t.network,t["@opentelemetry/instrumentation-xml-http-request"]))),a};function _u(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}function mu(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){_u(s,r,i,o,a,"next",t)}function a(t){_u(s,r,i,o,a,"throw",t)}o(void 0)})}}class fu{forceFlush(){return mu(function*(){})()}onStart(t,e){var n;const r=null===(n=this._sessionIdProvider)||void 0===n?void 0:n.getSessionId();r&&t.setAttribute("session.id",r)}onEnd(t){}shutdown(){return mu(function*(){})()}constructor(t){this._sessionIdProvider=t}}const vu=new class{constructor({diagLogger:t=Vt.createComponentLogger({namespace:"embrace-registry"})}={}){this._sdk=null,this.register=t=>{null!==this._sdk&&this._diag.warn("previously registered sdk will be overwritten"),this._sdk=t},this.clear=()=>{null===this._sdk&&this._diag.warn("sdk already cleared, this is a no-op"),this._sdk=null},this.registered=()=>this._sdk,this._diag=t}},Eu=/\/\/(.+):(.+)@(.+)\//,Tu=["AWSAccessKeyId","Signature","sig","`X-Goog-Signature","password","auth","pw","token"],Su=({value:t,queryParamRegex:e,scrubPath:n,scrubQuery:r})=>{let i=t;return n&&(i=i.replace(Eu,"//REDACTED:REDACTED@$3/")),r&&(i=i.replaceAll(e,"$1$2=REDACTED")),i},bu=t=>{const e=[...Tu,...t||[]],n=new RegExp(`(^|&|\\?)(${e.join("|")})=[^&]+`,"g");return[{key:Cs,scrub:t=>Su({value:t,queryParamRegex:n,scrubPath:!0,scrubQuery:!0})},{key:fs,scrub:t=>Su({value:t,queryParamRegex:n,scrubPath:!0,scrubQuery:!0})},{key:"url.path",scrub:t=>Su({value:t,queryParamRegex:n,scrubPath:!0,scrubQuery:!1})},{key:"url.query",scrub:t=>Su({value:t,queryParamRegex:n,scrubPath:!1,scrubQuery:!0})}]};function yu(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}const Lu=()=>{const t=new ao;return pe.setGlobalUserManager(t),t},Ou=({limitManager:t})=>{const e=new Qs({limitManager:t});return u.setGlobalSessionManager(e),e},wu=({sendingToEmbrace:t,appID:e,enduserPseudoID:n,resource:r,spanSessionManager:i,userManager:s,spanExporters:o,spanProcessors:a=[],propagator:u=null,contextManager:c=null,limitManager:l,attributeScrubbers:h,embraceDataURL:d})=>{const p=new ro;ue.setGlobalTraceManager(p);const g=[...a,(_=i,new fu(_)),new bo,new Oo({userManager:s}),new Ro({attributeScrubbers:h})];var _;null==o||o.forEach(t=>{g.push(new Hr(t))}),t&&e&&n&&g.push(new Eo({exporter:new Di({appID:e,embraceDataURL:d,userID:n}),limitManager:l}));const m=new Jr({resource:r,spanProcessors:g,spanLimits:{attributeCountLimit:2*Js.maxAllowed.session_property,attributePerEventCountLimit:20,eventCountLimit:2*Js.maxAllowed.breadcrumb,attributeValueLengthLimit:1024}});return m.register({contextManager:c,propagator:u}),m},Ru=({sendingToEmbrace:t,appID:e,enduserPseudoID:n,resource:r,userManager:s,logExporters:o,logProcessors:a,spanSessionManager:u,limitManager:c,attributeScrubbers:l,embraceDataURL:h})=>{const d=new Gs({spanSessionManager:u,limitManager:c});i.setGlobalLogManager(d);const p=new Or({resource:r}),g=[...a,new To({spanSessionManager:u}),new yo,new Lo({userManager:s}),new wo({attributeScrubbers:l})];null==o||o.forEach(t=>{g.push(new Cr(t))}),t&&e&&n&&g.push(new Cr(new Pi({appID:e,embraceDataURL:h,userID:n})));for(const t of g)p.addLogRecordProcessor(t);return Le.setGlobalLoggerProvider(p),p};var Cu=Object.freeze({__proto__:null,get DiagLogLevel(){return E},initSDK:({appID:t,appVersion:e,templateBundleID:n,resource:r=fr.empty(),spanExporters:i=[],logExporters:s=[],spanProcessors:o=[],propagator:a=null,defaultInstrumentationConfig:u,instrumentations:c=[],contextManager:l=null,logProcessors:h=[],attributeScrubbers:d=[],enableDefaultAttributeScrubbing:p=!0,additionalQueryParamsToScrub:g=[],logLevel:_=E.ERROR,embraceDataURL:m,embraceConfigURL:f,diagLogger:v=Vt.createComponentLogger({namespace:"embrace-sdk"}),dynamicSDKConfigManager:T,dynamicSDKConfig:S}={appID:""})=>{try{const E=new ls,b=E.getNowMillis(),y=vu.registered();if(null!==y)return v.warn("SDK has already been successfully initialized, skipping this invocation of initSDK"),y;if(Vt.setLogger(new B,{logLevel:_}),n&&32!==n.length)throw new Error("templateBundleID should be 32 characters long");const L=r.merge((({diagLogger:t,appVersion:e,templateBundleID:n,pageSessionStorage:r})=>{const i=null!=e?e:"EmbIOAppVersionX.X.X".trim();return new fr({[Ls]:Ao,[ws]:Ao,app_version:i,app_framework:1,bundle_id:null!=n?n:"EmbIOBundleIDfd6996f1007b363f87a",sdk_version:Co,[Rs]:Co,sdk_simple_version:1,sdk_platform:"web",[Os]:"webjs",[Bs]:Io(r,t),[As]:window.navigator.userAgent,screen_resolution:`${window.screen.width}x${window.screen.height}`})})({diagLogger:v,appVersion:e,templateBundleID:n,pageSessionStorage:window.sessionStorage})),O=!!t&&(t=>{if(void 0===t)throw new Error("appID is required when using Embrace exporter");if(5!==t.length)throw new Error("appID should be 5 characters long");return!0})(t);if(!O&&!s.length&&!i.length)throw new Error("when the embrace appID is omitted then at least one logExporter or spanExporter must be set");const w=Lu(),R=w.getEmbraceUserId();if(O&&!R)throw new Error("userID is required when using Embrace exporter");const C=null!=T?T:new _o({appID:t,appVersion:e,embraceConfigURL:f,defaultConfig:S,deviceId:R});C.refreshRemoteConfig();if(!new mo({dynamicConfigManager:C,deviceId:R}).isSDKEnabled())return v.debug("SDK is disabled, skipping initialization."),!1;const A=new Zs(Js),P=Ou({limitManager:A}),I=[...p?bu(g):[],...d],M=wu({sendingToEmbrace:O,appID:t,enduserPseudoID:R,resource:L,spanSessionManager:P,userManager:w,spanExporters:i,spanProcessors:o,propagator:a,contextManager:l,limitManager:A,attributeScrubbers:I,embraceDataURL:m}),N=Ru({sendingToEmbrace:O,appID:t,enduserPseudoID:R,resource:L,userManager:w,logExporters:s,logProcessors:h,spanSessionManager:P,limitManager:A,attributeScrubbers:I,embraceDataURL:m});!function(t){var e,n;const r=t.tracerProvider||re.getTracerProvider(),i=t.meterProvider||Gt.getMeterProvider(),s=t.loggerProvider||Le.getLoggerProvider(),o=null!==(n=null===(e=t.instrumentations)||void 0===e?void 0:e.flat())&&void 0!==n?n:[];(function(t,e,n,r){for(let i=0,s=t.length;i<s;i++){const s=t[i];e&&s.setTracerProvider(e),n&&s.setMeterProvider(n),r&&s.setLoggerProvider&&s.setLoggerProvider(r),s.getConfig().enabled||s.enable()}})(o,r,i,s)}({instrumentations:[...c,gu(u)]}),v.info("successfully initialized the SDK");const x={setDynamicConfig:t=>{C.setConfig(t)},flush:()=>{return(t=function*(){yield M.forceFlush(),yield N.forceFlush()},function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){yu(s,r,i,o,a,"next",t)}function a(t){yu(s,r,i,o,a,"throw",t)}o(void 0)})})();var t}};return vu.register(x),P.recordStartupDuration(E.getNowMillis()-b),x}catch(t){const e=t instanceof Error?t.message:"Unknown error.";return v.error(`failed to initialize the SDK: ${e}`),!1}}});return t.getNavigationInstrumentation=(t={})=>(ja||(ja=new Ba(t)),ja),t.log=i,t.sdk=Cu,t.session=u,t.trace=ue,t.user=pe,t}({});window.EmbraceWebSdk=EmbraceWebSdk;
//# sourceMappingURL=bundle.js.map
