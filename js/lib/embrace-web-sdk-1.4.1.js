/**
 * Skipped minification because the original files appears to be already minified.
 * Original file: /npm/@embrace-io/web-sdk@1.4.1/build/iife/bundle.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var EmbraceWebSdk=function(t){"use strict";const e=new class{logException(t,e){}message(t,e,n){}};class n{getDelegate(){var t;return null!=(t=this._delegate)?t:e}setDelegate(t){this._delegate=t}logException(t,e){this.getDelegate().logException(t,e)}message(t,e,n){this.getDelegate().message(t,e,n)}}class r{static getInstance(){return r._instance||(r._instance=new r({proxyLogManager:new n})),r._instance}setGlobalLogManager(t){this._proxyLogManager.setDelegate(t)}logException(t,e){this.getLogManager().logException(t,e)}message(t,e,n){this.getLogManager().message(t,e,n)}constructor({proxyLogManager:t}){this.getLogManager=()=>this._proxyLogManager,this._proxyLogManager=t}}const s=r.getInstance();const i=new class{addBreadcrumb(t){}addProperty(t,e,n){}removeProperty(t){}endSessionSpan(){}endSessionSpanInternal(){}getSessionSpan(){return null}getSessionStartTime(){return null}startSessionSpan(){}addSessionStartedListener(t){return()=>{}}addSessionEndedListener(t){return()=>{}}constructor(){this.getSessionId=()=>null}};class o{getDelegate(){var t;return null!=(t=this._delegate)?t:i}setDelegate(t){this._delegate=t}addBreadcrumb(t){this.getDelegate().addBreadcrumb(t)}addProperty(t,e,n){this.getDelegate().addProperty(t,e,n)}removeProperty(t){this.getDelegate().removeProperty(t)}endSessionSpan(){this.getDelegate().endSessionSpan()}endSessionSpanInternal(t){this.getDelegate().endSessionSpanInternal(t)}getSessionId(){return this.getDelegate().getSessionId()}getSessionSpan(){return this.getDelegate().getSessionSpan()}getSessionStartTime(){return this.getDelegate().getSessionStartTime()}startSessionSpan(){this.getDelegate().startSessionSpan()}addSessionStartedListener(t){return this.getDelegate().addSessionStartedListener(t)}addSessionEndedListener(t){return this.getDelegate().addSessionEndedListener(t)}}class a{static getInstance(){return a._instance||(a._instance=new a({proxySpanSessionManager:new o})),a._instance}setGlobalSessionManager(t){this._proxySpanSessionManager.setDelegate(t)}addBreadcrumb(t){this.getSpanSessionManager().addBreadcrumb(t)}addProperty(t,e,n){this.getSpanSessionManager().addProperty(t,e,n)}removeProperty(t){this.getSpanSessionManager().removeProperty(t)}endSessionSpan(){this.getSpanSessionManager().endSessionSpan()}endSessionSpanInternal(t){this.getSpanSessionManager().endSessionSpanInternal(t)}getSessionId(){return this.getSpanSessionManager().getSessionId()}getSessionSpan(){return this.getSpanSessionManager().getSessionSpan()}getSessionStartTime(){return this.getSpanSessionManager().getSessionStartTime()}startSessionSpan(){this.getSpanSessionManager().startSessionSpan()}addSessionStartedListener(t){return this.getSpanSessionManager().addSessionStartedListener(t)}addSessionEndedListener(t){return this.getSpanSessionManager().addSessionEndedListener(t)}constructor({proxySpanSessionManager:t}){this.getSpanSessionManager=()=>this._proxySpanSessionManager,this._proxySpanSessionManager=t}}const u=a.getInstance();var c="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},l="1.9.0",d=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var h=function(t){var e=new Set([t]),n=new Set,r=t.match(d);if(!r)return function(){return!1};var s=+r[1],i=+r[2],o=+r[3];if(null!=r[4])return function(e){return e===t};function a(t){return n.add(t),!1}function u(t){return e.add(t),!0}return function(t){if(e.has(t))return!0;if(n.has(t))return!1;var r=t.match(d);if(!r)return a(t);var c=+r[1],l=+r[2],h=+r[3];return null!=r[4]||s!==c?a(t):0===s?i===l&&o<=h?u(t):a(t):i<=l?u(t):a(t)}}(l),p=l.split(".")[0],g=Symbol.for("opentelemetry.js.api."+p),_=c;function f(t,e,n,r){var s;void 0===r&&(r=!1);var i=_[g]=null!==(s=_[g])&&void 0!==s?s:{version:l};if(!r&&i[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(o.stack||o.message),!1}if(i.version!==l){o=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+t+" does not match previously registered API v"+l);return n.error(o.stack||o.message),!1}return i[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+l+"."),!0}function m(t){var e,n,r=null===(e=_[g])||void 0===e?void 0:e.version;if(r&&h(r))return null===(n=_[g])||void 0===n?void 0:n[t]}function v(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+l+".");var n=_[g];n&&delete n[t]}var E,T=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,s,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){s={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o},S=function(t,e,n){if(n||2===arguments.length)for(var r,s=0,i=e.length;s<i;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))},y=function(){function t(t){this._namespace=t.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return b("debug",this._namespace,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return b("error",this._namespace,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return b("info",this._namespace,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return b("warn",this._namespace,t)},t.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return b("verbose",this._namespace,t)},t}();function b(t,e,n){var r=m("diag");if(r)return n.unshift(e),r[t].apply(r,S([],T(n),!1))}!function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"}(E||(E={}));var L=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,s,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){s={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o},O=function(t,e,n){if(n||2===arguments.length)for(var r,s=0,i=e.length;s<i;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))},w=function(){function t(){function t(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=m("diag");if(r)return r[t].apply(r,O([],L(e),!1))}}var e=this;e.setLogger=function(t,n){var r,s,i;if(void 0===n&&(n={logLevel:E.INFO}),t===e){var o=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return e.error(null!==(r=o.stack)&&void 0!==r?r:o.message),!1}"number"==typeof n&&(n={logLevel:n});var a=m("diag"),u=function(t,e){function n(n,r){var s=e[n];return"function"==typeof s&&t>=r?s.bind(e):function(){}}return t<E.NONE?t=E.NONE:t>E.ALL&&(t=E.ALL),e=e||{},{error:n("error",E.ERROR),warn:n("warn",E.WARN),info:n("info",E.INFO),debug:n("debug",E.DEBUG),verbose:n("verbose",E.VERBOSE)}}(null!==(s=n.logLevel)&&void 0!==s?s:E.INFO,t);if(a&&!n.suppressOverrideMessage){var c=null!==(i=(new Error).stack)&&void 0!==i?i:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),u.warn("Current logger will overwrite one already registered from "+c)}return f("diag",u,e,!0)},e.disable=function(){v("diag",e)},e.createComponentLogger=function(t){return new y(t)},e.verbose=t("verbose"),e.debug=t("debug"),e.info=t("info"),e.warn=t("warn"),e.error=t("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),R=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,s,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){s={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o},A=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},P=function(){function t(t){this._entries=t?new Map(t):new Map}return t.prototype.getEntry=function(t){var e=this._entries.get(t);if(e)return Object.assign({},e)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(t){var e=R(t,2);return[e[0],e[1]]})},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e,n,r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var i=new t(this._entries);try{for(var o=A(r),a=o.next();!a.done;a=o.next()){var u=a.value;i._entries.delete(u)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i},t.prototype.clear=function(){return new t},t}(),C=Symbol("BaggageEntryMetadata"),I=w.instance();function N(t){return void 0===t&&(t={}),new P(new Map(Object.entries(t)))}function x(t){return Symbol.for(t)}var M,D,U=function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(t){return n._currentContext.get(t)},n.setValue=function(e,r){var s=new t(n._currentContext);return s._currentContext.set(e,r),s},n.deleteValue=function(e){var r=new t(n._currentContext);return r._currentContext.delete(e),r}},k=new U,F=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],B=function(){function t(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(console){var r=console[t];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,e)}}}for(var e=0;e<F.length;e++)this[F[e].n]=t(F[e].c)},j=(M=function(t,e){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},M(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}M(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),H=function(){function t(){}return t.prototype.createGauge=function(t,e){return J},t.prototype.createHistogram=function(t,e){return tt},t.prototype.createCounter=function(t,e){return Z},t.prototype.createUpDownCounter=function(t,e){return et},t.prototype.createObservableGauge=function(t,e){return rt},t.prototype.createObservableCounter=function(t,e){return nt},t.prototype.createObservableUpDownCounter=function(t,e){return st},t.prototype.addBatchObservableCallback=function(t,e){},t.prototype.removeBatchObservableCallback=function(t){},t}(),V=function(){},G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.add=function(t,e){},e}(V),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.add=function(t,e){},e}(V),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.record=function(t,e){},e}(V),$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.record=function(t,e){},e}(V),q=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.removeCallback=function(t){},t}(),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e}(q),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e}(q),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e}(q),Y=new H,Z=new G,J=new z,tt=new $,et=new X,nt=new W,rt=new K,st=new Q,it={get:function(t,e){if(null!=t)return t[e]},keys:function(t){return null==t?[]:Object.keys(t)}},ot={set:function(t,e,n){null!=t&&(t[e]=n)}},at=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,s,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){s={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o},ut=function(t,e,n){if(n||2===arguments.length)for(var r,s=0,i=e.length;s<i;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))},ct=function(){function t(){}return t.prototype.active=function(){return k},t.prototype.with=function(t,e,n){for(var r=[],s=3;s<arguments.length;s++)r[s-3]=arguments[s];return e.call.apply(e,ut([n],at(r),!1))},t.prototype.bind=function(t,e){return e},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),lt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,s,i=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(t){s={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o},dt=function(t,e,n){if(n||2===arguments.length)for(var r,s=0,i=e.length;s<i;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))},ht="context",pt=new ct,gt=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(t){return f(ht,t,w.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(t,e,n){for(var r,s=[],i=3;i<arguments.length;i++)s[i-3]=arguments[i];return(r=this._getContextManager()).with.apply(r,dt([t,e,n],lt(s),!1))},t.prototype.bind=function(t,e){return this._getContextManager().bind(t,e)},t.prototype._getContextManager=function(){return m(ht)||pt},t.prototype.disable=function(){this._getContextManager().disable(),v(ht,w.instance())},t}();!function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"}(D||(D={}));var _t="0000000000000000",ft="00000000000000000000000000000000",mt={traceId:ft,spanId:_t,traceFlags:D.NONE},vt=function(){function t(t){void 0===t&&(t=mt),this._spanContext=t}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(t,e){return this},t.prototype.setAttributes=function(t){return this},t.prototype.addEvent=function(t,e){return this},t.prototype.addLink=function(t){return this},t.prototype.addLinks=function(t){return this},t.prototype.setStatus=function(t){return this},t.prototype.updateName=function(t){return this},t.prototype.end=function(t){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(t,e){},t}(),Et=x("OpenTelemetry Context Key SPAN");function Tt(t){return t.getValue(Et)||void 0}function St(){return Tt(gt.getInstance().active())}function yt(t,e){return t.setValue(Et,e)}function bt(t){return t.deleteValue(Et)}function Lt(t,e){return yt(t,new vt(e))}function Ot(t){var e;return null===(e=Tt(t))||void 0===e?void 0:e.spanContext()}var wt=/^([0-9a-f]{32})$/i,Rt=/^[0-9a-f]{16}$/i;function At(t){return wt.test(t)&&t!==ft}function Pt(t){return At(t.traceId)&&(e=t.spanId,Rt.test(e)&&e!==_t);var e}function Ct(t){return new vt(t)}var It=gt.getInstance(),Nt=function(){function t(){}return t.prototype.startSpan=function(t,e,n){if(void 0===n&&(n=It.active()),Boolean(null==e?void 0:e.root))return new vt;var r,s=n&&Ot(n);return"object"==typeof(r=s)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&Pt(s)?new vt(s):new vt},t.prototype.startActiveSpan=function(t,e,n,r){var s,i,o;if(!(arguments.length<2)){2===arguments.length?o=e:3===arguments.length?(s=e,o=n):(s=e,i=n,o=r);var a=null!=i?i:It.active(),u=this.startSpan(t,s,a),c=yt(a,u);return It.with(c,o,void 0,u)}},t}();var xt,Mt,Dt,Ut=new Nt,kt=function(){function t(t,e,n,r){this._provider=t,this.name=e,this.version=n,this.options=r}return t.prototype.startSpan=function(t,e,n){return this._getTracer().startSpan(t,e,n)},t.prototype.startActiveSpan=function(t,e,n,r){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Ut},t}(),Ft=new(function(){function t(){}return t.prototype.getTracer=function(t,e,n){return new Nt},t}()),Bt=function(){function t(){}return t.prototype.getTracer=function(t,e,n){var r;return null!==(r=this.getDelegateTracer(t,e,n))&&void 0!==r?r:new kt(this,t,e,n)},t.prototype.getDelegate=function(){var t;return null!==(t=this._delegate)&&void 0!==t?t:Ft},t.prototype.setDelegate=function(t){this._delegate=t},t.prototype.getDelegateTracer=function(t,e,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(t,e,n)},t}();!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(xt||(xt={})),function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"}(Mt||(Mt={})),function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"}(Dt||(Dt={}));var jt=gt.getInstance(),Ht=w.instance(),Vt=new(function(){function t(){}return t.prototype.getMeter=function(t,e,n){return Y},t}()),Gt="metrics",Xt=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(t){return f(Gt,t,w.instance())},t.prototype.getMeterProvider=function(){return m(Gt)||Vt},t.prototype.getMeter=function(t,e,n){return this.getMeterProvider().getMeter(t,e,n)},t.prototype.disable=function(){v(Gt,w.instance())},t}().getInstance(),zt=function(){function t(){}return t.prototype.inject=function(t,e){},t.prototype.extract=function(t,e){return t},t.prototype.fields=function(){return[]},t}(),$t=x("OpenTelemetry Baggage Key");function qt(t){return t.getValue($t)||void 0}function Wt(){return qt(gt.getInstance().active())}function Kt(t,e){return t.setValue($t,e)}function Qt(t){return t.deleteValue($t)}var Yt="propagation",Zt=new zt,Jt=function(){function t(){this.createBaggage=N,this.getBaggage=qt,this.getActiveBaggage=Wt,this.setBaggage=Kt,this.deleteBaggage=Qt}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(t){return f(Yt,t,w.instance())},t.prototype.inject=function(t,e,n){return void 0===n&&(n=ot),this._getGlobalPropagator().inject(t,e,n)},t.prototype.extract=function(t,e,n){return void 0===n&&(n=it),this._getGlobalPropagator().extract(t,e,n)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){v(Yt,w.instance())},t.prototype._getGlobalPropagator=function(){return m(Yt)||Zt},t}(),te=Jt.getInstance(),ee="trace",ne=function(){function t(){this._proxyTracerProvider=new Bt,this.wrapSpanContext=Ct,this.isSpanContextValid=Pt,this.deleteSpan=bt,this.getSpan=Tt,this.getActiveSpan=St,this.getSpanContext=Ot,this.setSpan=yt,this.setSpanContext=Lt}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(t){var e=f(ee,this._proxyTracerProvider,w.instance());return e&&this._proxyTracerProvider.setDelegate(t),e},t.prototype.getTracerProvider=function(){return m(ee)||this._proxyTracerProvider},t.prototype.getTracer=function(t,e){return this.getTracerProvider().getTracer(t,e)},t.prototype.disable=function(){v(ee,w.instance()),this._proxyTracerProvider=new Bt},t}(),re=ne.getInstance();class se{fail(t){}spanContext(){return this._spanContext}setAttribute(t,e){return this}setAttributes(t){return this}removeAttribute(t){return this}addEvent(t,e,n){return this}addLink(t){return this}addLinks(t){return this}setStatus(t){return this}updateName(t){return this}end(t){}isRecording(){return!1}recordException(t,e){}constructor(t=mt){this.attributes={},this._spanContext=t}}const ie=new class{startSpan(t,e){return new se}setSpan(t,e){return k}getSpan(t){}};class oe{getDelegate(){var t;return null!=(t=this._delegate)?t:ie}setDelegate(t){this._delegate=t}startSpan(t,e,n){return this.getDelegate().startSpan(t,e,n)}setSpan(t,e){return this.getDelegate().setSpan(t,e)}getSpan(t){return this.getDelegate().getSpan(t)}}class ae{static getInstance(){return ae._instance||(ae._instance=new ae({proxyTraceManager:new oe})),ae._instance}setGlobalTraceManager(t){this._proxyTraceManager.setDelegate(t)}startSpan(t,e,n){return this.getTraceManager().startSpan(t,e,n)}setSpan(t,e){return this.getTraceManager().setSpan(t,e)}getSpan(t){return this.getTraceManager().getSpan(t)}constructor({proxyTraceManager:t}){this.getTraceManager=()=>this._proxyTraceManager,this._proxyTraceManager=t}}const ue=ae.getInstance(),ce="enduser.pseudo.id";const le=new class{getEmbraceUserId(){return""}getUserId(){return null}setUserId(){}clearUserId(){}};class de{getDelegate(){var t;return null!=(t=this._delegate)?t:le}setDelegate(t){this._delegate=t}getEmbraceUserId(){return this.getDelegate().getEmbraceUserId()}getUserId(){return this.getDelegate().getUserId()}setUserId(t){this.getDelegate().setUserId(t)}clearUserId(){this.getDelegate().clearUserId()}}class he{static getInstance(){return he._instance||(he._instance=new he({proxyUserManager:new de})),he._instance}getUserManager(){return this._proxyUserManager}setGlobalUserManager(t){this._proxyUserManager.setDelegate(t)}getEmbraceUserId(){return this.getUserManager().getEmbraceUserId()}getUserId(){return this.getUserManager().getUserId()}setUserId(t){this.getUserManager().setUserId(t)}clearUserId(){this.getUserManager().clearUserId()}constructor({proxyUserManager:t}){this._proxyUserManager=t}}const pe=he.getInstance();var ge;!function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.TRACE=1]="TRACE",t[t.TRACE2=2]="TRACE2",t[t.TRACE3=3]="TRACE3",t[t.TRACE4=4]="TRACE4",t[t.DEBUG=5]="DEBUG",t[t.DEBUG2=6]="DEBUG2",t[t.DEBUG3=7]="DEBUG3",t[t.DEBUG4=8]="DEBUG4",t[t.INFO=9]="INFO",t[t.INFO2=10]="INFO2",t[t.INFO3=11]="INFO3",t[t.INFO4=12]="INFO4",t[t.WARN=13]="WARN",t[t.WARN2=14]="WARN2",t[t.WARN3=15]="WARN3",t[t.WARN4=16]="WARN4",t[t.ERROR=17]="ERROR",t[t.ERROR2=18]="ERROR2",t[t.ERROR3=19]="ERROR3",t[t.ERROR4=20]="ERROR4",t[t.FATAL=21]="FATAL",t[t.FATAL2=22]="FATAL2",t[t.FATAL3=23]="FATAL3",t[t.FATAL4=24]="FATAL4"}(ge||(ge={}));class _e{emit(t){}}const fe=new _e;const me=new class{getLogger(t,e,n){return new _e}};class ve{emit(t){this._getLogger().emit(t)}_getLogger(){if(this._delegate)return this._delegate;const t=this._provider.getDelegateLogger(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):fe}constructor(t,e,n,r){this._provider=t,this.name=e,this.version=n,this.options=r}}class Ee{getLogger(t,e,n){var r;return null!==(r=this.getDelegateLogger(t,e,n))&&void 0!==r?r:new ve(this,t,e,n)}getDelegate(){var t;return null!==(t=this._delegate)&&void 0!==t?t:me}setDelegate(t){this._delegate=t}getDelegateLogger(t,e,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getLogger(t,e,n)}}const Te="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},Se=Symbol.for("io.opentelemetry.js.api.logs"),ye=Te;class be{static getInstance(){return this._instance||(this._instance=new be),this._instance}setGlobalLoggerProvider(t){return ye[Se]?this.getLoggerProvider():(ye[Se]=(e=1,n=t,r=me,t=>t===e?n:r),this._proxyLoggerProvider.setDelegate(t),t);var e,n,r}getLoggerProvider(){var t,e;return null!==(e=null===(t=ye[Se])||void 0===t?void 0:t.call(ye,1))&&void 0!==e?e:this._proxyLoggerProvider}getLogger(t,e,n){return this.getLoggerProvider().getLogger(t,e,n)}disable(){delete ye[Se],this._proxyLoggerProvider=new Ee}constructor(){this._proxyLoggerProvider=new Ee}}const Le=be.getInstance();var Oe,we;var Re=function(){if(we)return Oe;function t(t){return"function"==typeof t}we=1;var e=console.error.bind(console);function n(t,e,n){var r=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:r,writable:!0,value:n})}function r(n){n&&n.logger&&(t(n.logger)?e=n.logger:e("new logger isn't a function, not replacing"))}function s(r,s,i){if(r&&r[s]){if(!i)return e("no wrapper function"),void e((new Error).stack);if(t(r[s])&&t(i)){var o=r[s],a=i(o,s);return n(a,"__original",o),n(a,"__unwrap",function(){r[s]===a&&n(r,s,o)}),n(a,"__wrapped",!0),n(r,s,a),a}e("original object and wrapper must be functions")}else e("no original function "+s+" to wrap")}function i(t,n){return t&&t[n]?t[n].__unwrap?t[n].__unwrap():void e("no original to unwrap to -- has "+n+" already been unwrapped?"):(e("no function to unwrap."),void e((new Error).stack))}return r.wrap=s,r.massWrap=function(t,n,r){if(!t)return e("must provide one or more modules to patch"),void e((new Error).stack);Array.isArray(t)||(t=[t]),n&&Array.isArray(n)?t.forEach(function(t){n.forEach(function(e){s(t,e,r)})}):e("must provide one or more functions to wrap on modules")},r.unwrap=i,r.massUnwrap=function(t,n){if(!t)return e("must provide one or more modules to patch"),void e((new Error).stack);Array.isArray(t)||(t=[t]),n&&Array.isArray(n)?t.forEach(function(t){n.forEach(function(e){i(t,e)})}):e("must provide one or more functions to unwrap on modules")},Oe=r}();let Ae=class{get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){var t;const e=null!==(t=this.init())&&void 0!==t?t:[];return Array.isArray(e)?e:[e]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t){this._config=Object.assign({enabled:!0},t)}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(t,e,n,r){if(t)try{t(n,r)}catch(t){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:e},t)}}constructor(t,e,n){this.instrumentationName=t,this.instrumentationVersion=e,this._config={},this._wrap=Re.wrap,this._unwrap=Re.unwrap,this._massWrap=Re.massWrap,this._massUnwrap=Re.massUnwrap,this.setConfig(n),this._diag=Ht.createComponentLogger({namespace:t}),this._tracer=re.getTracer(t,e),this._meter=Xt.getMeter(t,e),this._logger=Le.getLogger(t,e),this._updateMetricInstruments()}};class Pe extends Ae{constructor(t,e,n){super(t,e,n),this._config.enabled&&this.enable()}}function Ce(t,e,n){let r,s;try{s=t()}catch(t){r=t}finally{return e(r,s),s}}function Ie(t){return"function"==typeof t&&"function"==typeof t.__original&&"function"==typeof t.__unwrap&&!0===t.__wrapped}var Ne="service.name",xe="telemetry.sdk.name",Me="telemetry.sdk.language",De="telemetry.sdk.version";const Ue=x("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function ke(t){return t.setValue(Ue,!0)}function Fe(t){return!0===t.getValue(Ue)}const Be="baggage";function je(t){const e=t.split(";");if(e.length<=0)return;const n=e.shift();if(!n)return;const r=n.indexOf("=");if(r<=0)return;const s=decodeURIComponent(n.substring(0,r).trim()),i=decodeURIComponent(n.substring(r+1).trim());let o;var a;return e.length>0&&("string"!=typeof(a=e.join(";"))&&(I.error("Cannot create baggage metadata from unknown type: "+typeof a),a=""),o={__TYPE__:C,toString:function(){return a}}),{key:s,value:i,metadata:o}}class He{inject(t,e,n){const r=te.getBaggage(t);if(!r||Fe(t))return;const s=function(t){return t.getAllEntries().map(([t,e])=>{let n=`${encodeURIComponent(t)}=${encodeURIComponent(e.value)}`;return void 0!==e.metadata&&(n+=";"+e.metadata.toString()),n})}(r).filter(t=>t.length<=4096).slice(0,180),i=function(t){return t.reduce((t,e)=>{const n=`${t}${""!==t?",":""}${e}`;return n.length>8192?t:n},"")}(s);i.length>0&&n.set(e,Be,i)}extract(t,e,n){const r=n.get(e,Be),s=Array.isArray(r)?r.join(","):r;if(!s)return t;const i={};if(0===s.length)return t;return s.split(",").forEach(t=>{const e=je(t);if(e){const t={value:e.value};e.metadata&&(t.metadata=e.metadata),i[e.key]=t}}),0===Object.entries(i).length?t:te.setBaggage(t,te.createBaggage(i))}fields(){return[Be]}}function Ve(t){const e={};if("object"!=typeof t||null==t)return e;for(const[n,r]of Object.entries(t))Ge(n)?Xe(r)?Array.isArray(r)?e[n]=r.slice():e[n]=r:Ht.warn(`Invalid attribute value set for key: ${n}`):Ht.warn(`Invalid attribute key: ${n}`);return e}function Ge(t){return"string"==typeof t&&t.length>0}function Xe(t){return null==t||(Array.isArray(t)?function(t){let e;for(const n of t)if(null!=n){if(!e){if(ze(n)){e=typeof n;continue}return!1}if(typeof n!==e)return!1}return!0}(t):ze(t))}function ze(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}let $e=t=>{Ht.error(function(t){return"string"==typeof t?t:JSON.stringify(function(t){const e={};let n=t;for(;null!==n;)Object.getOwnPropertyNames(n).forEach(t=>{if(e[t])return;const r=n[t];r&&(e[t]=String(r))}),n=Object.getPrototypeOf(n);return e}(t))}(t))};function qe(t){try{$e(t)}catch(t){}}var We;!function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"}(We||(We={}));const Ke=["OTEL_SDK_DISABLED"];function Qe(t){return Ke.indexOf(t)>-1}const Ye=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Ze(t){return Ye.indexOf(t)>-1}const Je=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS","OTEL_SEMCONV_STABILITY_OPT_IN"];function tn(t){return Je.indexOf(t)>-1}const en=1/0,nn=128,rn={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:E.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:en,OTEL_ATTRIBUTE_COUNT_LIMIT:nn,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:en,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:nn,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:en,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:nn,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:We.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative",OTEL_SEMCONV_STABILITY_OPT_IN:[]};function sn(t,e,n){if(void 0===n[t])return;const r=String(n[t]);e[t]="true"===r.toLowerCase()}function on(t,e,n,r=-1/0,s=1/0){if(void 0!==n[t]){const i=Number(n[t]);isNaN(i)||(e[t]=i<r?r:i>s?s:i)}}function an(t,e,n,r=","){const s=n[t];"string"==typeof s&&(e[t]=s.split(r).map(t=>t.trim()))}const un={ALL:E.ALL,VERBOSE:E.VERBOSE,DEBUG:E.DEBUG,INFO:E.INFO,WARN:E.WARN,ERROR:E.ERROR,NONE:E.NONE};function cn(t,e,n){const r=n[t];if("string"==typeof r){const n=un[r.toUpperCase()];null!=n&&(e[t]=n)}}function ln(t){const e={};for(const n in rn){const r=n;if("OTEL_LOG_LEVEL"===r)cn(r,e,t);else if(Qe(r))sn(r,e,t);else if(Ze(r))on(r,e,t);else if(tn(r))an(r,e,t);else{const n=t[r];null!=n&&(e[r]=String(n))}}return e}const dn="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{};function hn(){const t=ln(dn);return Object.assign({},rn,t)}function pn(){return ln(dn)}function gn(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function _n(t){const e=new Uint8Array(t.length/2);let n=0;for(let r=0;r<t.length;r+=2){const s=gn(t.charCodeAt(r)),i=gn(t.charCodeAt(r+1));e[n++]=s<<4|i}return e}const fn=performance;var mn="process.runtime.name",vn="telemetry.sdk.name",En="telemetry.sdk.language",Tn="telemetry.sdk.version";const Sn={[vn]:"opentelemetry",[mn]:"browser",[En]:"webjs",[Tn]:"1.30.1"};const yn=Math.pow(10,6),bn=Math.pow(10,9);function Ln(t){const e=t/1e3;return[Math.trunc(e),Math.round(t%1e3*yn)]}function On(){let t=fn.timeOrigin;if("number"!=typeof t){const e=fn;t=e.timing&&e.timing.fetchStart}return t}function wn(t){return Nn(Ln(On()),Ln("number"==typeof t?t:fn.now()))}function Rn(t){if(Cn(t))return t;if("number"==typeof t)return t<On()?wn(t):Ln(t);if(t instanceof Date)return Ln(t.getTime());throw TypeError("Invalid input type")}function An(t){return t[0]*bn+t[1]}function Pn(t){return 1e3*t[0]+t[1]/1e6}function Cn(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}function In(t){return Cn(t)||"number"==typeof t||t instanceof Date}function Nn(t,e){const n=[t[0]+e[0],t[1]+e[1]];return n[1]>=bn&&(n[1]-=bn,n[0]+=1),n}var xn;!function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"}(xn||(xn={}));class Mn{inject(t,e,n){for(const r of this._propagators)try{r.inject(t,e,n)}catch(t){Ht.warn(`Failed to inject with ${r.constructor.name}. Err: ${t.message}`)}}extract(t,e,n){return this._propagators.reduce((t,r)=>{try{return r.extract(t,e,n)}catch(t){Ht.warn(`Failed to extract with ${r.constructor.name}. Err: ${t.message}`)}return t},t)}fields(){return this._fields.slice()}constructor(t={}){var e;this._propagators=null!==(e=t.propagators)&&void 0!==e?e:[],this._fields=Array.from(new Set(this._propagators.map(t=>"function"==typeof t.fields?t.fields():[]).reduce((t,e)=>t.concat(e),[])))}}const Dn="[_0-9a-z-*/]",Un=new RegExp(`^(?:${`[a-z]${Dn}{0,255}`}|${`[a-z0-9]${Dn}{0,240}@[a-z]${Dn}{0,13}`})$`),kn=/^[ -~]{0,255}[!-~]$/,Fn=/,|=/;class Bn{set(t,e){const n=this._clone();return n._internalState.has(t)&&n._internalState.delete(t),n._internalState.set(t,e),n}unset(t){const e=this._clone();return e._internalState.delete(t),e}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce((t,e)=>(t.push(e+"="+this.get(e)),t),[]).join(",")}_parse(t){t.length>512||(this._internalState=t.split(",").reverse().reduce((t,e)=>{const n=e.trim(),r=n.indexOf("=");if(-1!==r){const s=n.slice(0,r),i=n.slice(r+1,e.length);(function(t){return Un.test(t)})(s)&&function(t){return kn.test(t)&&!Fn.test(t)}(i)&&t.set(s,i)}return t},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new Bn;return t._internalState=new Map(this._internalState),t}constructor(t){this._internalState=new Map,t&&this._parse(t)}}const jn="traceparent",Hn="tracestate",Vn=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");class Gn{inject(t,e,n){const r=re.getSpanContext(t);if(!r||Fe(t)||!Pt(r))return;const s=`00-${r.traceId}-${r.spanId}-0${Number(r.traceFlags||D.NONE).toString(16)}`;n.set(e,jn,s),r.traceState&&n.set(e,Hn,r.traceState.serialize())}extract(t,e,n){const r=n.get(e,jn);if(!r)return t;const s=Array.isArray(r)?r[0]:r;if("string"!=typeof s)return t;const i=function(t){const e=Vn.exec(t);return e?"00"===e[1]&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}:null}(s);if(!i)return t;i.isRemote=!0;const o=n.get(e,Hn);if(o){const t=Array.isArray(o)?o.join(","):o;i.traceState=new Bn("string"==typeof t?t:void 0)}return re.setSpanContext(t,i)}fields(){return[jn,Hn]}}const Xn="[object Null]",zn="[object Undefined]",$n=Function.prototype.toString,qn=$n.call(Object),Wn=(Kn=Object.getPrototypeOf,Qn=Object,function(t){return Kn(Qn(t))});var Kn,Qn;const Yn=Object.prototype,Zn=Yn.hasOwnProperty,Jn=Symbol?Symbol.toStringTag:void 0,tr=Yn.toString;function er(t){if(!function(t){return null!=t&&"object"==typeof t}(t)||"[object Object]"!==function(t){if(null==t)return void 0===t?zn:Xn;return Jn&&Jn in Object(t)?function(t){const e=Zn.call(t,Jn),n=t[Jn];let r=!1;try{t[Jn]=void 0,r=!0}catch(t){}const s=tr.call(t);r&&(e?t[Jn]=n:delete t[Jn]);return s}(t):function(t){return tr.call(t)}(t)}(t))return!1;const e=Wn(t);if(null===e)return!0;const n=Zn.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&$n.call(n)===qn}function nr(...t){let e=t.shift();const n=new WeakMap;for(;t.length>0;)e=sr(e,t.shift(),0,n);return e}function rr(t){return or(t)?t.slice():t}function sr(t,e,n=0,r){let s;if(!(n>20)){if(n++,cr(t)||cr(e)||ar(e))s=rr(e);else if(or(t)){if(s=t.slice(),or(e))for(let t=0,n=e.length;t<n;t++)s.push(rr(e[t]));else if(ur(e)){const t=Object.keys(e);for(let n=0,r=t.length;n<r;n++){const r=t[n];s[r]=rr(e[r])}}}else if(ur(t))if(ur(e)){if(!function(t,e){if(!er(t)||!er(e))return!1;return!0}(t,e))return e;s=Object.assign({},t);const i=Object.keys(e);for(let o=0,a=i.length;o<a;o++){const a=i[o],u=e[a];if(cr(u))void 0===u?delete s[a]:s[a]=u;else{const i=s[a],o=u;if(ir(t,a,r)||ir(e,a,r))delete s[a];else{if(ur(i)&&ur(o)){const n=r.get(i)||[],s=r.get(o)||[];n.push({obj:t,key:a}),s.push({obj:e,key:a}),r.set(i,n),r.set(o,s)}s[a]=sr(s[a],u,n,r)}}}}else s=e;return s}}function ir(t,e,n){const r=n.get(t[e])||[];for(let n=0,s=r.length;n<s;n++){const s=r[n];if(s.key===e&&s.obj===t)return!0}return!1}function or(t){return Array.isArray(t)}function ar(t){return"function"==typeof t}function ur(t){return!cr(t)&&!or(t)&&!ar(t)&&"object"==typeof t}function cr(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||void 0===t||t instanceof Date||t instanceof RegExp||null===t}class lr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,lr.prototype)}}function dr(t,e){let n;const r=new Promise(function(t,r){n=setTimeout(function(){r(new lr("Operation timed out."))},e)});return Promise.race([t,r]).then(t=>(clearTimeout(n),t),t=>{throw clearTimeout(n),t})}function hr(t,e){return"string"==typeof e?t===e:!!t.match(e)}function pr(t,e){if(!e)return!1;for(const n of e)if(hr(t,n))return!0;return!1}class gr{get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}constructor(){this._promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}}class _r{get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then(t=>this._deferred.resolve(t),t=>this._deferred.reject(t))}catch(t){this._deferred.reject(t)}}return this._deferred.promise}constructor(t,e){this._callback=t,this._that=e,this._isCalled=!1,this._deferred=new gr}}const fr={_export:function(t,e){return new Promise(n=>{jt.with(ke(jt.active()),()=>{t.export(e,t=>{n(t)})})})}};function mr(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}class vr{static empty(){return vr.EMPTY}static default(){return new vr({[Ne]:"unknown_service",[Me]:Sn[Me],[xe]:Sn[xe],[De]:Sn[De]})}get attributes(){var t;return this.asyncAttributesPending&&Ht.error("Accessing resource attributes before async attributes settled"),null!==(t=this._attributes)&&void 0!==t?t:{}}waitForAsyncAttributes(){return(t=function*(){this.asyncAttributesPending&&(yield this._asyncAttributesPromise)},function(){var e=this,n=arguments;return new Promise(function(r,s){var i=t.apply(e,n);function o(t){mr(i,r,s,o,a,"next",t)}function a(t){mr(i,r,s,o,a,"throw",t)}o(void 0)})}).call(this);var t}merge(t){var e;if(!t)return this;const n=Object.assign(Object.assign({},this._syncAttributes),null!==(e=t._syncAttributes)&&void 0!==e?e:t.attributes);if(!this._asyncAttributesPromise&&!t._asyncAttributesPromise)return new vr(n);const r=Promise.all([this._asyncAttributesPromise,t._asyncAttributesPromise]).then(([e,n])=>{var r;return Object.assign(Object.assign(Object.assign(Object.assign({},this._syncAttributes),e),null!==(r=t._syncAttributes)&&void 0!==r?r:t.attributes),n)});return new vr(n,r)}constructor(t,e){var n;this._attributes=t,this.asyncAttributesPending=null!=e,this._syncAttributes=null!==(n=this._attributes)&&void 0!==n?n:{},this._asyncAttributesPromise=null==e?void 0:e.then(t=>(this._attributes=Object.assign({},this._attributes,t),this.asyncAttributesPending=!1,t),t=>(Ht.debug("a resource's async attributes promise rejected: %s",t),this.asyncAttributesPending=!1,{}))}}vr.EMPTY=new vr({});function Er(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}const Tr=(t={})=>{var e;const n=(null!==(e=t.detectors)&&void 0!==e?e:[]).map(e=>{try{const r=e.detect(t);let s;if(null!==(n=r)&&"object"==typeof n&&"function"==typeof n.then){const t=()=>{return(t=function*(){var t;const e=yield r;return yield null===(t=e.waitForAsyncAttributes)||void 0===t?void 0:t.call(e),e.attributes},function(){var e=this,n=arguments;return new Promise(function(r,s){var i=t.apply(e,n);function o(t){Er(i,r,s,o,a,"next",t)}function a(t){Er(i,r,s,o,a,"throw",t)}o(void 0)})})();var t};s=new vr({},t())}else s=r;return s.waitForAsyncAttributes?s.waitForAsyncAttributes().then(()=>Ht.debug(`${e.constructor.name} found resource.`,s)):Ht.debug(`${e.constructor.name} found resource.`,s),s}catch(t){return Ht.error(`${e.constructor.name} failed: ${t.message}`),vr.empty()}var n}),r=n.reduce((t,e)=>t.merge(e),vr.empty());return r.waitForAsyncAttributes&&r.waitForAsyncAttributes().then(()=>{Sr(n)}),r},Sr=t=>{t.forEach(t=>{if(Object.keys(t.attributes).length>0){const e=JSON.stringify(t.attributes,null,4);Ht.verbose(e)}})};class yr{set severityText(t){this._isLogRecordReadonly()||(this._severityText=t)}get severityText(){return this._severityText}set severityNumber(t){this._isLogRecordReadonly()||(this._severityNumber=t)}get severityNumber(){return this._severityNumber}set body(t){this._isLogRecordReadonly()||(this._body=t)}get body(){return this._body}get droppedAttributesCount(){return this.totalAttributesCount-Object.keys(this.attributes).length}setAttribute(t,e){return this._isLogRecordReadonly()||null===e?this:0===t.length?(Ht.warn(`Invalid attribute key: ${t}`),this):Xe(e)||"object"==typeof e&&!Array.isArray(e)&&Object.keys(e).length>0?(this.totalAttributesCount+=1,Object.keys(this.attributes).length>=this._logRecordLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(1===this.droppedAttributesCount&&Ht.warn("Dropping extra attributes."),this):(Xe(e)?this.attributes[t]=this._truncateToSize(e):this.attributes[t]=e,this)):(Ht.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,n]of Object.entries(t))this.setAttribute(e,n);return this}setBody(t){return this.body=t,this}setSeverityNumber(t){return this.severityNumber=t,this}setSeverityText(t){return this.severityText=t,this}_makeReadonly(){this._isReadonly=!0}_truncateToSize(t){const e=this._logRecordLimits.attributeValueLengthLimit;return e<=0?(Ht.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map(t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t):t}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substring(0,e)}_isLogRecordReadonly(){return this._isReadonly&&Ht.warn("Can not execute the operation on emitted log record"),this._isReadonly}constructor(t,e,n){this.attributes={},this.totalAttributesCount=0,this._isReadonly=!1;const{timestamp:r,observedTimestamp:s,severityNumber:i,severityText:o,body:a,attributes:u={},context:c}=n,l=Date.now();if(this.hrTime=Rn(null!=r?r:l),this.hrTimeObserved=Rn(null!=s?s:l),c){const t=re.getSpanContext(c);t&&Pt(t)&&(this.spanContext=t)}this.severityNumber=i,this.severityText=o,this.body=a,this.resource=t.resource,this.instrumentationScope=e,this._logRecordLimits=t.logRecordLimits,this.setAttributes(u)}}class br{emit(t){const e=t.context||jt.active(),n=new yr(this._sharedState,this.instrumentationScope,Object.assign({context:e},t));this._sharedState.activeProcessor.onEmit(n,e),n._makeReadonly()}constructor(t,e){this.instrumentationScope=t,this._sharedState=e}}function Lr(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}function Or(t){return function(){var e=this,n=arguments;return new Promise(function(r,s){var i=t.apply(e,n);function o(t){Lr(i,r,s,o,a,"next",t)}function a(t){Lr(i,r,s,o,a,"throw",t)}o(void 0)})}}class wr{forceFlush(){return Or(function*(){const t=this.forceFlushTimeoutMillis;yield Promise.all(this.processors.map(e=>dr(e.forceFlush(),t)))}).call(this)}onEmit(t,e){this.processors.forEach(n=>n.onEmit(t,e))}shutdown(){return Or(function*(){yield Promise.all(this.processors.map(t=>t.shutdown()))}).call(this)}constructor(t,e){this.processors=t,this.forceFlushTimeoutMillis=e}}class Rr{forceFlush(){return Promise.resolve()}onEmit(t,e){}shutdown(){return Promise.resolve()}}class Ar{constructor(t,e,n){this.resource=t,this.forceFlushTimeoutMillis=e,this.logRecordLimits=n,this.loggers=new Map,this.registeredLogRecordProcessors=[],this.activeProcessor=new Rr}}class Pr{getLogger(t,e,n){if(this._shutdownOnce.isCalled)return Ht.warn("A shutdown LoggerProvider cannot provide a Logger"),fe;t||Ht.warn("Logger requested without instrumentation scope name.");const r=t||"unknown",s=`${r}@${e||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._sharedState.loggers.has(s)||this._sharedState.loggers.set(s,new br({name:r,version:e,schemaUrl:null==n?void 0:n.schemaUrl},this._sharedState)),this._sharedState.loggers.get(s)}addLogRecordProcessor(t){0===this._sharedState.registeredLogRecordProcessors.length&&this._sharedState.activeProcessor.shutdown().catch(t=>Ht.error("Error while trying to shutdown current log record processor",t)),this._sharedState.registeredLogRecordProcessors.push(t),this._sharedState.activeProcessor=new wr(this._sharedState.registeredLogRecordProcessors,this._sharedState.forceFlushTimeoutMillis)}forceFlush(){return this._shutdownOnce.isCalled?(Ht.warn("invalid attempt to force flush after LoggerProvider shutdown"),this._shutdownOnce.promise):this._sharedState.activeProcessor.forceFlush()}shutdown(){return this._shutdownOnce.isCalled?(Ht.warn("shutdown may only be called once per LoggerProvider"),this._shutdownOnce.promise):this._shutdownOnce.call()}_shutdown(){return this._sharedState.activeProcessor.shutdown()}constructor(t={}){const e=nr({},{forceFlushTimeoutMillis:3e4,logRecordLimits:{attributeValueLengthLimit:hn().OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:hn().OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT},includeTraceContext:!0,mergeResourceWithDefaults:!0},t),n=function(t,e){const n=null!=e?e:vr.empty();return t?vr.default().merge(n):n}(e.mergeResourceWithDefaults,t.resource);this._sharedState=new Ar(n,e.forceFlushTimeoutMillis,function(t){var e,n,r,s,i,o;const a=pn();return{attributeCountLimit:null!==(r=null!==(n=null!==(e=t.attributeCountLimit)&&void 0!==e?e:a.OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT)&&void 0!==n?n:a.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==r?r:nn,attributeValueLengthLimit:null!==(o=null!==(i=null!==(s=t.attributeValueLengthLimit)&&void 0!==s?s:a.OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==i?i:a.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==o?o:en}}(e.logRecordLimits)),this._shutdownOnce=new _r(this._shutdown,this)}}function Cr(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}class Ir{onEmit(t){this._shutdownOnce.isCalled||this._addToBuffer(t)}forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}shutdown(){return this._shutdownOnce.call()}_shutdown(){return(t=function*(){this.onShutdown(),yield this._flushAll(),yield this._exporter.shutdown()},function(){var e=this,n=arguments;return new Promise(function(r,s){var i=t.apply(e,n);function o(t){Cr(i,r,s,o,a,"next",t)}function a(t){Cr(i,r,s,o,a,"throw",t)}o(void 0)})}).call(this);var t}_addToBuffer(t){this._finishedLogRecords.length>=this._maxQueueSize||(this._finishedLogRecords.push(t),this._maybeStartTimer())}_flushAll(){return new Promise((t,e)=>{const n=[],r=Math.ceil(this._finishedLogRecords.length/this._maxExportBatchSize);for(let t=0;t<r;t++)n.push(this._flushOneBatch());Promise.all(n).then(()=>{t()}).catch(e)})}_flushOneBatch(){return this._clearTimer(),0===this._finishedLogRecords.length?Promise.resolve():new Promise((t,e)=>{dr(this._export(this._finishedLogRecords.splice(0,this._maxExportBatchSize)),this._exportTimeoutMillis).then(()=>t()).catch(e)})}_maybeStartTimer(){void 0===this._timer&&(this._timer=setTimeout(()=>{this._flushOneBatch().then(()=>{this._finishedLogRecords.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(t=>{qe(t)})},this._scheduledDelayMillis),this._timer)}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}_export(t){const e=()=>fr._export(this._exporter,t).then(t=>{var e;t.code!==xn.SUCCESS&&qe(null!==(e=t.error)&&void 0!==e?e:new Error(`BatchLogRecordProcessor: log record export failed (status ${t})`))}).catch(qe),n=t.map(t=>t.resource).filter(t=>t.asyncAttributesPending);return 0===n.length?e():Promise.all(n.map(t=>{var e;return null===(e=t.waitForAsyncAttributes)||void 0===e?void 0:e.call(t)})).then(e,qe)}constructor(t,e){var n,r,s,i;this._exporter=t,this._finishedLogRecords=[];const o=hn();this._maxExportBatchSize=null!==(n=null==e?void 0:e.maxExportBatchSize)&&void 0!==n?n:o.OTEL_BLRP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=null!==(r=null==e?void 0:e.maxQueueSize)&&void 0!==r?r:o.OTEL_BLRP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=null!==(s=null==e?void 0:e.scheduledDelayMillis)&&void 0!==s?s:o.OTEL_BLRP_SCHEDULE_DELAY,this._exportTimeoutMillis=null!==(i=null==e?void 0:e.exportTimeoutMillis)&&void 0!==i?i:o.OTEL_BLRP_EXPORT_TIMEOUT,this._shutdownOnce=new _r(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Ht.warn("BatchLogRecordProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}}class Nr extends Ir{onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}_onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush()},this._pageHideListener=()=>{this.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}constructor(t,e){super(t,e),this._onInit(e)}}var xr="exception.type",Mr="exception.message";class Dr{spanContext(){return this._spanContext}setAttribute(t,e){return null==e||this._isSpanEnded()?this:0===t.length?(Ht.warn(`Invalid attribute key: ${t}`),this):Xe(e)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(e),this):(Ht.warn(`Invalid attribute value set for key: ${t}`),this)}setAttributes(t){for(const[e,n]of Object.entries(t))this.setAttribute(e,n);return this}addEvent(t,e,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return Ht.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(0===this._droppedEventsCount&&Ht.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),In(e)&&(In(n)||(n=e),e=void 0);const r=Ve(e);return this.events.push({name:t,attributes:r,time:this._getTime(n),droppedAttributesCount:0}),this}addLink(t){return this.links.push(t),this}addLinks(t){return this.links.push(...t),this}setStatus(t){return this._isSpanEnded()||(this.status=Object.assign({},t),null!=this.status.message&&"string"!=typeof t.message&&(Ht.warn(`Dropping invalid status.message of type '${typeof t.message}', expected 'string'`),delete this.status.message)),this}updateName(t){return this._isSpanEnded()||(this.name=t),this}end(t){this._isSpanEnded()?Ht.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`):(this._ended=!0,this.endTime=this._getTime(t),this._duration=function(t,e){let n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=bn),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&(Ht.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&Ht.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this))}_getTime(t){if("number"==typeof t&&t<=fn.now())return wn(t+this._performanceOffset);if("number"==typeof t)return Ln(t);if(t instanceof Date)return Ln(t.getTime());if(Cn(t))return t;if(this._startTimeProvided)return Ln(Date.now());const e=fn.now()-this._performanceStartTime;return Nn(this.startTime,Ln(e))}isRecording(){return!1===this._ended}recordException(t,e){const n={};"string"==typeof t?n[Mr]=t:t&&(t.code?n[xr]=t.code.toString():t.name&&(n[xr]=t.name),t.message&&(n[Mr]=t.message),t.stack&&(n["exception.stacktrace"]=t.stack)),n[xr]||n[Mr]?this.addEvent("exception",n,e):Ht.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){return this._ended&&Ht.warn(`Can not execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`),this._ended}_truncateToLimitUtil(t,e){return t.length<=e?t:t.substring(0,e)}_truncateToSize(t){const e=this._attributeValueLengthLimit;return e<=0?(Ht.warn(`Attribute value limit must be positive, got ${e}`),t):"string"==typeof t?this._truncateToLimitUtil(t,e):Array.isArray(t)?t.map(t=>"string"==typeof t?this._truncateToLimitUtil(t,e):t):t}constructor(t,e,n,r,s,i,o=[],a,u,c){this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:Dt.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=r,this.parentSpanId=i,this.kind=s,this.links=o;const l=Date.now();this._performanceStartTime=fn.now(),this._performanceOffset=l-(this._performanceStartTime+On()),this._startTimeProvided=null!=a,this.startTime=this._getTime(null!=a?a:l),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this._spanLimits=t.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,null!=c&&this.setAttributes(c),this._spanProcessor=t.getActiveSpanProcessor(),this._spanProcessor.onStart(this,e)}}var Ur;!function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Ur||(Ur={}));class kr{shouldSample(){return{decision:Ur.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class Fr{shouldSample(){return{decision:Ur.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class Br{shouldSample(t,e,n,r,s,i){const o=re.getSpanContext(t);return o&&Pt(o)?o.isRemote?o.traceFlags&D.SAMPLED?this._remoteParentSampled.shouldSample(t,e,n,r,s,i):this._remoteParentNotSampled.shouldSample(t,e,n,r,s,i):o.traceFlags&D.SAMPLED?this._localParentSampled.shouldSample(t,e,n,r,s,i):this._localParentNotSampled.shouldSample(t,e,n,r,s,i):this._root.shouldSample(t,e,n,r,s,i)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}constructor(t){var e,n,r,s;this._root=t.root,this._root||(qe(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Fr),this._remoteParentSampled=null!==(e=t.remoteParentSampled)&&void 0!==e?e:new Fr,this._remoteParentNotSampled=null!==(n=t.remoteParentNotSampled)&&void 0!==n?n:new kr,this._localParentSampled=null!==(r=t.localParentSampled)&&void 0!==r?r:new Fr,this._localParentNotSampled=null!==(s=t.localParentNotSampled)&&void 0!==s?s:new kr}}class jr{shouldSample(t,e){return{decision:At(e)&&this._accumulate(e)<this._upperBound?Ur.RECORD_AND_SAMPLED:Ur.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return"number"!=typeof t||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let e=0;for(let n=0;n<t.length/8;n++){const r=8*n;e=(e^parseInt(t.slice(r,r+8),16))>>>0}return e}constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(4294967295*this._ratio)}}const Hr=We.AlwaysOn;function Vr(){const t=hn();return{sampler:Gr(t),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:t.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:t.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:t.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:t.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT},mergeResourceWithDefaults:!0}}function Gr(t=hn()){switch(t.OTEL_TRACES_SAMPLER){case We.AlwaysOn:return new Fr;case We.AlwaysOff:return new kr;case We.ParentBasedAlwaysOn:return new Br({root:new Fr});case We.ParentBasedAlwaysOff:return new Br({root:new kr});case We.TraceIdRatio:return new jr(Xr(t));case We.ParentBasedTraceIdRatio:return new Br({root:new jr(Xr(t))});default:return Ht.error(`OTEL_TRACES_SAMPLER value "${t.OTEL_TRACES_SAMPLER} invalid, defaulting to ${Hr}".`),new Fr}}function Xr(t){if(void 0===t.OTEL_TRACES_SAMPLER_ARG||""===t.OTEL_TRACES_SAMPLER_ARG)return Ht.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;const e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(Ht.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is invalid, defaulting to 1.`),1):e<0||e>1?(Ht.error(`OTEL_TRACES_SAMPLER_ARG=${t.OTEL_TRACES_SAMPLER_ARG} was given, but it is out of range ([0..1]), defaulting to 1.`),1):e}class zr{forceFlush(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()}onStart(t,e){}onEnd(t){this._shutdownOnce.isCalled||0!==(t.spanContext().traceFlags&D.SAMPLED)&&this._addToBuffer(t)}shutdown(){return this._shutdownOnce.call()}_shutdown(){return Promise.resolve().then(()=>this.onShutdown()).then(()=>this._flushAll()).then(()=>this._exporter.shutdown())}_addToBuffer(t){if(this._finishedSpans.length>=this._maxQueueSize)return 0===this._droppedSpansCount&&Ht.debug("maxQueueSize reached, dropping spans"),void this._droppedSpansCount++;this._droppedSpansCount>0&&(Ht.warn(`Dropped ${this._droppedSpansCount} spans because maxQueueSize reached`),this._droppedSpansCount=0),this._finishedSpans.push(t),this._maybeStartTimer()}_flushAll(){return new Promise((t,e)=>{const n=[];for(let t=0,e=Math.ceil(this._finishedSpans.length/this._maxExportBatchSize);t<e;t++)n.push(this._flushOneBatch());Promise.all(n).then(()=>{t()}).catch(e)})}_flushOneBatch(){return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((t,e)=>{const n=setTimeout(()=>{e(new Error("Timeout"))},this._exportTimeoutMillis);jt.with(ke(jt.active()),()=>{let r;this._finishedSpans.length<=this._maxExportBatchSize?(r=this._finishedSpans,this._finishedSpans=[]):r=this._finishedSpans.splice(0,this._maxExportBatchSize);const s=()=>this._exporter.export(r,r=>{var s;clearTimeout(n),r.code===xn.SUCCESS?t():e(null!==(s=r.error)&&void 0!==s?s:new Error("BatchSpanProcessor: span export failed"))});let i=null;for(let t=0,e=r.length;t<e;t++){const e=r[t];e.resource.asyncAttributesPending&&e.resource.waitForAsyncAttributes&&(null!=i||(i=[]),i.push(e.resource.waitForAsyncAttributes()))}null===i?s():Promise.all(i).then(s,t=>{qe(t),e(t)})})})}_maybeStartTimer(){if(this._isExporting)return;const t=()=>{this._isExporting=!0,this._flushOneBatch().finally(()=>{this._isExporting=!1,this._finishedSpans.length>0&&(this._clearTimer(),this._maybeStartTimer())}).catch(t=>{this._isExporting=!1,qe(t)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();void 0===this._timer&&(this._timer=setTimeout(()=>t(),this._scheduledDelayMillis),this._timer)}_clearTimer(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)}constructor(t,e){this._exporter=t,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;const n=hn();this._maxExportBatchSize="number"==typeof(null==e?void 0:e.maxExportBatchSize)?e.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==e?void 0:e.maxQueueSize)?e.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==e?void 0:e.scheduledDelayMillis)?e.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==e?void 0:e.exportTimeoutMillis)?e.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new _r(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Ht.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}}class $r extends zr{onInit(t){!0!==(null==t?void 0:t.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=()=>{"hidden"===document.visibilityState&&this.forceFlush().catch(t=>{qe(t)})},this._pageHideListener=()=>{this.forceFlush().catch(t=>{qe(t)})},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))}onShutdown(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))}constructor(t,e){super(t,e),this.onInit(e)}}class qr{constructor(){this.generateTraceId=Kr(16),this.generateSpanId=Kr(8)}}const Wr=Array(32);function Kr(t){return function(){for(let e=0;e<2*t;e++)Wr[e]=Math.floor(16*Math.random())+48,Wr[e]>=58&&(Wr[e]+=39);return String.fromCharCode.apply(null,Wr.slice(0,2*t))}}class Qr{startSpan(t,e={},n=jt.active()){var r,s,i;e.root&&(n=re.deleteSpan(n));const o=re.getSpan(n);if(Fe(n)){Ht.debug("Instrumentation suppressed, returning Noop Span");return re.wrapSpanContext(mt)}const a=null==o?void 0:o.spanContext(),u=this._idGenerator.generateSpanId();let c,l,d;a&&re.isSpanContextValid(a)?(c=a.traceId,l=a.traceState,d=a.spanId):c=this._idGenerator.generateTraceId();const h=null!==(r=e.kind)&&void 0!==r?r:Mt.INTERNAL,p=(null!==(s=e.links)&&void 0!==s?s:[]).map(t=>({context:t.context,attributes:Ve(t.attributes)})),g=Ve(e.attributes),_=this._sampler.shouldSample(n,c,t,h,g,p);l=null!==(i=_.traceState)&&void 0!==i?i:l;const f={traceId:c,spanId:u,traceFlags:_.decision===xt.RECORD_AND_SAMPLED?D.SAMPLED:D.NONE,traceState:l};if(_.decision===xt.NOT_RECORD){Ht.debug("Recording is off, propagating context in a non-recording span");return re.wrapSpanContext(f)}const m=Ve(Object.assign(g,_.attributes));return new Dr(this,n,t,f,h,d,p,e.startTime,void 0,m)}startActiveSpan(t,e,n,r){let s,i,o;if(arguments.length<2)return;2===arguments.length?o=e:3===arguments.length?(s=e,o=n):(s=e,i=n,o=r);const a=null!=i?i:jt.active(),u=this.startSpan(t,s,a),c=re.setSpan(a,u);return jt.with(c,o,void 0,u)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}getActiveSpanProcessor(){return this._tracerProvider.getActiveSpanProcessor()}constructor(t,e,n){this._tracerProvider=n;const r=function(t){const e={sampler:Gr()},n=Vr(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}(e);this._sampler=r.sampler,this._generalLimits=r.generalLimits,this._spanLimits=r.spanLimits,this._idGenerator=e.idGenerator||new qr,this.resource=n.resource,this.instrumentationLibrary=t}}class Yr{forceFlush(){const t=[];for(const e of this._spanProcessors)t.push(e.forceFlush());return new Promise(e=>{Promise.all(t).then(()=>{e()}).catch(t=>{qe(t||new Error("MultiSpanProcessor: forceFlush failed")),e()})})}onStart(t,e){for(const n of this._spanProcessors)n.onStart(t,e)}onEnd(t){for(const e of this._spanProcessors)e.onEnd(t)}shutdown(){const t=[];for(const e of this._spanProcessors)t.push(e.shutdown());return new Promise((e,n)=>{Promise.all(t).then(()=>{e()},n)})}constructor(t){this._spanProcessors=t}}class Zr{onStart(t,e){}onEnd(t){}shutdown(){return Promise.resolve()}forceFlush(){return Promise.resolve()}}var Jr,ts;!function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"}(Jr||(Jr={}));class es{getTracer(t,e,n){const r=`${t}@${e||""}:${(null==n?void 0:n.schemaUrl)||""}`;return this._tracers.has(r)||this._tracers.set(r,new Qr({name:t,version:e,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)}addSpanProcessor(t){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch(t=>Ht.error("Error while trying to shutdown current span processor",t)),this._registeredSpanProcessors.push(t),this.activeSpanProcessor=new Yr(this._registeredSpanProcessors)}getActiveSpanProcessor(){return this.activeSpanProcessor}register(t={}){re.setGlobalTracerProvider(this),void 0===t.propagator&&(t.propagator=this._buildPropagatorFromEnv()),t.contextManager&&jt.setGlobalContextManager(t.contextManager),t.propagator&&te.setGlobalPropagator(t.propagator)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,e=this._registeredSpanProcessors.map(e=>new Promise(n=>{let r;const s=setTimeout(()=>{n(new Error(`Span processor did not completed within timeout period of ${t} ms`)),r=Jr.timeout},t);e.forceFlush().then(()=>{clearTimeout(s),r!==Jr.timeout&&(r=Jr.resolved,n(r))}).catch(t=>{clearTimeout(s),r=Jr.error,n(t)})}));return new Promise((t,n)=>{Promise.all(e).then(e=>{const r=e.filter(t=>t!==Jr.resolved);r.length>0?n(r):t()}).catch(t=>n([t]))})}shutdown(){return this.activeSpanProcessor.shutdown()}_getPropagator(t){var e;return null===(e=this.constructor._registeredPropagators.get(t))||void 0===e?void 0:e()}_getSpanExporter(t){var e;return null===(e=this.constructor._registeredExporters.get(t))||void 0===e?void 0:e()}_buildPropagatorFromEnv(){const t=Array.from(new Set(hn().OTEL_PROPAGATORS)),e=t.map(t=>{const e=this._getPropagator(t);return e||Ht.warn(`Propagator "${t}" requested through environment variable is unavailable.`),e}).reduce((t,e)=>(e&&t.push(e),t),[]);return 0===e.length?void 0:1===t.length?e[0]:new Mn({propagators:e})}_buildExporterFromEnv(){const t=hn().OTEL_TRACES_EXPORTER;if("none"===t||""===t)return;const e=this._getSpanExporter(t);return e||Ht.error(`Exporter "${t}" requested through environment variable is unavailable.`),e}constructor(t={}){var e,n;this._registeredSpanProcessors=[],this._tracers=new Map;const r=nr({},Vr(),function(t){var e,n,r,s,i,o,a,u,c,l,d,h;const p=Object.assign({},t.spanLimits),g=pn();return p.attributeCountLimit=null!==(o=null!==(i=null!==(s=null!==(n=null===(e=t.spanLimits)||void 0===e?void 0:e.attributeCountLimit)&&void 0!==n?n:null===(r=t.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==s?s:g.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==i?i:g.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==o?o:nn,p.attributeValueLengthLimit=null!==(h=null!==(d=null!==(l=null!==(u=null===(a=t.spanLimits)||void 0===a?void 0:a.attributeValueLengthLimit)&&void 0!==u?u:null===(c=t.generalLimits)||void 0===c?void 0:c.attributeValueLengthLimit)&&void 0!==l?l:g.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==d?d:g.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==h?h:en,Object.assign({},t,{spanLimits:p})}(t));if(this.resource=null!==(e=r.resource)&&void 0!==e?e:vr.empty(),r.mergeResourceWithDefaults&&(this.resource=vr.default().merge(this.resource)),this._config=Object.assign({},r,{resource:this.resource}),null===(n=t.spanProcessors)||void 0===n?void 0:n.length)this._registeredSpanProcessors=[...t.spanProcessors],this.activeSpanProcessor=new Yr(this._registeredSpanProcessors);else{const t=this._buildExporterFromEnv();if(void 0!==t){const e=new $r(t);this.activeSpanProcessor=e}else this.activeSpanProcessor=new Zr}}}es._registeredPropagators=new Map([["tracecontext",()=>new Gn],["baggage",()=>new He]]),es._registeredExporters=new Map;class ns{_bindFunction(t=k,e){const n=this,r=function(...r){return n.with(t,()=>e.apply(this,r))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:e.length}),r}active(){return this._currentContext}bind(t,e){return void 0===t&&(t=this.active()),"function"==typeof e?this._bindFunction(t,e):e}disable(){return this._currentContext=k,this._enabled=!1,this}enable(){return this._enabled||(this._enabled=!0,this._currentContext=k),this}with(t,e,n,...r){const s=this._currentContext;this._currentContext=t||k;try{return e.call(n,...r)}finally{this._currentContext=s}}constructor(){this._enabled=!1,this._currentContext=k}}class rs extends es{register(t={}){void 0===t.contextManager&&(t.contextManager=new ns),t.contextManager&&t.contextManager.enable(),super.register(t)}constructor(t={}){if(super(t),t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor"}}!function(t){t.CONNECT_END="connectEnd",t.CONNECT_START="connectStart",t.DECODED_BODY_SIZE="decodedBodySize",t.DOM_COMPLETE="domComplete",t.DOM_CONTENT_LOADED_EVENT_END="domContentLoadedEventEnd",t.DOM_CONTENT_LOADED_EVENT_START="domContentLoadedEventStart",t.DOM_INTERACTIVE="domInteractive",t.DOMAIN_LOOKUP_END="domainLookupEnd",t.DOMAIN_LOOKUP_START="domainLookupStart",t.ENCODED_BODY_SIZE="encodedBodySize",t.FETCH_START="fetchStart",t.LOAD_EVENT_END="loadEventEnd",t.LOAD_EVENT_START="loadEventStart",t.NAVIGATION_START="navigationStart",t.REDIRECT_END="redirectEnd",t.REDIRECT_START="redirectStart",t.REQUEST_START="requestStart",t.RESPONSE_END="responseEnd",t.RESPONSE_START="responseStart",t.SECURE_CONNECTION_START="secureConnectionStart",t.UNLOAD_EVENT_END="unloadEventEnd",t.UNLOAD_EVENT_START="unloadEventStart"}(ts||(ts={}));let ss;function is(t,e){return e in t}function os(t,e,n,r){let s,i;is(n,e)&&"number"==typeof n[e]&&(s=n[e]);const o=ts.FETCH_START;if(is(n,o)&&"number"==typeof n[o]&&(i=n[o]),void 0!==s&&void 0!==i&&s>=i)return t.addEvent(e,s),t}function as(t,e,n=!1){n||(os(t,ts.FETCH_START,e),os(t,ts.DOMAIN_LOOKUP_START,e),os(t,ts.DOMAIN_LOOKUP_END,e),os(t,ts.CONNECT_START,e),is(e,"name")&&e.name.startsWith("https:")&&os(t,ts.SECURE_CONNECTION_START,e),os(t,ts.CONNECT_END,e),os(t,ts.REQUEST_START,e),os(t,ts.RESPONSE_START,e),os(t,ts.RESPONSE_END,e));const r=e[ts.ENCODED_BODY_SIZE];void 0!==r&&t.setAttribute("http.response_content_length",r);const s=e[ts.DECODED_BODY_SIZE];void 0!==s&&r!==s&&t.setAttribute("http.response_content_length_uncompressed",s)}function us(){return"undefined"!=typeof location?location.origin:void 0}function cs(t,e,n,r,s=new WeakSet,i){const o=ls(t),a=function(t,e,n,r,s,i){const o=An(e),a=An(n);let u=r.filter(e=>{const n=An(Rn(e[ts.FETCH_START])),r=An(Rn(e[ts.RESPONSE_END]));return e.initiatorType.toLowerCase()===(i||"xmlhttprequest")&&e.name===t&&n>=o&&r<=a});u.length>0&&(u=u.filter(t=>!s.has(t)));return u}(t=o.toString(),e,n,r,s,i);if(0===a.length)return{mainRequest:void 0};if(1===a.length)return{mainRequest:a[0]};const u=function(t){return t.slice().sort((t,e)=>{const n=t[ts.FETCH_START],r=e[ts.FETCH_START];return n>r?1:n<r?-1:0})}(a);if(o.origin!==us()&&u.length>1){let t=u[0],e=function(t,e,n){const r=An(n),s=An(Rn(e));let i,o=t[1];const a=t.length;for(let e=1;e<a;e++){const n=t[e],a=An(Rn(n[ts.FETCH_START])),u=r-An(Rn(n[ts.RESPONSE_END]));a>=s&&(!i||u<i)&&(i=u,o=n)}return o}(u,t[ts.RESPONSE_END],n);const r=t[ts.RESPONSE_END];return e[ts.FETCH_START]<r&&(e=t,t=void 0),{corsPreFlightRequest:t,mainRequest:e}}return{mainRequest:a[0]}}function ls(t){if("function"==typeof URL)return new URL(t,"undefined"!=typeof document?document.baseURI:"undefined"!=typeof location?location.href:void 0);const e=(ss||(ss=document.createElement("a")),ss);return e.href=t,e}function ds(t,e){let n=e||[];("string"==typeof n||n instanceof RegExp)&&(n=[n]);return ls(t).origin===us()||n.some(e=>hr(t,e))}function hs(t){const e=BigInt(1e9);return BigInt(t[0])*e+BigInt(t[1])}function ps(t){const e=hs(t);return n=e,{low:Number(BigInt.asUintN(32,n)),high:Number(BigInt.asUintN(32,n>>BigInt(32)))};var n}const gs="undefined"!=typeof BigInt?function(t){return hs(t).toString()}:An;function _s(t){return t}function fs(t){if(void 0!==t)return _n(t)}const ms={encodeHrTime:ps,encodeSpanContext:_n,encodeOptionalSpanContext:fs};function vs(t){var e,n;if(void 0===t)return ms;const r=null===(e=t.useLongBits)||void 0===e||e,s=null!==(n=t.useHex)&&void 0!==n&&n;return{encodeHrTime:r?ps:gs,encodeSpanContext:s?_s:_n,encodeOptionalSpanContext:s?_s:fs}}function Es(t){return{attributes:Ss(t.attributes),droppedAttributesCount:0}}function Ts(t){return{name:t.name,version:t.version}}function Ss(t){return Object.keys(t).map(e=>ys(e,t[e]))}function ys(t,e){return{key:t,value:bs(e)}}function bs(t){const e=typeof t;return"string"===e?{stringValue:t}:"number"===e?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:"boolean"===e?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(bs)}}:"object"===e&&null!=t?{kvlistValue:{values:Object.entries(t).map(([t,e])=>ys(t,e))}}:{}}function Ls(t,e){const n=function(t){const e=new Map;for(const n of t){const{resource:t,instrumentationScope:{name:r,version:s="",schemaUrl:i=""}}=n;let o=e.get(t);o||(o=new Map,e.set(t,o));const a=`${r}@${s}:${i}`;let u=o.get(a);u||(u=[],o.set(a,u)),u.push(n)}return e}(t);return Array.from(n,([t,n])=>({resource:Es(t),scopeLogs:Array.from(n,([,t])=>({scope:Ts(t[0].instrumentationScope),logRecords:t.map(t=>function(t,e){var n,r,s;return{timeUnixNano:e.encodeHrTime(t.hrTime),observedTimeUnixNano:e.encodeHrTime(t.hrTimeObserved),severityNumber:t.severityNumber,severityText:t.severityText,body:bs(t.body),attributes:Os(t.attributes),droppedAttributesCount:t.droppedAttributesCount,flags:null===(n=t.spanContext)||void 0===n?void 0:n.traceFlags,traceId:e.encodeOptionalSpanContext(null===(r=t.spanContext)||void 0===r?void 0:r.traceId),spanId:e.encodeOptionalSpanContext(null===(s=t.spanContext)||void 0===s?void 0:s.spanId)}}(t,e)),schemaUrl:t[0].instrumentationScope.schemaUrl})),schemaUrl:void 0}))}function Os(t){return Object.keys(t).map(e=>ys(e,t[e]))}function ws(t,e){var n;const r=t.spanContext(),s=t.status;return{traceId:e.encodeSpanContext(r.traceId),spanId:e.encodeSpanContext(r.spanId),parentSpanId:e.encodeOptionalSpanContext(t.parentSpanId),traceState:null===(n=r.traceState)||void 0===n?void 0:n.serialize(),name:t.name,kind:null==t.kind?0:t.kind+1,startTimeUnixNano:e.encodeHrTime(t.startTime),endTimeUnixNano:e.encodeHrTime(t.endTime),attributes:Ss(t.attributes),droppedAttributesCount:t.droppedAttributesCount,events:t.events.map(t=>function(t,e){return{attributes:t.attributes?Ss(t.attributes):[],name:t.name,timeUnixNano:e.encodeHrTime(t.time),droppedAttributesCount:t.droppedAttributesCount||0}}(t,e)),droppedEventsCount:t.droppedEventsCount,status:{code:s.code,message:s.message},links:t.links.map(t=>function(t,e){var n;return{attributes:t.attributes?Ss(t.attributes):[],spanId:e.encodeSpanContext(t.context.spanId),traceId:e.encodeSpanContext(t.context.traceId),traceState:null===(n=t.context.traceState)||void 0===n?void 0:n.serialize(),droppedAttributesCount:t.droppedAttributesCount||0}}(t,e)),droppedLinksCount:t.droppedLinksCount}}function Rs(t,e){const n=function(t){const e=new Map;for(const n of t){let t=e.get(n.resource);t||(t=new Map,e.set(n.resource,t));const r=`${n.instrumentationLibrary.name}@${n.instrumentationLibrary.version||""}:${n.instrumentationLibrary.schemaUrl||""}`;let s=t.get(r);s||(s=[],t.set(r,s)),s.push(n)}return e}(t),r=[],s=n.entries();let i=s.next();for(;!i.done;){const[t,n]=i.value,o=[],a=n.values();let u=a.next();for(;!u.done;){const t=u.value;if(t.length>0){const n=t.map(t=>ws(t,e));o.push({scope:Ts(t[0].instrumentationLibrary),spans:n,schemaUrl:t[0].instrumentationLibrary.schemaUrl})}u=a.next()}const c={resource:Es(t),scopeSpans:o,schemaUrl:void 0};r.push(c),i=s.next()}return r}const As={serializeRequest:t=>{const e={resourceLogs:Ls(t,vs({useHex:!0,useLongBits:!1}))};return(new TextEncoder).encode(JSON.stringify(e))},deserializeResponse:t=>{const e=new TextDecoder;return JSON.parse(e.decode(t))}},Ps={serializeRequest:t=>{const e={resourceSpans:Rs(t,vs({useHex:!0,useLongBits:!1}))};return(new TextEncoder).encode(JSON.stringify(e))},deserializeResponse:t=>{const e=new TextDecoder;return JSON.parse(e.decode(t))}};class Cs{export(t,e){this._delegate.export(t,e)}forceFlush(){return this._delegate.forceFlush()}shutdown(){return this._delegate.shutdown()}constructor(t){this._delegate=t}}class Is extends Cs{constructor(t){super(_i(t,As))}}const Ns=t=>Hs(t)+"/v2/logs";function xs(){return xs=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},xs.apply(this,arguments)}class Ms extends Is{constructor({appID:t,userID:e}){super(xs({},Vs,{headers:js(t,e),url:Ns(t)}))}}function Ds(){return Ds=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ds.apply(this,arguments)}class Us extends Cs{constructor(t){super(_i(Ds({},t,{compression:"gzip"}),Ps))}}const ks=t=>Hs(t)+"/v2/spans";function Fs(){return Fs=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Fs.apply(this,arguments)}class Bs extends Us{constructor({appID:t,userID:e}){super(Fs({},Vs,{headers:js(t,e),url:ks(t)}))}}const js=(t,e)=>({"X-EM-AID":t,"X-EM-DID":e}),Hs=t=>`https://a-${t}.data.emb-api.com`,Vs={compression:"gzip",keepalive:!0,concurrencyLimit:5,timeoutMillis:3e4};var Gs=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xs=function(t){function e(e,n,r){var s=t.call(this,e)||this;return s.name="OTLPExporterError",s.data=r,s.code=n,s}return Gs(e,t),e}(Error),zs=function(t,e,n,r){return new(n||(n=Promise))(function(s,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})},$s=function(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},qs=function(){function t(t){this._sendingPromises=[],this._concurrencyLimit=t}return t.prototype.pushPromise=function(t){var e=this;if(this.hasReachedLimit())throw new Error("Concurrency Limit reached");this._sendingPromises.push(t);var n=function(){var n=e._sendingPromises.indexOf(t);e._sendingPromises.splice(n,1)};t.then(n,n)},t.prototype.hasReachedLimit=function(){return this._sendingPromises.length>=this._concurrencyLimit},t.prototype.awaitAll=function(){return zs(this,void 0,void 0,function(){return $s(this,function(t){switch(t.label){case 0:return[4,Promise.all(this._sendingPromises)];case 1:return t.sent(),[2]}})})},t}();function Ws(t){return new qs(t.concurrencyLimit)}function Ks(){return{handleResponse:function(t){null!=t&&function(t){return Object.prototype.hasOwnProperty.call(t,"partialSuccess")}(t)&&null!=t.partialSuccess&&0!==Object.keys(t.partialSuccess).length&&Ht.warn("Received Partial Success response:",JSON.stringify(t.partialSuccess))}}}var Qs=function(t,e,n,r){return new(n||(n=Promise))(function(s,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})},Ys=function(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},Zs=function(){function t(t,e,n,r,s){this._transport=t,this._serializer=e,this._responseHandler=n,this._promiseQueue=r,this._timeout=s,this._diagLogger=Ht.createComponentLogger({namespace:"OTLPExportDelegate"})}return t.prototype.export=function(t,e){var n=this;if(this._diagLogger.debug("items to be sent",t),this._promiseQueue.hasReachedLimit())e({code:xn.FAILED,error:new Error("Concurrent export limit reached")});else{var r=this._serializer.serializeRequest(t);null!=r?this._promiseQueue.pushPromise(this._transport.send(r,this._timeout).then(function(t){if("success"!==t.status)"failure"===t.status&&t.error?e({code:xn.FAILED,error:t.error}):"retryable"===t.status?e({code:xn.FAILED,error:new Xs("Export failed with retryable status")}):e({code:xn.FAILED,error:new Xs("Export failed with unknown error")});else{if(null!=t.data)try{n._responseHandler.handleResponse(n._serializer.deserializeResponse(t.data))}catch(e){n._diagLogger.warn("Export succeeded but could not deserialize response - is the response specification compliant?",e,t.data)}e({code:xn.SUCCESS})}},function(t){return e({code:xn.FAILED,error:t})})):e({code:xn.FAILED,error:new Error("Nothing to send")})}},t.prototype.forceFlush=function(){return this._promiseQueue.awaitAll()},t.prototype.shutdown=function(){return Qs(this,void 0,void 0,function(){return Ys(this,function(t){switch(t.label){case 0:return this._diagLogger.debug("shutdown started"),[4,this.forceFlush()];case 1:return t.sent(),this._transport.shutdown(),[2]}})})},t}();function Js(t,e,n){return r={transport:n,serializer:e,promiseHandler:Ws(t)},s={timeout:t.timeoutMillis},new Zs(r.transport,r.serializer,Ks(),r.promiseHandler,s.timeout);var r,s}function ti(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}function ei(t){return function(){var e=this,n=arguments;return new Promise(function(r,s){var i=t.apply(e,n);function o(t){ti(i,r,s,o,a,"next",t)}function a(t){ti(i,r,s,o,a,"throw",t)}o(void 0)})}}function ni(){return ni=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ni.apply(this,arguments)}class ri{static _compressRequest(t){return ei(function*(){const e=new CompressionStream("gzip"),n=e.writable.getWriter();n.write(t),n.close();const r=[],s=e.readable.getReader();let i=!1;for(;!i;){const t=yield s.read();t.value&&r.push(t.value),i=t.done}const o=new Uint8Array(r.reduce((t,e)=>t+e.length,0));let a=0;for(const t of r)o.set(t,a),a+=t.length;return o})()}send(t,e){return this._asyncSend(t,e)}shutdown(){}_asyncSend(t,e){return ei(function*(){let n=t;const r=ni({"Content-Type":"application/json"},this._config.headers);"gzip"===this._config.compression&&(n=yield ri._compressRequest(t),r["Content-Encoding"]="gzip",r["Content-Length"]=n.length.toString());try{return(yield fetch(this._config.url,{method:"POST",keepalive:!0,headers:r,body:n,signal:AbortSignal.timeout(e)})).ok?{status:"success"}:{status:"failure",error:new Error("Fetch request failed")}}catch(t){return{status:"failure",error:new Error("Fetch request errored")}}}).call(this)}constructor(t){this._config=t}}const si=t=>new ri(t),ii=[];for(let t=0;t<256;++t)ii.push((t+256).toString(16).slice(1));let oi;const ai=new Uint8Array(16);var ui={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ci(t,e,n){if(ui.randomUUID&&!t)return ui.randomUUID();var r,s;const i=null!=(s=null!=(r=(t=t||{}).random)?r:null==t.rng?void 0:t.rng.call(t))?s:function(){if(!oi){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");oi=crypto.getRandomValues.bind(crypto)}return oi(ai)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(t,e=0){return(ii[t[e+0]]+ii[t[e+1]]+ii[t[e+2]]+ii[t[e+3]]+"-"+ii[t[e+4]]+ii[t[e+5]]+"-"+ii[t[e+6]]+ii[t[e+7]]+"-"+ii[t[e+8]]+ii[t[e+9]]+"-"+ii[t[e+10]]+ii[t[e+11]]+ii[t[e+12]]+ii[t[e+13]]+ii[t[e+14]]+ii[t[e+15]]).toLowerCase()}(i)}const li=()=>ci().replace(/-/g,"").toUpperCase();class di{constructor(t=fn){this.epochMillisFromOriginOffset=t=>this._clock.timeOrigin+t,this.getNowHRTime=()=>Ln(this.getNowMillis()),this.getNowMillis=()=>this.epochMillisFromOriginOffset(this._clock.now()),this._clock=t}}function hi(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}const pi=()=>40*Math.random()-20;class gi{send(t,e){return(n=function*(){const n=this._perf.getNowMillis()+e;let r=yield this._transport.send(t,e),s=5,i=1e3;for(;"retryable"===r.status&&s>0;){s--;const e=Math.max(Math.min(i,5e3)+pi(),0);var o;i*=1.5;const a=null!=(o=r.retryInMillis)?o:e,u=n-this._perf.getNowMillis();if(a>u)return r;r=yield this._retry(t,u,a)}return r},function(){var t=this,e=arguments;return new Promise(function(r,s){var i=n.apply(t,e);function o(t){hi(i,r,s,o,a,"next",t)}function a(t){hi(i,r,s,o,a,"throw",t)}o(void 0)})}).call(this);var n}shutdown(){this._transport.shutdown()}_retry(t,e,n){return new Promise((r,s)=>{setTimeout(()=>{this._transport.send(t,e).then(r,s)},n)})}constructor(t,e=new di){this._transport=t,this._perf=e}}const _i=(t,e)=>{return Js(t,e,(n={transport:si(t)},new gi(n.transport)));var n},fi="http.method",mi="http.url",vi="http.status_code",Ei="exception.message",Ti="exception.stacktrace",Si="exception.type",yi="http.request.method",bi="http.response.status_code",Li="service.name",Oi="telemetry.sdk.language",wi="telemetry.sdk.name",Ri="telemetry.sdk.version",Ai="url.full",Pi="emb.type",Ci="emb.state",Ii="emb.cold_start",Ni="emb.properties.",xi="emb.session_end_type",Mi="emb.stacktrace.js",Di="emb.exception_handling",Ui="emb.app_instance_id";var ki=function(t){return t.Session="ux.session",t.View="ux.view",t.Network="perf.network_request",t.Perf="perf",t.SystemLog="sys.log",t.SystemException="sys.exception",t.WebVital="ux.web_vital",t}({}),Fi=function(t){return t.Foreground="foreground",t.Background="background",t}({});function Bi(){return Bi=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Bi.apply(this,arguments)}class ji{static _logSeverityToSeverityNumber(t){switch(t){case"info":return ge.INFO;case"warning":return ge.WARN;default:return ge.ERROR}}logException(t,{handled:e=!0,attributes:n={},timestamp:r=this._perf.getNowMillis()}={}){e||this._spanSessionManager.incrSessionCountForKey("emb.unhandled_exceptions_count"),this._logger.emit({timestamp:r,severityNumber:ge.ERROR,severityText:"ERROR",body:t.message||"",attributes:Bi({},n,{[Pi]:ki.SystemException,[Di]:e?"HANDLED":"UNHANDLED",[Si]:t.constructor.name,"exception.name":t.name,[Ei]:t.message,[Ti]:t.stack})})}message(t,e,{attributes:n={},includeStacktrace:r=!0}={}){"error"===e&&this._spanSessionManager.incrSessionCountForKey("emb.error_log_count"),this._logMessage({message:t,severity:e,timestamp:this._perf.getNowMillis(),attributes:n,stackTrace:r&&"info"!=e?(new Error).stack:void 0})}_logMessage({message:t,severity:e,timestamp:n,attributes:r={},stackTrace:s}){this._logger.emit({timestamp:n,severityNumber:ji._logSeverityToSeverityNumber(e),severityText:e.toUpperCase(),body:t,attributes:Bi({},r,{[Pi]:ki.SystemLog},s?{[Mi]:s}:{})})}constructor({perf:t,spanSessionManager:e}){this._perf=null!=t?t:new di,this._logger=Le.getLogger("embrace-web-sdk-logs"),this._spanSessionManager=e}}const Hi="log.record.uid",Vi="session.id",Gi="user.id";function Xi(){return Xi=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Xi.apply(this,arguments)}class zi{_getPermanentAttributes(){const t=new Map;try{for(let e=0;e<this._storage.length;e++){const n=this._storage.key(e);if(null==n?void 0:n.startsWith(Ni)){const e=this._storage.getItem(n);e&&t.set(n,e)}}}catch(t){this._diag.warn("Error loading permanent session properties",t)}return Object.fromEntries(t.entries())}addBreadcrumb(t){this._sessionSpan?this._sessionSpan.addEvent("emb-breadcrumb",{message:t},this._perf.getNowMillis()):this._diag.debug("trying to add breadcrumb to a session, but there is no session in progress. This is a no-op.")}addProperty(t,e,n){if(!this._sessionSpan)return void this._diag.debug("trying to add properties to a session, but there is no session in progress. This is a no-op.");const r=Ni+t;if(this._sessionSpan.setAttribute(r,e),"permanent"===(null==n?void 0:n.lifespan))try{this._storage.setItem(r,e)}catch(t){this._diag.warn("Failed to set permanent session property",t)}}removeProperty(t){if(!this._sessionSpan)return void this._diag.debug("trying to remove a session property, but there is no session in progress. This is a no-op.");const e=Ni+t;this._sessionSpan.removeAttribute(e);try{this._storage.getItem(e)&&this._storage.removeItem(e)}catch(t){this._diag.warn("Error removing permanent session property",t)}}endSessionSpan(){this.endSessionSpanInternal("manual")}endSessionSpanInternal(t){if(this._sessionSpan){this._sessionSpan.setAttributes(Xi({},this._getPermanentAttributes(),{[xi]:t},this._activeSessionCounts)),this._sessionSpan.end(),this._sessionSpan=null,this._activeSessionStartTime=null,this._activeSessionId=null,this._activeSessionCounts=null;for(const t of this._sessionEndedListeners)try{t()}catch(t){this._diag.warn("Error while executing session ended listener",t)}}else this._diag.debug("trying to end a session, but there is no session in progress. This is a no-op.")}getSessionId(){return this._activeSessionId}getSessionSpan(){return this._sessionSpan}getSessionStartTime(){return this._activeSessionStartTime}startSessionSpan(){this._sessionSpan&&this.endSessionSpanInternal("manual");const t=re.getTracer("embrace-web-sdk-sessions");this._activeSessionId=li(),this._activeSessionStartTime=this._perf.getNowHRTime(),this._activeSessionCounts={},this._sessionSpan=new Wi(t.startSpan("emb-session",{attributes:Xi({},this._getPermanentAttributes(),{[Pi]:ki.Session,[Ci]:"hidden"===this._visibilityDoc.visibilityState?Fi.Background:Fi.Foreground,[Vi]:this._activeSessionId,[Ii]:this._coldStart})})),this._coldStart=!1;for(const t of this._sessionStartedListeners)try{t()}catch(t){this._diag.warn("Error while executing session started listener",t)}}incrSessionCountForKey(t){this._sessionSpan&&this._activeSessionCounts?this._activeSessionCounts[t]=(this._activeSessionCounts[t]||0)+1:this._diag.debug("trying to increment a count for the active session, but there is no session in progress. This is a no-op.")}addSessionStartedListener(t){const e=this._sessionStartedListeners.push(t);return()=>{this._sessionStartedListeners.splice(e-1,1)}}addSessionEndedListener(t){const e=this._sessionEndedListeners.push(t);return()=>{this._sessionEndedListeners.splice(e-1,1)}}constructor({diag:t,perf:e,visibilityDoc:n=window.document,storage:r=window.localStorage}={}){this._activeSessionId=null,this._activeSessionStartTime=null,this._sessionSpan=null,this._activeSessionCounts=null,this._coldStart=!0,this._sessionStartedListeners=[],this._sessionEndedListeners=[],this._diag=null!=t?t:Ht.createComponentLogger({namespace:"EmbraceSpanSessionManager"}),this._perf=null!=e?e:new di,this._visibilityDoc=n,this._storage=r}}function $i(t){var e=function(t,e){if("object"!==qi(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!==qi(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"===qi(e)?e:String(e)}function qi(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}class Wi{get attributes(){return this._span.attributes}addEvent(t,e,n){return this._span.addEvent(t,e,n),this}addLink(t){return this._span.addLink(t),this}addLinks(t){return this._span.addLinks(t),this}end(t){this._span.end(t)}isRecording(){return this._span.isRecording()}recordException(t,e){this._span.recordException(t,e)}setAttribute(t,e){return this._span.setAttribute(t,e),this}setAttributes(t){return this._span.setAttributes(t),this}removeAttribute(t){const e=this._span.attributes,{[t]:n}=e,r=function(t,e){if(null==t)return{};var n,r,s={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(s[n]=t[n]);return s}(e,[t].map($i));return this._span.attributes=r,this}setStatus(t){return this._span.setStatus(t),this}spanContext(){return this._span.spanContext()}updateName(t){return this._span.updateName(t),this}fail(t={code:"failure"}){t.code&&this._span.setAttribute("emb.error_code",t.code.toUpperCase()),this._span.end(t.endTime)}constructor(t){this._span=t}}class Ki{startSpan(t,e={},n){const r=re.getTracer("embrace-web-sdk-traces");e.attributes=e.attributes?e.attributes:{},e.attributes[Pi]=ki.Perf;const s=e.parentSpan?re.setSpan(jt.active(),e.parentSpan):n;return new Wi(r.startSpan(t,e,s))}getSpan(t){const e=re.getSpan(t);if(e)return new Wi(e)}constructor(){this.setSpan=re.setSpan}}const Qi="embrace_user",Yi="embrace_user_id",Zi="embrace_external_user_id";class Ji{getEmbraceUserId(){return this._embraceUserId||this._generateNewEmbraceUserId()}setEmbraceUserId(t){this._embraceUserId=t;try{this._storage.setItem(Yi,t)}catch(t){this._diag.warn("Failed to persist user object for storage, keeping it in-memory only",t)}}clearEmbraceUserId(){this._embraceUserId=null;try{this._storage.removeItem(Yi)}catch(t){this._diag.warn("Failed to remove embrace user in storage",t)}}_migrateOldLocalStorageKey(){try{const t=this._storage.getItem(Qi);if(t){const e=JSON.parse(t);(t=>"string"==typeof t[ce]&&32===t[ce].length)(e)?(this._diag.debug("Migrating old user data from storage"),this._storage.setItem(Yi,e[ce]),this._storage.removeItem(Qi)):(this._diag.warn("Invalid user data found in storage, clearing old user data"),this._storage.removeItem(Qi))}}catch(t){this._diag.warn("Failed to get old user data from storage",t)}}_initialSetup(){try{const e=this._storage.getItem(Yi);e?"string"==typeof(t=e)&&32===t.length?this._embraceUserId=e:(this._diag.warn("Invalid embrace user id, generating a new one"),this.clearEmbraceUserId()):this._diag.debug("No existing user found in storage, creating a new one")}catch(t){this._diag.warn("Failed to get embrace user id from storage, defaulting to a new one",t)}var t;this._embraceUserId||(this._embraceUserId=this._generateNewEmbraceUserId())}_generateNewEmbraceUserId(){const t=li();return this.setEmbraceUserId(t),t}getUserId(){return this._storage.getItem(Zi)}setUserId(t){this._storage.setItem(Zi,t)}clearUserId(){this._storage.removeItem(Zi)}constructor({diag:t,storage:e=localStorage}={}){this._embraceUserId=null,this._diag=null!=t?t:Ht.createComponentLogger({namespace:"EmbraceUserManager"}),this._storage=e,this._migrateOldLocalStorageKey(),this._initialSetup()}}class to{get diag(){return this._diag}get processorName(){return this._processorName}constructor({diag:t,processorName:e}){this._processorName=e,this._diag=null!=t?t:Ht.createComponentLogger({namespace:e})}}function eo(){return eo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},eo.apply(this,arguments)}class no extends to{forceFlush(){return this.diag.debug("forceFlush called for EmbraceSessionBatchedSpanProcessor. This is a no op"),Promise.resolve(void 0)}onEnd(t){this._shutdownOnce.isCalled?this.diag.debug("span ended after processor shutdown. Ignoring span."):(t=>t.attributes[Pi]===ki.Session)(t)?(this.diag.debug("session span ended. Exporting all pending spans."),fr._export(this._exporter,[t,...this._pendingSpans]).then(t=>{var e;t.code===xn.FAILED&&this.diag.error(`spans failed to export: ${(null==(e=t.error)?void 0:e.message)||"unknown error"}`)}).catch(t=>{let e="unknown error";t&&t instanceof Error?e=t.message:"string"==typeof t&&(e=t),this.diag.error(`spans failed to export: ${e}`)}),this._pendingSpans=[]):(this.diag.debug("non-session span ended. Adding to pending spans queue."),this._pendingSpans.push(t))}onStart(){}shutdown(){return this._shutdownOnce.call()}constructor(t){var{exporter:e}=t,n=function(t,e){if(null==t)return{};var n,r,s={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(s[n]=t[n]);return s}(t,["exporter"]);super(eo({},n,{processorName:"EmbraceSessionBatchedSpanProcessor"})),this._pendingSpans=[],this._shutdown=()=>this._exporter.shutdown(),this._exporter=e,this._shutdownOnce=new _r(this._shutdown,this)}}class ro{forceFlush(){return Promise.resolve(void 0)}onEmit(t){t.setAttributes({[Hi]:li(),[Vi]:this._spanSessionManager.getSessionId()})}shutdown(){return Promise.resolve(void 0)}constructor({spanSessionManager:t}){this._spanSessionManager=t}}const so=/.+:\/\/.+/;class io{forceFlush(){return Promise.resolve(void 0)}onEnd(t){var e,n,r,s,i,o,a,u;(t=>{if((t.attributes[yi]||t.attributes[fi])&&(t.attributes[bi]||t.attributes[vi])){var e;const n=null!=(e=t.attributes[Ai])?e:t.attributes[mi];return!(!n||"string"!=typeof n||!so.exec(n))}return!1})(t)&&(t.attributes[Pi]=ki.Network,null!=(e=t.attributes)[n=Ai]||(e[n]=t.attributes[mi]),null!=(r=t.attributes)[s=bi]||(r[s]=t.attributes[vi]),null!=(i=t.attributes)[o=yi]||(i[o]=t.attributes[fi]),null!=(a=t.attributes)["http.response.body.size"]||(a["http.response.body.size"]=t.attributes["http.response_content_length"]),null!=(u=t.attributes)["http.request.body.size"]||(u["http.request.body.size"]=t.attributes["http.request_content_length"]))}onStart(){}shutdown(){return Promise.resolve(void 0)}}class oo{forceFlush(){return Promise.resolve(void 0)}onEmit(t){t.attributes[Pi]||t.setAttribute(Pi,ki.SystemLog),t.setAttribute(Ai,this._urlDocument.URL)}shutdown(){return Promise.resolve(void 0)}constructor({urlDocument:t=window.document}={}){this._urlDocument=t}}class ao{forceFlush(){return Promise.resolve(void 0)}onEmit(t){this._userManager.getUserId()&&t.setAttributes({[Gi]:this._userManager.getUserId()})}shutdown(){return Promise.resolve(void 0)}constructor({userManager:t}){this._userManager=t}}class uo{forceFlush(){return Promise.resolve(void 0)}onEnd(t){const e=this._userManager.getUserId();e&&(t.attributes[Gi]=e)}onStart(){}shutdown(){return Promise.resolve(void 0)}constructor({userManager:t}){this._userManager=t}}const co="browser.platform",lo="browser.brands",ho="browser.mobile",po="browser.language",go="browser.user_agent";function _o(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}const fo=new class{detect(t){return(e=function*(){if("undefined"==typeof navigator)return vr.empty();const e=function(){const t={},e=navigator.userAgentData;return e?(t[co]=e.platform,t[lo]=e.brands.map(t=>`${t.brand} ${t.version}`),t[ho]=e.mobile):t[go]=navigator.userAgent,t[po]=navigator.language,t}();return this._getResourceAttributes(e,t)},function(){var t=this,n=arguments;return new Promise(function(r,s){var i=e.apply(t,n);function o(t){_o(i,r,s,o,a,"next",t)}function a(t){_o(i,r,s,o,a,"throw",t)}o(void 0)})}).call(this);var e}_getResourceAttributes(t,e){return t[go]||t[co]?new vr(t):(Ht.debug("BrowserDetector failed: Unable to find required browser resources. "),vr.empty())}},mo="1.4.1",vo="embrace-web-sdk",Eo="embrace_app_instance_id",To=(t,e)=>{let n=null;try{n=t.getItem(Eo)}catch(t){e.warn("Failed to retrieve app instance ID from session storage",t)}if(!n){e.debug("No existing app instance ID found in session storage, creating a new one"),n=li();try{t.setItem(Eo,n)}catch(t){e.warn("Failed to persist app instance ID to session storage",t)}}return n};function So(){return So=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},So.apply(this,arguments)}class yo{get tracer(){return this._tracer}get meter(){return this._meter}get logger(){return this._logger}getModuleDefinitions(){var t;const e=null!=(t=this.init())?t:[];return Array.isArray(e)?e:[e]}getConfig(){return this._config}setConfig(t){this._config=So({enabled:!0},t)}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}_updateMetricInstruments(){}_runSpanCustomizationHook(t,e,n,r){if(t)try{t(n,r)}catch(t){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:e},t)}}constructor(t,e,n){this.instrumentationName=t,this.instrumentationVersion=e,this._config={},this.setConfig(n),this._diag=Ht.createComponentLogger({namespace:t}),this._tracer=re.getTracer(t,e),this._meter=Xt.getMeter(t,e),this._logger=Le.getLogger(t,e),this._updateMetricInstruments()}}class bo extends yo{get sessionManager(){return this._sessionManager}get logManager(){return this._logManager}get perf(){return this._perf}init(){}constructor({instrumentationName:t,instrumentationVersion:e,config:n,diag:r,perf:i}){super(t,e,n),r&&(this._diag=r),this._perf=null!=i?i:new di,this._sessionManager=u.getSpanSessionManager(),this._logManager=s.getLogManager()}}class Lo extends bo{disable(){window.removeEventListener("visibilitychange",this._onVisibilityChange)}enable(){window.addEventListener("visibilitychange",this._onVisibilityChange)}constructor({diag:t,backgroundSessions:e=!1,visibilityDoc:n=window.document}={}){super({instrumentationName:"SpanSessionOnLoadInstrumentation",instrumentationVersion:"1.0.0",config:{},diag:t}),this._onVisibilityChange=()=>{this._diag.debug(`Visibility change detected: ${n.visibilityState}`),this.sessionManager.endSessionSpanInternal("state_changed"),"hidden"===n.visibilityState&&e?(this._diag.debug("Starting a session since document visibility switched to hidden and `backgroundSessions` is enabled"),this.sessionManager.startSessionSpan()):"visible"===n.visibilityState&&(this._diag.debug("Starting a session since document visibility switched to visible"),this.sessionManager.startSessionSpan())},this._config.enabled&&this.enable()}}const Oo=["keydown","mousedown","mousemove","scroll"];class wo extends bo{constructor({diag:t}={}){super({instrumentationName:"SpanSessionBrowserActivityInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),this.disable=()=>{(({target:t,events:e,callback:n})=>{e.forEach(e=>{t.removeEventListener(e,n)})})({target:window,events:Oo,callback:this._onActivityThrottled}),this._activityTimeout&&clearTimeout(this._activityTimeout),this._activityTimeout=null},this.enable=()=>{(({target:t,events:e,callback:n})=>{e.forEach(e=>{t.addEventListener(e,n)})})({target:window,events:Oo,callback:this._onActivityThrottled})},this._onInactivity=()=>{this._diag.debug("Inactivity detected"),this._activityTimeout&&clearTimeout(this._activityTimeout),this._activityTimeout=null,this.sessionManager.endSessionSpanInternal("inactivity")},this._onActivity=()=>{this._diag.debug("Activity detected"),this._activityTimeout&&clearTimeout(this._activityTimeout),this.sessionManager.getSessionId()||this.sessionManager.startSessionSpan(),this._activityTimeout=setTimeout(this._onInactivity,18e5)},this._activityTimeout=null,this._onActivityThrottled=((t,e=1e3)=>{let n=!1;return(...r)=>{n||(t(...r),setTimeout(()=>{n=!1},e),n=!0)}})(this._onActivity,3e4),this._config.enabled&&this.enable()}}class Ro extends bo{disable(){this.sessionManager.endSessionSpanInternal("unknown")}enable(){this.sessionManager.startSessionSpan()}constructor({diag:t}={}){super({instrumentationName:"SpanSessionOnLoadInstrumentation",instrumentationVersion:"1.0.0",diag:t,config:{}}),this._config.enabled&&this.enable()}}const Ao=144e5;class Po extends bo{constructor({diag:t,perf:e}={}){super({instrumentationName:"SpanSessionTimeoutInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this.disable=()=>{this._sessionTimeout&&clearTimeout(this._sessionTimeout),this._sessionTimeout=null},this.enable=()=>{this._checkTimeout()},this._onTimeout=()=>{this._diag.debug("Timeout detected"),this._sessionTimeout&&clearTimeout(this._sessionTimeout),this.sessionManager.endSessionSpanInternal("timer"),this.sessionManager.startSessionSpan(),this._sessionTimeout=setTimeout(this._checkTimeout,Ao)},this._checkTimeout=()=>{const t=this.sessionManager.getSessionStartTime();if(t){const e=Pn(this.perf.getNowHRTime()),n=Pn(t),r=Ao-(e-n);return r<=0?void this._onTimeout():(this._sessionTimeout&&clearTimeout(this._sessionTimeout),void(this._sessionTimeout=setTimeout(this._checkTimeout,r)))}this._sessionTimeout&&clearTimeout(this._sessionTimeout),this._sessionTimeout=setTimeout(this._checkTimeout,Ao)},this._sessionTimeout=null,this._config.enabled&&this.enable()}}class Co extends bo{disable(){window.removeEventListener("error",this._onErrorHandler),window.removeEventListener("unhandledrejection",this._onUnhandledRejectionHandler)}enable(){window.addEventListener("error",this._onErrorHandler),window.addEventListener("unhandledrejection",this._onUnhandledRejectionHandler)}constructor({diag:t,perf:e}={}){super({instrumentationName:"GlobalExceptionInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this._onErrorHandler=t=>{this.logManager.logException(t.error,{handled:!1,timestamp:this.perf.epochMillisFromOriginOffset(t.timeStamp)})},this._onUnhandledRejectionHandler=t=>{let e;t.reason&&t.reason instanceof Error?e=t.reason:(e=new Error("string"==typeof t.reason?t.reason:"Unhandled Rejected Promise"),e.stack=""),this.logManager.logException(e,{handled:!1,timestamp:this.perf.epochMillisFromOriginOffset(t.timeStamp)})},this._config.enabled&&this.enable()}}const Io=t=>{const e=t.nodeName.toLowerCase(),n=t.innerText.substring(0,30),r=t.innerText.length>30?"...":"";return`<${e}${t.className?` class="${t.className}"`:""}>${n}${r}</${e}>`};class No extends bo{disable(){document.removeEventListener("click",this._onClickHandler)}enable(){document.addEventListener("click",this._onClickHandler)}constructor({diag:t,perf:e}={}){super({instrumentationName:"SpanSessionBrowserActivityInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this._onClickHandler=t=>{const e=t.target;if(e instanceof HTMLElement&&!e.hasAttribute("disabled"))try{const n=this.sessionManager.getSessionSpan();n&&n.addEvent("click",{"emb.type":"ux.tap","view.name":Io(e),"tap.coords":`${t.x.toString()},${t.y.toString()}`},this.perf.epochMillisFromOriginOffset(t.timeStamp))}catch(t){this._diag.error("failed to create new user interaction span event",t)}},this._config.enabled&&this.enable()}}function xo(){return xo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},xo.apply(this,arguments)}class Mo{u(t){if(t.hadRecentInput)return;const e=this.i[0],n=this.i.at(-1);this.o&&e&&n&&t.startTime-n.startTime<1e3&&t.startTime-e.startTime<5e3?(this.o+=t.value,this.i.push(t)):(this.o=t.value,this.i=[t]),null==this.t||this.t.call(this,t)}constructor(){this.o=0,this.i=[]}}const Do=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},Uo=t=>{if("loading"===document.readyState)return"loading";{const e=Do();if(e){if(t<e.domInteractive)return"loading";if(0===e.domContentLoadedEventStart||t<e.domContentLoadedEventStart)return"dom-interactive";if(0===e.domComplete||t<e.domComplete)return"dom-content-loaded"}}return"complete"},ko=t=>{const e=t.nodeName;return 1===t.nodeType?e.toLowerCase():e.toUpperCase().replace(/^#/,"")},Fo=t=>{let e="";try{for(;9!==(null==t?void 0:t.nodeType);){const n=t,r=n.id?"#"+n.id:[ko(n),...Array.from(n.classList).sort()].join(".");if(e.length+r.length>99)return e||r;if(e=e?r+">"+e:r,n.id)break;t=n.parentNode}}catch(e){}return e},Bo=new WeakMap;function jo(t,e){return Bo.get(t)||Bo.set(t,new e),Bo.get(t)}let Ho=-1;const Vo=()=>Ho,Go=t=>{addEventListener("pageshow",e=>{e.persisted&&(Ho=e.timeStamp,t(e))},!0)},Xo=(t,e,n,r)=>{let s,i;return o=>{e.value>=0&&(o||r)&&(i=e.value-(null!=s?s:0),(i||void 0===s)&&(s=e.value,e.delta=i,e.rating=((t,e)=>t>e[1]?"poor":t>e[0]?"needs-improvement":"good")(e.value,n),t(e)))}},zo=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},$o=()=>{const t=Do();var e;return null!=(e=null==t?void 0:t.activationStart)?e:0},qo=(t,e=-1)=>{const n=Do();let r="navigate";return Vo()>=0?r="back-forward-cache":n&&(document.prerendering||$o()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},Wo=(t,e,n={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver(t=>{Promise.resolve().then(()=>{e(t.getEntries())})});return r.observe(xo({type:t,buffered:!0},n)),r}}catch(e){}},Ko=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let Qo=-1;const Yo=()=>"hidden"!==document.visibilityState||document.prerendering?1/0:0,Zo=t=>{"hidden"===document.visibilityState&&Qo>-1&&(Qo="visibilitychange"===t.type?t.timeStamp:0,ta())},Jo=()=>{addEventListener("visibilitychange",Zo,!0),addEventListener("prerenderingchange",Zo,!0)},ta=()=>{removeEventListener("visibilitychange",Zo,!0),removeEventListener("prerenderingchange",Zo,!0)},ea=()=>{if(Qo<0){var t;const e=$o(),n=document.prerendering||null==(t=globalThis.performance.getEntriesByType("visibility-state").filter(t=>"hidden"===t.name&&t.startTime>e)[0])?void 0:t.startTime;Qo=null!=n?n:Yo(),Jo(),Go(()=>{setTimeout(()=>{Qo=Yo(),Jo()})})}return{get firstHiddenTime(){return Qo}}},na=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},ra=[1800,3e3],sa=(t,e={})=>{na(()=>{const n=ea();let r,s=qo("FCP");const i=Wo("paint",t=>{for(const e of t)"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<n.firstHiddenTime&&(s.value=Math.max(e.startTime-$o(),0),s.entries.push(e),r(!0)))});i&&(r=Xo(t,s,ra,e.reportAllChanges),Go(n=>{s=qo("FCP"),r=Xo(t,s,ra,e.reportAllChanges),zo(()=>{s.value=performance.now()-n.timeStamp,r(!0)})}))})},ia=[.1,.25],oa=t=>t.find(t=>{var e;return 1===(null==(e=t.node)?void 0:e.nodeType)})||t[0];let aa=0,ua=1/0,ca=0;const la=t=>{for(const e of t)e.interactionId&&(ua=Math.min(ua,e.interactionId),ca=Math.max(ca,e.interactionId),aa=ca?(ca-ua)/7+1:0)};let da;const ha=()=>{var t;return da?aa:null!=(t=performance.interactionCount)?t:0};let pa=0;class ga{v(){pa=ha(),this.l.length=0,this.h.clear()}M(){const t=Math.min(this.l.length-1,Math.floor((ha()-pa)/50));return this.l[t]}u(t){if(null==this.m||this.m.call(this,t),!t.interactionId&&"first-input"!==t.entryType)return;const e=this.l.at(-1);let n=this.h.get(t.interactionId);if(n||this.l.length<10||t.duration>e.T){if(n?t.duration>n.T?(n.entries=[t],n.T=t.duration):t.duration===n.T&&t.startTime===n.entries[0].startTime&&n.entries.push(t):(n={id:t.interactionId,entries:[t],T:t.duration},this.h.set(n.id,n),this.l.push(n)),this.l.sort((t,e)=>e.T-t.T),this.l.length>10){const t=this.l.splice(10);for(const e of t)this.h.delete(e.id)}null==this.p||this.p.call(this,n)}}constructor(){this.l=[],this.h=new Map}}const _a=t=>{const e=globalThis.requestIdleCallback||setTimeout;"hidden"===document.visibilityState?t():(t=Ko(t),document.addEventListener("visibilitychange",t,{once:!0}),e(()=>{t(),document.removeEventListener("visibilitychange",t)}))},fa=[200,500];class ma{u(t){null==this.m||this.m.call(this,t)}}const va=[2500,4e3],Ea=[800,1800],Ta=t=>{document.prerendering?na(()=>Ta(t)):"complete"!==document.readyState?addEventListener("load",()=>Ta(t),!0):setTimeout(t)},Sa=["CLS","INP","LCP"],ya=["CLS","INP","LCP","FCP","TTFB"],ba={CLS:(t,e={})=>{const n=jo(e=Object.assign({},e),Mo),r=new WeakMap;n.t=t=>{var n;if(null==t||null==(n=t.sources)?void 0:n.length){const n=oa(t.sources);if(n){var s;const t=(null!=(s=e.generateTarget)?s:Fo)(n.node);r.set(n,t)}}},((t,e={})=>{sa(Ko(()=>{let n,r=qo("CLS",0);const s=jo(e,Mo),i=t=>{for(const e of t)s.u(e);s.o>r.value&&(r.value=s.o,r.entries=s.i,n())},o=Wo("layout-shift",i);o&&(n=Xo(t,r,ia,e.reportAllChanges),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(i(o.takeRecords()),n(!0))}),Go(()=>{s.o=0,r=qo("CLS",0),n=Xo(t,r,ia,e.reportAllChanges),zo(()=>n())}),setTimeout(n))}))})(e=>{const n=(t=>{let e={};if(t.entries.length){var n;const s=t.entries.reduce((t,e)=>t.value>e.value?t:e);if(null==s||null==(n=s.sources)?void 0:n.length){const t=oa(s.sources);t&&(e={largestShiftTarget:r.get(t),largestShiftTime:s.startTime,largestShiftValue:s.value,largestShiftSource:t,largestShiftEntry:s,loadState:Uo(s.startTime)})}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},FCP:(t,e={})=>{sa(e=>{const n=(t=>{let e={timeToFirstByte:0,firstByteToFCP:t.value,loadState:Uo(Vo())};if(t.entries.length){const n=Do(),r=t.entries.at(-1);if(n){const s=n.activationStart||0,i=Math.max(0,n.responseStart-s);e={timeToFirstByte:i,firstByteToFCP:t.value-i,loadState:Uo(t.entries[0].startTime),navigationEntry:n,fcpEntry:r}}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},LCP:(t,e={})=>{const n=jo(e=Object.assign({},e),ma),r=new WeakMap;n.m=t=>{if(t.element){var n;const s=(null!=(n=e.generateTarget)?n:Fo)(t.element);r.set(t,s)}},((t,e={})=>{na(()=>{const n=ea();let r,s=qo("LCP");const i=jo(e,ma),o=t=>{e.reportAllChanges||(t=t.slice(-1));for(const e of t)i.u(e),e.startTime<n.firstHiddenTime&&(s.value=Math.max(e.startTime-$o(),0),s.entries=[e],r())},a=Wo("largest-contentful-paint",o);if(a){r=Xo(t,s,va,e.reportAllChanges);const n=Ko(()=>{o(a.takeRecords()),a.disconnect(),r(!0)});for(const t of["keydown","click","visibilitychange"])addEventListener(t,()=>_a(n),{capture:!0,once:!0});Go(n=>{s=qo("LCP"),r=Xo(t,s,va,e.reportAllChanges),zo(()=>{s.value=performance.now()-n.timeStamp,r(!0)})})}})})(e=>{const n=(t=>{let e={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:t.value};if(t.entries.length){const n=Do();if(n){const s=n.activationStart||0,i=t.entries.at(-1),o=i.url&&performance.getEntriesByType("resource").filter(t=>t.name===i.url)[0],a=Math.max(0,n.responseStart-s),u=Math.max(a,o?(o.requestStart||o.startTime)-s:0),c=Math.min(t.value,Math.max(u,o?o.responseEnd-s:0));e={target:r.get(i),timeToFirstByte:a,resourceLoadDelay:u-a,resourceLoadDuration:c-u,elementRenderDelay:t.value-c,navigationEntry:n,lcpEntry:i},i.url&&(e.url=i.url),o&&(e.lcpResourceEntry=o)}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},INP:(t,e={})=>{const n=jo(e=Object.assign({},e),ga);let r=[],s=[],i=0;const o=new WeakMap,a=new WeakMap;let u=!1;const c=()=>{u||(_a(l),u=!0)},l=()=>{const t=n.l.map(t=>o.get(t.entries[0])),e=s.length-50;s=s.filter((n,r)=>r>=e||t.includes(n));const a=new Set;for(const t of s){const e=d(t.startTime,t.processingEnd);for(const t of e)a.add(t)}const c=r.length-1-50;r=r.filter((t,e)=>t.startTime>i&&e>c||a.has(t)),u=!1};n.m=t=>{const e=t.startTime+t.duration;let n;i=Math.max(i,t.processingEnd);for(let r=s.length-1;r>=0;r--){const i=s[r];if(Math.abs(e-i.renderTime)<=8){n=i,n.startTime=Math.min(t.startTime,n.startTime),n.processingStart=Math.min(t.processingStart,n.processingStart),n.processingEnd=Math.max(t.processingEnd,n.processingEnd),n.entries.push(t);break}}n||(n={startTime:t.startTime,processingStart:t.processingStart,processingEnd:t.processingEnd,renderTime:e,entries:[t]},s.push(n)),(t.interactionId||"first-input"===t.entryType)&&o.set(t,n),c()},n.p=t=>{if(!a.get(t)){var n;const r=(null!=(n=e.generateTarget)?n:Fo)(t.entries[0].target);a.set(t,r)}};const d=(t,e)=>{const n=[];for(const s of r)if(!(s.startTime+s.duration<t)){if(s.startTime>e)break;n.push(s)}return n},h=t=>{const e=t.entries[0],r=o.get(e),s=e.processingStart,i=Math.max(e.startTime+e.duration,s),u=Math.min(r.processingEnd,i),c=r.entries.sort((t,e)=>t.processingStart-e.processingStart),l=d(e.startTime,u),h=n.h.get(e.interactionId),p={interactionTarget:a.get(h),interactionType:e.name.startsWith("key")?"keyboard":"pointer",interactionTime:e.startTime,nextPaintTime:i,processedEventEntries:c,longAnimationFrameEntries:l,inputDelay:s-e.startTime,processingDuration:u-s,presentationDelay:i-u,loadState:Uo(e.startTime),longestScript:void 0,totalScriptDuration:void 0,totalStyleAndLayoutDuration:void 0,totalPaintDuration:void 0,totalUnattributedDuration:void 0};return(t=>{var e;if(!(null==(e=t.longAnimationFrameEntries)?void 0:e.length))return;const n=t.interactionTime,r=t.inputDelay,s=t.processingDuration;let i,o,a=0,u=0,c=0,l=0;for(const e of t.longAnimationFrameEntries){u=u+e.startTime+e.duration-e.styleAndLayoutStart;for(const t of e.scripts){const e=t.startTime+t.duration;if(e<n)continue;const c=e-Math.max(n,t.startTime),d=t.duration?c/t.duration*t.forcedStyleAndLayoutDuration:0;a+=c-d,u+=d,c>l&&(o=t.startTime<n+r?"input-delay":t.startTime>=n+r+s?"presentation-delay":"processing-duration",i=t,l=c)}}const d=t.longAnimationFrameEntries.at(-1),h=d?d.startTime+d.duration:0;h>=n+r+s&&(c=t.nextPaintTime-h),i&&o&&(t.longestScript={entry:i,subpart:o,intersectingDuration:l}),t.totalScriptDuration=a,t.totalStyleAndLayoutDuration=u,t.totalPaintDuration=c,t.totalUnattributedDuration=t.nextPaintTime-n-a-u-c})(p),Object.assign(t,{attribution:p})};Wo("long-animation-frame",t=>{r=r.concat(t),c()}),((t,e={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&na(()=>{"interactionCount"in performance||da||(da=Wo("event",la,{type:"event",buffered:!0,durationThreshold:0}));let n,r=qo("INP");var s;const i=jo(e,ga),o=t=>{_a(()=>{for(const e of t)i.u(e);const e=i.M();e&&e.T!==r.value&&(r.value=e.T,r.entries=e.entries,n())})},a=Wo("event",o,{durationThreshold:null!=(s=e.durationThreshold)?s:40});n=Xo(t,r,fa,e.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(o(a.takeRecords()),n(!0))}),Go(()=>{i.v(),r=qo("INP"),n=Xo(t,r,fa,e.reportAllChanges)}))})})(e=>{const n=h(e);t(n)},e)},TTFB:(t,e={})=>{((t,e={})=>{let n=qo("TTFB"),r=Xo(t,n,Ea,e.reportAllChanges);Ta(()=>{const s=Do();s&&(n.value=Math.max(s.responseStart-$o(),0),n.entries=[s],r(!0),Go(()=>{n=qo("TTFB",0),r=Xo(t,n,Ea,e.reportAllChanges),r(!0)}))})})(e=>{const n=(t=>{let e={waitingDuration:0,cacheDuration:0,dnsDuration:0,connectionDuration:0,requestDuration:0};if(t.entries.length){const n=t.entries[0],r=n.activationStart||0,s=Math.max((n.workerStart||n.fetchStart)-r,0),i=Math.max(n.domainLookupStart-r,0),o=Math.max(n.connectStart-r,0),a=Math.max(n.connectEnd-r,0);e={waitingDuration:s,cacheDuration:i-s,dnsDuration:o-i,connectionDuration:a-o,requestDuration:t.value-a,navigationEntry:n}}return Object.assign(t,{attribution:e})})(e);t(n)},e)},FID:void 0};function La(){return La=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},La.apply(this,arguments)}class Oa extends bo{disable(){}enable(){this._metricsToTrack.forEach(t=>{var e;null==(e=this._listeners[t])||e.call(this._listeners,e=>{const n=this.sessionManager.getSessionSpan();if(!n)return;const r=this._getTimeForMetric(e),s=La({[Pi]:ki.WebVital,[Ai]:this._getAttributedURLForMetric(e),"emb.web_vital.navigation_type":e.navigationType,"emb.web_vital.name":e.name,"emb.web_vital.rating":e.rating,"emb.web_vital.id":e.id,"emb.web_vital.delta":e.delta,"emb.web_vital.value":e.value},((t,e)=>{const n={},r=[];if("CLS"===t){const t=e.attribution;r.push({key:"largestShiftTarget",value:t.largestShiftTarget},{key:"largestShiftValue",value:t.largestShiftValue})}else if("INP"===t){const t=e.attribution;r.push({key:"interactionTarget",value:t.interactionTarget},{key:"interactionType",value:t.interactionType},{key:"nextPaintTime",value:t.nextPaintTime},{key:"inputDelay",value:t.inputDelay},{key:"processingDuration",value:t.processingDuration},{key:"presentationDelay",value:t.presentationDelay},{key:"totalScriptDuration",value:t.totalScriptDuration},{key:"totalStyleAndLayoutDuration",value:t.totalStyleAndLayoutDuration},{key:"totalPaintDuration",value:t.totalPaintDuration},{key:"totalUnattributedDuration",value:t.totalUnattributedDuration},{key:"loadState",value:t.loadState})}else if("LCP"===t){const t=e.attribution;r.push({key:"target",value:t.target},{key:"url",value:t.url},{key:"timeToFirstByte",value:t.timeToFirstByte},{key:"resourceLoadDelay",value:t.resourceLoadDelay},{key:"resourceLoadDuration",value:t.resourceLoadDuration},{key:"elementRenderDelay",value:t.elementRenderDelay})}return r.forEach(t=>{void 0!==t.value&&(n[`emb.web_vital.attribution.${t.key}`]=t.value)}),n})(t,e));n.addEvent(`emb-web-vitals-report-${t}`,s,r)})}),this._urlAttribution&&(null==this._listeners.INP||this._listeners.INP.call(this._listeners,()=>{this._attributedURL.INP=this._urlDocument.URL},{reportAllChanges:!0}),null==this._listeners.LCP||this._listeners.LCP.call(this._listeners,()=>{this._attributedURL.LCP=this._urlDocument.URL},{reportAllChanges:!0}),null==this._listeners.CLS||this._listeners.CLS.call(this._listeners,t=>{const e=t;this._largestShiftTargetForCLS!==e.attribution.largestShiftTarget&&(this._largestShiftTargetForCLS=e.attribution.largestShiftTarget,this._attributedURL.CLS=this._urlDocument.URL)},{reportAllChanges:!0}))}_getTimeForMetric(t){return"CLS"===t.name&&t.attribution.largestShiftTime?this.perf.epochMillisFromOriginOffset(t.attribution.largestShiftTime):"INP"===t.name&&t.attribution.interactionTime?this.perf.epochMillisFromOriginOffset(t.attribution.interactionTime):this.perf.getNowMillis()}_getAttributedURLForMetric(t){return"INP"===t.name&&this._attributedURL.INP?this._attributedURL.INP:"LCP"===t.name&&this._attributedURL.LCP?this._attributedURL.LCP:"CLS"===t.name&&this._attributedURL.CLS&&t.attribution.largestShiftTarget===this._largestShiftTargetForCLS?this._attributedURL.CLS:this._urlDocument.URL}constructor({diag:t,perf:e,trackingLevel:n="core",listeners:r=ba,urlDocument:s=window.document,urlAttribution:i=!1}={}){super({instrumentationName:"WebVitalsInstrumentation",instrumentationVersion:"1.0.0",diag:t,perf:e,config:{}}),this._attributedURL={INP:void 0,LCP:void 0,CLS:void 0,FCP:void 0,TTFB:void 0},this._listeners=r,this._urlDocument=s,this._metricsToTrack="core"===n?[...Sa]:[...ya],this._urlAttribution=i,this._config.enabled&&this.enable()}}var wa;!function(t){t.DOCUMENT_LOAD="documentLoad",t.DOCUMENT_FETCH="documentFetch",t.RESOURCE_FETCH="resourceFetch"}(wa||(wa={}));var Ra;!function(t){t.FIRST_PAINT="firstPaint",t.FIRST_CONTENTFUL_PAINT="firstContentfulPaint"}(Ra||(Ra={}));const Aa={"first-paint":Ra.FIRST_PAINT,"first-contentful-paint":Ra.FIRST_CONTENTFUL_PAINT};class Pa extends Pe{init(){}_onDocumentLoaded(){window.setTimeout(()=>{this._collectPerformance()})}_addResourcesSpans(t){var e,n;const r=null===(n=(e=fn).getEntriesByType)||void 0===n?void 0:n.call(e,"resource");r&&r.forEach(e=>{this._initResourceSpan(e,t)})}_collectPerformance(){const t=Array.from(document.getElementsByTagName("meta")).find(t=>t.getAttribute("name")===jn),e=(()=>{var t,e;const n={},r=null===(e=(t=fn).getEntriesByType)||void 0===e?void 0:e.call(t,"navigation")[0];if(r)Object.values(ts).forEach(t=>{if(is(r,t)){const e=r[t];"number"==typeof e&&(n[t]=e)}});else{const t=fn.timing;t&&Object.values(ts).forEach(e=>{if(is(t,e)){const r=t[e];"number"==typeof r&&(n[e]=r)}})}return n})(),n=t&&t.content||"";jt.with(te.extract(k,{traceparent:n}),()=>{var t;const n=this._startSpan(wa.DOCUMENT_LOAD,ts.FETCH_START,e);n&&(jt.with(re.setSpan(jt.active(),n),()=>{const t=this._startSpan(wa.DOCUMENT_FETCH,ts.FETCH_START,e);t&&(t.setAttribute(mi,location.href),jt.with(re.setSpan(jt.active(),t),()=>{var n;this.getConfig().ignoreNetworkEvents||as(t,e),this._addCustomAttributesOnSpan(t,null===(n=this.getConfig().applyCustomAttributesOnSpan)||void 0===n?void 0:n.documentFetch),this._endSpan(t,ts.RESPONSE_END,e)}))}),n.setAttribute(mi,location.href),n.setAttribute("http.user_agent",navigator.userAgent),this._addResourcesSpans(n),this.getConfig().ignoreNetworkEvents||(os(n,ts.FETCH_START,e),os(n,ts.UNLOAD_EVENT_START,e),os(n,ts.UNLOAD_EVENT_END,e),os(n,ts.DOM_INTERACTIVE,e),os(n,ts.DOM_CONTENT_LOADED_EVENT_START,e),os(n,ts.DOM_CONTENT_LOADED_EVENT_END,e),os(n,ts.DOM_COMPLETE,e),os(n,ts.LOAD_EVENT_START,e),os(n,ts.LOAD_EVENT_END,e)),this.getConfig().ignorePerformancePaintEvents||(t=>{var e,n;const r=null===(n=(e=fn).getEntriesByType)||void 0===n?void 0:n.call(e,"paint");r&&r.forEach(({name:e,startTime:n})=>{is(Aa,e)&&t.addEvent(Aa[e],n)})})(n),this._addCustomAttributesOnSpan(n,null===(t=this.getConfig().applyCustomAttributesOnSpan)||void 0===t?void 0:t.documentLoad),this._endSpan(n,ts.LOAD_EVENT_END,e))})}_endSpan(t,e,n){t&&(is(n,e)?t.end(n[e]):t.end())}_initResourceSpan(t,e){var n;const r=this._startSpan(wa.RESOURCE_FETCH,ts.FETCH_START,t,e);r&&(r.setAttribute(mi,t.name),this.getConfig().ignoreNetworkEvents||as(r,t),this._addCustomAttributesOnResourceSpan(r,t,null===(n=this.getConfig().applyCustomAttributesOnSpan)||void 0===n?void 0:n.resourceFetch),this._endSpan(r,ts.RESPONSE_END,t))}_startSpan(t,e,n,r){if(is(n,e)&&"number"==typeof n[e]){return this.tracer.startSpan(t,{startTime:n[e]},r?re.setSpan(jt.active(),r):void 0)}}_waitForPageLoad(){"complete"===window.document.readyState?this._onDocumentLoaded():(this._onDocumentLoaded=this._onDocumentLoaded.bind(this),window.addEventListener("load",this._onDocumentLoaded))}_addCustomAttributesOnSpan(t,e){e&&Ce(()=>e(t),t=>{t&&this._diag.error("addCustomAttributesOnSpan",t)})}_addCustomAttributesOnResourceSpan(t,e,n){n&&Ce(()=>n(t,e),t=>{t&&this._diag.error("addCustomAttributesOnResourceSpan",t)})}enable(){window.removeEventListener("load",this._onDocumentLoaded),this._waitForPageLoad()}disable(){window.removeEventListener("load",this._onDocumentLoaded)}constructor(t={}){super("@opentelemetry/instrumentation-document-load","0.44.1",t),this.component="document-load",this.version="1",this.moduleName=this.component}}var Ca;!function(t){t.COMPONENT="component",t.HTTP_ERROR_NAME="http.error_name",t.HTTP_STATUS_TEXT="http.status_text"}(Ca||(Ca={}));var Ia="http.method",Na="http.url";function xa(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}const Ma=Ht.createComponentLogger({namespace:"@opentelemetry/opentelemetry-instrumentation-fetch/utils"});function Da(...t){if(t[0]instanceof URL||"string"==typeof t[0]){const e=t[1];if(!(null==e?void 0:e.body))return Promise.resolve();if(e.body instanceof ReadableStream){const{body:t,length:n}=function(t){if(!t.pipeThrough)return Ma.warn("Platform has ReadableStream but not pipeThrough!"),{body:t,length:Promise.resolve(void 0)};let e,n=0;const r=new Promise(t=>{e=t}),s=new TransformStream({start(){},transform(t,e){return(r=function*(){const r=yield t;n+=r.byteLength,e.enqueue(t)},function(){var t=this,e=arguments;return new Promise(function(n,s){var i=r.apply(t,e);function o(t){xa(i,n,s,o,a,"next",t)}function a(t){xa(i,n,s,o,a,"throw",t)}o(void 0)})})();var r},flush(){e(n)}});return{body:t.pipeThrough(s),length:r}}(e.body);return e.body=t,n}return Promise.resolve(function(t){if("undefined"!=typeof Document&&t instanceof Document)return(new XMLSerializer).serializeToString(document).length;if(t instanceof Blob)return t.size;if(void 0!==t.byteLength)return t.byteLength;if(t instanceof FormData)return function(t){let e=0;for(const[n,r]of t.entries())e+=n.length,r instanceof Blob?e+=r.size:e+=r.length;return e}(t);if(t instanceof URLSearchParams)return ka(t.toString());if("string"==typeof t)return ka(t);return void Ma.warn("unknown body type")}(e.body))}{const e=t[0];return(null==e?void 0:e.body)?e.clone().text().then(t=>ka(t)):Promise.resolve()}}const Ua=new TextEncoder;function ka(t){return Ua.encode(t).byteLength}const Fa="0.57.2";var Ba;const ja="object"==typeof process&&"node"===(null===(Ba=process.release)||void 0===Ba?void 0:Ba.name);class Ha extends Pe{init(){}_addChildSpan(t,e){const n=this.tracer.startSpan("CORS Preflight",{startTime:e[ts.FETCH_START]},re.setSpan(jt.active(),t));as(n,e,this.getConfig().ignoreNetworkEvents),n.end(e[ts.RESPONSE_END])}_addFinalSpanAttributes(t,e){const n=ls(e.url);t.setAttribute("http.status_code",e.status),null!=e.statusText&&t.setAttribute(Ca.HTTP_STATUS_TEXT,e.statusText),t.setAttribute("http.host",n.host),t.setAttribute("http.scheme",n.protocol.replace(":","")),"undefined"!=typeof navigator&&t.setAttribute("http.user_agent",navigator.userAgent)}_addHeaders(t,e){if(!ds(e,this.getConfig().propagateTraceHeaderCorsUrls)){const t={};return te.inject(jt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}if(t instanceof Request)te.inject(jt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else if(t.headers instanceof Headers)te.inject(jt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else if(t.headers instanceof Map)te.inject(jt.active(),t.headers,{set:(t,e,n)=>t.set(e,"string"==typeof n?n:String(n))});else{const e={};te.inject(jt.active(),e),t.headers=Object.assign({},e,t.headers||{})}}_clearResources(){0===this._tasksCount&&this.getConfig().clearTimingResources&&(performance.clearResourceTimings(),this._usedResources=new WeakSet)}_createSpan(t,e={}){if(pr(t,this.getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const n=(e.method||"GET").toUpperCase(),r=`HTTP ${n}`;return this.tracer.startSpan(r,{kind:Mt.CLIENT,attributes:{[Ca.COMPONENT]:this.moduleName,[Ia]:n,[Na]:t}})}_findResourceAndAddNetworkEvents(t,e,n){let r=e.entries;if(!r.length){if(!performance.getEntriesByType)return;r=performance.getEntriesByType("resource")}const s=cs(e.spanUrl,e.startTime,n,r,this._usedResources,"fetch");if(s.mainRequest){const e=s.mainRequest;this._markResourceAsUsed(e);const n=s.corsPreFlightRequest;n&&(this._addChildSpan(t,n),this._markResourceAsUsed(n)),as(t,e,this.getConfig().ignoreNetworkEvents)}}_markResourceAsUsed(t){this._usedResources.add(t)}_endSpan(t,e,n){const r=Ln(Date.now()),s=wn();this._addFinalSpanAttributes(t,n),setTimeout(()=>{var n;null===(n=e.observer)||void 0===n||n.disconnect(),this._findResourceAndAddNetworkEvents(t,e,s),this._tasksCount--,this._clearResources(),t.end(r)},300)}_patchConstructor(){return t=>{const e=this;return function(...n){const r=this,s=ls(n[0]instanceof Request?n[0].url:String(n[0])).href,i=n[0]instanceof Request?n[0]:n[1]||{},o=e._createSpan(s,i);if(!o)return t.apply(this,n);const a=e._prepareSpanData(s);function u(t,n){e._applyAttributesAfterFetch(t,i,n),e._endSpan(t,a,{status:n.status||0,statusText:n.message,url:s})}function c(t,n){e._applyAttributesAfterFetch(t,i,n),n.status>=200&&n.status<400?e._endSpan(t,a,n):e._endSpan(t,a,{status:n.status,statusText:n.statusText,url:s})}function l(t,e,n){try{const e=n.clone(),r=n.clone(),s=e.body;if(s){const e=s.getReader(),n=()=>{e.read().then(({done:e})=>{e?c(t,r):n()},e=>{u(t,e)})};n()}else c(t,n)}finally{e(n)}}function d(t,e,n){try{u(t,n)}finally{e(n)}}return e.getConfig().measureRequestSize&&Da(...n).then(t=>{t&&o.setAttribute("http.request_content_length_uncompressed",t)}).catch(t=>{e._diag.warn("getFetchBodyLength",t)}),new Promise((n,a)=>jt.with(re.setSpan(jt.active(),o),()=>(e._addHeaders(i,s),e._tasksCount++,t.apply(r,i instanceof Request?[i]:[s,i]).then(l.bind(r,o,n),d.bind(r,o,a)))))}}}_applyAttributesAfterFetch(t,e,n){const r=this.getConfig().applyCustomAttributesOnSpan;r&&Ce(()=>r(t,e,n),t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)})}_prepareSpanData(t){const e=wn(),n=[];if("function"!=typeof PerformanceObserver)return{entries:n,startTime:e,spanUrl:t};const r=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"fetch"===e.initiatorType&&e.name===t&&n.push(e)})});return r.observe({entryTypes:["resource"]}),{entries:n,observer:r,startTime:e,spanUrl:t}}enable(){ja?this._diag.warn("this instrumentation is intended for web usage only, it does not instrument Node.js's fetch()"):(Ie(fetch)&&(this._unwrap(dn,"fetch"),this._diag.debug("removing previous patch for constructor")),this._wrap(dn,"fetch",this._patchConstructor()))}disable(){ja||(this._unwrap(dn,"fetch"),this._usedResources=new WeakSet)}constructor(t={}){super("@opentelemetry/instrumentation-fetch",Fa,t),this.component="fetch",this.version=Fa,this.moduleName=this.component,this._usedResources=new WeakSet,this._tasksCount=0}}var Va,Ga="http.method",Xa="http.url";!function(t){t.METHOD_OPEN="open",t.METHOD_SEND="send",t.EVENT_ABORT="abort",t.EVENT_ERROR="error",t.EVENT_LOAD="loaded",t.EVENT_TIMEOUT="timeout"}(Va||(Va={}));const za=Ht.createComponentLogger({namespace:"@opentelemetry/opentelemetry-instrumentation-xml-http-request/utils"});function $a(t){return"undefined"!=typeof Document&&t instanceof Document?(new XMLSerializer).serializeToString(document).length:t instanceof Blob?t.size:void 0!==t.byteLength?t.byteLength:t instanceof FormData?function(t){let e=0;for(const[n,r]of t.entries())e+=n.length,r instanceof Blob?e+=r.size:e+=r.length;return e}(t):t instanceof URLSearchParams?Wa(t.toString()):"string"==typeof t?Wa(t):void za.warn("unknown body type")}const qa=new TextEncoder;function Wa(t){return qa.encode(t).byteLength}const Ka="0.57.2";var Qa;!function(t){t.HTTP_STATUS_TEXT="http.status_text"}(Qa||(Qa={}));class Ya extends Pe{init(){}_addHeaders(t,e){if(!ds(ls(e).href,this.getConfig().propagateTraceHeaderCorsUrls)){const t={};return te.inject(jt.active(),t),void(Object.keys(t).length>0&&this._diag.debug("headers inject skipped due to CORS policy"))}const n={};te.inject(jt.active(),n),Object.keys(n).forEach(e=>{t.setRequestHeader(e,String(n[e]))})}_addChildSpan(t,e){jt.with(re.setSpan(jt.active(),t),()=>{const t=this.tracer.startSpan("CORS Preflight",{startTime:e[ts.FETCH_START]});as(t,e,this.getConfig().ignoreNetworkEvents),t.end(e[ts.RESPONSE_END])})}_addFinalSpanAttributes(t,e,n){if("string"==typeof n){const r=ls(n);void 0!==e.status&&t.setAttribute("http.status_code",e.status),void 0!==e.statusText&&t.setAttribute(Qa.HTTP_STATUS_TEXT,e.statusText),t.setAttribute("http.host",r.host),t.setAttribute("http.scheme",r.protocol.replace(":","")),t.setAttribute("http.user_agent",navigator.userAgent)}}_applyAttributesAfterXHR(t,e){const n=this.getConfig().applyCustomAttributesOnSpan;"function"==typeof n&&Ce(()=>n(t,e),t=>{t&&this._diag.error("applyCustomAttributesOnSpan",t)})}_addResourceObserver(t,e){const n=this._xhrMem.get(t);n&&"function"==typeof PerformanceObserver&&"function"==typeof PerformanceResourceTiming&&(n.createdResources={observer:new PerformanceObserver(t=>{const r=t.getEntries(),s=ls(e);r.forEach(t=>{"xmlhttprequest"===t.initiatorType&&t.name===s.href&&n.createdResources&&n.createdResources.entries.push(t)})}),entries:[]},n.createdResources.observer.observe({entryTypes:["resource"]}))}_clearResources(){0===this._tasksCount&&this.getConfig().clearTimingResources&&(fn.clearResourceTimings(),this._xhrMem=new WeakMap,this._usedResources=new WeakSet)}_findResourceAndAddNetworkEvents(t,e,n,r,s){if(!(n&&r&&s&&t.createdResources))return;let i=t.createdResources.entries;i&&i.length||(i=fn.getEntriesByType("resource"));const o=cs(ls(n).href,r,s,i,this._usedResources);if(o.mainRequest){const t=o.mainRequest;this._markResourceAsUsed(t);const n=o.corsPreFlightRequest;n&&(this._addChildSpan(e,n),this._markResourceAsUsed(n)),as(e,t,this.getConfig().ignoreNetworkEvents)}}_cleanPreviousSpanInformation(t){const e=this._xhrMem.get(t);if(e){const n=e.callbackToRemoveEvents;n&&n(),this._xhrMem.delete(t)}}_createSpan(t,e,n){if(pr(e,this.getConfig().ignoreUrls))return void this._diag.debug("ignoring span as url matches ignored url");const r=n.toUpperCase(),s=this.tracer.startSpan(r,{kind:Mt.CLIENT,attributes:{[Ga]:n,[Xa]:ls(e).toString()}});return s.addEvent(Va.METHOD_OPEN),this._cleanPreviousSpanInformation(t),this._xhrMem.set(t,{span:s,spanUrl:e}),s}_markResourceAsUsed(t){this._usedResources.add(t)}_patchOpen(){return t=>{const e=this;return function(...n){const r=n[0],s=n[1];return e._createSpan(this,s,r),t.apply(this,n)}}}_patchSend(){const t=this;function e(e,n){const r=t._xhrMem.get(n);if(!r)return;r.status=n.status,r.statusText=n.statusText,t._xhrMem.delete(n),r.span&&t._applyAttributesAfterXHR(r.span,n);const s=wn(),i=Date.now();setTimeout(()=>{!function(e,n,r,s){const i=n.callbackToRemoveEvents;"function"==typeof i&&i();const{span:o,spanUrl:a,sendStartTime:u}=n;o&&(t._findResourceAndAddNetworkEvents(n,o,a,u,r),o.addEvent(e,s),t._addFinalSpanAttributes(o,n,a),o.end(s),t._tasksCount--),t._clearResources()}(e,r,s,i)},300)}function n(){e(Va.EVENT_ERROR,this)}function r(){e(Va.EVENT_ABORT,this)}function s(){e(Va.EVENT_TIMEOUT,this)}function i(){this.status<299?e(Va.EVENT_LOAD,this):e(Va.EVENT_ERROR,this)}return e=>function(...o){const a=t._xhrMem.get(this);if(!a)return e.apply(this,o);const u=a.span,c=a.spanUrl;if(u&&c){if(t.getConfig().measureRequestSize&&(null==o?void 0:o[0])){const t=$a(o[0]);void 0!==t&&u.setAttribute("http.request_content_length_uncompressed",t)}jt.with(re.setSpan(jt.active(),u),()=>{t._tasksCount++,a.sendStartTime=wn(),u.addEvent(Va.METHOD_SEND),this.addEventListener("abort",r),this.addEventListener("error",n),this.addEventListener("load",i),this.addEventListener("timeout",s),a.callbackToRemoveEvents=()=>{!function(e){e.removeEventListener("abort",r),e.removeEventListener("error",n),e.removeEventListener("load",i),e.removeEventListener("timeout",s);const o=t._xhrMem.get(e);o&&(o.callbackToRemoveEvents=void 0)}(this),a.createdResources&&a.createdResources.observer.disconnect()},t._addHeaders(this,c),t._addResourceObserver(this,c)})}return e.apply(this,o)}}enable(){this._diag.debug("applying patch to",this.moduleName,this.version),Ie(XMLHttpRequest.prototype.open)&&(this._unwrap(XMLHttpRequest.prototype,"open"),this._diag.debug("removing previous patch from method open")),Ie(XMLHttpRequest.prototype.send)&&(this._unwrap(XMLHttpRequest.prototype,"send"),this._diag.debug("removing previous patch from method send")),this._wrap(XMLHttpRequest.prototype,"open",this._patchOpen()),this._wrap(XMLHttpRequest.prototype,"send",this._patchSend())}disable(){this._diag.debug("removing patch from",this.moduleName,this.version),this._unwrap(XMLHttpRequest.prototype,"open"),this._unwrap(XMLHttpRequest.prototype,"send"),this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}constructor(t={}){super("@opentelemetry/instrumentation-xml-http-request",Ka,t),this.component="xml-http-request",this.version=Ka,this.moduleName=this.component,this._tasksCount=0,this._xhrMem=new WeakMap,this._usedResources=new WeakSet}}const Za=(t={})=>{var e,n,r,s,i,o;const a=[new Ro(t["session-on-load"]),new Lo(t["session-visibility"]),new wo(t["session-activity"]),new Po(t["session-timeout"])];return(null==(e=t.omit)?void 0:e.has("exception"))||a.push(new Co(t.exception)),(null==(n=t.omit)?void 0:n.has("click"))||a.push(new No(t.click)),(null==(r=t.omit)?void 0:r.has("web-vital"))||a.push(new Oa(t["web-vital"])),(null==(s=t.omit)?void 0:s.has("@opentelemetry/instrumentation-document-load"))||a.push(new Pa(t["@opentelemetry/instrumentation-document-load"])),(null==(i=t.omit)?void 0:i.has("@opentelemetry/instrumentation-fetch"))||a.push(new Ha(t["@opentelemetry/instrumentation-fetch"])),(null==(o=t.omit)?void 0:o.has("@opentelemetry/instrumentation-xml-http-request"))||a.push(new Ya(t["@opentelemetry/instrumentation-xml-http-request"])),a};function Ja(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}function tu(t){return function(){var e=this,n=arguments;return new Promise(function(r,s){var i=t.apply(e,n);function o(t){Ja(i,r,s,o,a,"next",t)}function a(t){Ja(i,r,s,o,a,"throw",t)}o(void 0)})}}class eu{forceFlush(){return tu(function*(){})()}onStart(t,e){var n;const r=null===(n=this._sessionIdProvider)||void 0===n?void 0:n.getSessionId();r&&t.setAttribute("session.id",r)}onEnd(t){}shutdown(){return tu(function*(){})()}constructor(t){this._sessionIdProvider=t}}const nu=new class{constructor({diagLogger:t=Ht.createComponentLogger({namespace:"embrace-registry"})}={}){this._sdk=null,this.register=t=>{null!==this._sdk&&this._diag.warn("previously registered sdk will be overwritten"),this._sdk=t},this.clear=()=>{null===this._sdk&&this._diag.warn("sdk already cleared, this is a no-op"),this._sdk=null},this.registered=()=>this._sdk,this._diag=t}};function ru(t,e,n,r,s,i,o){try{var a=t[i](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,s)}const su=()=>{const t=new Ji;return pe.setGlobalUserManager(t),t},iu=()=>{const t=new zi;return u.setGlobalSessionManager(t),t},ou=({sendingToEmbrace:t,appID:e,enduserPseudoID:n,resource:r,spanSessionManager:s,userManager:i,spanExporters:o,spanProcessors:a=[],propagator:u=null,contextManager:c=null})=>{const l=new Ki;ue.setGlobalTraceManager(l);const d=[...a,(h=s,new eu(h)),new io,new uo({userManager:i})];var h;null==o||o.forEach(t=>{d.push(new $r(t))}),t&&e&&n&&d.push(new no({exporter:new Bs({appID:e,userID:n})}));const p=new rs({resource:r,spanProcessors:d});return p.register({contextManager:c,propagator:u}),p},au=({sendingToEmbrace:t,appID:e,enduserPseudoID:n,resource:r,userManager:i,logExporters:o,logProcessors:a,spanSessionManager:u})=>{const c=new ji({spanSessionManager:u});s.setGlobalLogManager(c);const l=new Pr({resource:r}),d=[...a,new ro({spanSessionManager:u}),new oo,new ao({userManager:i})];null==o||o.forEach(t=>{d.push(new Nr(t))}),t&&e&&n&&d.push(new Nr(new Ms({appID:e,userID:n})));for(const t of d)l.addLogRecordProcessor(t);return Le.setGlobalLoggerProvider(l),l};var uu=Object.freeze({__proto__:null,get DiagLogLevel(){return E},initSDK:({appID:t,appVersion:e,templateBundleID:n,resource:r=vr.empty(),spanExporters:s=[],logExporters:i=[],spanProcessors:o=[],propagator:a=null,defaultInstrumentationConfig:u,instrumentations:c=[],contextManager:l=null,logProcessors:d=[],logLevel:h=E.ERROR,diagLogger:p=Ht.createComponentLogger({namespace:"embrace-sdk"})}={appID:""})=>{try{const g=nu.registered();if(null!==g)return p.warn("SDK has already been successfully initialized, skipping this invocation of initSDK"),g;if(Ht.setLogger(new B,{logLevel:h}),n&&32!==n.length)throw new Error("templateBundleID should be 32 characters long");const _=r.merge((({diagLogger:t,appVersion:e,templateBundleID:n,pageSessionStorage:r})=>{const s=null!=e?e:"EmbIOAppVersionX.X.X".trim();let i=new vr({[Li]:vo,[wi]:vo,app_version:s,app_framework:1,bundle_id:null!=n?n:"EmbIOBundleIDfd6996f1007b363f87a",sdk_version:mo,[Ri]:mo,sdk_simple_version:1,sdk_platform:"web",[Oi]:"webjs",[Ui]:To(r,t)});const o=Tr({detectors:[fo]});return i=i.merge(o),i})({diagLogger:p,appVersion:e,templateBundleID:n,pageSessionStorage:window.sessionStorage})),f=!!t&&(t=>{if(void 0===t)throw new Error("appID is required when using Embrace exporter");if(5!==t.length)throw new Error("appID should be 5 characters long");return!0})(t);if(!f&&!i.length&&!s.length)throw new Error("when the embrace appID is omitted then at least one logExporter or spanExporter must be set");const m=su(),v=m.getEmbraceUserId();if(f&&!v)throw new Error("userID is required when using Embrace exporter");const E=iu(),T=ou({sendingToEmbrace:f,appID:t,enduserPseudoID:v,resource:_,spanSessionManager:E,userManager:m,spanExporters:s,spanProcessors:o,propagator:a,contextManager:l}),S=au({sendingToEmbrace:f,appID:t,enduserPseudoID:v,resource:_,userManager:m,logExporters:i,logProcessors:d,spanSessionManager:E});!function(t){var e,n;const r=t.tracerProvider||re.getTracerProvider(),s=t.meterProvider||Xt.getMeterProvider(),i=t.loggerProvider||Le.getLoggerProvider(),o=null!==(n=null===(e=t.instrumentations)||void 0===e?void 0:e.flat())&&void 0!==n?n:[];(function(t,e,n,r){for(let s=0,i=t.length;s<i;s++){const i=t[s];e&&i.setTracerProvider(e),n&&i.setMeterProvider(n),r&&i.setLoggerProvider&&i.setLoggerProvider(r),i.getConfig().enabled||i.enable()}})(o,r,s,i)}({instrumentations:[...c,Za(u)]}),p.info("successfully initialized the SDK");const y={flush:()=>{return(t=function*(){yield T.forceFlush(),yield S.forceFlush()},function(){var e=this,n=arguments;return new Promise(function(r,s){var i=t.apply(e,n);function o(t){ru(i,r,s,o,a,"next",t)}function a(t){ru(i,r,s,o,a,"throw",t)}o(void 0)})})();var t}};return nu.register(y),y}catch(t){const e=t instanceof Error?t.message:"Unknown error.";return p.error(`failed to initialize the SDK: ${e}`),!1}}});return t.log=s,t.sdk=uu,t.session=u,t.trace=ue,t.user=pe,t}({});
//# sourceMappingURL=bundle.js.map
